var App=Backbone.View.extend({initialize:function(){"undefined"==typeof window.pmWindowsOpen&&(window.pmWindowsOpen=0);var a=this.model.get("variableProcessor"),b=this.model.get("globals");this.on("modalClose",this.onModalClose,this),this.on("modalOpen",this.onModalOpen,this),a.on("change:selectedEnv",this.renderContextMenu,this),b.on("change",this.renderContextMenu,this);var c=this;c.menuIdPrefix=guid(),c.contextMenuIds={},setTimeout(function(){$('a[rel="tooltip"]').tooltip()},500),$('input[rel="popover"]').popover(),$(".html-source-pane").css("height",window.innerHeight-300+"px");var d;$(window).on("resize",function(){clearTimeout(d),d=setTimeout(function(){c.setLayout()},500),$(".html-source-pane").css("height",window.innerHeight-300+"px")}),$("body").on("keydown","textarea",function(a){c.isModalOpen()||27===a.keyCode&&$(a.target).blur()}),$("body").on("keydown","select",function(a){27===a.keyCode&&$(a.target).blur()}),$(document).bind("keydown","esc",function(){if(c.isModalOpen()){pm.tracker.trackEvent("interaction","shortcut","hide_modal");var a=c.model.get("activeModal");if("#modal-eula-notif"==a)return;""!==a&&$(a).modal("hide")}});var e=pm.settings.getSetting("haveDonated");e?$("#donate-link").css("display","none"):$("#donate-link").css("display","inline");var f=pm.settings.getSetting("instantModals");f&&$(".fade").removeClass("fade").addClass("fade_disable"),pm.mediator.on("donatedStatusChanged",function(a){a?$("#donate-link").css("display","none"):$("#donate-link").css("display","inline")}),pm.mediator.on("notifySuccess",function(a){noty({type:"success",text:a,layout:"topCenter",timeout:750})}),pm.mediator.on("notifyError",function(a){noty({type:"error",text:a,layout:"topCenter",timeout:750})}),pm.mediator.on("error",function(){noty({type:"error",text:"Something went wrong.",layout:"topCenter",timeout:750})}),pm.mediator.on("openModuleSection",this.openModuleSection,this),pm.mediator.on("openModule",this.openModule,this),this.renderContextMenu(),this.setLayout(),pm.mediator.on("sidebarResize",this.positionSearchPanel,this),setTimeout(function(){pm.envManager.get("globals").trigger("change")},1e3)},createOrUpdateContextMenuItem:function(a,b,c){var d=this,e=d.contextMenuIds,f={title:b,contexts:["selection"]};e[a]?a=chrome.contextMenus.update(a,f):(f.id=a,c&&(f.parentId=c),a=chrome.contextMenus.create(f),e[a]=!0)},createEnvironmentContextMenu:function(a){var b,c,d,e,f,g=this;if(a){if(d=g.menuIdPrefix+"/postman_current_environment",this.createOrUpdateContextMenuItem(d,"Set: "+a.get("name"),!1),f=a.get("values"),!f)return void a.set("values",[]);for(c=f.length,b=0;c>b;b++)e=f[b],d=g.menuIdPrefix+"/environment/"+e.key,this.createOrUpdateContextMenuItem(d,e.key,g.menuIdPrefix+"/postman_current_environment")}},createGlobalsContextMenu:function(a){var b,c,d,e,f,g=this;if(a){if(d=g.menuIdPrefix+"/postman_globals",this.createOrUpdateContextMenuItem(d,"Set: Globals",!1),f=a.get("globals"),!f)return void a.set("globals",[]);for(c=f.length,b=0;c>b;b++)e=f[b],d=g.menuIdPrefix+"/globals/"+e.key,this.createOrUpdateContextMenuItem(d,e.key,g.menuIdPrefix+"/postman_globals")}},createEncodingContextMenu:function(){var a=this,b=a.menuIdPrefix+"/encodeURI";this.createOrUpdateContextMenuItem(b,"EncodeURIComponent",!1),b=a.menuIdPrefix+"/decodeURI",this.createOrUpdateContextMenuItem(b,"DecodeURIComponent",!1)},createContextMenu:function(a,b){this.createEnvironmentContextMenu(a),this.createGlobalsContextMenu(b),this.createEncodingContextMenu()},renderContextMenu:function(){var a=this.model.get("variableProcessor"),b=this.model.get("globals"),c=a.get("selectedEnv"),d=this;chrome.contextMenus.removeAll(function(){d.contextMenuIds={},_.bind(d.createContextMenu,d)(c,b)}),chrome.contextMenus.onClicked.addListener(function(a,b){if(document.hasFocus()){var c=a.menuItemId.split("/"),e=c[1],f=c[2];"encodeURI"===e?_.bind(d.userEncodeUri,d)(a,b):"decodeURI"===e?_.bind(d.userDecodeUri,d)(a,b):_.bind(d.updateVariableFromContextMenu,d)(e,f,a.selectionText)}})},userEncodeUri:function(){var a=document.activeElement,b=a.selectionStart,c=a.selectionEnd,d=a.value,e=d.substring(0,b)+encodeURIComponent(d.substring(b,c))+d.substring(c,d.length);a.value=e},userDecodeUri:function(){var a=document.activeElement,b=a.selectionStart,c=a.selectionEnd,d=a.value,e=d.substring(0,b)+decodeURIComponent(d.substring(b,c))+d.substring(c,d.length);a.value=e},updateEnvironmentVariableFromContextMenu:function(a,b){var c=this.model.get("variableProcessor"),d=this.model.get("environments"),e=c.get("selectedEnv");if(e){for(var f=_.clone(e.get("values")),g=f.length,h=0;g>h;h++)if(value=f[h],value.key===a){value.value=b;break}var i=e.get("id"),j=e.get("name");d.updateEnvironment(i,j,f)}},updateGlobalVariableFromContextMenu:function(a,b){for(var c,d=(this.model.get("variableProcessor"),this.model.get("globals")),e=_.clone(d.get("globals")),f=e.length,g=0;f>g;g++)if(c=e[g],c.key===a){c.value=b;break}d.saveGlobals(e),d.trigger("change:globals")},updateVariableFromContextMenu:function(a,b,c){"globals"===a?this.updateGlobalVariableFromContextMenu(b,c):"environment"===a&&this.updateEnvironmentVariableFromContextMenu(b,c)},onModalOpen:function(a){this.model.set("activeModal",a),this.model.set("isModalOpen",!0)},onModalClose:function(){$("#url").focus(),this.model.set("activeModal",null),this.model.set("isModalOpen",!1),$(".tooltip").remove()},isModalOpen:function(){return this.model.get("isModalOpen")},setLayout:function(){this.refreshScrollPanes()},refreshScrollPanes:function(){var a=$(document).height(),b=a-55;$("#main").height(b+"px");var c=$("#container").width()-$("#sidebar").width()-10;$("#main").width(c+"px"),pm.mediator.trigger("refreshLayout"),pm.mediator.trigger("refreshPrscriptLayout"),$("#directory-browser").height(b+"px");var d=$("div#main.content").css("width");d=parseInt(d.substring(0,d.length-2)),this.positionSearchPanel(),$(".xv-source-pane-inner").css("height",a-331+"px"),$(".xv-outline").css("height",a-301+"px"),$("#response-as-code>.CodeMirror").css("height",a-295+"px")},positionSearchPanel:function(a){var b=a&&a.hasOwnProperty("sidebarOuterWidth")?a.sidebarOuterWidth:$("#sidebar").width()+$("#sidebar-toggle").width();$(".search-panel").css({width:$("#container").width()+"px",paddingLeft:b+15+"px"}),$(".search-field").css({width:$("#main").width()+"px"})},openModuleSection:function(a){"requester"===a&&($("#add-ons").css("display","block"),$("#back-to-requester-container").css("display","none"),$("#main-container").css("display","block"),$("#directory-browser").css("display","none"),$("#team-directory-browser").css("display","none"),pm.mediator.trigger("showSidebar"))},openModule:function(a){"requester"===a?this.openRequester():"directory"===a?($("#add-ons").css("display","none"),$("#back-to-requester-container").css("display","block"),$("#main-container").css("display","none"),$("#team-directory-browser").css("display","block"),$("#directory-browser").css("display","block"),pm.mediator.trigger("hideSidebar")):"test_runner"===a?pm.purchases.isUpgradeAvailable("collection-runner")?(this.openTestRunner(),tracker.sendEvent("test_runner","collection_runner","new_window")):(tracker.sendEvent("test_runner","collection_runner","purchase"),pm.mediator.trigger("startPurchaseFlow","test_runner")):"teamDirectory"===a&&($("#add-ons").css("display","none"),$("#back-to-requester-container").css("display","block"),$("#main-container").css("display","none"),$("#directory-browser").css("display","none"),$("#team-directory-browser").css("display","block"),pm.mediator.trigger("hideSidebar"))},startPurchase:function(){pm.mediator.trigger("startPurchaseFlow")},openRequester:function(){window.pmWindowsOpen++,chrome.app.window.create("requester.html",{bounds:{top:60,left:60,width:1e3,height:800}},function(a){a.pmWindowsOpen=window.pmWindowsOpen,a.onClosed.addListener(function(){})})},openTestRunner:function(){window.pmWindowsOpen++,chrome.app.window.create("test_runner.html",{bounds:{top:130,left:130,width:1e3,height:800}},function(a){a.onClosed.addListener(function(){})})}}),FEATURES={USER:"user",DIRECTORY:"directory",DRIVE_SYNC:"drive_sync",TESTER:"tester"},Features=Backbone.Model.extend({defaults:function(){var a={};return a[FEATURES.USER]=!0,a[FEATURES.DIRECTORY]=!0,a[FEATURES.DRIVE_SYNC]=!1,a[FEATURES.TESTER]=!0,a},isFeatureEnabled:function(a){return this.get(a)}}),Header=Backbone.View.extend({initialize:function(){{var a=pm.settings.getSetting("haveDonated"),b=this;new InterceptorStatus({model:{}})}a?$("#donate-link").css("display","none"):$("#donate-link").css("display","inline-block");var c=pm.settings.getSetting("instantModals");c&&$(".fade").removeClass("fade").addClass("fade_disable"),pm.mediator.on("donatedStatusChanged",function(a){a?$("#donate-link").css("display","none"):$("#donate-link").css("display","inline-block")}),$("#add-on-directory").on("click",function(){pm.mediator.trigger("openModule","directory"),pm.mediator.trigger("initializeDirectory"),pm.tracker.trackEvent("collection","list","api_directory")}),$("#add-on-team-directory").on("click",function(){pm.mediator.trigger("openModule","teamDirectory"),pm.mediator.trigger("initializeTeamDirectory")}),$("#add-on-test-runner").on("click",function(){pm.mediator.trigger("openModule","test_runner")}),$("#logo a").on("click",function(){pm.mediator.trigger("openModule","requester")}),$("#back-to-request").on("click",function(){pm.mediator.trigger("openModuleSection","requester")}),$('a[data-toggle="popover"]').popover({animation:!0,placement:"bottom",trigger:"hover"}),$("#twitter-profile").on("click",function(){tracker.sendEvent("social","profileview","twitter")}),$("#postman-docs").on("click",function(){tracker.sendEvent("docs","view")}),$("#toggle-import-bar").on("click",function(){$("#modal-importer").modal("show")}),pm.mediator.on("loadedPurchases",function(a){b.updateJetpacksTrialStatus(a)}),pm.mediator.on("showEnableSyncButton",function(){b.showEnableSyncButton()}),this.showEnableSyncButton(),$("#enable-sync").on("click",function(){pm.mediator.trigger("showSyncInvitePopup"),pm.tracker.forceTrackEvent("sync","view","click_modal")}),this.render()},showEnableSyncButton:function(){var a=pm.settings.getSetting("enableSync"),b=pm.settings.getSetting("syncInviteShown");b&&!a?$("#sync-enable").show():$("#sync-enable").hide(),a?$("#sync-status").show():$("#sync-status").hide()},createSupporterPopover:function(){var a="<div class='supporters'><div class='supporter clearfix'>";a+="<div class='supporter-image supporter-image-mashape'>",a+="<a href='http://www.getpostman.com/r?url=https://www.mashape.com/?utm_source=chrome%26utm_medium=app%26utm_campaign=postman' target='_blank'>",a+="<img src='img/supporters/mashape.png'/></a></div>",a+="<div class='supporter-tag'>Consume or provide cloud services with the Mashape API Platform</div></div>",a+="<div class='supporter clearfix'>",a+="<div class='supporter-image supporter-image-mashape'>",a+="<a href='http://www.getpostman.com/r?url=http://restlet.com/?utm_source=POSTMAN' target='_blank'>",a+="<img src='img/supporters/restlet-new.png'/></a></div>",a+="<div class='supporter-tag'>The all-in-one platform for web APIs</div></div>",a+="<div class='supporter clearfix'>",a+="<div class='supporter-image supporter-image-datalogics'>",a+="<a href='http://www.getpostman.com/r?url=http://www.datalogics.com//?utm_source=POSTMAN' target='_blank'>",a+="<img src='img/supporters/datalogics.png'/></a></div>",a+="<div class='supporter-tag'>Adobe eBook and PDF technologies for developers</div></div>";var b;$("#donate-link").popover({animation:!1,content:a,placement:"bottom",trigger:"manual",html:!0,title:"Postman is supported by amazing companies"}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(a).popover("hide")}),b=setTimeout(function(){tracker.sendEvent("sponsors","view")},1e3)}).on("mouseleave",function(){var a=this;clearTimeout(b),setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},100)})},updateJetpacksTrialStatus:function(a){var b=a.get("collection-runner");if(b)if(b.isPurchased())$("#header-trial-status").css("display","none");else if(b.isTrialValid()){var c=b.getDaysLeft();$("#header-trial-status").css("display","block"),$("#header-trial-status").html("Upgrade ("+c+" days left)")}else b.isTrialCompleted()?($("#header-trial-status").css("display","block"),$("#header-trial-status").attr("data-content","Your trial period has expired"),$("#header-trial-status").html("Upgrade")):$("#header-trial-status").css("display","none")},render:function(){this.createSupporterPopover(),pm.features.isFeatureEnabled(FEATURES.DIRECTORY)&&$("#add-ons").css("display","block")}}),pm={};pm.targets={CHROME_LEGACY_APP:0,CHROME_PACKAGED_APP:1},pm.target=pm.targets.CHROME_PACKAGED_APP,pm.isTesting=postman_flag_is_testing,pm.databaseName=postman_database_name,pm.webUrl=postman_web_url,pm.features=new Features,pm.debug=!1,pm.arePurchasesInBeta="false",pm.syncSocket=null,pm.syncManager=null,pm.syncQueue=[],pm.environments=null,pm.globals=null,pm.indexedDB={},pm.indexedDB.db=null,pm.indexedDB.modes={readwrite:"readwrite",readonly:"readonly"},pm.globalPrScriptNotif=null,pm.fs={},pm.gaClientId="",pm.hasPostmanInitialized=!1,pm.bannedHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB,IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,IDBCursor=window.IDBCursor||window.webkitIDBCursor;window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,pm.init=function(){function a(){new TestPurchaser({model:{}});pm.purchases=new Purchases}function b(){new Tester,new PreRequestScripter}function c(){{var a=new TCPReader;new TCPReaderStatus({model:a}),new TCPManager({model:a})}pm.tcpReader=a}function d(){pm.api=new PostmanAPI}function e(){console.log("Initialize interceptor");new InterceptorIntro({model:{}}),new InterceptorCapture,new CurlCapture}function f(){pm.collectionValidator=postmanvalidator;{var a=new PmCollections;new AddCollectionModal({model:a}),new AddFolderModal({model:a}),new EditFolderModal({model:a}),new DeleteFolderModal({model:a}),new EditCollectionModal({model:a}),new DeleteCollectionModal({model:a}),new ImportModal({model:a}),new ShareCollectionModal({model:a}),new OverwriteCollectionModal({model:a}),new AddCollectionRequestModal({model:a}),new EditCollectionRequestModal({model:a}),new DeleteCollectionRequestModal({model:a})}pm.collections=a}function g(){pm.syncLogger=new SyncLogger;var a=new LocalChanges;pm.syncManager=new SyncManagerNew,pm.localChanges=a,pm.subscriptionManger=new SubscriptionHandler;new SyncStatusNotif({model:pm.syncManager});pm.conflictResolverModal=new ConflictResolverModal}function h(){var a=new History;pm.history=a}function i(){{var a=new Globals,b=new Environments,c=new VariableProcessor({environments:b,globals:a});new EnvironmentSelector({environments:b,variableProcessor:c}),new EnvironmentManagerModal({environments:b,globals:a}),new QuickLookPopOver({environments:b,globals:a,variableProcessor:c})}pm.envManager=c,pm.environments=b,pm.globals=a;var d=new AppState({globals:a,environments:b,variableProcessor:c}),e=new App({model:d});pm.app=e}function j(){pm.headerPresets=new HeaderPresets;new HeaderPresetsModal({model:pm.headerPresets}),new HeaderPresetsRequestEditor({model:pm.headerPresets})}function k(){var a=new URLCache;pm.urlCache=a;var b=new Request,c=(new RequestEditor({model:b}),new ResponseViewer({model:b}),new BasicAuthProcessor({request:b})),d=new DigestAuthProcessor({request:b}),e=new OAuth1Processor({request:b}),f=new OAuth2TokenFetcher({request:b}),g=new Helpers({basicAuth:c,digestAuth:d,oAuth1:e,oAuth2:f,request:b}),h=new OAuth2Tokens,i=(new OAuth2TokenList({model:h}),new HelperManager({model:g}));pm.helpers=i,pm.request=b,l(),m()}function l(){chrome.runtime.onMessageExternal.addListener(function(a,b,c){pm.mediator.trigger("onMessageExternal",a,b,c)})}function m(){new AppUpdateNotifier}function n(){var a=new Storage;pm.storage=a}function o(){{var a=new SidebarState({history:pm.history,collections:pm.collections});new Sidebar({model:a})}}function p(){if(pm.features.isFeatureEnabled(FEATURES.DRIVE_SYNC)){var a=new DriveSyncLog,b=(new DriveSyncLogger({model:a}),new DriveSync({log:a}));new DriveSyncIntroduction({model:b})}}function q(){{var a=new Directory;new DirectoryBrowser({model:a})}}function r(){{var a=new TeamDirectory;new TeamDirectoryBrowser({model:a})}}function s(){pm.tracker=new Tracker}function t(){var a=(new Header,new User);pm.user=a;new UserSyncDataDeleteModal({model:a}),new UserUnsyncedDataDeleteModal({model:a}),new UserStatus({model:a}),new UserCollections({model:a})}Handlebars.partials=Handlebars.templates,Handlebars.registerHelper("ifEditable",function(a,b){return a!==!1?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("ifEditableItem",function(a,b,c){return a!==!1||pm.user.id==b?c.fn(this):c.inverse(this)}),pm.mediator=new Mediator,n(),a(),pm.appWindow=new AppWindow,pm.settings=new Settings;new Legal;pm.methods=new RequestMethods(function(){pm.settings.init(function(){pm.settings.getSetting("installation_id")||pm.settings.setSetting("installation_id",guid());new SettingsModal({model:pm.settings});pm.themeManager=new ThemeManager,pm.filesystem.init(),pm.indexedDB.open(function(){g(),d(),k(),e(),h(),f(),b(),i(),j(),o(),pm.broadcasts.init(),p(),t(),q(),r(),s(),c(),pm.hasPostmanInitialized=!0,pm.mediator.trigger("postmanInitialized");try{pm.gaClientId=window.fu}catch(a){}})})})};var GruntLiveReload=GruntLiveReload||{};GruntLiveReload.init=function(){var a=new WebSocket("ws://localhost:35729/livereload");a.onopen=function(){console.log("LiveReload WebSocket initialized and ready.")},a.onmessage=function(a){var b=JSON.parse(a.data);"reload"==b.command?chrome.runtime.reload():console.log("LiveReload Message",a.data)},a.onerror=function(a){console.error("LiveReload WebSocket Error",a)}},$(document).ready(function(){pm.init()});var AppState=Backbone.Model.extend({defaults:function(){return{variableProcessor:null,isModalOpen:!1,activeModal:""}}}),AppUpdateNotifier=Backbone.Model.extend({initialize:function(){pm.mediator.on("showVersionNotice",this.showVersionNotice,this),pm.mediator.on("notifyVersionUpdate",this.notifyVersionUpdate,this),console.log("Checking for update notifications..."),chrome.storage.local.get("lastKnownVersion",function(a){var b=chrome.runtime.getManifest().version;if(a.lastKnownVersion||(a.lastKnownVersion="blank"),a.lastKnownVersion){var c=a.lastKnownVersion;console.log("Stored version: "+c+", currentVersion: "+b),c!==b&&(setTimeout(function(){pm.mediator.trigger("showVersionNotice",b),pm.mediator.trigger("notifyVersionUpdate")},2500),"2.0.7"===c&&setTimeout(function(){pm.mediator.trigger("syncAllRequestsFix")},5e3))}chrome.storage.local.set({lastKnownVersion:b})})},notifyVersionUpdate:function(){var a=chrome.runtime.getManifest().version;pm.api.notifyServerOfVersionChange(a+"")},showVersionNotice:function(a){var b=a.replace(/\./g,"-"),c="version_"+b;Handlebars.templates.hasOwnProperty(c)&&(console.log("Showing notification for "+c),$("#modal-update-notif .modal-body").html("").append(Handlebars.templates[c]()),$("#modal-update-notif").modal("show"))}}),AppWindow=Backbone.Model.extend({defaults:function(){return{id:0,internalEvents:{}}},initialize:function(){this.set("id",guid()),this.initializeInternalMessaging()},onRegisterInternalEvent:function(a,b,c){var d=this.get("internalEvents");d[a]={handler:b,context:c}},sendMessageObject:function(a,b){if(0!=window.pmWindowsOpen){var c={id:this.get("id"),event:a,object:b};chrome.runtime.sendMessage(c)}},initializeInternalMessaging:function(){var a=this;this.on("registerInternalEvent",this.onRegisterInternalEvent,this),this.on("sendMessageObject",this.sendMessageObject,this),chrome.runtime.onMessage.addListener(function(b){if(a.get("id")!==b.id){var c=a.get("internalEvents");if(b.event in c){var d=b.event,e=b.object;_.bind(c[d].handler,c[d].context)(e)}}})}}),FEATURES={USER:"user",DIRECTORY:"directory",DRIVE_SYNC:"drive_sync",TESTER:"tester"},Features=Backbone.Model.extend({defaults:function(){var a={};return a[FEATURES.USER]=!0,a[FEATURES.DIRECTORY]=!0,a[FEATURES.DRIVE_SYNC]=!1,a[FEATURES.TESTER]=!0,a},isFeatureEnabled:function(a){return this.get(a)}}),Legal=Backbone.Model.extend({initialize:function(){var a={syncTerms:postman_web_url+"/privacy",syncEulas:postman_web_url+"/privacy#using-postman",syncDocs:postman_web_url+"/docs/sync_overview"};pm.mediator.on("showSyncInvitePopup",function(){$("#modal-eula-notif .modal-body").html(Handlebars.templates.sync_eula(a)),$("#modal-eula-notif").modal("show"),pm.app.trigger("modalOpen","#modal-eula-notif"),pm.settings.setSetting("syncInviteShown",!0)}),$("body").on("click","#sync-eula-accept",function(){pm.settings.setSetting("enableSync",!0),pm.mediator.trigger("setSync",!0),pm.user.setSyncEnabled(!0),pm.mediator.trigger("showEnableSyncButton"),pm.api.acceptSyncEula(pm.user.get("id"),pm.user.get("access_token"),function(){pm.syncManager.signIn()}),$("#modal-eula-notif .modal-body").html(""),pm.app.trigger("modalClose"),$("#modal-eula-notif").modal("hide"),pm.tracker.forceTrackEvent("sync","enable")}),$("body").on("click","#sync-eula-reject",function(){$("#modal-eula-notif .modal-body").html(""),$("#modal-eula-notif").modal("hide"),pm.app.trigger("modalClose"),pm.user.setSyncEnabled(!1),pm.settings.setSetting("enableSync",!1),pm.mediator.trigger("setSync",!1),pm.mediator.trigger("showEnableSyncButton"),pm.tracker.forceTrackEvent("sync","reject")}),$("body").on("click","#sync-eula-link",function(){pm.tracker.forceTrackEvent("sync","view","eula")}),$("body").on("click","#sync-toc-link",function(){pm.tracker.forceTrackEvent("sync","view","toc")}),$("body").on("click","#sync-docs-link",function(){pm.tracker.forceTrackEvent("sync","view","documentation")})}}),Mediator=Backbone.Model.extend({defaults:function(){return{}}});pm.broadcasts={items:[],init:function(){pm.storage.getValue("broadcasts",function(){pm.storage.getValue("broadcast_last_update_time",function(a){var b=new Date;if(pm.broadcasts.showBlank(),pm.broadcasts.fetch(),a){{new Date(a)}pm.broadcasts.setLastUpdateTime(b)}else pm.broadcasts.setLastUpdateTime(b);$("#broadcasts-count").on("click",function(){pm.broadcasts.markAllAsRead()})})})},showBlank:function(){var a=$("#broadcasts-count");a.removeClass(),a.addClass("no-new-broadcasts"),a.html("0")},fetch:function(){var a="http://www.getpostman.com/broadcasts";$.get(a,function(a){pm.broadcasts.setBroadcasts(a.broadcasts),pm.broadcasts.renderBroadcasts()})},setLastUpdateTime:function(a){pm.storage.setValue({broadcast_last_update_time:a.toUTCString()})},setBroadcasts:function(a){function b(a){return a.id===d.id}var c,d;pm.storage.getValue("broadcasts",function(e){c=e?JSON.parse(e):[];var f,g,h;if(0===c.length){for(g=a.length,f=0;g>f;f++)a[f].status="unread";h=a.length,e=JSON.stringify(a),pm.storage.setValue({broadcasts:e},function(){})}else{g=a.length;var i=[];for(f=0;g>f;f++){d=a[f];var j=_.find(c,b);j||(d.status="unread",i.push(d))}h=i.length,c=_.union(i,c),e=JSON.stringify(c),pm.storage.setValue({broadcasts:e},function(){})}var k=$("#broadcasts-count");k.html(h),k.removeClass(),k.addClass(h>0?"new-broadcasts":"no-new-broadcasts")})},markAllAsRead:function(){var a=$("#broadcasts-count");a.removeClass(),a.addClass("no-new-broadcasts"),a.html("0"),pm.storage.getValue("broadcasts",function(a){var b;b=a?JSON.parse(a):[];for(var c=b.length,d=0;c>d;d++)b[d].status="read";var e=JSON.stringify(b);pm.storage.setValue({broadcasts:e},function(){}),pm.broadcasts.renderBroadcasts()})},renderBroadcasts:function(){pm.storage.getValue("broadcasts",function(a){var b=JSON.parse(a);$("#broadcasts .dropdown-menu").html(""),$("#broadcasts .dropdown-menu").append(Handlebars.templates.broadcasts({items:b}))})}};var PmCollection=Backbone.Model.extend({defaults:function(){return{id:"",name:"",description:"",order:[],folders:[],requests:[],timestamp:0,synced:!1,syncedFilename:"",remote_id:0,remoteLink:"","public":!1,owner:"",subscribed:!1,write:!0}},toSyncableJSON:function(){var a=this.getAsJSON();return a.synced=!0,a},setRequests:function(a){this.set("requests",a)},getRequestIndex:function(a){for(var b,c,d,e=this.get("requests"),f=e.length,g=0;f>g;g++)if(b=e[g],b.id===a.id){c=!0,d=g;break}return c?d:-1},addRequest:function(a){var b=this.getRequestIndex(a),c=this.get("requests");-1!==b||c.push(a)},deleteRequest:function(a){var b=_.clone(this.get("requests")),c=arrayObjectIndexOf(b,a,"id");-1!==c&&(this.removeRequestIdFromOrderOrFolder(a),b.splice(c,1),this.set("requests",b))},updateRequest:function(a){var b=this.getRequestIndex(a),c=this.get("requests");-1!==b&&c.splice(b,1,a)},getFolderById:function(a){var b=_.clone(this.get("folders")),c=arrayObjectIndexOf(b,a,"id");return b[c]},getFolders:function(){var a=_.clone(this.get("folders"));return a},getRequestsInCollection:function(){var a=_.clone(this.get("requests")),b=_.clone(this.get("order")),c=[],d=this.get("folders"),e=d.length;if(e>0){for(var f=0;e>f;f++){folder=_.clone(d[f]),folderOrder=folder.order,folderRequests=[];for(var g=0;g<folderOrder.length;g++){id=folderOrder[g];var h=arrayObjectIndexOf(a,id,"id");h>=0&&(folderRequests.push(a[h]),a.splice(h,1))}folderRequests=this.orderRequests(folderRequests,folderOrder),c=_.union(c,folderRequests)}c=_.union(c,this.orderRequests(a,b))}else c=this.orderRequests(a,b);return c},getRequestsInFolder:function(a){for(var b,c=a.order,d=_.clone(this.get("requests")),e=c.length,f=[],g=0;e>g;g++)b=arrayObjectIndexOf(d,c[g],"id"),b>=0&&f.push(d[b]);var h=this.orderRequests(f,a.order);return h},addFolder:function(a){var b=_.clone(this.get("folders"));b.push(a),this.set("folders",b)},hasFolderId:function(a){var b=_.clone(this.get("folders")),c=arrayObjectIndexOf(b,a,"id");return-1===c?!1:!0},editFolder:function(a){var b=a.id,c=_.clone(this.get("folders")),d=arrayObjectIndexOf(c,b,"id");-1!==d&&(c.splice(d,1,a),this.set("folders",c))},deleteFolder:function(a){var b=_.clone(this.get("folders")),c=arrayObjectIndexOf(b,a,"id");b.splice(c,1),this.set("folders",b)},getAsJSON:function(){return{id:this.get("id"),name:this.get("name"),description:this.get("description"),order:this.get("order"),folders:this.get("folders"),timestamp:this.get("timestamp"),synced:this.get("synced"),remote_id:this.get("remote_id"),owner:this.get("owner"),sharedWithTeam:this.get("sharedWithTeam"),subscribed:this.get("subscribed"),remoteLink:this.get("remoteLink"),"public":this.get("public"),write:this.get("write")}},addRequestIdToFolder:function(a,b){for(var c=_.clone(this.get("folders")),d=(arrayObjectIndexOf(c,a,"id"),c.length),e=0;d>e;e++){var f=c[e].order.indexOf(b);c[e].id===a?-1===f&&c[e].order.push(b):f>=0&&c[e].order.splice(f,1)}this.set("folders",c)},removeRequestIdFromOrder:function(a){var b=this.get("order"),c=b.indexOf(a);return-1===c?-1:(b.splice(c,1),this.set("order",b),a)},requestExistsInCollectionRoot:function(a){var b=this.get("requests");return b.indexOf(a)?!0:!1},requestExistsInCollectionFolders:function(a){for(var b=this.get("folders"),c=b.length,d=0;c>d;d++){var e=b[d].order.indexOf(a);if(e>=0)return b[d].id}return!1},addRequestIdToOrder:function(a){this.removeRequestIdFromOrderOrFolder(a);var b=_.clone(this.get("order")),c=b.indexOf(a);if(-1!==c)throw"Request already exists in collectionOrder. Not re-adding.";b.push(a),this.set("order",b)},removeRequestIdFromOrderOrFolder:function(a){var b,c=_.clone(this.get("order")),d=_.clone(this.get("folders")),e=c.indexOf(a);e>=0&&(c.splice(e,1),this.set("order",c));for(var f=0;f<d.length&&(b=d[f].order.indexOf(a),!(b>=0));f++);b>=0&&(d[f].order.splice(b,1),this.set("folders",d))},isUploaded:function(){return 0!==this.get("remote_id")},orderRequests:function(){for(var a,b,c,d,e=this.get("folders"),f=this.get("requests"),g=e.length,h=[],i=0;g>i;i++){a=_.clone(e[i]),b=a.order,d=[];for(var j=0;j<b.length;j++){c=b[j];var k=arrayObjectIndexOf(f,c,"id");k>=0&&(d.push(f[k]),f.splice(k,1))}a.requests=this.orderRequests(d,b),h.push(a)}return this.set("folders",h),this.set("requests",this.orderRequests(f,this.get("order"))),collection},orderRequests:function(a,b){function c(a){return a.id===b[f]}var d=_.clone(a);if(0===b.length)d.sort(sortAlphabetical);else{for(var e=[],f=0,g=b.length;g>f;f++){var h=_.find(d,c);h&&e.push(h)}d=e}return d}}),PmCollectionRequest=Backbone.Model.extend({defaults:function(){return{}}}),PmCollections=Backbone.Collection.extend({originalCollectionId:"",toBeImportedCollection:{},model:PmCollection,isLoaded:!1,initializedSyncing:!1,syncFileTypeCollection:"collection",syncFileTypeCollectionRequest:"collection_request",comparator:function(a,b){var c,d=a.get("name"),e=b.get("name");if(null==d)return-1;if(null==e)return 1;c=d.length>e.legnth?e.length:d.length;for(var f=0;c>f;f++)if(d[f]!=e[f])return d[f]>e[f]?1:-1;return 1},initialize:function(){this.loadAllCollections(),this.collectionIdUserMap={},pm.appWindow.trigger("registerInternalEvent","addedCollection",this.onAddedCollection,this),pm.appWindow.trigger("registerInternalEvent","updatedCollection",this.onUpdatedCollection,this),pm.appWindow.trigger("registerInternalEvent","deletedCollection",this.onDeletedCollection,this),pm.appWindow.trigger("registerInternalEvent","addedCollectionRequest",this.onAddedCollectionRequest,this),pm.appWindow.trigger("registerInternalEvent","updatedCollectionRequest",this.onUpdatedCollectionRequest,this),pm.appWindow.trigger("registerInternalEvent","deletedCollectionRequest",this.onDeletedCollectionRequest,this),pm.mediator.on("addDirectoryCollection",this.onAddDirectoryCollection,this),pm.mediator.on("addResponseToCollectionRequest",this.addResponseToCollectionRequest,this),pm.mediator.on("updateResponsesForCollectionRequest",this.updateResponsesForCollectionRequest,this),pm.mediator.on("updateResponsesForCollectionRequestWithOptSync",this.updateResponsesForCollectionRequestWithOptSync,this),pm.mediator.on("deletedSharedCollection",this.onDeletedSharedCollection,this),pm.mediator.on("overwriteCollection",this.onOverwriteCollection,this),pm.mediator.on("uploadAllLocalCollections",this.onUploadAllLocalCollections,this),pm.mediator.on("syncChangeReceived",this.onSyncChangeReceived,this),pm.mediator.on("syncErrorReceived",this.onSyncErrorReceived,this),this.on("unsubscribeFromCollection",this.unsubscribeFromCollection,this)},unsubscribeFromCollection:function(){console.error("Wrong event triggered")},getOwnerForCollection:function(a){var b=this.collectionIdUserMap[a];return b?b:0},onAddedCollection:function(a){this.add(a,{merge:!0})},onUpdatedCollection:function(a){this.add(a,{merge:!0}),this.trigger("updateCollection"),pm.syncManager.addUnsyncedChange("collection","update",a)},onDeletedCollection:function(a){this.remove(a),pm.syncManager.addUnsyncedChange("collection","destroy",{id:a})},onAddedCollectionRequest:function(a){var b=this.get(a.collectionId);b&&b.addRequest(a)},onUpdatedCollectionRequest:function(a){var b=this.get(a.collectionId);b&&b.updateRequest(a)},onDeletedCollectionRequest:function(a){var b=this.get(request.collectionId);b&&b.deleteRequest(a)},onUploadAllLocalCollections:function(){function a(){b++,b===c&&pm.mediator.trigger("refreshSharedCollections")}var b=0,c=this.models.length;pm.tracker.trackEvent("collection","share","upload_all",c);for(var d=0;d<this.models.length;d++)this.uploadCollection(this.models[d].get("id"),!1,!1,a)},getCollectionById:function(a){for(var b=0;b<this.models.length;b++)if(a===this.models[b].get("id"))return this.models[b];return null},getAllCollections:function(){return this.models},loadAllCollections:function(){var a=this;
this.startListeningForFileSystemSyncEvents(),pm.indexedDB.getCollections(function(b){function c(b,c){var f=new PmCollection(b);f.setRequests(c),a.add(f,{merge:!0}),a.collectionIdUserMap[b.id]=b.owner,e++;for(var g=0;g<c.length;g++)pm.mediator.trigger("addToURLCache",c[g].url);e===d&&(a.isLoaded=!0,a.trigger("startSync"),pm.syncManager&&pm.syncManager.trigger("itemLoaded","collections"),pm.mediator.trigger("refreshCollections"),pm.mediator.trigger("loadedCollections"))}var d=b.length,e=0;if(0===d)a.isLoaded=!0,a.trigger("startSync"),pm.syncManager&&pm.syncManager.trigger("itemLoaded","collections");else for(var f=0;d>f;f++){var g=b[f];pm.indexedDB.getAllRequestsInCollection(g,c)}})},startListeningForFileSystemSyncEvents:function(){{var a=this;a.isLoaded,a.initializedSyncing}pm.mediator.on("initializedSyncableFileSystem",function(){a.initializedSyncing=!0,a.trigger("startSync")}),this.on("startSync",this.startSyncing,this)},startSyncing:function(){var a,b,c,d,e,f,g=this;if(this.isLoaded&&this.initializedSyncing)for(pm.mediator.on("addSyncableFileFromRemote",function(a,b){"collection"===a?g.onReceivingSyncableFileData(b):"collection_request"===a&&g.onReceivingSyncableFileDataForRequests(b)}),pm.mediator.on("updateSyncableFileFromRemote",function(a,b){"collection"===a?g.onReceivingSyncableFileData(b):"collection_request"===a&&g.onReceivingSyncableFileDataForRequests(b)}),pm.mediator.on("deleteSyncableFileFromRemote",function(a,b){"collection"===a?g.onRemoveSyncableFile(b):"collection_request"===a&&g.onRemoveSyncableFileForRequests(b)}),a=0;a<this.models.length;a++)for(c=this.models[a],f=c.get("synced"),f||this.addToSyncableFilesystem(c.get("id")),d=c.get("requests"),b=0;b<d.length;b++)e=d[b],e.hasOwnProperty("synced")?e.synced||this.addRequestToSyncableFilesystem(e.id):this.addRequestToSyncableFilesystem(e.id)},onReceivingSyncableFileData:function(a){var b=JSON.parse(a);this.addCollectionFromSyncableFileSystem(b)},onRemoveSyncableFile:function(a){this.deleteCollectionFromDataStore(a,!1,function(){})},onReceivingSyncableFileDataForRequests:function(a){var b=JSON.parse(a);this.addRequestFromSyncableFileSystem(b)},onRemoveSyncableFileForRequests:function(a){this.deleteRequestFromDataStore(a,!1,!1,function(){})},onOverwriteCollection:function(a){this.overwriteCollection(a)},onDeletedSharedCollection:function(a){for(var b,c=this,d=0;d<this.models.length;d++){var b=this.models[d];if(b&&b.get("remote_id")===a.remote_id){var e=c.getJSONFromCollection(b);b.set("remote_id",0),c.updateCollectionInDataStore(b.getAsJSON(),e,!0,function(){});break}}},getAsSyncableFile:function(a){var b=this.get(a),c=a+".collection",d="collection",e=JSON.stringify(b.toSyncableJSON());return{name:c,type:d,data:e}},getRequestAsSyncableFile:function(a){var b=this.getRequestById(a),c=a+".collection_request",d="collection_request";null!=b&&(b.synced=!0);var e=JSON.stringify(b);return{name:c,type:d,data:e}},addToSyncableFilesystem:function(a){var b=this,c=this.getAsSyncableFile(a);pm.mediator.trigger("addSyncableFile",c,function(c){"success"===c&&b.updateCollectionSyncStatus(a,!0)})},removeFromSyncableFilesystem:function(a){var b=a+".collection";pm.mediator.trigger("removeSyncableFile",b,function(){})},addRequestToSyncableFilesystem:function(a){var b=this,c=this.getRequestAsSyncableFile(a);pm.mediator.trigger("addSyncableFile",c,function(c){"success"===c&&b.updateCollectionRequestSyncStatus(a,!0)})},removeRequestFromSyncableFilesystem:function(a){var b=a+".collection_request";pm.mediator.trigger("removeSyncableFile",b,function(){})},getMissingServerRequest:function(a,b){pm.syncManager.getEntityFromId("request",a,b,null,function(a){a.collectionId=a.collection,"raw"===a.dataMode&&a.rawModeData&&(a.data=a.rawModeData,delete a.rawModeData),pm.collections.addFullCollectionRequest(a,null)})},correctFolderOrder:function(a,b,c,d){var e=pm.collections.getFolderById(a);if(!e)return console.log("Fatal - tried to update folder order but can't find the folder locally"),!0;for(var f=b.length,g=0;f>g;g++)-1==c.indexOf(b[g])&&this.getMissingServerRequest(b[g],d);for(var g=0;g<c.length;g++)-1==b.indexOf(c[g])&&pm.collections.resyncRequestId(c[g]);return!1},correctCollectionOrder:function(a,b,c,d){var e=pm.collections.getCollectionById(a);if(!e)return console.log("Fatal - tried to update folder order but can't find the folder locally"),!0;for(var f=b.length,g=0;f>g;g++)-1==c.indexOf(b[g])&&this.getMissingServerRequest(b[g],d);for(var g=0;g<c.length;g++)-1==b.indexOf(c[g])&&pm.collections.resyncRequestId(c[g]);return!1},addCollectionToDataStore:function(a,b,c,d){var e=this,f=a.justSubscribed;delete a.justSubscribed,pm.indexedDB.addCollection(a,function(a){var g=new PmCollection(a);if(g.justSubscribed=f,e.add(g,{merge:!0}),pm.appWindow.trigger("sendMessageObject","addedCollection",g),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("refreshCollections"),pm.mediator.trigger("syncOperationDone"),!g.attributes.synced&&(pm.syncManager.addChangeset("collection","create",a,null,c),0==c&&a.hasOwnProperty("folders")&&a.folders instanceof Array)){var h,i=a.folders.length;for(h=0;i>h;h++)pm.syncManager.addChangeset("folder","create",a.folders[h],null,!1),h===i-1&&a.hasRequests!==!0&&pm.mediator.trigger("commitTransaction",a.id)}b&&e.addToSyncableFilesystem(g.get("id")),d&&d(a)})},updateCollectionInDataStoreWithOptSync:function(a,b,c,d,e){var f=this;pm.indexedDB.updateCollection(a,b,d,function(a){var g=f.get(a.id);if(f.add(g,{merge:!0}),pm.appWindow.trigger("sendMessageObject","updatedCollection",g),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("refreshCollections"),d){var h=pm.syncManager.mergeEntitiesForUpdate(a,b);pm.syncManager.addChangeset("collection","update",h,null,!0)}c&&null!=g&&f.addToSyncableFilesystem(g.get("id")),e&&e(a)})},updateCollectionInDataStore:function(a,b,c,d){this.updateCollectionInDataStoreWithOptSync(a,b,c,!0,d)},updateCollectionInDataStoreWithoutSync:function(a,b,c,d){this.updateCollectionInDataStoreWithOptSync(a,b,c,!1,d)},mergeEntitiesForUpdate:function(a,b){var c={};c.id=a.id;for(key in b)c[key]=b[key];for(key in a)c[key]=a[key];return c},updateRemoteCollectionInDataStore:function(a,b,c,d){var e=this;try{b=pm.collections.getCollectionById(a.id),b||pm.syncLogger.error("Updating remote collection failed. Collection id "+a.id+" doesn't exist on this machine"),b=b.getAsJSON(),a=this.mergeEntitiesForUpdate(a,b),a.hasOwnProperty("shared")&&(a.sharedWithTeam=a.shared),pm.indexedDB.updateCollection(a,b,!1,function(b){var f=new PmCollection(a),g=pm.collections.getCollectionById(b.id).get("requests");f.setRequests(g),e.add(f,{merge:!0}),pm.appWindow.trigger("sendMessageObject","updatedCollection",f),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("refreshCollections"),pm.collections.trigger("updateCollectionMeta",f),pm.mediator.trigger("syncOperationDone"),c&&e.addToSyncableFilesystem(f.get("id")),"function"==typeof d&&d(b)})}catch(f){return pm.syncLogger.error("Update collection failed: "+f),"function"==typeof d&&d(),-1}return 0},deleteCollectionFromDataStoreWithOptSync:function(a,b,c,d){var e=this;pm.indexedDB.deleteCollectionWithOptSync(a,c,function(){e.remove(a),pm.appWindow.trigger("sendMessageObject","deletedCollection",a),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("syncOperationDone"),b&&e.removeFromSyncableFilesystem(a),c&&pm.syncManager.addChangeset("collection","destroy",{id:a},null,!0),pm.api.deleteCollectionFromTeam(pm.user.id,pm.user.get("access_token"),a,function(){},function(){}),pm.indexedDB.getAllRequestsForCollectionId(a,function(a){var c,f,g=0,h=a.length;if(h>0)for(f=0;h>f;f++)c=a[f],pm.indexedDB.deleteCollectionRequestWithOptSync(c.id,!1,function(a){g++,pm.mediator.trigger("databaseOperationComplete"),b&&e.removeRequestFromSyncableFilesystem(a),g===h&&(pm.mediator.trigger("refreshCollections"),d&&d())});else d&&d()})})},deleteCollectionFromDataStore:function(a,b,c){this.deleteCollectionFromDataStoreWithOptSync(a,b,!1,c)},getJSONFromCollection:function(a){return{id:a.attributes.id,name:a.attributes.name,description:a.attributes.description,order:a.attributes.order,folders:a.attributes.folders,timestamp:a.attributes.timestamp,synced:a.attributes.synced,owner:a.attributes.owner,remote_id:a.attributes.remote_id,remoteLink:a.attributes.remoteLink,write:a.attributes.write}},getJSONFromRequest:function(a){return a?{collectionId:a.collectionId,data:_.clone(a.data),dataMode:a.dataMode,description:a.description,headers:a.headers,id:a.id,method:a.method,name:a.name,pathVariables:_.clone(a.pathVariables),preRequestScript:a.preRequestScript,responses:_.clone(a.responses),tests:a.tests,time:a.time,url:a.url,version:a.version}:null},addRequestToDataStoreWithOptSync:function(a,b,c,d,e){var f=this,g=_.clone(a);delete a.isLastRequest,pm.indexedDB.addCollectionRequest(a,c,function(h){pm.mediator.trigger("addToURLCache",a.url);var i=f.get(a.collectionId);if(pm.mediator.trigger("databaseOperationComplete"),i&&(i.addRequest(a),pm.appWindow.trigger("sendMessageObject","addedCollectionRequest",a)),c){pm.syncManager.addChangeset("request","create",h,null,d);for(var j=h.responses||[],k=0;k<j.length;k++){j[k].owner=h.owner,j[k].request=h.id,j[k].collectionId=h.collectionId;var l=_.clone(j[k]);0==d?pm.syncManager.addChangeset("response","create",l,null,!1):setTimeout(function(a){return function(){pm.syncManager.addChangeset("response","create",a,null,!0)}}(l),500)}}b&&f.addRequestToSyncableFilesystem(a.id),e&&e(g)})},addRequestToDataStore:function(a,b,c,d){this.addRequestToDataStoreWithOptSync(a,b,!0,c,d)},addRemoteRequestToDataStore:function(a,b,c){this.addRequestToDataStoreWithOptSync(a,b,!1,!0,c)},updateRequestInDataStore:function(a,b,c,d,e){var f=this;a.name||(a.name=a.url),pm.indexedDB.updateCollectionRequest(a,b,e,function(g){var h=f.get(a.collectionId);if(h&&(h.updateRequest(a),pm.appWindow.trigger("sendMessageObject","updatedCollectionRequest",a)),pm.mediator.trigger("databaseOperationComplete"),e){var i=pm.syncManager.mergeEntitiesForUpdate(g,b);g.dataMode&&(i.dataMode=g.dataMode),i.owner=h.get("owner"),pm.syncManager.addChangeset("request","update",i,null,!0)}c&&f.addRequestToSyncableFilesystem(a.id),d&&d(a)})},deleteRequestFromDataStoreWithOptSync:function(a,b,c,d,e){var f,g=this,h=this.getRequestById(a);h&&(f=this.get(h.collectionId)),pm.indexedDB.deleteCollectionRequestWithOptSync(a,d,function(){if(f){var h=f.getAsJSON();f.deleteRequest(a),collection=f.getAsJSON(),pm.mediator.trigger("databaseOperationComplete"),b&&(g.removeRequestFromSyncableFilesystem(a),pm.appWindow.trigger("sendMessageObject","deletedCollectionRequest",a)),d&&pm.syncManager.addChangeset("request","destroy",{id:a,owner:collection.owner},null,!0),e&&e(),g.updateCollectionInDataStoreWithoutSync(collection,h,c,function(){})}else b&&g.removeRequestFromSyncableFilesystem(a),e&&e()})},deleteRequestFromDataStore:function(a,b,c,d){this.deleteRequestFromDataStoreWithOptSync(a,b,c,!0,d)},getCollectionForFolderId:function(a){function b(b){return b.id===a}for(var c=0;c<this.length;c++){var d=this.models[c],e=d.get("folders"),f=_.find(e,b);if(f)return d}return null},addCollection:function(a,b){var c=this,d={};a&&(d.id=guid(),d.name=a,d.description=b,d.order=[],d.timestamp=(new Date).getTime(),d.owner=pm.user.id,d.sharedWithTeam=!1,c.collectionIdUserMap[d.id]=pm.user.id,c.addCollectionToDataStore(d,!0,!0))},resyncCollectionId:function(a){var b=pm.collections.getCollectionById(a);if(!b)return console.log("Could not find collection"),!1;var c=b.getAsJSON();if(c.owner!==pm.user.id)return console.log("Only the owner can recreate the lost objects"),!1;pm.syncManager.addChangeset("collection","create",c,null,!0);for(var d=c.folders?c.folders.length:0,e=0;d>e;e++){var f=c.folders[e];this.resyncWholeFolder(f)}for(var g=c.order||[],e=0;e<g.length;e++)this.resyncRequestId(c.order[e]);return!0},resyncFolderId:function(a){var b=pm.collections.getFolderById(a);this.resyncWholeFolder(b)},resyncWholeFolder:function(a){if(!a)return console.log("Cannot find folder"),!1;if(a.owner!==pm.user.id)return console.log("Only the owner can recreate the lost objects"),!1;pm.syncManager.addChangeset("folder","create",a,null,!0);for(var b=a.order||[],c=0;c<b.length;c++)this.resyncRequestId(a.order[c]);return!0},resyncRequestId:function(a){var b=pm.collections.getRequestById(a);if(!b)return!1;if(b.owner!==pm.user.id&&pm.collections.getOwnerForCollection(b.collectionId)!=pm.user.id)return console.log("Only the owner can recreate the lost objects"),!1;pm.syncManager.addChangeset("request","create",b,null,!0);for(var c=b.responses?b.responses.length:0,d=0;d<c.length;d++)pm.syncManager.addChangeset("response","create",b.responses[d],null,!0);return!0},addFullCollection:function(a,b,c){var d=this;d.collectionIdUserMap[a.id]=a.owner,a.synced=b,a.sharedWithTeam=a.shared,a.write=1==a.write||pm.user.id==a.owner;try{d.addCollectionToDataStore(a,!0,!0,c)}catch(e){return console.log("Adding collection failed: "+e),-1}return 0},addCollectionFromSyncableFileSystem:function(a){var b=this;b.addCollectionToDataStore(a,!1,!1,function(a){pm.indexedDB.getAllRequestsInCollection(a,function(a,c){var d=b.get(a.id);d.set("synced",!0),d.setRequests(c),b.trigger("updateCollection",d)})})},addRequestFromSyncableFileSystem:function(a){var b=this;b.addRequestToDataStore(a,!1,!0,function(){var c,d,e=b.get(a.collectionId);e&&(d=b.getRequestLocation(a.id),"collection"===d.type?b.trigger("moveRequestToCollection",null,e,a):"folder"===d.type&&(c=b.getFolderById(d.folderId),b.trigger("moveRequestToFolder",null,e,c,a)))})},addAsNewCollection:function(a){var b,c,d,e=this,f=[],g={},h=_.clone(a);h.requests=[],h.sharedWithTeam=!1,h.subscribed=!1,h.remoteLink="",h.remote_id=0,h["public"]=!1,h.write=!0,e.addCollectionToDataStore(h,!0,!1,function(h){var i,j,k,l,m,n,o,p;i=e.get(h.id);var q=_.clone(i);e.trigger("importCollection",{type:"collection",name:a.name,action:"added"}),j=[],k=!1,"order"in a?k=!0:(k=!1,a.order=[],a.requests.sort(sortAlphabetical));for(l=0;l<a.requests.length;l++){m=a.requests[l],m.collectionId=a.id,m.hasOwnProperty("rawModeData")&&(m.data=m.rawModeData,delete m.rawModeData);var n=guid();if(g[m.id]=n,k?(o=m.id,p=_.indexOf(a.order,o),a.order[p]=n):a.order.push(n),m.id=n,"responses"in m)for(c=0,d=m.responses.length;d>c;c++)m.responses[c].id=guid(),m.responses[c].collectionRequestId=n;j.push(m)}if("folders"in a)for(f=a.folders,l=0;l<f.length;l++)for(f[l].id=guid(),b=f[l].order,c=0;c<b.length;c++)b[c]=g[b[c]];if(i.setRequests(j),i.set("folders",f),i.set("order",a.order),pm.user.isLoggedIn()){var r=pm.user.getRemoteIdForCollection(h.id);i.set("remote_id",r)}e.updateCollectionInDataStoreWithOptSync(i.getAsJSON(),q,!0,!0,function(){var a,b;for(a=0;a<j.length;a++){b=j[a];var c=function(a){a.isLastRequest&&pm.mediator.trigger("commitTransaction",i.id)};a==j.length-1&&(b.isLastRequest=!0),e.addRequestToDataStore(b,!0,!1,c)}e.trigger("updateCollection",i)})})},updateCollectionOwnerWithoutSync:function(a,b){var c=this,d=c.get(a),e=c.getJSONFromCollection(d);d.set("owner",b),c.updateCollectionInDataStoreWithoutSync(d.getAsJSON(),e,!0,function(){})},updateCollectionOrder:function(a,b){var c=this,d=c.get(a),e=c.getJSONFromCollection(d);d.set("order",b),c.updateCollectionInDataStore(d.getAsJSON(),e,!0,function(){})},updateCollectionSyncStatus:function(a,b){var c=this,d=c.get(a),e=c.getJSONFromCollection(d);d.set("synced",b),c.updateCollectionInDataStore(d.getAsJSON(),e,!1,function(){})},updateCollectionWrite:function(a,b){var c=this,d=c.get(a),e=c.getJSONFromCollection(d);d.set("write",b),c.updateCollectionInDataStore(d.getAsJSON(),e,!0,function(){c.trigger("updateCollectionMeta",d)})},updateCollectionMeta:function(a,b,c){var d=this,e=d.get(a),f=d.getJSONFromCollection(e);e.set("name",b),e.set("description",c),d.updateCollectionInDataStore(e.getAsJSON(),f,!0,function(b){d.trigger("updateCollectionMeta",e),b.sharedWithTeam===!0&&pm.api.updateCollectionToTeam(pm.user.id,pm.user.get("access_token"),a,e.get("name"),e.get("description"),e.get("owner"),function(){})})},deleteCollection:function(a,b,c){this.deleteCollectionFromDataStoreWithOptSync(a,b,!0,c)},getCollectionDataForFile:function(a,b){pm.indexedDB.getCollection(a,function(a){var c,d,e,f,g=a;pm.indexedDB.getAllRequestsInCollection(g,function(a,g){for(c=0,count=g.length;count>c;c++)g[c].synced=!1,"raw"===g[c].dataMode&&(g[c].rawModeData=g[c].data,g[c].data=[]);a.hasOwnProperty("remote_id")&&delete a.remote_id,a.synced=!1,a.requests=g,d=a.name+".json",e="application/json",f=JSON.stringify(a,null,"	"),b(d,e,f)})})},saveCollection:function(a){this.getCollectionDataForFile(a,function(a,b,c){var d=a+".postman_collection";pm.filesystem.saveAndOpenFile(d,c,b,function(){noty({type:"success",text:"Saved collection to disk",layout:"topCenter",timeout:750})}),pm.tracker.trackEvent("collection","share","json")})},uploadAndGetLinkForCollection:function(a,b,c){var d=this;this.getCollectionDataForFile(a,function(e,f,g){pm.api.uploadCollection(g,b,function(e){var f=e.link;c&&c(f),pm.mediator.trigger("refreshSharedCollections");var g=d.get(a),h=parseInt(e.id,10),i=d.getJSONFromCollection(g);g.set("remote_id",h),g.set("remoteLink",f),g.set("public",b),d.updateCollectionInDataStoreWithOptSync(g.getAsJSON(),i,!0,!0,function(){})}),b?pm.tracker.trackEvent("collection","share","api_directory"):pm.tracker.trackEvent("collection","share","upload")})},uploadCollection:function(a,b,c,d,e){var f=this;this.uploadAndGetLinkForCollection(a,b,e);var g=f.get(a);if(c===!0&&g.get("sharedWithTeam")!==!0){var h=f.getJSONFromCollection(g);g.set("sharedWithTeam",!0);var i=pm.user.get("organizations");if(i.length>0){var j=i[0].id;pm.syncManager.addChangeset("collection","share",{team:j},a,!0),f.updateCollectionInDataStoreWithOptSync(g.getAsJSON(),h,!0,!1,function(){f.trigger("updateCollection",g)})}else console.log("Cannot share. You are not a member of a team.")}else if(c===!1&&g.get("sharedWithTeam")===!0){var g=f.get(a),h=f.getJSONFromCollection(g);g.set("sharedWithTeam",!1),pm.syncManager.addChangeset("collection","unshare",null,a,!0),f.updateCollectionInDataStoreWithOptSync(g.getAsJSON(),h,!0,!1,function(){f.trigger("updateCollection",g),pm.api.deleteCollectionFromTeam(pm.user.id,pm.user.get("access_token"),a,function(){},function(){console.log("Could not delete collection from team")})})}},unshareCollection:function(a){pm.api.deleteCollectionFromTeam(pm.user.id,pm.user.get("access_token"),a,function(){},function(){console.log("Could not delete collection from team")})},overwriteCollection:function(a){var b=this;if(a.hasOwnProperty("order"))ordered=!0;else{a.hasOwnProperty("requests")&&a.requests instanceof Array||(a.requests=[]),ordered=!1,a.order=[];for(var c=0;c<a.requests.length;c++)a.order.push(a.requests[c].id)}a.subscribed=!1;var d=_.clone(a);"requests"in a&&(delete d.requests,d.hasRequests=!0);var e=!1;d.order&&0!=d.order.length||d.folders&&0!==d.folders.length||(e=!0),b.addCollectionToDataStore(d,!0,e,function(){var c,d,e,f=a.requests;if(c=b.get(a.id),a.hasOwnProperty("requests")){for(d=0;d<f.length;d++)"raw"===a.requests[d].dataMode&&a.requests[d].hasOwnProperty("rawModeData")&&(a.requests[d].data=a.requests[d].rawModeData),a.requests[d].hasOwnProperty("preRequestScript")||(a.requests[d].preRequestScript=""),a.requests[d].hasOwnProperty("tests")||(a.requests[d].tests="");for(c.set("requests",a.requests),d=0;d<f.length;d++){e=f[d];var g=function(b){b.isLastRequest&&(pm.syncManager.trigger("singleSyncDone"),pm.mediator.trigger("commitTransaction",a.id))};d==f.length-1&&(e.isLastRequest=!0),b.setFolderIdForRequest(e,a),b.addRequestToDataStore(e,!0,!1,g)}}else c.set("requests",[]);b.trigger("updateCollection",c),b.trigger("importCollection",{type:"collection",name:a.name,action:"added"})})},setFolderIdForRequest:function(a,b){if(-1===b.order.indexOf(a.id)){var c,d=b.folders,e=d.length;for(c=0;e>c;c++)if(-1!=d[c].order.indexOf(a.id))return void(a.folder=d[c].id)}},duplicateCollection:function(a){this.addAsNewCollection(a)},mergeCollection:function(a){var b=pm.collectionValidator.validateJSON("c",a,{correctDuplicates:!0,validateSchema:!1});if(0==b.status)return void noty({type:"warning",text:"Invalid collection file: "+b.message,layout:"topCenter",timeout:5e3});var c,d=this,e={id:a.id,name:a.name,timestamp:a.timestamp};c=new PmCollection(e);var f=d.getJSONFromCollection(c);if(c.set("name",a.name),c.set("requests",a.requests),"order"in a)c.set("order",a.order);else{for(var g=[],h=c.get("requests"),i=0;i<h.length;i++)g.push(h[i].id);c.set("order",g)}"folders"in a&&c.set("folders",a.folders),d.add(c,{merge:!0}),pm.appWindow.trigger("sendMessageObject","updatedCollection",c),d.updateCollectionInDataStore(c.getAsJSON(),f,!0,function(){var b=a.requests;pm.indexedDB.getAllRequestsInCollection(a,function(a,e){function f(a){return g.id===a.id}var g,h,i,j,k,l,m,n,o=[],p=[],q=[],r=0,s=b.length;for(r=0;s>r;r++)if(g=b[r],h=_.find(e,f)){for(o.push(g),i=e.length,j=-1,k=0;i>k;k++)if(e[k].id===h.id){j=k;break}j>=0&&e.splice(j,1)}else q.push(g);for(p=e,l=o.length,r=0;l>r;r++)d.updateRequestInDataStore(o[r],!0);for(m=q.length,r=0;m>r;r++)d.addRequestToDataStore(q[r],!0,!0,function(){});for(n=p.length,r=0;n>r;r++)d.deleteRequestFromDataStore(p[r],!0);d.trigger("updateCollection",c)})})},mergeCollections:function(a){for(var b=this,c=a.length,d=0;c>d;d++){var e=a[d];b.importCollectionData(e,!0)}},importCollectionData:function(a){!a.hasOwnProperty("order")&&a.hasOwnProperty("requests")&&(a.order=a.requests.map(function(a){return a.id}));var b=pm.user.id;if(a.owner=b,a.folders)for(var c=a.folders.length,d=0;c>d;d++)a.folders[d].owner=b;if(a.requests)for(var e=a.requests.length,d=0;e>d;d++)a.requests[d].owner=b;a.sharedWithTeam=!1,a.synced=!1,a.subscribed=!1;var f=pm.collectionValidator.validateJSON("c",a,{correctDuplicates:!0,validateSchema:!1});return 0==f.status?void noty({type:"warning",text:"Invalid collection file: "+f.message,layout:"topCenter",timeout:5e3}):void(null!==this.getCollectionById(a.id)?(this.originalCollectionId=a.id,this.toBeImportedCollection=a,this.trigger("overwriteCollectionChoice",a)):this.overwriteCollection(a))},setNewCollectionId:function(a){for(var b=guid(),c=a.folders?a.folders.length:0,d=0;c>d;d++)a.folders[d].collection_id=b;for(var e=a.requests?a.requests.length:0,d=0;e>d;d++)a.requests[d].collectionId=b;a.id=b},changeFolderAndRequestIds:function(a){for(var b=a.folders?a.folders.length:0,c={},d={},e=a.requests?a.requests.length:0,f=0;e>f;f++){var g=guid();if(d[a.requests[f].id]=g,a.requests[f].hasOwnProperty("responses"))for(var h=a.requests[f].responses.length,i=0;h>i;i++)a.requests[f].responses[i].id=guid();a.requests[f].id=g}for(var f=0;b>f;f++){var g=guid();c[a.folders[f].id]=g,a.folders[f].id=g;var j=a.folders[f].order,k=_.map(j,function(a){return d[a]});a.folders[f].order=k}var j=a.order,k=_.map(j,function(a){return d[a]});a.order=k},onAddDirectoryCollection:function(a){this.setNewCollectionId(a),this.changeFolderAndRequestIds(a),this.addAsNewCollection(a)},guessFileFormat:function(a,b){var c;try{return c=b===!0?a:JSON.parse(a),c.hasOwnProperty("swaggerVersion")?"SWAGGER1.2":c.hasOwnProperty("folders")||c.hasOwnProperty("requests")||c.hasOwnProperty("order")?"COLLECTION":0}catch(d){if(a instanceof Node){var e=new XMLSerializer;a=e.serializeToString(a)}a=a.trim();var f=a.split("\n")[0];return 0===f.indexOf("#%RAML")?"RAML":0===f.toLowerCase().indexOf("curl")?"CURL":-1!==a.substring(0,5).indexOf("<")&&-1!==a.substring(0,400).indexOf("<application")?"WADL":0}},showImportError:function(a,b){noty({type:"error",text:"Errow while importing "+a+": "+b,layout:"center",timeout:2e3})},importData:function(a,b,c){var d=this;if("SWAGGER1.2"===b){var e=c?a:JSON.parse(a);postmanConverters.swagger1_2Converter.convertJSON(e,{group:!0,test:!1},function(a){pm.collections.importCollectionData(a)},function(a){pm.collections.showImportError("Swagger",a)})}else if("COLLECTION"===b){var f=c?a:JSON.parse(a);d.importCollectionData(f)}else if("RAML"===b)postmanConverters.ramlConverter.parseString(a,function(a){pm.collections.importCollectionData(a)},function(a){-1!==a.indexOf("cannot fetch")&&(a="External references are not supported yet. "+a),pm.collections.showImportError("RAML",a)});else if("CURL"===b)try{var g=postmanConverters.curlConverter.convertCurlToRequest(a);if(g.error)pm.collections.showImportError("Curl",g.error);else{var h=/\\n/gi;g.headers=g.headers.replace(h,"\n"),pm.mediator.trigger("loadRequest",g,!0),d.trigger("importCollection",{type:"request",name:""!=g.name&&null!=g.name?g.name:g.url,action:"added"})}}catch(i){pm.collections.showImportError("Curl",i.message)}else"WADL"===b&&postmanConverters.wadlConverter.convertXMLString(a,{},function(a){pm.collections.importCollectionData(a)},function(a){pm.collections.showImportError("WADL",a)})},importFiles:function(a){for(var b,c=this,d=0;b=a[d];d++){var e=new FileReader;e.onload=function(){return function(a){var b=a.currentTarget.result;try{b=b.trim();var d=c.guessFileFormat(b);if(0===d)throw"Could not parse";c.importData(b,d)}catch(a){pm.mediator.trigger("failedCollectionImport","format not recognized")}}}(b),e.readAsText(b)}},importCollections:function(a){for(var b,c=this,d=0;b=a[d];d++){var e=new FileReader;e.onload=function(){return function(a){var b=a.currentTarget.result;try{b=b.trim();var d=jsonlint.parse(b);c.importCollectionData(d)}catch(a){pm.mediator.trigger("failedCollectionImport","could not import collection - "+a.message)}}}(b),e.readAsText(b)}},importFileFromUrl:function(a){var b=this;$.ajax({type:"GET",url:a,success:function(a){try{if("object"!=typeof a||a instanceof Node)if(a instanceof Node){var c=b.guessFileFormat(a,!1);if(0===c)throw"Could not parse";var d=new XMLSerializer;a=d.serializeToString(a),b.importData(a,c,!1)}else{a=a.trim();var c=b.guessFileFormat(a,!1);if(0===c)throw"Could not parse";b.importData(a,c,!1)}else{var c=b.guessFileFormat(a,!0);if(0===c)throw"Could not parse";b.importData(a,c,!0)}}catch(e){pm.mediator.trigger("failedCollectionImport","format not recognized")}}})},getRequestById:function(a){function b(b){return b.id===a}for(var c=0;c<this.models.length;c++){var d=this.models[c],e=d.get("requests"),f=_.find(e,b);if(f)return f}return null},getRequestLocation:function(a){for(var b,c,d,e,f,b=0;b<this.models.length;b++){if(c=this.models[b],d=_.indexOf(c.get("order"),a),d>=0)return{type:"collection",collectionId:c.get("id")};for(e=c.get("folders"),j=0;j<e.length;j++)if(f=_.indexOf(e[j].order,a),f>=0)return{type:"folder",folderId:e[j].id,collectionId:c.get("id")}}return{type:"not_found"}},loadCollectionRequest:function(a){var b=this;pm.indexedDB.getCollectionRequest(a,function(c){return c?(c.isFromCollection=!0,c.collectionRequestId=a,pm.mediator.trigger("loadRequest",c,!0),void b.trigger("selectedCollectionRequest",c)):void pm.syncLogger.error("Could not find request to load. Id: "+a)})},addRequestToCollectionId:function(a,b){var c=this;a.collectionId=b;var d=c.get(b),e=c.getJSONFromCollection(d);d.addRequestIdToOrder(a.id),c.addRequestToDataStore(a,!0,!0,function(a){c.updateCollectionInDataStore(d.getAsJSON(),e,!0,function(){c.trigger("addCollectionRequest",a,!0)})})},addFullCollectionRequest:function(a,b){var c,d=this;try{if(c=this.getCollectionById(a.collection),!c)throw"The parent collection no longer exists.";var e=c.requestExistsInCollectionRoot(a.id),f=c.requestExistsInCollectionFolders(a.id);e||f||c.addRequestIdToOrder(a.id),a.write=1==c.get("write")||pm.user.id==c.get("owner"),this.addRemoteRequestToDataStore(a,!0,function(a){null!=a.folder&&a.folder.length>0?d.moveRequestToFolderWithOptSync(a.id,a.folder,!1,b):(d.trigger("addCollectionRequest",a,!1,!1),"function"==typeof b&&b()),pm.mediator.trigger("syncOperationDone")})}catch(g){return pm.syncLogger.error("Error while adding request: "+(g.stack||g)),"function"==typeof b&&b(),-1}return 0},addRequestToCollection:function(a,b,c,d){"undefined"==typeof c&&(c=!1);var e=this;if(b.name){b.requests=[],b.order=[a.id],b.timestamp=(new Date).getTime();{[a.id]}e.addCollectionToDataStore(b,!0,!1,function(){e.addRequestToDataStore(a,!0,!1,function(a){e.trigger("addCollectionRequest",a,!0),e.loadCollectionRequest(a.id),d&&(pm.syncManager.trigger("singleSyncDone"),pm.mediator.trigger("commitTransaction",b.id))})})}else{a.collectionId=b.id,a.collectionOwner=0;var f=e.get(b.id),g=e.getJSONFromCollection(f);f.addRequestIdToOrder(a.id),e.addRequestToDataStore(a,!0,!0,function(a){e.updateCollectionInDataStoreWithoutSync(f.getAsJSON(),g,!0,function(){e.trigger("addCollectionRequest",a,!0),e.loadCollectionRequest(a.id)})})}this.trigger("updateCollectionRequest",a,c),pm.mediator.trigger("updateCollectionRequest",a)},addRequestToFolder:function(a,b,c,d,e){"undefined"==typeof d&&(d=!1);var f=this,g=this.get(b);a.collectionId=b,a.folder=c,g.addRequestIdToOrder(a.id);this.getFolderById(c);f.addRequestToDataStore(a,!0,e,function(a){return function(b){f.moveRequestToFolderWithOptSync(b.id,a,!1)}}(c)),d||noty({type:"success",text:"Saved request",layout:"topCenter",timeout:750})},addResponseToCollectionRequestWithOptSync:function(a,b,c,d){var e=this;return pm.indexedDB.getCollectionRequest(a,function(a,b,c){return function(d){if(!d)return void("function"==typeof a&&a());var f=e.getJSONFromRequest(d),g=pm.collections.getCollectionById(d.collectionId);b.write=1==g.get("write")||pm.user.id==g.get("owner"),d.responses instanceof Array?d.responses.push(b):d.responses=[b];var h=_.clone(b);e.updateRequestInDataStore(d,f,!0,function(b){e.trigger("updateCollectionRequest",b,!0),pm.mediator.trigger("updateCollectionRequest",b),c&&(h.requestObject=JSON.stringify(h.request),h.request=b.id,h.collection=b.collection,h.collectionId=b.collectionId,h.owner=b.owner,pm.syncManager.addChangeset("response","create",h,null,!0)),"function"==typeof a&&a()},!1)}}(d,b,c)),0},addResponsesToCollectionRequestWithoutSync:function(a,b,c){var d=this,e=_.cloneDeep(b);return pm.indexedDB.getCollectionRequest(a,function(a){var b=d.getJSONFromRequest(a),f=pm.collections.getCollectionById(a.collection);_.each(e,function(a){a.write=f.get("write")||pm.user.id==f.get("owner")}),a.responses=a.responses instanceof Array?a.responses.concat(e):e,d.updateRequestInDataStore(a,b,!0,function(a){d.trigger("updateCollectionRequest",a,!0),pm.mediator.trigger("updateCollectionRequest",a),c&&c()},!1)}),0},addResponseToCollectionRequest:function(a,b){this.addResponseToCollectionRequestWithOptSync(a,b,!0)},updateResponsesForCollectionRequestWithOptSync:function(a,b,c){var d=this;pm.indexedDB.getCollectionRequest(a,function(a){var e=d.getJSONFromRequest(a);a.responses=b,d.updateRequestInDataStore(a,e,!0,function(a){d.trigger("updateCollectionRequest",a,!0),pm.mediator.trigger("updateCollectionRequest",a)},c)})},updateResponsesForCollectionRequest:function(a,b){this.updateResponsesForCollectionRequestWithOptSync(a,b,!0)},updateCollectionRequest:function(a){var b=this;pm.indexedDB.getCollectionRequest(a.id,function(c){var d=b.getJSONFromRequest(c);a.name=c.name,a.description=c.description,a.collectionId=c.collectionId,a.responses=c.responses,b.updateRequestInDataStore(a,d,!0,function(a){b.trigger("updateCollectionRequest",a),pm.mediator.trigger("updateCollectionRequest",a)},!0)})},updateRemoteCollectionRequest:function(a,b){try{var c=this,d=pm.collections.getRequestById(a.id),e=this.mergeEntitiesForUpdate(a,d);c.updateRequestInDataStore(e,d,!0,function(a){c.trigger("updateCollectionRequest",a,!0),pm.mediator.trigger("updateCollectionRequest",a),pm.mediator.trigger("syncOperationDone"),b&&b()},!1)}catch(f){return console.log("Updating collection request failed: "+f),b(),-1}return 0},updateCollectionRequestMeta:function(a,b,c){var d=this;pm.indexedDB.getCollectionRequest(a,function(a){var e=d.getJSONFromRequest(a);a.name=b,a.description=c,d.updateRequestInDataStore(a,e,!0,function(a){d.trigger("updateCollectionRequest",a),pm.mediator.trigger("updateCollectionRequest",a)},!0)
})},updateCollectionRequestSyncStatus:function(a,b){var c=this;pm.indexedDB.getCollectionRequest(a,function(a){var d=c.getJSONFromRequest(a);a.synced=b,c.updateRequestInDataStore(a,d,!1,function(){})})},updateCollectionRequestTests:function(a,b){var c=this;pm.indexedDB.getCollectionRequest(a,function(a){var d=c.getJSONFromRequest(a);a.tests=b,c.updateRequestInDataStore(a,d,!0,function(a){c.trigger("updateCollectionRequest",a),pm.mediator.trigger("updateCollectionRequest",a)},!0)})},deleteCollectionRequestWithOptSync:function(a,b,c){var d=this;return d.deleteRequestFromDataStoreWithOptSync(a,!0,!0,b,function(){d.trigger("removeCollectionRequest",a),pm.mediator.trigger("syncOperationDone"),c&&c()}),0},deleteCollectionRequest:function(a,b){this.deleteCollectionRequestWithOptSync(a,!0,b)},addRequestToFolder_old:function(a,b,c){b.order.push(a),c&&pm.syncManager.addChangeset("folder","update",b,null,!0)},getRemoteRequestIntoCollectionOrFolder:function(a,b,c,d,e){var f=this;pm.syncManager.getEntityFromId("request",a,d,null,function(a){return a.hasOwnProperty("err")?void pm.mediator.trigger("syncOperationFailed",a.err):(a.collectionId=c,b&&(a.folder=b),"raw"===a.dataMode&&a.rawModeData&&(a.data=a.rawModeData,delete a.rawModeData),void f.addFullCollectionRequest(a,e))})},moveRequestToFolderWithOptSync:function(a,b,c,d){pm.requestTransferInProgress=!0,setTimeout(function(){pm.requestTransferInProgress=!1},200);var e=this,f=this.getRequestById(a);b=b.substring(b.indexOf("#")+1);var g=this.getFolderById(b),h=this.getCollectionForFolderId(b);if(null==f&&null!=h){var i=h.get("owner");this.getRemoteRequestIntoCollectionOrFolder(a,b,h.get("id"),i,d)}else if(null==g||null==h)this.deleteCollectionRequestWithOptSync(a,!1,d);else{var j={};j=null!=f.folder?{model:"folder",model_id:f.folder,collection_id:f.collectionId,owner:pm.collections.getOwnerForCollection(f.collectionId)}:{model:"collection",model_id:f.collectionId,collection_id:f.collectionId,owner:pm.collections.getOwnerForCollection(f.collectionId)};var k=e.getJSONFromCollection(h);if(h.id===f.collectionId){c&&pm.tracker.trackEvent("request","transfer","same_collection"),h.addRequestIdToFolder(g.id,f.id);var l=_.clone(f);f.folder=g.id,h.removeRequestIdFromOrder(f.id),e.updateRequestInDataStore(f,l,!0,function(){e.updateCollectionInDataStoreWithoutSync(h.getAsJSON(),k,!0,function(){e.trigger("moveRequestToFolder",j,h,g,f,c),pm.mediator.trigger("syncOperationDone"),"function"==typeof d&&d()})},!1)}else{c&&pm.tracker.trackEvent("request","transfer","different_collection");var m=guid();e.deleteCollectionRequestWithOptSync(a,!0,function(a,b,c,d,f,g,h){return function(){var i=a.id;a.id=b,a.collectionId=c.get("id"),a.folder=d.id,a.owner=c.get("owner"),e.addRequestToDataStoreWithOptSync(a,!0,!0,!0,function(b,c,d,f){return function(h){b.addRequestIdToFolder(c.id,h.id);var j=b.getAsJSON();e.updateCollectionInDataStoreWithoutSync(j,d,!0,function(a,b,c,d,f,g){return function(){e.trigger("moveRequestToFolder",a,b,c,d,!1,g),pm.mediator.trigger("syncOperationDone"),"function"==typeof f&&f()}}(g,b,c,a,f,i))}}(c,d,f,h))}}(f,m,h,g,k,j,d))}}},moveRequestToFolder:function(a,b){this.moveRequestToFolderWithOptSync(a,b,!0)},moveRequestToCollection:function(a,b){this.moveRequestToCollectionWithOptSync(a,b,!0)},moveRequestToCollectionWithOptSync:function(a,b,c,d){pm.requestTransferInProgress=!0,setTimeout(function(){pm.requestTransferInProgress=!1},200);var e=this,f=this.get(b),g=_.clone(this.getRequestById(a));if(null==g&&null!=f){var h=f.get("owner");this.getRemoteRequestIntoCollectionOrFolder(a,null,f.get("id"),h,d)}else if(null==f)this.deleteCollectionRequestWithOptSync(a,!1,d);else{g.owner=pm.collections.getOwnerForCollection(g.collectionId);var i={};i=null!=g.folder?{model:"folder",model_id:g.folder,collection_id:g.collectionId,owner:g.owner}:{model:"collection",model_id:g.collectionId,collection_id:g.collectionId,owner:g.owner};var j=e.getJSONFromCollection(f);if(b===g.collectionId){c&&pm.tracker.trackEvent("request","transfer","same_collection"),f.addRequestIdToOrder(g.id);var k=_.clone(g);delete g.folder,e.updateRequestInDataStore(g,k,!0,function(a){e.updateCollectionInDataStoreWithoutSync(f.getAsJSON(),j,!0,function(){e.trigger("moveRequestToCollection",i,f,a,c),pm.mediator.trigger("syncOperationDone"),d&&d()})})}else{var l=guid();e.deleteCollectionRequestWithOptSync(a,!0,function(){g.id=l,g.collectionId=b,g.owner=f.get("owner"),delete g.folder,c&&pm.tracker.trackEvent("request","transfer","different_collection"),e.trigger("removeCollectionRequest",a),f.addRequestIdToOrder(g.id),e.addRequestToDataStoreWithOptSync(g,!0,!0,!0,function(){e.updateCollectionInDataStoreWithoutSync(f.getAsJSON(),j,!0,function(){e.trigger("addCollectionRequest",g,!1,!1),pm.mediator.trigger("syncOperationDone"),d&&d()})})})}}},getFolderById:function(a){function b(b){return b.id===a}for(var c=0;c<this.length;c++){var d=this.models[c],e=d.get("folders"),f=_.find(e,b);if(f)return f}return null},addFolder:function(a,b,c){var d=this.get(a),e=this.getJSONFromCollection(d),f={id:guid(),name:b,description:c,write:d.get("write")||pm.user.id==d.get("owner"),order:[]};d.addFolder(f),this.trigger("addFolder",d,f),this.updateCollectionInDataStoreWithoutSync(d.getAsJSON(),e,!0),f.collection=a,f.owner=d.get("owner"),pm.syncManager.addChangeset("folder","create",f,null,!0)},addExistingFolder:function(a,b,c){var d=this.get(a),e=this.getJSONFromCollection(d);d.hasFolderId(b.id)||(d.addFolder(b),this.trigger("addFolder",d,b),this.updateCollectionInDataStoreWithoutSync(d.getAsJSON(),e,!0),b.collection=a,pm.syncManager.addChangeset("folder","create",b,null,c))},addFolderFromRemote:function(a,b){var c,d;try{if(c=this.get(a.collection),!c)throw"The parent collection no longer exiloadsts";if(d=this.getJSONFromCollection(c),a.write=c.get("write")||pm.user.id==c.get("owner"),c.hasFolderId(a.id))throw"The folderID already exists in the collection. Not re-adding.";c.addFolder(a),this.trigger("addFolder",c,a),this.updateCollectionInDataStoreWithoutSync(c.getAsJSON(),d,!0,b),pm.mediator.trigger("syncOperationDone")}catch(e){"function"==typeof b&&b()}return 0},updateFolderFromRemote:function(a,b){var c,d;try{c=this.get(a.collection),d=this.getJSONFromCollection(c),c.editFolder(a),this.trigger("updateFolder",c,a),this.updateCollectionInDataStoreWithoutSync(c.getAsJSON(),d,!0,b),pm.mediator.trigger("syncOperationDone")}catch(e){return b(),-1}return 0},updateFolderOrder:function(a,b,c){var d=this.getFolderById(b);d.order=c;var e=this.get(a),f=this.getJSONFromCollection(e);e.editFolder(d),this.updateCollectionInDataStoreWithoutSync(e.getAsJSON(),f,!0),d.collectionId=a,pm.syncManager.addChangeset("folder","update",d,null,!0)},updateFolderMeta:function(a,b,c){var d=this.getFolderById(a);d.name=b,d.description=c;var e=this.getCollectionForFolderId(a),f=this.getJSONFromCollection(e);e.editFolder(d),this.trigger("updateFolder",e,d),this.updateCollectionInDataStoreWithoutSync(e.getAsJSON(),f,!0),d.collectionId=e.getAsJSON().id;var g=_.clone(d);delete g.order,pm.syncManager.addChangeset("folder","update",g,null,!0)},deleteFolderWithOptSync:function(a,b,c){var d=this.getFolderById(a);if(!d)return pm.mediator.trigger("syncOperationDone"),void(c&&c());var e,f,g=_.clone(d.order);for(e=0;e<g.length;e++)this.deleteRequestFromDataStoreWithOptSync(g[e],!0,!1,!1,null);f=this.getCollectionForFolderId(a);var h=this.getJSONFromCollection(f);f.deleteFolder(a),this.trigger("deleteFolder",f,a),this.updateCollectionInDataStoreWithoutSync(f.getAsJSON(),h,!0,function(){b&&pm.syncManager.addChangeset("folder","destroy",{id:a,owner:f.get("owner")},null,!0),pm.mediator.trigger("syncOperationDone"),c&&c()})},deleteFolder:function(a){this.deleteFolderWithOptSync(a,!0)},filter:function(a){a=a.toLowerCase();var b,c,d,e,f,g,h,i,j,k,l,m=this.toJSON(),n=m.length,o=[],p={};for(e=0;n>e;e++){if(h={id:m[e].id,name:m[e].name,requests:[],folders:[],toShow:!1},b=m[e].name.toLowerCase(),b.search(a)>=0&&(h.toShow=!0),c=m[e].requests)for(d=c.length,f=0;d>f;f++)i={id:c[f].id,name:c[f].name,toShow:!1},b=c[f].name.toLowerCase(),b.search(a)>=0?(i.toShow=!0,h.toShow=!0,p[i.id]=!0):(i.toShow=!1,p[i.id]=!1),h.requests.push(i);if("folders"in m[e])for(k=m[e].folders,f=0;f<k.length;f++){for(j={id:k[f].id,name:k[f].name,toShow:!1},b=k[f].name.toLowerCase(),b.search(a)>=0&&(j.toShow=!0,h.toShow=!0),l=k[f].order,g=0;g<l.length;g++)if(p[l[g]]===!0){j.toShow=!0,h.toShow=!0;break}h.folders.push(j)}o.push(h)}return this.trigger("filter",o),o},revert:function(){this.trigger("revertFilter")},onSyncChangeReceived:function(a,b,c){b.model||(b.model=b.type);var d=["collection","request","response","folder"];-1!==d.indexOf(b.model)&&("create"===a?this.createRemoteEntity(b,c):"update"===a?this.updateRemoteEntity(b,c):"destroy"===a||"delete"===a?this.deleteRemoteEntity(b,c):"transfer"===a&&this.transferRemoteEntity(b,c))},createRemoteEntity:function(a,b){if("collection"===a.model){a.data.requests=[];var c=this.addFullCollection(a.data,!0,b);-1==c?pm.mediator.trigger("syncOperationFailed","Adding full collection failed"):(pm.syncManager.updateSinceFromMessage(a),a.data.order&&this.trigger("sortRequestContainer","collection",a.data.id,a.data.order)),pm.syncLogger.log(new Error,["Collection created: ",a.data])}else if("request"===a.model){a.data.collectionId=a.data.collection,"raw"===a.data.dataMode&&a.data.rawModeData&&(a.data.data=a.data.rawModeData,delete a.data.rawModeData);var c=this.addFullCollectionRequest(a.data,b);-1==c?pm.mediator.trigger("syncOperationFailed","Adding full collection request failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["Request created: ",a.data])}else if("response"===a.model){var d=a.data.request,e=new RegExp("\n","g");a.data.requestObject&&(a.data.requestObject=a.data.requestObject.replace(e,""));try{a.data.request=JSON.parse(a.data.requestObject)}catch(f){a.data.request={}}var c=this.addResponseToCollectionRequestWithOptSync(d,a.data,!1,b);-1==c?pm.mediator.trigger("syncOperationFailed","Adding response to request failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["Response added: ",a.data])}else if("folder"===a.model){var c=pm.collections.addFolderFromRemote(a.data,b);-1==c?pm.mediator.trigger("syncOperationFailed","Add folder from remote failed"):(pm.syncManager.updateSinceFromMessage(a),a.data.order&&this.trigger("sortRequestContainer","folder",a.data.id,a.data.order)),pm.syncLogger.log(new Error,["Folder added: ",a.data])}},updateRemoteEntity:function(a,b){if("collection"===a.model){var c=pm.collections.updateRemoteCollectionInDataStore(a.data,null,!0,b);-1==c?pm.mediator.trigger("syncOperationFailed","Updating collection failed"):(pm.syncManager.updateSinceFromMessage(a),a.data.order&&this.trigger("sortRequestContainer","collection",a.data.id,a.data.order)),pm.syncLogger.log(new Error,["Collection updated: ",a.data])}else if("request"===a.model){a.data.collectionId=a.data.collection,"raw"===a.data.dataMode&&a.data.rawModeData&&(a.data.data=a.data.rawModeData,delete a.data.rawModeData);var c=pm.collections.updateRemoteCollectionRequest(a.data,b);-1==c?pm.mediator.trigger("syncOperationFailed","Updating collection request failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["Request updated: ",a.data])}else if("folder"===a.model){var c=pm.collections.updateFolderFromRemote(a.data,b);-1==c?pm.mediator.trigger("syncOperationFailed","Updating folder failed"):(pm.syncManager.updateSinceFromMessage(a),a.data.order&&this.trigger("sortRequestContainer","folder",a.data.id,a.data.order)),pm.syncLogger.log(new Error,["Folder updated: ",a.data])}},deleteRemoteEntity:function(a,b){if("collection"===a.model){pm.syncLogger.log(new Error,["Collection destroyed: ",a.data]),pm.subscriptionManger.isSubscribedTo(a.data.id)&&(a.data.model_id=a.data.id,pm.mediator.trigger("unsubscribeFromCollection",a,!1,function(){}));var c=pm.collections.deleteCollectionFromDataStoreWithOptSync(a.data.id,!0,!1,b);-1==c?pm.mediator.trigger("syncOperationFailed","Deleting collection failed"):pm.syncManager.updateSinceFromMessage(a)}else if("request"===a.model){pm.syncLogger.log(new Error,["Request destroyed: ",a.data]);var c=pm.collections.deleteCollectionRequestWithOptSync(a.data.id,!1,b);-1==c?pm.mediator.trigger("syncOperationFailed","Deleting collection request failed"):pm.syncManager.updateSinceFromMessage(a)}else if("folder"===a.model){pm.syncLogger.log(new Error,["Folder destroyed: ",a.data]);var c=pm.collections.deleteFolderWithOptSync(a.data.id,!1,b);-1==c?pm.mediator.trigger("syncOperationFailed","Deleting folder failed"):pm.syncManager.updateSinceFromMessage(a)}else"response"===a.model&&(pm.syncLogger.log(new Error,["Response destroyed: ",a.data]),pm.request.deleteSampleResponseByIdWithOptSync(a.data.id,!1,b),pm.syncManager.updateSinceFromMessage(a))},transferRemoteEntity:function(a,b){var c=a.data.to.model;"folder"===c?this.moveRequestToFolderWithOptSync(a.data.id,a.data.to.model_id,!1,b):"collection"===c&&this.moveRequestToCollectionWithOptSync(a.data.id,a.data.to.model_id,!1,b)},onSyncErrorReceived:function(a,b){var c=this;if("collectionIdSharedError"===b.error.name){noty({type:"warning",text:"This collection has already been shared in the team. You can share it if you duplicate it",layout:"topCenter",timeout:5e3});var d=pm.collections.getCollectionById(b.error.details.model_id);d.set("sharedWithTeam",!1),c.updateCollectionInDataStoreWithOptSync(d.getAsJSON(),d,!0,!1,function(){c.trigger("updateCollection",d)})}}}),AddCollectionModal=Backbone.View.extend({initialize:function(){var a=this.model,b=this;pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),$("#form-new-collection").submit(function(){var c=$("#new-collection-blank").val(),d=b.editor.getValue();return a.addCollection(c,d),$("#new-collection-blank").val(""),$("#modal-new-collection").modal("hide"),pm.tracker.trackEvent("collection","add","empty"),!1}),$("#modal-new-collection .btn-primary").click(function(){var c=$("#new-collection-blank").val(),d=b.editor.getValue();return a.addCollection(c,d),$("#new-collection-blank").val(""),$("#modal-new-collection").modal("hide"),pm.tracker.trackEvent("collection","add","empty"),!1}),$("#modal-new-collection").on("shown",function(){$("#new-collection-blank").focus(),pm.app.trigger("modalOpen","#modal-new-collection"),b.editor||b.initializeEditor(),setTimeout(function(){b.editor.setValue("",-1),b.editor.gotoLine(0,0,!1)},150)}),$("#modal-new-collection").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-new-collection").on("keydown","div.input",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?(pm.tracker.trackEvent("interaction","shortcut","create_collection"),$("#form-new-collection").submit(),a.preventDefault(),!1):!0})},onSwitchCodeMirrorTheme:function(a){var b=pm.addCollectionEditor;b&&b.setTheme("ace/theme/"+a)},initializeEditor:function(){if(!this.editor){this.editor=ace.edit(document.getElementById("new-collection-description")),pm.addCollectionEditor=this.editor;var a="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+a)}}}),AddCollectionRequestModal=Backbone.View.extend({initialize:function(){var a=this.model,b=this;pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),b.pendingDescription=null,a.on("add",this.onChanged,this),a.on("remove",this.onChanged,this),a.on("change",this.onChanged,this),a.on("updateCollection",this.onChanged,this),a.on("updateCollectionMeta",this.onChanged,this),a.on("addFolder",this.onChanged,this),a.on("updateFolder",this.onChanged,this),a.on("deleteFolder",this.onChanged,this);var b=this;$("#form-add-to-collection").submit(function(){_.bind(b.addRequestToCollection,b)(),$("#modal-add-to-collection").modal("hide"),$("#new-collection").val("")}),$("#modal-add-to-collection .btn-primary").click(function(){_.bind(b.addRequestToCollection,b)(),$("#modal-add-to-collection").modal("hide"),$("#new-collection").val("")}),$("#modal-add-to-collection").on("shown",function(){$("#select-collection").focus(),pm.app.trigger("modalOpen","#modal-add-to-collection"),$("#blank-collection-error").hide(),b.editor||b.initializeEditor()}),$("#modal-add-to-collection").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-add-to-collection").on("keydown","div.input",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?(pm.tracker.trackEvent("interaction","shortcut","add_req_to_collection"),$("#form-add-to-collection").submit(),a.preventDefault(),!1):!0}),$("#modal-add-to-collection").keydown(function(a){return 13===a.keyCode?($("#form-add-to-collection").submit(),a.preventDefault(),!1):!0}),$(document).bind("keydown","a",function(){return pm.tracker.trackEvent("interaction","shortcut","show_new_collection_modal"),pm.app.isModalOpen()?void 0:($("#modal-add-to-collection").modal({keyboard:!0}),$("#modal-add-to-collection").modal("show"),!1)}),pm.mediator.on("showAddCollectionModal",this.onShowAddCollectionModal,this)},onSwitchCodeMirrorTheme:function(a){var b=pm.addRequestToCollectionEditor;b&&b.setTheme("ace/theme/"+a)},onShowAddCollectionModal:function(a,b){$("#new-request-name").val(a),this.editor?(b?this.editor.setValue(b,-1):this.editor.setValue("",-1),this.pendingDescription=null):this.pendingDescription=b,$("#modal-add-to-collection").modal("show")},initializeEditor:function(){if(!this.editor){this.editor=ace.edit(document.getElementById("new-request-description"));var a="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+a),this.editor.getSession().setMode("ace/mode/markdown"),pm.addRequestToCollectionEditor=this.editor,this.pendingDescription?(this.editor.setValue(this.pendingDescription,-1),this.pendingDescription=null):(this.editor.setValue("",-1),this.pendingDescription=null),$("#blank-collection-error").hide()}},add:function(a){$("#select-collection").append(Handlebars.templates.item_collection_selector_list(a.toJSON()))},remove:function(a){var b=a.toJSON();$('#select-collection option[value="'+b.id+'"]').remove()},onChanged:function(){for(var a,b=_.clone(this.model.toJSON()),c=0;c<b.length;c++)if("folders"in b[c]){a=b[c].folders,a.sort(sortAlphabetical);for(var d=0;d<a.length;d++)a[d].collection_name=b[c].name,a[d].collection_owner=b[c].owner,a[d].collection_id=b[c].id}$("#select-collection").html("<option>Select</option>"),$("#select-collection").append(Handlebars.templates.collection_selector_list({items:this.model.toJSON()})),$("#select-collection").val(this.lastSelectValue)},addRequestToCollection:function(){$("#blank-collection-error").hide();var a=$("#select-collection").val();this.lastSelectValue=a;var b,c,d=$("#select-collection option[value='"+a+"']"),e=d.attr("data-type");"collection"===e?b=d.attr("data-collection-id"):"folder"===e&&(b=d.attr("data-collection-id"),c=d.attr("data-folder-id"));var f=(d.attr("data-collection-owner"),$("#new-collection").val()),g={};if(f)pm.tracker.trackEvent("request","add","new_collection"),pm.tracker.trackEvent("collection","add","request"),e="collection",g.id=guid(),g.name=f;else{if(!b)return void $("#blank-collection-error").show();g.id=b,pm.tracker.trackEvent("request","add","existing_collection")}var h=$("#new-request-name").val(),i=this.editor.getValue(),j=this.model;pm.mediator.trigger("getRequest",function(a){var d=a.get("body"),f=a.get("url");""===h&&(h=f);var k,l,m,n=pm.helpers.getActiveHelperType();"normal"!==n?(k=pm.helpers.getHelper(n).attributes,l=a.getHelperProperties(k),m=$("#request-helper-"+n+"-saveHelper").is(":checked")):m=!1,m===!1&&(n="normal",l={});var o={id:guid(),headers:a.getPackedHeaders(),url:f,pathVariables:a.get("pathVariables"),preRequestScript:a.get("preRequestScript"),method:a.get("method"),collectionId:g.id,data:d.get("dataAsObjects"),dataMode:d.get("dataMode"),name:h,description:i,descriptionFormat:"html",time:(new Date).getTime(),version:2,responses:[],tests:a.get("tests"),currentHelper:n,helperAttributes:l};"folder"===e?(o.folder=c,j.addRequestToFolder(o,b,c,!1,!0)):j.addRequestToCollection(o,g,!1,!0)})}}),AddFolderModal=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("showAddFolderModal",this.render,this),pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),$("#form-add-folder").submit(function(){var c=$("#add-folder-parent-id").val(),d=$("#add-folder-name").val(),e=b.editor.getValue();return a.addFolder(c,d,e),$("#add-folder-name").val(""),$("#modal-add-folder").modal("hide"),pm.tracker.trackEvent("folder","add"),!1}),$("#modal-add-folder .btn-primary").click(function(){var c=$("#add-folder-parent-id").val(),d=$("#add-folder-name").val(),e=b.editor.getValue();return a.addFolder(c,d,e),$("#add-folder-name").val(""),$("#modal-add-folder").modal("hide"),pm.tracker.trackEvent("folder","add"),!1}),$("#modal-add-folder").on("shown",function(){$("#add-folder-name").focus(),pm.app.trigger("modalOpen","#modal-add-folder"),b.editor||b.initializeEditor(),setTimeout(function(){b.editor.setValue("",-1),b.editor.gotoLine(0,0,!1)},150)}),$("#modal-add-folder").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-add-folder").on("keydown","div.input",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?($("#form-add-folder").submit(),a.preventDefault(),!1):!0})},onSwitchCodeMirrorTheme:function(a){var b=this.editor;b&&b.setTheme("ace/theme/"+a)},render:function(a){$("#add-folder-header").html("Add folder inside "+a.get("name")),$("#add-folder-parent-id").val(a.get("id")),$("#add-folder-parent-owner").val(a.get("owner")),$("#modal-add-folder").modal("show")},onSwitchCodeMirrorTheme:function(a){var b=pm.addFolderEditor;b&&b.setTheme("ace/theme/"+a)},initializeEditor:function(){if(!this.editor){this.editor=ace.edit(document.getElementById("add-folder-description")),pm.addFolderEditor=this.editor;var a="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+a),this.editor.getSession().setMode("ace/mode/markdown")}}}),CollectionSidebar=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("add",this.renderOneCollection,this),a.on("remove",this.removeOneCollection,this),a.on("reset",this.removeAllCollections,this),a.on("updateCollection",this.renderOneCollection,this),a.on("updateCollectionMeta",this.renderOneCollection,this),a.on("addCollectionRequest",this.addCollectionRequest,this),a.on("selectedCollectionRequest",this.selectedCollectionRequest,this),a.on("removeCollectionRequest",this.removeCollectionRequest,this),a.on("updateCollectionRequest",this.updateCollectionRequest,this),a.on("moveRequestToCollection",this.onMoveRequestToCollection,this),a.on("moveRequestToFolder",this.onMoveRequestToFolder,this),a.on("sortRequestContainer",this.onSortRequestContainer,this),a.on("duplicateCollection",this.duplicateCollection,this),a.on("duplicateCollectionRequest",this.duplicateCollectionRequest,this),a.on("duplicateFolder",this.duplicateFolder,this),a.on("addFolder",this.onAddFolder,this),a.on("updateFolder",this.onUpdateFolder,this),a.on("deleteFolder",this.onDeleteFolder,this),a.on("filter",this.onFilter,this),a.on("revertFilter",this.onRevertFilter,this),$("#collection-items").html(""),$("#collection-items").append(Handlebars.templates.message_no_collection({}));var c=$("#collection-items");c.on("mouseover",".sidebar-collection .sidebar-collection-head",function(){jQuery(".folder-head-actions,.collection-head-actions,.request-actions").hide();var a=jQuery(".collection-head-actions",this);a.css("display","block")}),c.on("mouseleave",".sidebar-collection .sidebar-collection-head",function(){var a=jQuery(".collection-head-actions",this);a.css("display","none")}),c.on("mouseover",".folder .folder-head",function(){jQuery(".folder-head-actions,.collection-head-actions,.request-actions").hide();var a=jQuery(".folder-head-actions",this);a.css("display","block")}),c.on("mouseleave",".folder .folder-head",function(){var a=jQuery(".folder-head-actions",this);a.css("display","none")}),c.on("click",".sidebar-collection-head-name",function(){var a=$(this).attr("data-id");$(this).removeClass("just-subscribed"),b.toggleRequestList(a)}),c.on("click",".folder-head-name",function(){var a=$(this).attr("data-id");b.toggleSubRequestList(a)}),c.on("click",".collection-action-duplicate",function(){var b=$(this).attr("data-id"),c=a.get(b);a.trigger("duplicateCollection",c),pm.tracker.trackEvent("collection","duplicate")}),c.on("click",".collection-head-actions .label",function(){var a=$(this).parent().parent().parent().attr("data-id");b.toggleRequestList(a)}),c.on("click",".collection-actions-add-folder",function(){var b=$(this).attr("data-id"),c=a.get(b);a.trigger("showAddFolderModal",c)}),c.on("click",".collection-actions-edit",function(){var b=$(this).attr("data-id"),c=a.get(b);a.trigger("showEditModal",c)}),c.on("click",".collection-actions-delete",function(){var a=$(this).attr("data-id"),b=$(this).attr("data-name"),c=$(this).attr("data-shared");$("#modal-delete-collection-yes").attr("data-id",a),$("#modal-delete-collection-yes").attr("data-shared",c);$(this).attr("data-shared");$("#collection-share-warning").html(""),$("#modal-delete-collection-name").html(b)}),c.on("click",".collection-actions-unsubscribe",function(){var a=$(this).attr("data-id"),b=$(this).attr("data-owner"),c={owner:b,model_id:a};pm.syncManager.addChangeset("collection","unsubscribe",{owner:c.owner},c.model_id,!0);pm.collections.deleteCollectionFromDataStoreWithOptSync(c.model_id,!0,!1,function(){})}),c.on("click",".folder-actions-edit",function(){var b=$(this).attr("data-id"),c=a.getFolderById(b);a.trigger("showEditFolderModal",c)}),c.on("click",".folder-actions-delete",function(){var a=$(this).attr("data-id"),b=$(this).attr("data-name");$("#modal-delete-folder-yes").attr("data-id",a),$("#modal-delete-folder-name").html(b)}),c.on("click",".collection-actions-download",function(){var b=$(this).attr("data-id");a.trigger("shareCollectionModal",b)}),$("#collection-items").on("mouseover",".sidebar-request",function(){jQuery(".folder-head-actions,.collection-head-actions,.request-actions").hide();var a=jQuery(".request-actions",this);a.css("display","block")}),$("#collection-items").on("mouseleave",".sidebar-request",function(){var a=jQuery(".request-actions",this);a.css("display","none")}),$("#collection-items").on("mouseenter",".sidebar-collection-request",function(){$(this).addClass("hover")}),$("#collection-items").on("mouseleave",".sidebar-collection-request",function(){$(this).removeClass("hover")}),c.on("click",".request-actions-load",function(){var b=$(this).attr("data-id");a.loadCollectionRequest(b),$(".sidebar-history-request").removeClass("sidebar-history-request-active")}),c.on("click",".request-actions-delete",function(){var b=$(this).attr("data-id"),c=a.getRequestById(b);a.trigger("deleteCollectionRequest",c)}),c.on("click",".request-actions-edit",function(){var b=$(this).attr("data-id"),c=a.getRequestById(b);a.trigger("editCollectionRequest",c)}),c.on("click",".request-actions-duplicate",function(){var b=$(this).attr("data-id"),c=a.getRequestById(b);a.trigger("duplicateCollectionRequest",c),pm.tracker.trackEvent("request","duplicate")}),c.on("click",".folder-actions-duplicate",function(){var b=$(this).attr("data-id"),c=a.getFolderById(b);a.trigger("duplicateFolder",c)}),this.collectionSortTimers={}},_updateSidebar:function(){clearTimeout(pm.globals.updateSidebarTooltips),pm.globals.updateSidebarTooltips=setTimeout(function(){$("#sidebar-section-collections [rel='tooltip']").tooltip()},500)},duplicateCollectionRequest:function(a){if(a){var b=this.model.getCollectionById(a.collectionId);if(b){var c=a.id,d=_.clone(a);this.setNewIdsForResponses(d),d.name=a.name+" copy",d.id=guid();var e=b.get("order"),f=b.get("folders");if(e.indexOf(c)>=0)return void this.model.addRequestToCollection(d,b,!0,!0);var g=this;_.each(f,function(a){return a.order.indexOf(c)>=0?void g.model.addRequestToFolder(d,b.id,a.id,!0,!0):void 0})}}},setNewIdsForResponses:function(a){if(a.responses)for(var b=a.responses.length,c=0;b>c;c++)a.responses[c].id=guid()},duplicateFolder:function(a){var b=this.model.getCollectionById(a.collection_id);if(b){var c=this.cloneFolder(a);c.name=a.name+" copy",this.model.addExistingFolder(b.id,c,!0);for(var d=this,e=a.order.length,f=0;e>f;f++){var g=a.order[f],h=d.model.getRequestById(g);if(h){var i=_.clone(h);i.folder=c.id,i.id=guid(),d.model.addRequestToFolder(i,b.id,c.id,!0,!1)}}pm.tracker.trackEvent("folder","duplicate"),setTimeout(function(){pm.syncManager.trigger("singleSyncDone"),pm.mediator.trigger("commitTransaction",b.id)},1e3)}},duplicateCollection:function(a){if(a){var b={};b.id=guid(),b.name=a.get("name")+" copy",b.description=a.get("description"),b.order=[],b.timestamp=(new Date).getTime(),b.owner=pm.user.id;var c=this;this.model.addCollectionToDataStore(b,!0,!0,function(){var d=c.model.getCollectionById(b.id),e={};_.each(a.get("folders"),function(a){var b=c.cloneFolder(a);b.write=!0,b.owner=pm.user.id,e[a.id]=b.id,c.model.addExistingFolder(d.id,b,!1)});var f=a.get("order"),g=a.get("folders"),h=a.get("requests");_.each(f,function(a){var b=_.find(h,function(b){return b.id==a}),e=_.clone(b);e.owner=pm.user.id,e.write=!0,delete e.folder,_.each(e.responses,function(a){a.write=!0,a.id=guid()}),e.id=guid(),e.collectionId=d.id,c.model.addRequestToCollection(e,d,!0,!1)}),_.each(g,function(a){_.each(a.order,function(b){var f=_.find(h,function(a){return a.id==b}),g=_.clone(f);g&&(g.id=guid(),g.write=!0,_.each(g.responses,function(a){a.write=!0,a.id=guid()}),g.owner=pm.user.id,g.collectionId=d.id,c.model.addRequestToFolder(g,d.id,e[a.id],!0,!1))})}),setTimeout(function(){pm.syncManager.trigger("singleSyncDone");var a=d.toJSON(),b={id:a.id,order:a.order,owner:a.owner};pm.syncManager.addChangeset("collection","update",b,null,!1),pm.mediator.trigger("commitTransaction",d.id)},Math.min(5e3,100+300*d.toJSON().order.length))})}},cloneFolder:function(a){var b=_.clone(a);return b.id=guid(),b.order=[],b},selectedCollectionRequest:function(a){var b=a.id;$(".sidebar-collection-request").removeClass("sidebar-collection-request-active"),$("#sidebar-request-"+b).addClass("sidebar-collection-request-active")},addRequestListeners:function(){$("#sidebar-sections").on("mouseenter",".sidebar-request",function(){var a=jQuery(".request-actions",this);a.css("display","block")}),$("#sidebar-sections").on("mouseleave",".sidebar-request",function(){var a=jQuery(".request-actions",this);a.css("display","none")})},emptyCollectionInSidebar:function(a){$("#collection-requests-"+a).html("")},removeOneCollection:function(a,b){var c=a.toJSON();$("#collection-"+c.id).remove(),0===b.length&&$("#sidebar-section-collections .empty-message").css("display","block")},removeAllCollections:function(){$("li.sidebar-collection").remove(),$("#sidebar-section-collections .empty-message").css("display","block")},organizeRequestsInFolders:function(a){if(!("folders"in a))return a;if(!("requests"in a))return a;var b,c,d,e,f,g,h=a.write||pm.user.id==a.owner,i=_.clone(a.folders),j=_.clone(a.requests),k=i.length,l=j.length,m=[];for(e=0;k>e;e++){a.folders[e].write=h,b=_.clone(i[e]),c=b.order,g=[];for(var f=0;f<c.length;f++){d=c[f];var n=arrayObjectIndexOf(j,d,"id");n>=0&&(g.push(j[n]),j.splice(n,1))}b.requests=this.orderRequests(g,c),m.push(b)}for(e=0;l>e;e++){a.requests[e].write=h;var o=a.requests[e].responses||[];for(f=0;f<o.length;f++)o[f].write=h}return a.folders=m,a.requests=j,a.requests=this.orderRequests(a.requests,a.order),a},orderRequests:function(a,b){function c(a){return a.id===b[f]}var d=_.clone(a);if(0===b.length)d.sort(sortAlphabetical);else{for(var e=[],f=0,g=b.length;g>f;f++){var h=_.find(d,c);h?e.push(h):(h=pm.collections.getRequestById(b[f]),h&&e.push(h))}d=e}return d},renderOneCollection:function(a){var b=!1;if(a){var c=_.clone(a.toJSON());
c=this.organizeRequestsInFolders(c),$("#sidebar-section-collections .empty-message").css("display","none");var d=$("#collection-"+c.id+" .sidebar-collection-head-dt");if(d.length){var e=d.attr("class");b=e.search("open")>=0}this.renderCollectionContainerInSidebar(c),this.renderFoldersInSidebar(c);var f=c.requests,g="#collection-requests-"+c.id;this.renderRequestsInSidebar(g,f),b&&this.openCollection(c.id,!1)}},renderCollectionContainerInSidebar:function(a){var b,c,d=$("#collection-"+a.id),e=-1,f=(this.model,this.model.toJSON());if(e=arrayObjectIndexOf(f,a.id,"id"),d.length)0===e?f[e+1]?(b="before",c=$("#collection-"+f[e+1].id)):b="none":(b="after",c=$("#collection-"+f[e-1].id)),d.remove();else if(e===f.length-1)b="append";else{var g=f[e+1].id;c=$("#collection-"+g),b=c.length>0?"before":"append"}b?"after"===b?$(c).after(Handlebars.templates.item_collection_sidebar_head(a)):"before"===b?$(c).before(Handlebars.templates.item_collection_sidebar_head(a)):$("#collection-items").append(Handlebars.templates.item_collection_sidebar_head(a)):$("#collection-items").append(Handlebars.templates.item_collection_sidebar_head(a)),a.justSubscribed===!0&&$("li#collection-"+a.id+" .sidebar-collection-head-name").addClass("just-subscribed"),setTimeout(function(){$('#collection-items [rel="tooltip"]').tooltip()},500),(a.write!==!1||a.owner===pm.user.id)&&$("#collection-"+a.id+" .sidebar-collection-head").droppable({accept:".sidebar-collection-request",hoverClass:"ui-state-hover",drop:_.bind(this.handleRequestDropOnCollection,this)})},renderFoldersInSidebar:function(a){var b,c,d,e;if("folders"in a){b=a.folders,b.sort(sortAlphabetical);for(var f,g,h=b.length,e=0;h>e;e++)f=b[e].requests,g=f.length;for(d="#folders-"+a.id,$(d).append(Handlebars.templates.collection_sidebar_folders({folders:b})),(a.write!==!1||a.owner===pm.user.id)&&$("#collection-"+a.id+" .folder-head").droppable({accept:".sidebar-collection-request",hoverClass:"ui-state-hover",drop:_.bind(this.handleRequestDropOnFolder,this)}),e=0;e<b.length;e++)c="#folder-requests-"+b[e].id,this.renderRequestsInSidebar(c,b[e].requests)}},renderRequestsInSidebar:function(a,b){if(b){var c,d=this,e=b.length;if(e>0){for(var f=0;e>f;f++)"undefined"==typeof b[f].name&&(b[f].name=b[f].url),c="#sidebar-request-"+b[f].id,$(c).draggable({});$(a).html(""),$(a).append(Handlebars.templates.collection_sidebar_requests({items:b})),$(a).sortable({axis:"y",delay:150,update:_.bind(d.onUpdateSortableCollectionRequestList,d)})}}},onUpdateSortableCollectionRequestList:function(a){if(console.error("Sortable called at : "+Date.now()),!pm.requestTransferInProgress){var b=this.model,c=this,d=$(a.target).attr("class").search("folder-requests")>=0;if(d){for(var e=$(a.target).attr("data-id"),f=$(a.target).parent(".folder-requests"),g=$(a.target).parents(".sidebar-collection"),h=$(g).attr("data-id"),i=($(f.context).attr("id"),$(f.context).children("li")),j=i.length,k=[],l=pm.collections.getFolderById(e).order,m=0;j>m;m++){var n=$(i[m]);if(!n.hasClass("ui-sortable-placeholder")){var o=n.attr("id"),p=$("#"+o+" .request").attr("data-id");-1!==l.indexOf(p)&&k.push(p)}}k=k.concat(_.difference(l,k)),b.updateFolderOrder(h,e,k,!0)}else{for(var f=$(a.target).parents(".sidebar-collection-requests"),g=$(a.target).parents(".sidebar-collection"),h=$(g).attr("data-id"),i=($(f.context).attr("id"),$(f.context).children("li")),j=i.length,k=[],l=pm.collections.getCollectionById(h).get("order"),m=0;j>m;m++){var o=$(i[m]).attr("id"),p=$("#"+o+" .request").attr("data-id");-1!==l.indexOf(p)&&k.push(p)}k=k.concat(_.difference(l,k)),b.updateCollectionOrder(h,k)}c._updateSidebar()}},updateCollectionMeta:function(a){var b=a.get("id"),c=$("#collection-"+b+" .sidebar-collection-head-dt").attr("class"),d='<span class="sidebar-collection-head-dt"><span class="icon-dt"></span></span>';d+='\n<span class="sidebar-collection-head-cname">\n'+a.get("name")+"\n</span>\n",a.get("subscribed")===!0?(d+='<span class="label label-info" rel="tooltip" data-original-title="You have subscribed to this collection" data-placement="bottom">Sub</span>',a.get("sharedWithTeam")===!0):a.get("sharedWithTeam")===!0&&(d+='<span class="label label-success" rel="tooltip" data-original-title="You have shared this collection" data-placement="bottom">Shared</span>'),$("#collection-"+a.id+" .sidebar-collection-head-name").html(d),$('#select-collection option[value="'+a.get("id")+'"]').html(a.get("name")),$("#collection-"+b+" .sidebar-collection-head-dt").addClass(c.indexOf("open")>=0?"disclosure-triangle-open":"disclosure-triangle-close")},onAddFolder:function(a,b){var c=$("#folders-"+a.id);0==c.children("#folder-"+b.id).length&&(c.append(Handlebars.templates.item_collection_folder(b)),(a.write!==!1||a.owner===pm.user.id)&&$("#collection-"+a.id+" .folder-head").droppable({accept:".sidebar-collection-request",hoverClass:"ui-state-hover",drop:_.bind(this.handleRequestDropOnFolder,this)}),this._updateSidebar())},onUpdateFolder:function(a,b){$("#folder-"+b.id+" .folder-head-name .name").html(b.name)},onDeleteFolder:function(a,b){$("#folder-"+b).remove()},onMoveRequestToFolder:function(a,b,c,d,e,f){f||(f=d.id);var g=!1;a.collection_id!==b.id&&(g=!0),e===!0&&(g?(pm.syncManager.addChangeset("request","destroy",{id:f,owner:a.owner},null,!0),pm.syncManager.addChangeset("request","create",d,null,!0)):(d.id=f,pm.syncManager.addChangeset("request","transfer",{to:{model:"folder",model_id:c.id,owner:b.get("owner")},from:a,owner:a.owner},d.id,!0))),this.removeCollectionRequest(f);$("#folder-requests-"+c.id);this.addRequestToFolder(c,d),this._updateSidebar()},onMoveRequestToCollection:function(a,b,c,d){var e=(guid(),!1);a.collection_id!==b.id&&(e=!0,c.id=guid()),d===!0&&(e?pm.syncLogger.error("Fatal - Moving to a new collection should not sync through this method"):pm.syncManager.addChangeset("request","transfer",{to:{model:"collection",model_id:b.id,owner:b.get("owner")},from:a,owner:a.owner},c.id,!0)),this.removeCollectionRequest(c.id);var f="#collection-requests-"+c.collectionId;this.addRequestToList(f,c,b.order),this._updateSidebar()},onSortRequestContainer:function(a,b,c){var d=$("#"+a+"-requests-"+b);this.sortRequestList(d,c)},sortRequestList:function(a,b){var c=a.children("li");c.detach().sort(function(a,c){var d=$(a).attr("id").split("request-")[1],e=$(c).attr("id").split("request-")[1];return b.indexOf(d)-b.indexOf(e)}),a.append(c)},addRequestToList:function(a,b,c){var d=this;0===$("#sidebar-request-"+b.id).length&&("undefined"==typeof b.name&&(b.name=b.url),$(a).append(Handlebars.templates.item_collection_sidebar_request(b)),b.isFromCollection=!0,b.collectionRequestId=b.id,b.write!==!1&&($(a).sortable({axis:"y",delay:150,update:_.bind(d.onUpdateSortableCollectionRequestList,d)}),$("#collection-"+b.collectionId+" .sidebar-collection-heaad").droppable({accept:".sidebar-collection-request",hoverClass:"ui-state-hover",drop:_.bind(this.handleRequestDropOnCollection,this)})),c instanceof Array&&-1!==c.indexOf(b.id)&&this.sortRequestList($(a),c))},addRequestToFolder:function(a,b){var c="#folder-requests-"+a.id;this.addRequestToList(c,b,a.order)},addCollectionRequest:function(a,b,c){var d="#collection-requests-"+a.collectionId;$(".sidebar-collection-request").removeClass("sidebar-collection-request-active"),$("#sidebar-request-"+a.id).addClass("sidebar-collection-request-active"),this.addRequestToList(d,a,[]),clearTimeout(this.collectionSortTimers[a.collectionId]),this.collectionSortTimers[a.collectionId]=setTimeout(function(a,b){return function(){clearTimeout(b.collectionSortTimers[a]);var c=pm.collections.getCollectionById(a).get("order");b.onSortRequestContainer("collection",a,c)}}(a.collectionId,this),300),b===!0&&this.openCollection(a.collectionId),c!==!1&&pm.mediator.trigger("loadRequest",a)},removeCollectionRequest:function(a){$("#sidebar-request-"+a).remove()},updateCollectionRequest:function(a,b){"undefined"==typeof b&&(b=!1);var c;c=a.name,$("#sidebar-request-"+a.id+" .request .request-name").html(c),$("#sidebar-request-"+a.id+" .request .label").html(a.method);for(var d=["GET","PUT","POST","DELETE"],e=0;e<d.length;e++)$("#sidebar-request-"+a.id+" .request .label").removeClass("label-method-"+d[e]);$("#sidebar-request-"+a.id+" .request .label").addClass("label-method-"+a.method),b||noty({type:"success",text:"Saved request",layout:"topCenter",timeout:750})},openCollection:function(a,b){var c="#collection-children-"+a;$("#collection-"+a+" .sidebar-collection-head-dt").removeClass("disclosure-triangle-close"),$("#collection-"+a+" .sidebar-collection-head-dt").addClass("disclosure-triangle-open"),"none"===$(c).css("display")&&(b===!1?$(c).css("display","block"):$(c).slideDown(100,function(){}))},toggleRequestList:function(a){var b="#collection-children-"+a;"none"===$(b).css("display")?($("#collection-"+a+" .sidebar-collection-head-dt").removeClass("disclosure-triangle-close"),$("#collection-"+a+" .sidebar-collection-head-dt").addClass("disclosure-triangle-open"),$(b).slideDown(100,function(){})):($("#collection-"+a+" .sidebar-collection-head-dt").removeClass("disclosure-triangle-open"),$("#collection-"+a+" .sidebar-collection-head-dt").addClass("disclosure-triangle-close"),$(b).slideUp(100,function(){}))},toggleSubRequestList:function(a){var b="#folder-requests-"+a;"none"===$(b).css("display")?($("#folder-"+a+" .folder-head-dt").removeClass("disclosure-triangle-close"),$("#folder-"+a+" .folder-head-dt").addClass("disclosure-triangle-open"),$(b).slideDown(100,function(){})):($("#folder-"+a+" .folder-head-dt").removeClass("disclosure-triangle-open"),$("#folder-"+a+" .folder-head-dt").addClass("disclosure-triangle-close"),$(b).slideUp(100,function(){}))},handleRequestDropOnCollection:function(a,b){var c=b.draggable.context.id,d=$("#"+c+" .request").attr("data-id"),e=$($(a.target).find(".sidebar-collection-head-name")[0]).attr("data-id");this.model.moveRequestToCollection(d,e)},handleRequestDropOnFolder:function(a,b){var c=b.draggable.context.id,d=$("#"+c+" .request").attr("data-id"),e=$($(a.target).find(".folder-head-name")[0]).attr("data-id");this.model.moveRequestToFolder(d,e)},onFilter:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e="#collection-"+d.id,f=("#folders-"+d.id,"#collection-children-"+d.id),g="#collection-"+d.id+" .sidebar-collection-head-dt";if(d.toShow){$(e).css("display","block"),$(f).css("display","block"),$(g).removeClass("disclosure-triangle-close"),$(g).addClass("disclosure-triangle-open");var h=d.requests;if(h)for(var i=h.length,j=0;i>j;j++){var k=h[j],l="#sidebar-request-"+k.id;k.toShow?$(l).css("display","block"):$(l).css("display","none")}if("folders"in d)for(var m=d.folders,n=0;n<m.length;n++){var o="#folder-"+m[n].id,p=o+" .folder-requests",q=o+" .folder-head .folder-head-dt";m[n].toShow?($(o).css("display","block"),$(p).css("display","block"),$(q).removeClass("disclosure-triangle-close"),$(q).addClass("disclosure-triangle-open")):($(o).css("display","none"),$(p).css("display","none"),$(q).addClass("disclosure-triangle-close"),$(q).removeClass("disclosure-triangle-open"))}}else $(e).css("display","none"),$(f).css("display","none"),$(g).removeClass("disclosure-triangle-open"),$(g).addClass("disclosure-triangle-close")}},onRevertFilter:function(){$(".sidebar-collection").css("display","block"),$(".folder").css("display","block"),$(".sidebar-collection-request").css("display","block")}}),DeleteCollectionModal=Backbone.View.extend({initialize:function(){var a=this.model;$("#modal-delete-collection-yes").on("click",function(){var b=$(this).attr("data-id"),c=$(this).attr("data-shared");"true"===c&&"0"!==pm.user.id&&a.unshareCollection(b),a.deleteCollection(b),$("#modal-delete-collection").modal("hide"),pm.tracker.trackEvent("collection","delete")}),$("#modal-delete-collection").on("shown",function(){pm.app.trigger("modalOpen","#modal-delete-collection")}),$("#modal-delete-collection").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-delete-collection").on("keydown",function(b){if(13===b.keyCode){pm.tracker.trackEvent("interaction","shortcut","delete_collection");var c=$("#modal-delete-collection-yes").attr("data-id"),d=$(this).attr("data-shared");return d===!0&&a.unshareCollection(c),a.deleteCollection(c),$("#modal-delete-collection").modal("hide"),pm.tracker.trackEvent("collection","delete"),b.preventDefault(),!1}})},render:function(){}}),DeleteCollectionRequestModal=Backbone.View.extend({initialize:function(){var a=this.model;a.on("deleteCollectionRequest",this.render,this),$("#modal-delete-collection-request-yes").on("click",function(){var b=$(this).attr("data-id");a.deleteCollectionRequest(b),$("#modal-delete-collection-request").modal("hide"),pm.tracker.trackEvent("request","delete")}),$("#modal-delete-collection-request").on("keydown",function(b){if(13===b.keyCode){pm.tracker.trackEvent("interaction","shortcut","delete_collection_request");var c=$("#modal-delete-collection-request-yes").attr("data-id");return a.deleteCollectionRequest(c),$("#modal-delete-collection-request").modal("hide"),b.preventDefault(),pm.tracker.trackEvent("request","delete"),!1}})},render:function(a){try{$("#modal-delete-collection-request-yes").attr("data-id",a.id),$("#modal-delete-collection-request-name").html(a.name),$("#modal-delete-collection-request").modal("show")}catch(b){throw"DeleteCollection Modal shown with null request. Request: "+JSON.stringify(a)}}}),DeleteFolderModal=Backbone.View.extend({initialize:function(){var a=this.model;$("#modal-delete-folder-yes").on("click",function(){var b=$(this).attr("data-id");a.deleteFolder(b,!0),pm.tracker.trackEvent("folder","delete")}),$("#modal-delete-folder").on("shown",function(){pm.app.trigger("modalOpen","#modal-delete-folder")}),$("#modal-delete-folder").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-delete-folder").on("keydown",function(b){if(13===b.keyCode){pm.tracker.trackEvent("interaction","shortcut","delete_folder");var c=$("#modal-delete-folder-yes").attr("data-id");return a.deleteFolder(c,!0),$("#modal-delete-folder").modal("hide"),b.preventDefault(),pm.tracker.trackEvent("folder","delete"),!1}})},render:function(){}}),EditCollectionModal=Backbone.View.extend({initialize:function(){var a=this.model,b=this;pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),a.on("showEditModal",this.render,this),$("#form-edit-collection").submit(function(){var c=$("#form-edit-collection .collection-id").val(),d=$("#form-edit-collection .collection-name").val(),e=b.editor.getValue();return a.updateCollectionMeta(c,d,e),$("#modal-edit-collection").modal("hide"),pm.tracker.trackEvent("collection","edit"),!1}),$("#modal-edit-collection .btn-primary").click(function(){var c=$("#form-edit-collection .collection-id").val(),d=$("#form-edit-collection .collection-name").val(),e=b.editor.getValue();a.updateCollectionMeta(c,d,e),$("#modal-edit-collection").modal("hide"),pm.tracker.trackEvent("collection","edit")}),$("#modal-edit-collection").on("shown",function(){$("#modal-edit-collection .collection-name").focus(),pm.app.trigger("modalOpen","#modal-edit-collection")}),$("#modal-edit-collection").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-edit-collection").on("keydown","div.input",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?(pm.tracker.trackEvent("interaction","shortcut","edit_collection"),$("#form-edit-collection").submit(),a.preventDefault(),!1):!0})},onSwitchCodeMirrorTheme:function(a){var b=pm.editCollectionEditor;b&&b.setTheme("ace/theme/"+a)},initializeEditor:function(){if(!this.editor){this.editor=ace.edit(document.getElementById("edit-collection-description"));var a="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+a),this.editor.getSession().setMode("ace/mode/markdown"),pm.editCollectionEditor=this.editor}},render:function(a){var b=a.toJSON();$("#form-edit-collection .collection-id").val(b.id),$("#form-edit-collection .collection-name").val(b.name),$("#modal-edit-collection").modal("show"),this.editor||this.initializeEditor();var c=this;setTimeout(function(){c.editor.setValue(b.description,-1),c.editor.gotoLine(0,0,!1)},100)}}),EditCollectionRequestModal=Backbone.View.extend({initialize:function(){var a=this.model;a.on("editCollectionRequest",this.render,this);var b=this;pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),$("#form-edit-collection-request").submit(function(){var c=$("#form-edit-collection-request .collection-request-id").val(),d=$("#form-edit-collection-request .collection-request-name").val(),e=b.editor.getValue();return a.updateCollectionRequestMeta(c,d,e),$("#modal-edit-collection-request").modal("hide"),pm.tracker.trackEvent("request","edit"),!1}),$("#modal-edit-collection-request .btn-primary").click(function(){var c=$("#form-edit-collection-request .collection-request-id").val(),d=$("#form-edit-collection-request .collection-request-name").val(),e=b.editor.getValue();a.updateCollectionRequestMeta(c,d,e),$("#modal-edit-collection-request").modal("hide"),pm.tracker.trackEvent("request","edit")}),$("#modal-edit-collection-request").on("keydown","div.input",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?(pm.tracker.trackEvent("interaction","shortcut","edit_collection_request"),$("#form-edit-collection-request").submit(),a.preventDefault(),!1):!0}),$("#modal-edit-collection-request").on("shown",function(){$("#modal-edit-collection-request .collection-request-name").focus(),pm.app.trigger("modalOpen","#modal-edit-collection-request")}),$("#modal-edit-collection-request").on("hidden",function(){pm.app.trigger("modalClose")})},onSwitchCodeMirrorTheme:function(a){var b=pm.editCollectionRequestEditor;b&&b.setTheme("ace/theme/"+a)},initializeEditor:function(){if(!this.editor){this.editor=ace.edit(document.getElementById("collection-request-description"));var a="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+a),this.editor.getSession().setMode("ace/mode/markdown"),pm.editCollectionRequestEditor=this.editor}},render:function(a){$("#form-edit-collection-request .collection-request-id").val(a.id),$("#form-edit-collection-request .collection-request-name").val(a.name),$("#modal-edit-collection-request").modal("show"),this.editor||this.initializeEditor();var b=this;setTimeout(function(){b.editor.setValue(a.description,-1),b.editor.gotoLine(0,0,!1)},150)}}),EditFolderModal=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("showEditFolderModal",this.render,this),pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),$("#form-edit-folder").submit(function(){var c=$("#form-edit-folder .folder-id").val(),d=$("#form-edit-folder .folder-name").val(),e=b.editor.getValue();return a.updateFolderMeta(c,d,e),$("#modal-edit-folder").modal("hide"),pm.tracker.trackEvent("folder","edit"),!1}),$("#modal-edit-folder .btn-primary").click(function(){var c=$("#form-edit-folder .folder-id").val(),d=$("#form-edit-folder .folder-name").val(),e=b.editor.getValue();a.updateFolderMeta(c,d,e),$("#modal-edit-folder").modal("hide"),pm.tracker.trackEvent("folder","edit")}),$("#modal-edit-folder").on("shown",function(){$("#modal-edit-folder .folder-name").focus(),pm.app.trigger("modalOpen","#modal-edit-folder")}),$("#modal-edit-folder").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-edit-folder").on("keydown","div.input",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?(pm.tracker.trackEvent("interaction","shortcut","edit_folder"),$("#form-edit-folder").submit(),a.preventDefault(),!1):!0})},onSwitchCodeMirrorTheme:function(a){var b=pm.editFolderEditor;b&&b.setTheme("ace/theme/"+a)},initializeEditor:function(){if(!this.editor){this.editor=ace.edit(document.getElementById("edit-folder-description"));var a="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+a),this.editor.getSession().setMode("ace/mode/markdown"),pm.editFolderEditor=this.editor}},render:function(a){$("#form-edit-folder .folder-id").val(a.id),$("#form-edit-folder .folder-name").val(a.name),$("#modal-edit-folder").modal("show"),this.editor||this.initializeEditor();var b=this;setTimeout(function(){b.editor.setValue(a.description,-1),b.editor.gotoLine(0,0,!1)},100)}}),ImportModal=Backbone.View.extend({initialize:function(){var a=this.model;a.on("importCollection",this.addAlert,this),pm.mediator.on("failedCollectionImport",this.onFailedImport,this),$("#import-submit-link").on("click",function(){var b=$("#importLink").val();a.importFileFromUrl(b),$("#import-submit-link").html("Importing...").attr("disabled","disabled")});var b=document.getElementById("import-collection-dropzone");b.addEventListener("dragover",function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},!1),b.addEventListener("drop",function(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer.files;a.importFiles(c)},!1),$("#collection-files-input").on("change",function(b){var c=b.target.files;a.importFiles(c),$("#collection-files-input").val("")}),$("#modal-importer").on("shown",function(){pm.app.trigger("modalOpen","#modal-importer")}),$("#modal-importer").on("hidden",function(){pm.app.trigger("modalClose")}),$("#import-submit-rawtext").on("click",function(){var a=$("#importRawText").val(),b=pm.collections.guessFileFormat(a);return 0===b?void pm.mediator.trigger("failedCollectionImport","format not recognized"):void pm.collections.importData(a,b)}),pm.mediator.on("failedCollectionImport",function(a){a&&(a=": "+a),noty({type:"error",text:"Failed to import data"+a,layout:"topCenter",timeout:750})})},onFailedImport:function(){$("#import-submit-link").html("Import!").removeAttr("disabled")},addAlert:function(a){$(".modal-import-alerts>.alert.alert-block").remove(),$("#import-submit-link").html("Import!").removeAttr("disabled"),"collection"===a.type?$(".modal-import-alerts").append(Handlebars.templates.message_collection_added(a)):"request"===a.type&&$(".modal-import-alerts").append(Handlebars.templates.message_request_added(a))}}),OverwriteCollectionModal=Backbone.View.extend({initialize:function(){var a=this.model;a.on("overwriteCollectionChoice",this.render,this),$("#modal-overwrite-collection-duplicate").on("click",function(){var b=(a.originalCollectionId,a.toBeImportedCollection);b.name=b.name+" copy",a.setNewCollectionId(b),a.changeFolderAndRequestIds(b),a.overwriteCollection(b)}),$("#modal-overwrite-collection-overwrite").on("click",function(){var b=(a.originalCollectionId,a.toBeImportedCollection);a.setNewCollectionId(b),a.changeFolderAndRequestIds(b),a.overwriteCollection(b)})},render:function(){var a=this.model.originalCollectionId;$("#existingCollectionName").html(this.model.getCollectionById(a).get("name")),$("#modal-overwrite-collection").modal("show")}}),ShareCollectionModal=Backbone.View.extend({initialize:function(){var a=this.model;pm.features.isFeatureEnabled(FEATURES.DIRECTORY)&&$("share-collection-directory-features").css("display","block"),$("#share-collection-readonly").on("change",function(){var b=!$("#share-collection-readonly").is(":checked"),c=$(this).attr("data-collection-id");a.updateCollectionWrite(c,b)}),$("#share-collection-get-link").on("click",function(){var b=$(this).attr("data-collection-id"),c=$("#share-collection-is-public").is(":checked"),d=a.get(b),e=!(d.get("sharedWithTeam")===!0);a.uploadCollection(b,c,e,!0,function(){}),$("#share-collection-get-link").html(e?"Unshare":"Share")}),$("#upload-collection-get-link").on("click",function(){{var b=$(this).attr("data-collection-id");$("#share-collection-is-public").is(":checked"),a.get(b)}a.uploadAndGetLinkForCollection(b,!1,function(a){$("#upload-collection-link").css("display","block"),$("#upload-collection-link").html(a),$("#copy-collection-url").show()})}),$("#share-collection-download").on("click",function(){var b=$(this).attr("data-collection-id");a.saveCollection(b)}),$("#modal-share-collection").on("shown",function(){pm.app.trigger("modalOpen","#modal-share-collection")}),$("#modal-share-collection").on("hidden",function(){pm.app.trigger("modalClose")}),$("#copy-collection-url").click(function(){copyToClipboard($("#upload-collection-link").html())}),$("#share-collection-unsubscribe").click(function(){var a=$(this).attr("data-collection-id"),b=$(this).attr("data-owner-id"),c={owner:b,model_id:a};pm.syncManager.addChangeset("collection","unsubscribe",{owner:c.owner},c.model_id,!0);pm.collections.deleteCollectionFromDataStoreWithOptSync(c.model_id,!0,!1,function(){})}),a.on("shareCollectionModal",this.show,this)},show:function(a){var b=this.model.get(a);if($("#modal-share-collection").modal("show"),$("#share-collection-get-link").attr("data-collection-id",a),$("#upload-collection-get-link").attr("data-collection-id",a),$("#share-collection-download").attr("data-collection-id",a),$("#copy-collection-url").hide(),$("#share-collection-link").css("display","none"),pm.user.isLoggedIn())if(b.get("subscribed")===!0)$("#share-collection-unsubscribe").attr("data-collection-id",a),$("#share-collection-unsubscribe").attr("data-owner-id",b.get("owner")),$("#shareOwnCollection").hide(),$("#shareSubscribedCollection").show();else{$("#share-collection-get-link").html(b.get("sharedWithTeam")===!0?"Unshare":"Share"),$("#upload-collection-link").html(b.get("remoteLink")).show(),$("#copy-collection-url").show();var c=pm.user.get("organizations");c.length>0?($("#share-collection-is-public").prop("checked",b.get("public")===!0),$("#share-collection-team").prop("checked",b.get("sharedWithTeam")===!0),$("#share-collection-readonly").prop("checked",1!=b.get("write")).attr("data-collection-id",a),$("#shareOwnCollection").hide()):$("#shareOwnCollection").hide(),$("#shareSubscribedCollection").hide()}else $("#share-collection-directory-features").css("display","none"),$("#share-collection-get-link").html("Upload"),$("#shareOwnCollection").hide(),$("#uploadOwnCollection").show(),$("#shareSubscribedCollection").hide();0!==b.get("remote_id")&&b.get("remoteLink")?($("#upload-collection-get-link").html("Update"),$("#upload-collection-link").html(b.get("remoteLink")).show(),$("#copy-collection-url").show()):($("#upload-collection-get-link").html("Upload and get link"),$("#upload-collection-link").hide(),$("#copy-collection-url").show()),$("#shareOwnCollection").hide()},render:function(){}}),DirectoryCollection=Backbone.Model.extend({defaults:function(){return{id:"",name:"",user_id:0,user_name:"",description:"",order:[],folders:[],requests:[],timestamp:0,updated_at:"",updated_at_formatted:""}}}),Directory=Backbone.Collection.extend({model:DirectoryCollection,startId:0,endId:0,fetchCount:44,lastCount:0,totalCount:0,order:"descending",isInitialized:!1,reload:function(){this.startId=0,this.fetchCount=44,this.lastCount=0,this.totalCount=0,this.getCollections(this.startId,this.fetchCount,"descending")},comparator:function(a,b){var c=a.get("timestamp"),d=b.get("timestamp");return c>d},initialize:function(){pm.mediator.on("initializeDirectory",this.onInitializeDirectory,this),pm.mediator.on("getDirectoryCollection",this.onGetDirectoryCollection,this),pm.mediator.on("showNextDirectoryPage",this.onShowNextDirectoryPage,this),pm.mediator.on("showNextDirectoryPage",this.onShowNextDirectoryPage,this)},onInitializeDirectory:function(){this.isInitialized||(this.isInitialized=!0),this.getCollections(this.startId,this.fetchCount,"descending")},onGetDirectoryCollection:function(a){this.downloadCollection(a)},loadNext:function(){this.getCollections(this.endId,this.fetchCount,"descending")},loadPrevious:function(){this.getCollections(this.startId,this.fetchCount,"ascending")},getCollections:function(a,b,c){var d=this;pm.api.getDirectoryCollections(a,b,c,function(a){var b,e,f;if(!a.length)return void console.log("No public APIs returned");if("descending"===c?d.totalCount+=a.length:d.totalCount-=d.lastCount,d.lastCount=a.length,a.hasOwnProperty("message"));else{var g=a[0].id,h=a[0].id;for(e=0;e<a.length;e++)b=a[e],f=new Date(b.updated_at).toDateString(),b.updated_at_formatted=f,b.timestamp=new Date(b.updated_at).getTime(),b.id>h&&(h=b.id),b.id<g&&(g=b.id);a.sort(sortById),d.add(a,{merge:!0}),d.startId=h,d.endId=h}})},downloadCollection:function(a){var b=pm.user.getRemoteIdForLinkId(a);b?pm.user.downloadSharedCollection(b,function(){pm.mediator.trigger("notifySuccess","Downloaded collection")}):pm.api.downloadDirectoryCollection(a,function(a){try{var b=a;pm.mediator.trigger("notifySuccess","Downloaded collection"),pm.mediator.trigger("addDirectoryCollection",b)}catch(c){pm.mediator.trigger("notifyError","Failed to download collection"),pm.mediator.trigger("failedCollectionImport")}})}}),DirectoryBrowser=Backbone.View.extend({initialize:function(){var a=this.model,b=this;this.directoryCollectionViewer=new DirectoryCollectionViewer({model:this.model}),a.on("add",this.addDirectoryCollection,this),a.on("remove",this.removeDirectoryCollection,this),a.on("reset",this.render,this),$(".directory-browser-header").on("click",function(){a.reload()}),$("#directory-collections").on("click",".directory-collection-action-view",function(){var c=$(this).attr("data-id"),d=a.get(c);b.directoryCollectionViewer.showCollection(d)}),$("#directory-collections").on("click",".directory-collection-action-download",function(){var a=$(this).attr("data-link-id");pm.mediator.trigger("getDirectoryCollection",a),pm.tracker.trackEvent("collection","import","api_directory")}),$(".directory-browser-navigator-next").on("click",function(){$(this).hasClass("disabled")||a.loadNext()}),$(".directory-browser-navigator-previous").on("click",function(){$(this).hasClass("disabled")||a.loadPrevious()})},render:function(){$("#directory-collections").html("")},renderNavigator:function(){{var a=this.model;a.startId,a.length}a.lastCount<a.fetchCount?($(".directory-browser-navigator-next").removeClass("enabled"),$(".directory-browser-navigator-next").addClass("disabled")):($(".directory-browser-navigator-next").removeClass("disabled"),$(".directory-browser-navigator-next").addClass("enabled")),a.totalCount<=a.fetchCount?($(".directory-browser-navigator-previous").removeClass("enabled"),$(".directory-browser-navigator-previous").addClass("disabled")):($(".directory-browser-navigator-previous").removeClass("disabled"),$(".directory-browser-navigator-previous").addClass("enabled"));var b=a.totalCount-a.lastCount+1;0>b&&(b=1);var c=a.totalCount;$(".directory-browser-navigator-status .start").html(b),$(".directory-browser-navigator-status .end").html(c)},addDirectoryCollection:function(a){this.renderNavigator();var b=_.clone(a.toJSON());b.desctiption||(b.description=""),b.description=markdown.toHTML(b.description),$("#directory-collections").append(Handlebars.templates.item_directory_collection(b))},removeDirectoryCollection:function(){this.renderNavigator()}}),DirectoryCollectionViewer=Backbone.View.extend({initialize:function(){this.model;$("#directory-collection-viewer").on("click",".btn-primary",function(){var a=$(this).attr("data-link-id");pm.mediator.trigger("getDirectoryCollection",a)})},showCollection:function(a){$("#directory-collection-viewer-name").html(a.get("name")),$("#directory-collection-viewer-user-name").html(a.get("user_name")),a.get("description")||a.set("description",""),$("#directory-collection-viewer-description").html(markdown.toHTML(a.get("description"))),$("#directory-collection-viewer-updated-at").html("Last updated: "+a.get("updated_at_formatted")),$("#directory-collection-viewer-count-requests").html(a.get("count_requests")+" endpoints"),$("#directory-collection-viewer-download").attr("data-id",a.get("id")),$("#directory-collection-viewer-download").attr("data-link-id",a.get("link_id")),$("#directory-collection-viewer").modal("show")}}),DriveSync=Backbone.Model.extend({defaults:function(){return{initializedSync:!1,lastSynced:"",canSync:!1,isSyncing:!1,fileSystem:null,queue:[],log:null}},initialize:function(){var a=this,b=pm.settings.getSetting("driveSyncEnabled");
b&&this.openSyncableFileSystem(),pm.mediator.on("driveSyncStatusChanged",function(){b=pm.settings.getSetting("driveSyncEnabled"),b&&a.openSyncableFileSystem()})},errorHandler:function(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;default:b="Unknown Error"}this.get("log").addToLog("DriveSync","Error: "+b)},openSyncableFileSystem:function(){this.get("log").addToLog("Opening Google Drive file system");var a=this,b=pm.settings.getSetting("driveSyncEnabled");return b?(chrome.syncFileSystem.requestFileSystem(function(b){return a.get("log").addToLog("Opened Google Drive file system"),chrome.runtime.lastError?void a.errorHandler("requestFileSystem: "+chrome.runtime.lastError.message):void _.bind(a.onFileSystemOpened,a)(b)}),!0):(this.get("log").addToLog("Can not sync"),!1)},isSyncingInitialized:function(){return this.get("initializedSync")},onFileSystemOpened:function(a){var b=this;this.set("fileSystem",a),this.set("initializedSync",!0),pm.mediator.trigger("initializedSyncableFileSystem"),pm.mediator.on("addSyncableFile",function(a,c){b.get("log").logChangeOnDrive("addSyncableFile",a.name),b.syncFile(a,c)}),pm.mediator.on("updateSyncableFile",function(a,c){b.get("log").logChangeOnDrive("updateSyncableFile",a.name),b.syncFile(a,c)}),pm.mediator.on("removeSyncableFile",function(a){b.get("log").logChangeOnDrive("removeSyncableFile",a),b.removeFile(a)}),pm.mediator.on("getSyncableFileData",function(a,c){b.get("log").logChangeOnDrive("getSyncableFileData"),b.getFile(a,c)}),this.startListeningForChanges()},removeFileIfExists:function(a,b){var c=this.get("fileSystem");c.root.getFile(a,{create:!1},function(a){a.remove(function(){b&&b()},function(){b&&b()})},function(){b&&b()})},syncFile:function(a,b){var c=this.get("fileSystem"),d=a.name,e=a.data,f=this.errorHandler;c.root.getFile(d,{create:!0},function(a){a&&a.createWriter(function(a){var c=!1;a.onerror=function(){b&&b("failed")},a.onwriteend=function(){return c?void(b&&b("success")):(c=!0,void this.truncate(this.position))},blob=new Blob([e],{type:"text/plain"}),a.write(blob)},f)},f)},getFile:function(a,b){var c=this.errorHandler;a.file(function(a){var c=new FileReader;c.readAsText(a,"utf-8"),c.onload=function(a){b&&b(a.target.result)}},c)},removeFile:function(a,b){this.removeFileIfExists(a,b)},startListeningForChanges:function(){var a=this;chrome.syncFileSystem.onFileStatusChanged.addListener(function(b){_.bind(a.onSyncableFileStatusChanged,a)(b)})},onSyncableFileStatusChanged:function(a){var b=this,c=a.direction,d=a.action,e=a.fileEntry.name,f=a.status,g=splitSyncableFilename(e),h=g.id,i=g.type;"synced"===f?"remote_to_local"===c?"added"===d?(b.get("log").logFileStatusChange("Add file",e),this.getFile(a.fileEntry,function(a){pm.mediator.trigger("addSyncableFileFromRemote",i,a)})):"updated"===d?(b.get("log").logFileStatusChange("Update file",e),this.getFile(a.fileEntry,function(a){pm.mediator.trigger("updateSyncableFileFromRemote",i,a)})):"deleted"===d&&(b.get("log").logFileStatusChange("Delete file",e),pm.mediator.trigger("deleteSyncableFileFromRemote",i,h)):b.get("log").logFileStatusChange("local_to_remote",e):b.get("log").logFileStatusChange("Not synced",e)}}),DriveSyncIntroduction=Backbone.View.extend({initialize:function(){var a=pm.settings.getSetting("driveSyncPermissionStatus");console.log("Permission status is ",a),"not_asked"===a&&$("#modal-drive-first-time-sync").modal("show"),$("#drive-sync-backup").on("click",function(){pm.indexedDB.downloadAllData(function(){noty({type:"success",text:"Saved the data dump",layout:"topCenter",timeout:750})})}),$("#drive-sync-start").on("click",function(){pm.settings.setSetting("driveSyncPermissionStatus","asked"),pm.settings.setSetting("driveSyncEnabled",!0),$("#modal-drive-first-time-sync").modal("hide")}),$("#drive-sync-cancel").on("click",function(){pm.settings.setSetting("driveSyncPermissionStatus","disabled"),pm.settings.setSetting("driveSyncEnabled",!1),$("#modal-drive-first-time-sync").modal("hide")})}}),DriveSyncLog=Backbone.Collection.extend({model:DriveSyncLogItem,initialize:function(){console.log("Initialized DriveSyncLog")},addToLog:function(a){var b=new DriveSyncLogItem({"class":"default",time:(new Date).toUTCString(),message:a});this.add(b)},logChangeOnDrive:function(a,b){var c=new DriveSyncLogItem({"class":"change-on-drive",time:(new Date).toUTCString(),message:"Local DB to Google Drive: "+a+", "+b});this.add(c)},logFileStatusChange:function(a,b){var c=new DriveSyncLogItem({"class":"file-status-change",time:(new Date).toUTCString(),message:"Google Drive to local DB: "+a+", "+b});this.add(c)}}),DriveSyncLogItem=Backbone.Model.extend({defaults:function(){return{"class":"",time:0,message:""}}}),DriveSyncLogger=Backbone.View.extend({initialize:function(){var a=this;this.model.on("add",this.render,this),$("#google-drive-toggle").on("click",function(){a.toggleGoogleDriveSync()}),$("#google-drive-status a").on("click",function(){a.toggleLoggerDisplay()}),$("#google-drive-close-logger").on("click",function(){a.toggleLoggerDisplay()}),$(document).bind("keydown","alt+g",function(){a.toggleLoggerDisplay()});var b=pm.settings.getSetting("driveSyncEnabled");b?($("#logger-drivesync-log-empty-view").css("display","none"),$("#logger-drivesync-log-container").css("display","block"),$("#google-drive-toggle").html("Disable syncing with Google Drive"),$("#google-drive-toggle").addClass("btn btn-danger")):($("#logger-drivesync-log-empty-view").css("display","block"),$("#logger-drivesync-log-container").css("display","none"),$("#google-drive-toggle").html("Enable syncing with Google Drive"),$("#google-drive-toggle").addClass("btn btn-primary"))},toggleGoogleDriveSync:function(){var a=pm.settings.getSetting("driveSyncEnabled");a?(pm.settings.setSetting("driveSyncEnabled",!1),$("#google-drive-toggle").html("Enable syncing with Google Drive"),$("#logger-drivesync-log-empty-view").css("display","block"),$("#logger-drivesync-log-container").css("display","none"),$("#google-drive-toggle").removeClass(),$("#google-drive-toggle").addClass("btn btn-primary"),$("#google-drive-toggle").html("Enable syncing with Google Drive"),pm.mediator.trigger("driveSyncStatusChanged")):(pm.settings.setSetting("driveSyncEnabled",!0),$("#logger-drivesync-log-empty-view").css("display","none"),$("#logger-drivesync-log-container").css("display","block"),$("#google-drive-toggle").html("Disable syncing with Google Drive"),$("#google-drive-toggle").removeClass(),$("#google-drive-toggle").addClass("btn btn-danger"),pm.mediator.trigger("driveSyncStatusChanged"))},toggleLoggerDisplay:function(){var a="block"===$("#logger-drivesync").css("display");a?$("#logger-drivesync").css("display","none"):$("#logger-drivesync").css("display","block")},render:function(){var a=this.model.toJSON();$("#logger-drivesync-items").html(""),$("#logger-drivesync-items").append(Handlebars.templates.logger_drivesync({items:a})),$("#logger-drivesync-log-container").scrollTop($("#logger-drivesync-items").height())}}),Environment=Backbone.Model.extend({defaults:function(){return{id:"",name:"",values:[],timestamp:0,synced:!1,syncedFilename:""}},toSyncableJSON:function(){var a=this.toJSON();return a.synced=!0,a},getEnabledValues:function(){var a=[],b=this.get("values");for(i=0;i<b.length;i++)b[i].hasOwnProperty("enabled")&&1!=b[i].enabled||a.push(b[i]);return a}}),Environments=Backbone.Collection.extend({model:Environment,isLoaded:!1,initializedSyncing:!1,comparator:function(a,b){var c,d=a.get("name"),e=b.get("name");c=d.length>e.legnth?e.length:d.length;for(var f=0;c>f;f++)if(d[f]!=e[f])return d[f]>e[f]?1:-1;return 1},initialize:function(){var a=this;pm.appWindow.trigger("registerInternalEvent","addedEnvironment",this.onAddedEnvironment,this),pm.appWindow.trigger("registerInternalEvent","updatedEnvironment",this.onUpdatedEnvironment,this),pm.appWindow.trigger("registerInternalEvent","deletedEnvironment",this.onDeletedEnvironment,this),this.startListeningForFileSystemSyncEvents(),pm.indexedDB.environments.getAllEnvironments(function(b){b.sort(sortAlphabetical),a.add(b,{merge:!0}),a.isLoaded=!0,a.trigger("startSync"),pm.syncManager&&pm.syncManager.trigger("itemLoaded","environments"),a.trigger("loadedEnvironments"),pm.mediator.trigger("loadedEnvironments")}),pm.mediator.on("syncChangeReceived",this.onSyncChangeReceived,this),this.set("envUpdateTimeout",null)},onAddedEnvironment:function(a){this.add(a,{merge:!0})},onUpdatedEnvironment:function(a){this.add(a,{merge:!0}),clearTimeout(this.get("envUpdateTimeout")),this.set("envUpdateTimeout",setTimeout(function(a){return function(){pm.indexedDB.environments.updateEnvironment(a,function(){pm.mediator.trigger("databaseOperationComplete")})}}(a),1e3))},onDeletedEnvironment:function(a){this.remove(a)},startListeningForFileSystemSyncEvents:function(){{var a=this;a.isLoaded,a.initializedSyncing}pm.mediator.on("initializedSyncableFileSystem",function(){a.initializedSyncing=!0,a.trigger("startSync")}),this.on("startSync",this.startSyncing,this)},startSyncing:function(){var a,b,c=0,d=this;if(this.isLoaded&&this.initializedSyncing)for(pm.mediator.on("addSyncableFileFromRemote",function(a,b){"environment"===a&&d.onReceivingSyncableFileData(b)}),pm.mediator.on("updateSyncableFileFromRemote",function(a,b){"environment"===a&&d.onReceivingSyncableFileData(b)}),pm.mediator.on("deleteSyncableFileFromRemote",function(a,b){"environment"===a&&d.onRemoveSyncableFile(b)}),c=0;c<this.models.length;c++)a=this.models[c],b=a.get("synced"),b||this.addToSyncableFilesystem(a.get("id"))},onReceivingSyncableFileData:function(a){this.importEnvironment(a,!0)},onRemoveSyncableFile:function(a){this.deleteEnvironment(a,!0)},getAsSyncableFile:function(a){var b=this.get(a),c=a+".environment",d="environment",e=JSON.stringify(b.toSyncableJSON());return{name:c,type:d,data:e}},addToSyncableFilesystem:function(a){var b=this,c=this.getAsSyncableFile(a);pm.mediator.trigger("addSyncableFile",c,function(c){"success"===c&&b.updateEnvironmentSyncStatus(a,!0)})},removeFromSyncableFilesystem:function(a){var b=a+".environment";pm.mediator.trigger("removeSyncableFile",b,function(){})},addFullEnvironment:function(a,b){var c=a.name,d=a.values;try{this.addEnvironment(a.id,c,d,!0,b)}catch(e){return console.log("Adding environment failed: "+e),-1}return 0},addEnvironmentWithoutId:function(a,b,c){var d=guid();this.addEnvironment(d,a,b,c)},addEnvironment:function(a,b,c,d,e){var f=this,g={id:a,name:b,values:c,timestamp:(new Date).getTime(),synced:!1},h=new Environment(g);f.add(h),pm.appWindow.trigger("sendMessageObject","addedEnvironment",g),pm.indexedDB.environments.addEnvironment(g,function(){pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("syncOperationDone"),d||(pm.syncManager.addChangeset("environment","create",g,null,!0),f.addToSyncableFilesystem(g.id)),e&&e()})},updateRemoteEnvironment:function(a,b){try{this.updateEnvironment(a.id,a.name,a.values,!0,b)}catch(c){return console.log("Updating environment failed: "+c),-1}return 0},updateEnvironment:function(a,b,c,d,e){var f=this,g={id:a,name:b,values:c,timestamp:(new Date).getTime()},h=new Environment(g);f.add(h,{merge:!0}),pm.indexedDB.environments.updateEnvironment(g,function(){pm.appWindow.trigger("sendMessageObject","updatedEnvironment",g),pm.mediator.trigger("syncOperationDone"),pm.mediator.trigger("databaseOperationComplete"),d||(pm.syncManager.addChangeset("environment","update",g,null,!0),f.addToSyncableFilesystem(g.id)),e&&e()})},clearEnvironment:function(a,b){var c=this,d={id:a,name:b,values:[],timestamp:(new Date).getTime()},e=new Environment(d);c.add(e,{merge:!0}),pm.indexedDB.environments.updateEnvironment(d,function(){pm.appWindow.trigger("sendMessageObject","clearedEnvironment",d)})},updateEnvironmentSyncStatus:function(a,b){var c=this,d=this.get(a);d.set("synced",b),c.add(d,{merge:!0}),pm.appWindow.trigger("sendMessageObject","updatedEnvironment",d),pm.indexedDB.environments.updateEnvironment(d.toJSON(),function(){pm.mediator.trigger("databaseOperationComplete")})},deleteRemoteEnvironment:function(a,b){try{this.deleteEnvironment(a,!0,b)}catch(c){return console.log("Deleting environment failed: "+c),-1}return 0},deleteEnvironment:function(a,b,c){var d=this;pm.indexedDB.environments.deleteEnvironment(a,function(){d.remove(a),pm.appWindow.trigger("sendMessageObject","deletedEnvironment",a),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("syncOperationDone"),b||(pm.syncManager.addChangeset("environment","destroy",null,a,!0),d.removeFromSyncableFilesystem(a)),c&&c()})},downloadEnvironment:function(a){var b=this.get(a);b.set("synced",!1);var c=b.get("name")+".postman_environment",d="application/json",e=JSON.stringify(b.toJSON(),null,"	");pm.filesystem.saveAndOpenFile(c,e,d,function(){noty({type:"success",text:"Saved environment to disk",layout:"topCenter",timeout:750})})},duplicateEnvironment:function(a){var b=this.get(a).toJSON(),c=_.clone(b);c.name=c.name+" copy",c.id=guid();var d=this;pm.indexedDB.environments.addEnvironment(c,function(){var a=new Environment(c);d.add(a),pm.mediator.trigger("databaseOperationComplete"),pm.syncManager.addChangeset("environment","create",c,null,!0),pm.appWindow.trigger("sendMessageObject","addedEnvironment",c),d.addToSyncableFilesystem(c.id)})},importEnvironment:function(a,b){var c=this,d=a;try{"string"==typeof a&&(d=JSON.parse(a))}catch(e){noty({type:"error",text:"Error - File is not a valid JSON file",layout:"topCenter",timeout:750})}pm.indexedDB.environments.addEnvironment(d,function(){var a=new Environment(d);c.add(a,{merge:!0}),pm.appWindow.trigger("sendMessageObject","updatedEnvironment",d),pm.syncManager.addChangeset("environment","create",d,null,!0),pm.mediator.trigger("databaseOperationComplete"),b||(c.trigger("importedEnvironment",d),c.addToSyncableFilesystem(d.id))})},importEnvironments:function(a){for(var b,c=this,d=0;b=a[d];d++){var e=new FileReader;e.onload=function(){return function(a){c.importEnvironment(a.currentTarget.result)}}(b),e.readAsText(b)}},mergeEnvironments:function(a){for(var b=a.length,c=this,d=0;b>d;d++){var e=a[d];c.importEnvironment(e)}},onSyncChangeReceived:function(a,b,c){b.model||(b.model=b.type);var d=["environment"];-1!==d.indexOf(b.model)&&("create"===a?this.get(b.data.id)?this.updateRemoteEntity(b,c):this.createRemoteEntity(b,c):"update"===a?this.updateRemoteEntity(b,c):("destroy"===a||"delete"===a)&&this.deleteRemoteEntity(b,c))},createRemoteEntity:function(a,b){if("environment"===a.model){var c=pm.environments.addFullEnvironment(a.data,b);-1==c?pm.mediator.trigger("syncOperationFailed","Adding full environment failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["Environment created: ",a.data])}},updateRemoteEntity:function(a,b){if("environment"===a.model){var c=pm.environments.updateRemoteEnvironment(a.data,b);-1==c?pm.mediator.trigger("syncOperationFailed","Updating remote environment failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["Environment updated: ",a.data])}},deleteRemoteEntity:function(a,b){if("environment"===a.model){pm.syncLogger.log(new Error,["Environment destroyed: ",a.data]);var c=pm.environments.deleteRemoteEnvironment(a.data.id,b);-1==c?pm.mediator.trigger("syncOperationFailed","Deleting remote env failed"):pm.syncManager.updateSinceFromMessage(a)}}}),Globals=Backbone.Model.extend({isLoaded:!1,initializedSyncing:!1,defaults:function(){return{globals:[],syncFileID:"postman_globals",synced:!1}},initialize:function(){this.set({globals:[]});var a=this;pm.appWindow.trigger("registerInternalEvent","updatedGlobals",this.onUpdatedGlobals,this),pm.mediator.on("downloadGlobals",this.downloadGlobals,this),this.startListeningForFileSystemSyncEvents(),pm.storage.getValue("globals",function(b){a.set(b?{globals:JSON.parse(b)}:{globals:[]}),a.isLoaded=!0,a.trigger("startSync"),pm.syncManager&&pm.syncManager.trigger("itemLoaded","globals")}),pm.mediator.on("syncChangeReceived",this.onSyncChangeReceived,this),this.set("glbUpdateTimeout",null)},getEnabledValues:function(){var a=[],b=this.get("globals");for(b||(b=[]),i=0;i<b.length;i++)b[i].hasOwnProperty("enabled")&&1!=b[i].enabled||a.push(b[i]);return a},startListeningForFileSystemSyncEvents:function(){{var a=this;a.isLoaded,a.initializedSyncing}pm.mediator.on("initializedSyncableFileSystem",function(){a.initializedSyncing=!0,a.trigger("startSync")}),this.on("startSync",this.startSyncing,this)},startSyncing:function(){var a,b=this;this.isLoaded&&this.initializedSyncing&&(pm.mediator.on("addSyncableFileFromRemote",function(a,c){"globals"===a&&b.onReceivingSyncableFileData(c)}),pm.mediator.on("updateSyncableFileFromRemote",function(a,c){"globals"===a&&b.onReceivingSyncableFileData(c)}),pm.mediator.on("deleteSyncableFileFromRemote",function(a,c){"globals"===a&&b.onRemoveSyncableFile(c)}),a=pm.settings.getSetting("syncedGlobals"),a||this.addToSyncableFilesystem(this.get("syncFileID")))},onReceivingSyncableFileData:function(a){var b=JSON.parse(a);this.mergeGlobals(b,!1)},onRemoveSyncableFile:function(){},getAsSyncableFile:function(a){var b=a+".globals",c="globals",d=JSON.stringify(this.get("globals"));return{name:b,type:c,data:d}},addToSyncableFilesystem:function(a){var b=this,c=this.getAsSyncableFile(a);pm.mediator.trigger("addSyncableFile",c,function(c){"success"===c&&b.updateGlobalSyncStatus(a,!0)})},removeFromSyncableFilesystem:function(a){var b=a+".globals";pm.mediator.trigger("removeSyncableFile",b,function(){model.saveGlobals([],!1)})},updateGlobalSyncStatus:function(a,b){pm.settings.setSetting("syncedGlobals",b)},onUpdatedGlobals:function(a){this.set({globals:a});var b=this;clearTimeout(this.get("glbUpdateTimeout")),this.set("glbUpdateTimeout",setTimeout(function(a){return function(){var c={globals:JSON.stringify(a)};pm.storage.setValue(c,function(){b.addToSyncableFilesystem(b.get("syncFileID"))})}}(a),1e3))},downloadGlobals:function(){var a="globals.postman_globals",b="application/json";globalsJSON=this.get("globals");var c=JSON.stringify(globalsJSON,null,"	");pm.filesystem.saveAndOpenFile(a,c,b,function(){noty({type:"success",text:"Saved globals to disk",layout:"topCenter",timeout:750})})},mergeGlobals:function(a,b,c){a||(a=[]);for(var d=this,e=this.get("globals"),f=[],g=e.length,h=0;g>h;h++){var i=e[h].key,j=_.find(a,function(a){a.key===i});f.push(j?j:e[h])}var k=a.length;for(h=0;k>h;h++){var j=_.find(f,function(b){b.key===a[h].key});j||f.push(a[h])}this.set({globals:f});var l={globals:JSON.stringify(f)};if(b){var m={globals:f};pm.syncManager.addChangeset("user","update",m,null,!0)}pm.storage.setValue(l,function(){pm.appWindow.trigger("sendMessageObject","updatedGlobals",f),d.addToSyncableFilesystem(d.get("syncFileID")),c&&c()})},clearGlobals:function(){var a=this;this.set({globals:[]});var b={globals:JSON.stringify([])};pm.storage.setValue(b,function(){pm.appWindow.trigger("sendMessageObject","clearedGlobals",[]),a.addToSyncableFilesystem(a.get("syncFileID"))})},saveGlobals:function(a,b){this.set({globals:a});var c={globals:JSON.stringify(a)};if(b){var d={globals:a};pm.syncManager.addChangeset("user","update",d,null,!0)}pm.storage.setValue(c,function(){pm.appWindow.trigger("sendMessageObject","updatedGlobals",a)})},onSyncChangeReceived:function(a,b,c){var d=["user"];b.model||(b.model=b.type),-1!==d.indexOf(b.model)&&"update"===a&&(b.data.hasOwnProperty("globals")&&this.mergeGlobals(b.data.globals,!1,c),pm.syncLogger.log(new Error,["User updated: (name=updated) ",b.data]))}}),VariableProcessor=Backbone.Model.extend({defaults:function(){return{environments:null,globals:null,externalDataVariables:[],functions:{},selectedEnv:null,selectedEnvironmentId:""}},initialize:function(){this.get("environments").on("reset",this.setCurrentEnvironment,this),this.get("environments").on("change",this.setCurrentEnvironment,this),this.get("environments").on("add",this.setCurrentEnvironment,this),this.get("environments").on("remove",this.setCurrentEnvironment,this),this.set("selectedEnvironmentId",pm.settings.getSetting("selectedEnvironmentId")),this.set("selectedEnv",this.get("environments").get(pm.settings.getSetting("selectedEnvironmentId"))),pm.mediator.on("setEnvironmentVariable",this.setEnvironmentVariable,this),pm.mediator.on("setGlobalVariable",this.setGlobalVariable,this),pm.mediator.on("clearEnvironmentVariables",this.clearEnvironmentVariables,this),pm.mediator.on("clearGlobalVariables",this.clearGlobalVariables,this),this.initializeFunctions()},setGlobalVariable:function(a){var b=a.key,c=a.value+"",d=(this.get("variableProcessor"),this.get("globals")),e=_.clone(d.get("globals"));e||(e=[]);for(var f,g=e.length,h=!1,i=0;g>i;i++)if(f=e[i],f.key===b){h=!0,f.value=c;break}h||e.push({key:b,type:"text",value:c}),d.saveGlobals(e),this.get("setGlobalsTimeout")&&clearTimeout(this.get("setGlobalsTimeout")),this.set("setGlobalsTimeout",setTimeout(function(){d.trigger("change:globals")},100))},setEnvironmentVariable:function(a){var b=a.key,c=a.value+"",d=this.get("environments"),e=this.get("selectedEnv"),f=!1;if(e){var g=_.clone(e.get("values"));g||(g=[]);for(var h=g.length,i=0;h>i;i++)if(value=g[i],value.key===b){f=!0,value.value=c;break}f||g.push({key:b,type:"text",value:c});var j=e.get("id"),k=e.get("name");d.updateEnvironment(j,k,g);var l=d.get(j);this.setEnvironment(l)}},clearEnvironmentVariables:function(){var a=this.get("environments"),b=this.get("selectedEnv");if(b){var c=b.get("id"),d=b.get("name");a.clearEnvironment(c,d);var e=a.get(c);this.setEnvironment(e)}},clearGlobalVariables:function(){var a=(this.get("variableProcessor"),this.get("globals")),b=[];a.saveGlobals(b),a.trigger("change:globals")},setExternalDataVariables:function(a){var b=[];for(key in a)a.hasOwnProperty(key)&&b.push({key:key,value:a[key],type:"text"});this.set("externalDataVariables",b)},initializeFunctions:function(){var a={"\\$guid":{key:"$guid",run:function(){return guid()}},"\\$timestamp":{key:"$timestamp",run:function(){return Math.round((new Date).getTime()/1e3)}},"\\$randomInt":{key:"$randomInt",run:function(a,b){return a||(a=0),b||(b=1e3),getRandomInt(a,b)}},"\\$random [0-9]+,[0-9]+":{key:"$randomInt",run:function(a,b){return a||(a=0),b||(b=1e3),getRandomArbitrary(a,b)}}};this.set("functions",a)},setCurrentEnvironment:function(){this.set("selectedEnvironmentId",pm.settings.getSetting("selectedEnvironmentId")),this.set("selectedEnv",this.get("environments").get(pm.settings.getSetting("selectedEnvironmentId")))},setEnvironment:function(a){this.set("selectedEnvironmentId",a.get("id")),this.set("selectedEnv",a)},disableEnvironment:function(){this.set("selectedEnvironmentId",""),this.set("selectedEnv",null)},setGlobals:function(a){var b=this.get("globals");b.set("globals",a)},containsVariable:function(a,b){var c,d=pm.settings.getSetting("variableDelimiter"),e=d.substring(0,2),f=d.substring(d.length-2),g=e+"[^\r\n]*"+f,h=new RegExp(g,"g"),i=a.match(h),j=b.length;if(null===i)return!1;for(var k=0;j>k;k++){if("text"===b[k].type?c=e+b[k].key+f:"function"===b[k].type&&(c=e+b[k].matcher+f),_.indexOf(i,c)>=0)return!0;if(i instanceof Array&&i[0].indexOf(c)>=0)return!0}return!1},processString:function(a,b){if(!b)return a;var c,d,e=b.length,f=_.clone(a),g=pm.settings.getSetting("variableDelimiter"),h=g.substring(0,2),i=g.substring(g.length-2);try{for(var j=0;e>j;j++){c=h+b[j].key+i,d=new RegExp(c,"g");var k=_.clone(b[j].value);if(null!==k)if("object"==typeof k){if("function"!=typeof k.run)continue;var l=k.run();f=f.replace(d,l)}else{k+="";var m=new RegExp("\\$","g");k=k.replace(m,"$$$$"),f=f.replace(d,k)}}}catch(n){console.log(n),f=a}return this.containsVariable(f,b)?f=this.processString(f,b):f},getCurrentValue:function(a){if("number"==typeof a)return a;var b=this.get("selectedEnv"),c=[];b&&(c=b.getEnabledValues());var d=this.get("globals").getEnabledValues(),e=[],g={};if(d)for(var h=0;h<d.length;h++)d[h].hasOwnProperty("enabled")&&0==d[h].enabled||(g[d[h].key]=d[h]);for(h=0;h<c.length;h++)g[c[h].key]=c[h];var i=this.get("externalDataVariables");if(i)for(h=0;h<i.length;h++)g[i[h].key]=i[h];var j=this.get("functions");for(f in j)if(j.hasOwnProperty(f)){var k={key:f,matcher:j[f].key,value:j[f],type:"function"};g[f]=k}if(e=_.values(g),a){var l=_.clone(this.processString(a,e));return l}return a}}),EnvironmentManagerModal=Backbone.View.extend({environments:null,globals:null,setEnvTimeout:null,initialize:function(){function a(){var a=$("#environment-editor-id").val(),c=$("#environment-editor-name").val(),e=$("#environment-keyvaleditor").keyvalueeditor("getValues");if("0"===a){if(!c||0==c.length)return void $("#new-env-name-missing").show();$("#new-env-name-missing").hide(),b.addEnvironmentWithoutId(c,e)}else b.updateEnvironment(a,c,e);$("#environment-editor-name").val(""),$("#environment-keyvaleditor").keyvalueeditor("reset",[]),d.showSelector()}this.environments=this.options.environments,this.globals=this.options.globals,this.environments.on("change",this.render,this),this.environments.on("reset",this.render,this),this.environments.on("add",this.render,this),this.environments.on("remove",this.render,this),this.environments.on("importedEnvironment",this.onImportedEnvironment,this),this.globals.on("change:globals",this.render,this);var b=this.environments,c=this.globals,d=this;$("#modal-environments").on("shown",function(){pm.app.trigger("modalOpen","#modal-environments")}),$("#modal-environments").on("hidden",function(){pm.app.trigger("modalClose")}),$("#environments-list").on("click",".environment-action-delete",function(){var a=$(this).attr("data-id");$('a[rel="tooltip"]').tooltip("hide"),b.deleteEnvironment(a)}),$("#environments-list").on("click",".environment-action-edit",function(){var a=$(this).attr("data-id");d.showEditor(a)}),$("#environments-list").on("click",".environment-action-duplicate",function(){var a=$(this).attr("data-id");b.duplicateEnvironment(a)}),$("#environments-list").on("click",".environment-action-download",function(){var a=$(this).attr("data-id");b.downloadEnvironment(a)}),$(".environment-action-back").on("click",function(){d.showSelector()}),$("#environment-files-input").on("change",function(a){var c=a.target.files;console.log("Start importEnvironments"),b.importEnvironments(c),$("#environment-files-input").val("")}),$(".environments-actions-add").on("click",function(){d.showEditor()}),$(".environments-actions-import").on("click",function(){d.showImporter()}),$(".environments-actions-manage-globals").on("click",function(){d.showGlobals()}),$("#environment-globals-download").on("click",function(){d.downloadGlobals()}),$("#environment-editor-form").submit(function(){a()}),$(".environments-actions-add-submit").on("click",function(){a()}),$("#environment-editor").keydown(function(b){return 13===b.keyCode?(a(),b.preventDefault(),!1):!0}),$("#globals-editor").keydown(function(a){return 13===a.keyCode?($("a.environments-actions-add-back").click(),a.preventDefault(),!1):!0}),$(".environments-actions-add-back").on("click",function(){var a=$("#globals-keyvaleditor").keyvalueeditor("getValues");c.saveGlobals(a,!0),d.showSelector(),$("#environment-editor-name").val(""),$("#environment-keyvaleditor").keyvalueeditor("reset",[])}),$("#environments-list-help-toggle").on("click",function(a){var b=$("#environments-list-help-detail").css("display");"none"===b?($("#environments-list-help-detail").css("display","inline"),$(a.currentTarget).html("Hide")):($("#environments-list-help-detail").css("display","none"),$(a.currentTarget).html("Tell me more"))});var e={placeHolderKey:"Key",placeHolderValue:"Value",deleteButton:'<span class="icon-delete"/>'};$("#environment-keyvaleditor").keyvalueeditor("init",e),$("#globals-keyvaleditor").keyvalueeditor("init",e),$(document).bind("keydown","e",function(){pm.tracker.trackEvent("interaction","shortcut","show_env_modal"),pm.app.isModalOpen()||$("#modal-environments").modal({keyboard:!0})}),this.render()},onImportedEnvironment:function(a){noty({type:"success",dismissQueue:!0,text:"Imported "+a.name,layout:"topCenter",timeout:2500})},showEditor:function(a){if(a){var b=this.environments.get(a).toJSON();$("#environment-editor-name").val(b.name),$("#environment-editor-id").val(a),$("#environment-keyvaleditor").keyvalueeditor("reset",b.values)}else $("#environment-editor-id").val(0);$("#environments-list-wrapper").css("display","none"),$("#environment-editor").css("display","block"),$("#globals-editor").css("display","none"),$("#new-env-name-missing").hide(),$("#modal-environments .modal-footer").css("display","block")},downloadGlobals:function(){pm.mediator.trigger("downloadGlobals")},showSelector:function(){$("#environments-list-wrapper").css("display","block"),$("#environment-editor").css("display","none"),$("#environment-importer").css("display","none"),$("#globals-editor").css("display","none"),$(".environments-actions-add-submit").css("display","inline"),$("#modal-environments .modal-footer").css("display","none")},showImporter:function(){$("#environments-list-wrapper").css("display","none"),$("#environment-editor").css("display","none"),$("#globals-editor").css("display","none"),$("#environment-importer").css("display","block"),$(".environments-actions-add-submit").css("display","none"),$("#modal-environments .modal-footer").css("display","block")},showGlobals:function(){$("#environments-list-wrapper").css("display","none"),$("#environment-editor").css("display","none"),$("#globals-editor").css("display","block"),$("#environment-importer").css("display","none"),$(".environments-actions-add-submit").css("display","none"),$("#modal-environments .modal-footer").css("display","block")},render:function(){var a=this;this.setEnvTimeout&&clearTimeout(this.setEnvTimeout),this.setEnvTimeout=setTimeout(function(){$("#environments-list tbody").html(""),$("#environments-list tbody").append(Handlebars.templates.environment_list({items:a.environments.toJSON()})),$('#environments-list tbody .environment-actions a[rel="tooltip"]').tooltip(),$("#globals-keyvaleditor").keyvalueeditor("reset",a.globals.get("globals"))},100)}}),EnvironmentSelector=Backbone.View.extend({environments:null,variableProcessor:null,initialize:function(){this.environments=this.options.environments,this.variableProcessor=this.options.variableProcessor,this.environments.on("change",this.render,this),this.environments.on("reset",this.render,this),this.environments.on("add",this.render,this),this.environments.on("remove",this.render,this),this.variableProcessor.on("change:selectedEnv",this.render,this);var a=this.environments,b=this.variableProcessor;$("#environment-selector").on("click",".environment-list-item",function(){var c=$(this).attr("data-id"),d=a.get(c);b.set({selectedEnv:d}),pm.settings.setSetting("selectedEnvironmentId",d.id),$("#environment-selector .environment-list-item-selected").html(d.name)}),$("#environment-selector").on("click",".environment-list-item-noenvironment",function(){b.set({selectedEnv:null}),pm.settings.setSetting("selectedEnvironmentId",""),$("#environment-selector .environment-list-item-selected").html("No environment")}),this.render()},render:function(){var a=this;this.setEnvTimeout&&clearTimeout(this.setEnvTimeout),this.setEnvTimeout=setTimeout(function(){$("#environment-selector .dropdown-menu").html(""),$("#environment-selector .dropdown-menu").append(Handlebars.templates.environment_selector({items:a.environments.toJSON()})),$("#environment-selector .dropdown-menu").append(Handlebars.templates.environment_selector_actions());var b=a.variableProcessor.get("selectedEnv");$("#environment-selector .environment-list-item-selected").html(b&&b.toJSON().name?b.toJSON().name:"No environment")},100)}}),QuickLookPopOver=Backbone.View.extend({initialize:function(){var a=this;this.environments=this.options.environments,this.variableProcessor=this.options.variableProcessor,this.globals=this.options.globals,this.environments.on("change",this.render,this),this.variableProcessor.on("change:selectedEnv",this.render,this),this.globals.on("change:globals",this.render,this),$("#environment-quicklook").on("mouseenter",function(){$("#environment-quicklook-content").css("display","block")
}),$("#environment-quicklook").on("mouseleave",function(){$("#environment-quicklook-content").css("display","none")}),$(document).bind("keydown","q",function(){return pm.tracker.trackEvent("interaction","shortcut","quick_look_toggle"),a.toggleDisplay(),!1}),this.render()},render:function(){var a=this;this.setEnvTimeout&&clearTimeout(this.setEnvTimeout),this.setEnvTimeout=setTimeout(function(){var b=a.environments.get(a.variableProcessor.get("selectedEnv"));b?($("#environment-quicklook-environments h6").html(b.get("name")),$("#environment-quicklook-environments ul").html(""),$("#environment-quicklook-environments ul").append(Handlebars.templates.environment_quicklook({items:b.getEnabledValues()}))):($("#environment-quicklook-environments h6").html("No environment"),$("#environment-quicklook-environments ul").html("")),a.globals&&($("#environment-quicklook-globals ul").html(""),$("#environment-quicklook-globals ul").append(Handlebars.templates.environment_quicklook({items:a.globals.getEnabledValues()})))},100)},toggleDisplay:function(){var a=$("#environment-quicklook-content").css("display");"none"===a?$("#environment-quicklook-content").css("display","block"):$("#environment-quicklook-content").css("display","none")}}),HeaderPreset=Backbone.Model.extend({defaults:function(){return{id:"",name:"",headers:[],timestamp:0,synced:!1}},toSyncableJSON:function(){var a=this.toJSON();return a.synced=!0,a}}),HeaderPresets=Backbone.Collection.extend({model:HeaderPreset,isLoaded:!1,initializedSyncing:!1,syncFileType:"header_preset",comparator:function(a,b){var c,d=a.get("name"),e=b.get("name");c=d.length>e.legnth?e.length:d.length;for(var f=0;c>f;f++)if(d[f]!=e[f])return d[f]>e[f]?1:-1;return 1},presetsForAutoComplete:[],initialize:function(){this.on("change",this.refreshAutoCompleteList,this),this.loadPresets(),pm.mediator.on("syncChangeReceived",this.onSyncChangeReceived,this)},loadPresets:function(){var a=this;this.startListeningForFileSystemSyncEvents(),pm.indexedDB.headerPresets.getAllHeaderPresets(function(b){a.add(b,{merge:!0}),a.refreshAutoCompleteList(),a.isLoaded=!0,a.trigger("startSync")})},startListeningForFileSystemSyncEvents:function(){{var a=this;a.isLoaded,a.initializedSyncing}pm.mediator.on("initializedSyncableFileSystem",function(){a.initializedSyncing=!0,a.trigger("startSync")}),this.on("startSync",this.startSyncing,this)},startSyncing:function(){var a,b,c=0,d=this;if(this.isLoaded&&this.initializedSyncing)for(pm.mediator.on("addSyncableFileFromRemote",function(a,b){a===d.syncFileType&&d.onReceivingSyncableFileData(b)}),pm.mediator.on("updateSyncableFileFromRemote",function(a,b){a===d.syncFileType&&d.onReceivingSyncableFileData(b)}),pm.mediator.on("deleteSyncableFileFromRemote",function(a,b){a===d.syncFileType&&d.onRemoveSyncableFile(b)}),c=0;c<this.models.length;c++)a=this.models[c],b=a.get("synced"),b||this.addToSyncableFilesystem(a.get("id"))},onReceivingSyncableFileData:function(a){this.mergeHeaderPreset(JSON.parse(a),!0)},onRemoveSyncableFile:function(a){this.deleteHeaderPreset(a,!0)},getAsSyncableFile:function(a){var b=this,c=this.get(a),d=a+"."+b.syncFileType,e=b.syncFileType,f=JSON.stringify(c.toSyncableJSON());return{name:d,type:e,data:f}},addToSyncableFilesystem:function(a){var b=this,c=this.getAsSyncableFile(a);pm.mediator.trigger("addSyncableFile",c,function(c){"success"===c&&b.updateHeaderPresetSyncStatus(a,!0)})},removeFromSyncableFilesystem:function(a){var b=this,c=a+"."+b.syncFileType;pm.mediator.trigger("removeSyncableFile",c,function(){})},getHeaderPreset:function(a){for(var b,c=this.models,d=0,e=c.length;e>d&&(b=c[d],b.get("id")!==a);d++);return b},addHeaderPreset:function(a,b,c,d){this.addHeaderPresetWithOptSync(a,b,c,d,!0)},addHeaderPresetWithOptSync:function(a,b,c,d,e){e&&pm.tracker.trackEvent("request","headers","new_preset"),0===a&&(a=guid());var f={id:a,name:b,headers:c,timestamp:(new Date).getTime()},g=this;pm.indexedDB.headerPresets.addHeaderPreset(f,function(){g.add(f,{merge:!0}),pm.mediator.trigger("databaseOperationComplete"),d||g.addToSyncableFilesystem(a),e&&pm.syncManager.addChangeset("headerpreset","create",f,null,!0)})},editHeaderPreset:function(a,b,c,d){this.editHeaderPresetWithOptSync(a,b,c,d,!0)},editHeaderPresetWithOptSync:function(a,b,c,d,e){var f=this;pm.indexedDB.headerPresets.getHeaderPreset(a,function(g){var h={id:a,name:b,headers:c,timestamp:g.timestamp};pm.indexedDB.headerPresets.updateHeaderPreset(h,function(){f.add(h,{merge:!0}),pm.mediator.trigger("databaseOperationComplete"),d||f.addToSyncableFilesystem(a),e&&pm.syncManager.addChangeset("headerpreset","update",h,null,!0)})})},updateHeaderPresetSyncStatus:function(a,b){var c=this,d=this.get(a);d.set("synced",b),c.add(d,{merge:!0}),pm.indexedDB.headerPresets.updateHeaderPreset(d.toJSON(),function(){pm.mediator.trigger("databaseOperationComplete")})},deleteHeaderPreset:function(a,b){this.deleteHeaderPresetWithOptSync(a,b,!0)},deleteHeaderPresetWithOptSync:function(a,b,c){var d=this;pm.indexedDB.headerPresets.deleteHeaderPreset(a,function(){d.remove(a),b||d.removeFromSyncableFilesystem(a),c&&pm.syncManager.addChangeset("headerpreset","destroy",null,a,!0)})},getPresetsForAutoComplete:function(){for(var a=[],b=this.toJSON(),c=0,d=b.length;d>c;c++){var e=b[c],f={id:e.id,type:"preset",label:e.name,category:"Header presets"};a.push(f)}return a=_.union(a,allowedChromeHeaders),a=_.union(a,restrictedChromeHeaders)},refreshAutoCompleteList:function(){var a=this.getPresetsForAutoComplete();this.presetsForAutoComplete=a},mergeHeaderPreset:function(a,b){var c=this;pm.indexedDB.headerPresets.addHeaderPreset(a,function(a){c.add(a,{merge:!0}),pm.mediator.trigger("databaseOperationComplete"),pm.syncManager.addChangeset("headerpreset","create",a,null,!0),b||c.addToSyncableFilesystem(a.id)})},mergeHeaderPresets:function(a){for(var b,c=a.length,d=this,e=0;c>e;e++)b=a[e],d.mergeHeaderPreset(b)},onSyncChangeReceived:function(a,b,c){b.model||(b.model=b.type);var d=["headerpreset"];-1!==d.indexOf(b.model)&&("create"===a?this.createRemoteEntity(b,c):"update"===a?this.updateRemoteEntity(b,c):("destroy"===a||"delete"===a)&&this.deleteRemoteEntity(b,c))},createRemoteEntity:function(a,b){if("headerpreset"===a.model){var c=pm.headerPresets.addHeaderPresetWithOptSync(a.data.id,a.data.name,a.data.headers,!0,!1);"function"==typeof b&&b(),-1==c?pm.mediator.trigger("syncOperationFailed","Adding header preset failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["HeaderPreset created: ",a.data])}},updateRemoteEntity:function(a,b){if("headerpreset"===a.model){var c=pm.headerPresets.editHeaderPresetWithOptSync(a.data.id,a.data.name,a.data.headers,!0,!1);"function"==typeof b&&b(),-1==c?pm.mediator.trigger("syncOperationFailed","Editing header preset failed"):pm.syncManager.updateSinceFromMessage(a),pm.syncLogger.log(new Error,["HeaderPreset updated: ",a.data])}},deleteRemoteEntity:function(a,b){if("headerpreset"===a.model){pm.syncLogger.log(new Error,["HeaderPreset destroyed: ",a.data]);var c=pm.headerPresets.deleteHeaderPresetWithOptSync(a.data.id,!0,!1);"function"==typeof b&&b(),-1==c?pm.mediator.trigger("syncOperationFailed","Deleting header preset failed"):pm.syncManager.updateSinceFromMessage(a)}}}),HeaderPresetsModal=Backbone.View.extend({el:$("#modal-header-presets"),initialize:function(){this.model.on("add",this.render,this),this.model.on("remove",this.render,this),this.model.on("change",this.render,this);var a=this.model,b=this;$("#modal-header-presets").on("shown",function(){$(".header-presets-actions-add").focus(),pm.app.trigger("modalOpen","#modal-header-presets")}),$("#modal-header-presets").on("hidden",function(){pm.app.trigger("modalClose")}),$(".header-presets-actions-add").on("click",function(){b.showEditor()}),$(".header-presets-actions-back").on("click",function(){b.showList()}),$(".header-presets-actions-submit").on("click",function(){var c=$("#header-presets-editor-id").val(),d=$("#header-presets-editor-name").val(),e=$("#header-presets-keyvaleditor").keyvalueeditor("getValues");"0"===c?_.bind(a.addHeaderPreset,a)(0,d,e):_.bind(a.editHeaderPreset,a)(c,d,e),b.showList()}),$("#header-presets-list").on("click",".header-preset-action-edit",function(c){var d=$(c.currentTarget).attr("data-id"),e=_.bind(a.getHeaderPreset,a)(d);$("#header-presets-editor-name").val(e.get("name")),$("#header-presets-editor-id").val(e.get("id")),$("#header-presets-keyvaleditor").keyvalueeditor("reset",e.get("headers")),b.showEditor()}),$("#header-presets-list").on("click",".header-preset-action-delete",function(b){var c=$(b.currentTarget).attr("data-id");a.deleteHeaderPreset(c)})},showList:function(){$("#header-presets-list-wrapper").css("display","block"),$("#header-presets-editor").css("display","none"),$("#header-presets-editor-name").attr("value",""),$("#header-presets-editor-id").attr("value",0),$("#header-presets-keyvaleditor").keyvalueeditor("reset",[]),$("#modal-header-presets .modal-footer").css("display","none")},showEditor:function(){$("#modal-header-presets .modal-footer").css("display","block"),$("#header-presets-list-wrapper").css("display","none"),$("#header-presets-editor").css("display","block")},render:function(){$("#header-presets-list tbody").html(""),$("#header-presets-list tbody").append(Handlebars.templates.header_preset_list({items:this.model.toJSON()}))}}),HeaderPresetsRequestEditor=Backbone.View.extend({initialize:function(){var a=this;this.model.on("add",this.render,this),this.model.on("remove",this.render,this);var b=this.model,c={placeHolderKey:"Key",placeHolderValue:"Value",deleteButton:'<span class="icon-delete"/>'};$("#header-presets-keyvaleditor").keyvalueeditor("init",c),$("#headers-keyvaleditor-actions-manage-presets").on("click",function(){$("#modal-header-presets").modal("show")}),$("#headers-keyvaleditor-actions-add-preset").on("click",".header-preset-dropdown-item",function(){pm.tracker.trackEvent("request","headers","add_preset");var c=$(this).attr("data-id"),d=b.getHeaderPreset(c),e=$("#headers-keyvaleditor").keyvalueeditor("getValues"),f=_.union(e,d.get("headers"));$("#headers-keyvaleditor").keyvalueeditor("reset",f),a.setHeadersInTextarea(f)})},render:function(){$("#headers-keyvaleditor-actions-add-preset ul").html(""),$("#headers-keyvaleditor-actions-add-preset ul").append(Handlebars.templates.header_preset_dropdown({items:this.model.toJSON()}))},setHeadersInTextarea:function(a){var b=$("textarea#headers-direct"),c=a.length,d="";for(i=0;c>i;i++)d+=a[i].key+": "+a[i].value+"\n";b.val(d),$("#headers-textarea-message").html('Enter headers in "key":"value" format.'),$("#headers-textarea-message").removeClass("wrong-header")}}),BasicAuthProcessor=Backbone.Model.extend({defaults:function(){return{username:null,password:null,request:null}},initialize:function(){this.on("change",this.updateDB,this);var a=this;pm.indexedDB.helpers.getHelper("basic",function(b){b&&a.set(b)})},process:function(){this.processCustomRequest(this.get("request"))},processCustomRequest:function(a){a.trigger("updateModel");var b=a.get("headers"),c="Authorization",d=(findPosition(b,"key",c),this.get("username")),e=this.get("password");d=pm.envManager.getCurrentValue(d),e=pm.envManager.getCurrentValue(e);var f=d+":"+e,g="Basic "+window.btoa(unescape(encodeURIComponent(f)));a.setHeader(c,g),a.trigger("customHeaderUpdate")},updateDB:function(){var a={id:"basic",username:this.get("username"),password:this.get("password"),timestamp:(new Date).getTime()};pm.indexedDB.helpers.addHelper(a,function(){})}}),DigestAuthProcessor=Backbone.Model.extend({defaults:function(){return{id:"",time:0,algorithm:"",username:"",realm:"",password:"",nonce:"",nonceCount:"",clientNonce:"",opaque:"",qop:"",request:null}},initialize:function(){this.on("change",this.updateDB,this);var a=this;pm.indexedDB.helpers.getHelper("digest",function(b){b&&a.set(b)})},getHeader:function(a){a.trigger("updateModel");var b,c=pm.envManager.getCurrentValue(this.get("algorithm")),d=pm.envManager.getCurrentValue(this.get("username")),e=pm.envManager.getCurrentValue(this.get("realm")),f=pm.envManager.getCurrentValue(this.get("password")),g=a.get("method"),h=pm.envManager.getCurrentValue(this.get("nonce")),i=pm.envManager.getCurrentValue(this.get("nonceCount")),j=pm.envManager.getCurrentValue(this.get("clientNonce")),k=pm.envManager.getCurrentValue(this.get("opaque")),l=pm.envManager.getCurrentValue(this.get("qop")),m=a.getRequestBodyPreview(),n=a.processUrl(a.get("url")),o=a.splitUrlIntoHostAndPath(n),p=o.path;if("MD5-sess"===c){var q=CryptoJS.MD5(d+":"+e+":"+f);b=q+":"+h+":"+j}else b=d+":"+e+":"+f;var r;r="auth-int"===l?g+":"+p+":"+m:g+":"+p;var s,t=CryptoJS.MD5(b),u=CryptoJS.MD5(r);s=CryptoJS.MD5("auth-int"===l||"auth"===l?t+":"+h+":"+i+":"+j+":"+l+":"+u:t+":"+h+":"+u);var v=" ";return v+='username="'+d+'", ',v+='realm="'+e+'", ',v+='nonce="'+h+'", ',v+='uri="'+p+'", ',("auth"===l||"auth-int"===l)&&(v+="qop="+l+", "),("auth"===l||"auth-int"===l||"MD5-sess"===c)&&(v+="nc="+i+", ",v+='cnonce="'+j+'", '),v+='response="'+s+'", ',v+='opaque="'+k+'"'},process:function(){var a=this.get("request");this.processCustomRequest(a)},processCustomRequest:function(a){var b=(a.get("headers"),"Authorization"),c=($("#request-helper-digestAuth-realm").val(),this.getHeader(a));c="Digest"+c,a.setHeader(b,c),a.trigger("customHeaderUpdate")},updateDB:function(){var a={id:"digest",time:(new Date).getTime(),realm:this.get("realm"),username:this.get("username"),password:this.get("password"),nonce:this.get("nonce"),algorithm:this.get("algorithm"),nonceCount:this.get("nonceCount"),clientNonce:this.get("clientNonce"),opaque:this.get("opaque"),qop:this.get("qop")};pm.indexedDB.helpers.addHelper(a,function(){})}}),Helpers=Backbone.Model.extend({defaults:function(){return{activeHelper:"normal",basicAuth:null,digestAuth:null,oAuth1:null,oAuth2:null}}}),OAuth1Processor=Backbone.Model.extend({defaults:function(){return{id:"oAuth1",time:0,consumerKey:"",consumerSecret:"",token:"",tokenSecret:"",signatureMethod:"HMAC-SHA1",timestamp:"",nonce:"",version:"",realm:"",header:"",auto:"",encodeSignature:!1,includeEmpty:!1,request:null}},initialize:function(){var a=this;this.on("change",this.updateDB,this),pm.indexedDB.helpers.getHelper("oAuth1",function(b){b&&(a.set(b),a.generateHelper())})},updateDB:function(){var a={id:"oAuth1",time:(new Date).getTime(),consumerKey:this.get("consumerKey"),consumerSecret:this.get("consumerSecret"),token:this.get("token"),tokenSecret:this.get("tokenSecret"),signatureMethod:this.get("signatureMethod"),timestamp:this.get("timestamp"),nonce:this.get("nonce"),version:this.get("version"),realm:this.get("realm"),header:this.get("header"),auto:this.get("auto"),encodeSignature:this.get("encodeSignature"),includeEmpty:this.get("includeEmpty")};pm.indexedDB.helpers.addHelper(a,function(){})},generateHelper:function(){""===this.get("version")&&this.set("version","1.0"),this.get(!1)&&this.set("signatureMethod","HMAC-SHA1"),this.set("timestamp",OAuth.timestamp()+""),this.set("nonce",OAuth.nonce(6))},generateSignature:function(a){var b,c=a.get("url");if(""===c)return noty({type:"success",text:"Please enter a URL first",layout:"topCenter",timeout:750}),null;var d,e=(this.get("realm"),a.get("method")),f=a.get("body");d=pm.envManager.getCurrentValue(c).trim(),d=ensureProperUrl(d),d.indexOf("?")>0&&(d=d.split("?")[0]);var g={action:d,method:e,parameters:[]},h=[{key:"oauth_consumer_key",value:this.get("consumerKey")},{key:"oauth_token",value:this.get("token")},{key:"oauth_signature_method",value:this.get("signatureMethod")},{key:"oauth_timestamp",value:this.get("timestamp")},{key:"oauth_nonce",value:this.get("nonce")},{key:"oauth_version",value:this.get("version")}];for(b=0;b<h.length;b++){var i=h[b];i.value=pm.envManager.getCurrentValue(i.value),(""!=i.value||this.get("includeEmpty")===!0)&&g.parameters.push([i.key,i.value])}var j,k=a.getUrlParams();pm.methods.isMethodWithBody(e)?(j=f.get("dataAsObjects"),"undefined"==typeof j&&(j=[])):j=[];var i,l,m=_.union(k,j),n=_.union(h,[{key:"oauth_signature",value:""}]);for(b=0;b<m.length;b++)i=m[b],i.key&&(l=findPosition(n,"key",i.key),0>l&&(i.value=pm.envManager.getCurrentValue(i.value),(""!=i.value||this.get("includeEmpty")===!0)&&g.parameters.push([i.key,i.value])));var o={};return""!==this.get("consumerSecret")&&(o.consumerSecret=this.get("consumerSecret"),o.consumerSecret=pm.envManager.getCurrentValue(o.consumerSecret)),""!==this.get("tokenSecret")&&(o.tokenSecret=this.get("tokenSecret"),o.tokenSecret=pm.envManager.getCurrentValue(o.tokenSecret)),OAuth.SignatureMethod.sign(g,o)},removeOAuthKeys:function(a){var b,c,d=["oauth_consumer_key","oauth_token","oauth_signature_method","oauth_timestamp","oauth_nonce","oauth_version","oauth_signature"],e=[];for(b=0,c=a.length;c>b;b++){var f=_.indexOf(d,a[b].key);0>f&&e.push(a[b])}return e},process:function(){var a=this.get("request");this.processCustomRequest(a),this.generateHelper()},processCustomRequest:function(a){a.trigger("updateModel");var b,c,d=[],e=a.getUrlParams(),f=[],g=(a.get("url"),a.get("body")),h=g.get("dataMode"),i=a.get("method"),f=g.get("dataAsObjects");d=d.concat(e),"undefined"!=typeof f&&(d=d.concat(f)),d=this.removeOAuthKeys(d);var j="oauth_signature",k=[],l=[{key:"oauth_consumer_key",value:this.get("consumerKey")},{key:"oauth_token",value:this.get("token")},{key:"oauth_signature_method",value:this.get("signatureMethod")},{key:"oauth_timestamp",value:this.get("timestamp")},{key:"oauth_nonce",value:this.get("nonce")},{key:"oauth_version",value:this.get("version")}];for(b=0;b<l.length;b++){var m=l[b];m.value=pm.envManager.getCurrentValue(m.value),k.push(m)}for(b=0,c=d.length;c>b;b++)d[b].value=pm.envManager.getCurrentValue(d[b].value);var n=this.generateSignature(a);if(null!==n){this.get("encodeSignature")===!0&&(n=encodeURIComponent(n)),k.push({key:j,value:n});var o=this.get("header");if(o){var p=this.get("realm"),q="Authorization",r="OAuth ";null!=p&&""!==p.trim()&&(r+='realm="'+encodeURIComponent(p)+'",');var s=k.length;for(b=0;s>b;b++)null!=k[b].value&&""!=k[b].value.trim()&&(r+=encodeURIComponent(k[b].key)+'="'+encodeURIComponent(k[b].value)+'",');r=r.substring(0,r.length-1),a.setHeader(q,r),a.trigger("customHeaderUpdate")}else d=d.concat(k),a.isMethodWithBody(i)?"urlencoded"===h?g.loadData("urlencoded",d,!0):"params"===h?g.loadData("params",d,!0):"raw"===h&&(a.setUrlParamString(d),a.trigger("customURLParamUpdate")):(a.setUrlParamStringWithOptBlankValRemoval(d,null,!0),a.trigger("customURLParamUpdate"))}}}),OAuth2TokenFetcher=Backbone.Model.extend({defaults:function(){return{id:"oAuth2",authorization_url:"",access_token_url:"",client_id:"",client_secret:"",scope:""}},initialize:function(){var a=this;this.on("startAuthorization",this.startAuthorization),this.on("change",this.updateDB,this),pm.indexedDB.helpers.getHelper("oAuth2",function(b){b&&a.set(b)})},updateDB:function(){var a={id:this.get("id"),authorization_url:this.get("authorization_url"),access_token_url:this.get("access_token_url"),client_id:this.get("client_id"),client_secret:this.get("client_secret"),scope:this.get("scope"),timestamp:(new Date).getTime()};pm.indexedDB.helpers.addHelper(a,function(){})},startAuthorization:function(a){var b={authorization_url:pm.envManager.getCurrentValue(_.clone(a.authorization_url)),access_token_url:pm.envManager.getCurrentValue(_.clone(a.access_token_url)),client_id:pm.envManager.getCurrentValue(_.clone(a.client_id)),client_secret:pm.envManager.getCurrentValue(_.clone(a.client_secret)),scope:pm.envManager.getCurrentValue(_.clone(a.scope))};this.set(a);var c=pm.webUrl+"/oauth2/start";c+="?authorization_url="+encodeURIComponent(b.authorization_url),c+="&access_token_url="+encodeURIComponent(b.access_token_url),c+="&client_id="+encodeURIComponent(b.client_id),c+="&client_secret="+encodeURIComponent(b.client_secret),c+="&scope="+encodeURIComponent(b.scope),c+="&app_id="+chrome.runtime.id,chrome.identity.launchWebAuthFlow({url:c,interactive:!0},function(a){if(chrome.runtime.lastError)pm.mediator.trigger("notifyError","Could not initiate OAuth 2 flow. Check debug URL."),$("#oauth2-debug-url-group .controls").html('<a class="selectable" target="_blank" href="'+c+'">'+c+"</a>"),$("#oauth2-debug-url-group").show();else{var b=getUrlVars(a);pm.mediator.trigger("addOAuth2Token",b)}})}}),OAuth2Token=Backbone.Model.extend({defaults:function(){return{id:"",name:"OAuth2 Token",access_token:"",expires_in:0,timestamp:0}}}),OAuth2Tokens=Backbone.Collection.extend({model:OAuth2Token,comparator:function(a,b){var c=a.get("timestamp"),d=b.get("timestamp");return c>d},initialize:function(){pm.mediator.on("addOAuth2Token",this.addAccessToken,this),pm.mediator.on("updateOAuth2Token",this.updateAccessToken,this),this.loadAllAccessTokens()},loadAllAccessTokens:function(){var a=this;pm.indexedDB.oAuth2AccessTokens.getAllAccessTokens(function(b){a.add(b,{merge:!0}),a.trigger("change")})},addAccessToken:function(a){var b=this,c=(guid(),{id:guid(),timestamp:(new Date).getTime(),data:a});a.hasOwnProperty("access_token")&&(c.access_token=a.access_token),pm.indexedDB.oAuth2AccessTokens.addAccessToken(c,function(a){var d=new OAuth2Token(c);b.add(d,{merge:!0}),pm.mediator.trigger("addedOAuth2Token",a)})},updateAccessToken:function(a){var b=this.get(a.id);b.set("name",a.name),pm.indexedDB.oAuth2AccessTokens.updateAccessToken(b.toJSON(),function(a){pm.mediator.trigger("updatedOAuth2Token",a.id)})},deleteAccessToken:function(a){this.remove(a),pm.indexedDB.oAuth2AccessTokens.deleteAccessToken(a,function(){})},addAccessTokenToRequest:function(a,b){var c=this.get(a),d=c.get("data"),e=arrayObjectIndexOf(d,"access_token","key");if("url"===b){var f={key:"access_token",value:d[e].value};pm.mediator.trigger("addRequestURLParam",f)}else if("header"===b){var g={key:"Authorization",value:"Bearer "+d[e].value};pm.mediator.trigger("addRequestHeader",g)}}}),BasicAuthForm=Backbone.View.extend({initialize:function(){this.model.on("change:username",this.render,this),this.model.on("change:password",this.render,this);var a=this,b=this.model;$("#request-helper-basicAuth .request-helper-submit").on("click",function(){$("#request-helpers").css("display","none");var a=$("#request-helper-basicAuth-username").val(),c=$("#request-helper-basicAuth-password").val();b.set({username:a,password:c}),b.process()}),$("#request-helper-basicAuth input").on("blur",function(){a.save()}),$("#request-helper-basicAuth .request-helper-clear").on("click",function(){a.clearFields()})},clearFields:function(){this.model.set({username:"",password:""}),$("#request-helper-basicAuth-username").val(""),$("#request-helper-basicAuth-password").val("")},save:function(){var a=$("#request-helper-basicAuth-username").val(),b=$("#request-helper-basicAuth-password").val();this.model.set({username:a,password:b})},render:function(){$("#request-helper-basicAuth-username").val(this.model.get("username")),$("#request-helper-basicAuth-password").val(this.model.get("password"))}}),DigestAuthForm=Backbone.View.extend({initialize:function(){this.model.on("change",this.render,this);var a=this,b=this.model;$("#request-helper-digestAuth .request-helper-submit").on("click",function(){$("#request-helpers").css("display","none");var a={id:"digest",time:(new Date).getTime(),realm:$("#request-helper-digestAuth-realm").val(),username:$("#request-helper-digestAuth-username").val(),password:$("#request-helper-digestAuth-password").val(),nonce:$("#request-helper-digestAuth-nonce").val(),algorithm:$("#request-helper-digestAuth-algorithm").val(),nonceCount:$("#request-helper-digestAuth-nonceCount").val(),clientNonce:$("#request-helper-digestAuth-clientNonce").val(),opaque:$("#request-helper-digestAuth-opaque").val(),qop:$("#request-helper-digestAuth-qop").val()};b.set(a),b.process()}),$("#request-helper-digestAuth .request-helper-clear").on("click",function(){a.clearFields()}),$("#request-helper-digestAuth input").on("blur",function(){a.save()})},clearFields:function(){$("#request-helper-digestAuth-realm").val(""),$("#request-helper-digestAuth-username").val(""),$("#request-helper-digestAuth-password").val(""),$("#request-helper-digestAuth-nonce").val(""),$("#request-helper-digestAuth-algorithm").val(""),$("#request-helper-digestAuth-nonceCount").val(""),$("#request-helper-digestAuth-clientNonce").val(""),$("#request-helper-digestAuth-opaque").val(""),$("#request-helper-digestAuth-qop").val("");var a={id:"digest",time:(new Date).getTime(),realm:"",username:"",password:"",nonce:"",algorithm:"",nonceCount:"",clientNonce:"",opaque:"",qop:""};this.model.set(a)},save:function(){var a={id:"digest",time:(new Date).getTime(),realm:$("#request-helper-digestAuth-realm").val(),username:$("#request-helper-digestAuth-username").val(),password:$("#request-helper-digestAuth-password").val(),nonce:$("#request-helper-digestAuth-nonce").val(),algorithm:$("#request-helper-digestAuth-algorithm").val(),nonceCount:$("#request-helper-digestAuth-nonceCount").val(),clientNonce:$("#request-helper-digestAuth-clientNonce").val(),opaque:$("#request-helper-digestAuth-opaque").val(),qop:$("#request-helper-digestAuth-qop").val()};this.model.set(a)},render:function(){$("#request-helper-digestAuth-realm").val(this.model.get("realm")),$("#request-helper-digestAuth-username").val(this.model.get("username")),$("#request-helper-digestAuth-algorithm").val(this.model.get("algorithm")),$("#request-helper-digestAuth-password").val(this.model.get("password")),$("#request-helper-digestAuth-nonce").val(this.model.get("nonce")),$("#request-helper-digestAuth-nonceCount").val(this.model.get("nonceCount")),$("#request-helper-digestAuth-clientNonce").val(this.model.get("clientNonce")),$("#request-helper-digestAuth-opaque").val(this.model.get("opaque")),$("#request-helper-digestAuth-qop").val(this.model.get("qop"))}}),HelperManager=Backbone.View.extend({initialize:function(){{var a=this.model;new BasicAuthForm({model:a.get("basicAuth")}),new DigestAuthForm({model:a.get("digestAuth")}),new OAuth1Form({model:a.get("oAuth1")}),new OAuth2Manager({model:a.get("oAuth2")})}this.model.on("change:activeHelper",this.render,this);var b=a.get("request");b.on("loadRequest",this.onLoadRequest,this);var c=this;$("#request-types .request-helper-tabs li").on("click",function(){$("#request-types .request-helper-tabs li").removeClass("active");var a=event?event.currentTarget:this;$(a).addClass("active");var b=$(a).attr("data-id");pm.tracker.trackEvent("request","auth_helper",b),c.showRequestHelper(b),c.render()}),$(".checkbox-show-password").click(function(){var a=$(this).attr("data-password-id"),b=$("#"+a)[0];b.type=$(this).is(":checked")?"text":"password"}),$("#callback-url-text").html(postman_oauth2_callback_url)},getAuthTypes:function(){return["normal","basicAuth","digestAuth","oAuth1","oAuth2"]},onLoadRequest:function(a){var b=a.get("currentHelper"),c=a.get("helperAttributes");if(-1!==this.getAuthTypes().indexOf(b)){if("normal"!==b){var d=this.model.get(b);for(var e in c)c.hasOwnProperty(e)&&d.set(e,c[e])}this.showRequestHelper(b)}else this.showRequestHelper("normal")},getActiveHelperType:function(){return this.model.get("activeHelper")},getHelper:function(a){return this.model.get(a)},showRequestHelper:function(a){return this.model.set("activeHelper",a),this.model.trigger("change:activeHelper"),!1},clearHelpers:function(){"#request-types ul li".removeClass("active"),$("#request-types ul li[data-id=normal]").addClass("active"),$("#request-helpers").css("display","none")},render:function(){var a=this.model.get("activeHelper");$("#request-types ul li").removeClass("active"),$("#request-types ul li[data-id="+a+"]").addClass("active"),"normal"!==a?$("#request-helpers").css("display","block"):$("#request-helpers").css("display","none"),"oauth1"===a.toLowerCase()&&this.model.get("oAuth1").generateHelper(),$("#request-helpers>.request-helpers").css("display","none"),$("#request-helper-"+a).css("display","block"),$("#oauth2-debug-url-group").hide()}}),OAuth1Form=Backbone.View.extend({initialize:function(){this.model.on("change",this.render,this);var a=this,b=this.model;$("#request-helper-oAuth1 .request-helper-submit").on("click",function(){$("#request-helpers").css("display","none"),a.save(),b.process()}),$("#request-helper-oAuth1 input").on("blur",function(){a.save()}),$("#request-helper-oAuth1 .request-helper-clear").on("click",function(){a.clearFields()}),$("#request-helper-oauth1-auto").change(function(){var c=$("#request-helper-oauth1-auto").attr("checked")?!0:!1;a.save(),b.set("auto",c),c?$("#request-helper-oAuth1 .request-helper-submit").css("display","none"):$("#request-helper-oAuth1 .request-helper-submit").css("display","inline-block")}),$("#request-helper-oauth1-header").click(function(){a.save()})},clearFields:function(){$("#request-helper-oauth1-consumerKey").val(""),$("#request-helper-oauth1-consumerSecret").val(""),$("#request-helper-oauth1-token").val(""),$("#request-helper-oauth1-tokenSecret").val(""),$("#request-helper-oauth1-signatureMethod").val("HMAC-SHA1"),$("#request-helper-oauth1-timestamp").val(""),$("#request-helper-oauth1-nonce").val(""),$("#request-helper-oauth1-version").val(""),$("#request-helper-oauth1-realm").val(""),$("#request-helper-oauth1-header").prop("checked",!1),$("#request-helper-oauth1-auto").prop("checked",!1),$("#request-helper-oauth1-empty-params").prop("checked",!1),$("#request-helper-oauth1-encode-signature").prop("checked",!1);var a={id:"oAuth1",time:(new Date).getTime(),consumerKey:"",consumerSecret:"",token:"",tokenSecret:"",signatureMethod:"HMAC-SHA1",timestamp:"",nonce:"",version:"",realm:"",header:!1,auto:!1,encodeSignature:!1,includeEmpty:!1};this.model.set(a)},save:function(){var a={id:"oAuth1",time:(new Date).getTime(),consumerKey:$("#request-helper-oauth1-consumerKey").val(),consumerSecret:$("#request-helper-oauth1-consumerSecret").val(),token:$("#request-helper-oauth1-token").val(),tokenSecret:$("#request-helper-oauth1-tokenSecret").val(),signatureMethod:$("#request-helper-oauth1-signatureMethod").val(),timestamp:$("#request-helper-oauth1-timestamp").val(),nonce:$("#request-helper-oauth1-nonce").val(),version:$("#request-helper-oauth1-version").val(),realm:$("#request-helper-oauth1-realm").val(),header:$("#request-helper-oauth1-header").prop("checked"),auto:$("#request-helper-oauth1-auto").prop("checked"),encodeSignature:$("#request-helper-oauth1-encode-signature").prop("checked"),includeEmpty:$("#request-helper-oauth1-empty-params").prop("checked")};this.model.set(a)},render:function(){$("#request-helper-oauth1-consumerKey").val(this.model.get("consumerKey")),$("#request-helper-oauth1-consumerSecret").val(this.model.get("consumerSecret")),$("#request-helper-oauth1-token").val(this.model.get("token")),$("#request-helper-oauth1-tokenSecret").val(this.model.get("tokenSecret")),$("#request-helper-oauth1-signatureMethod").val(this.model.get("signatureMethod")),$("#request-helper-oauth1-timestamp").val(this.model.get("timestamp")),$("#request-helper-oauth1-nonce").val(this.model.get("nonce")),$("#request-helper-oauth1-version").val(this.model.get("version")),$("#request-helper-oauth1-realm").val(this.model.get("realm")),$("#request-helper-oauth1-header").prop("checked",this.model.get("header")),$("#request-helper-oauth1-auto").prop("checked",this.model.get("auto")),$("#request-helper-oauth1-encode-signature").prop("checked",this.model.get("encodeSignature")),$("#request-helper-oauth1-empty-params").prop("checked",this.model.get("includeEmpty")),this.model.get("auto")?$("#request-helper-oAuth1 .request-helper-submit").css("display","none"):$("#request-helper-oAuth1 .request-helper-submit").css("display","inline-block")}}),OAuth2Form=Backbone.View.extend({initialize:function(){this.model.on("change",this.render,this);var a=this,b=this.model;$("#request-helper-oauth2-authorization-url").autocomplete({source:oAuth2AuthorizationUrls,delay:50}),$("#request-helper-oauth2-access-token-url").autocomplete({source:oAuth2TokenUrls,delay:50}),$("#request-helper-oAuth2 .request-helper-back").on("click",function(){a.save(),a.showAccessTokens()
}),$("#request-helper-oAuth2 .request-helper-submit").on("click",function(){var c={authorization_url:$("#request-helper-oauth2-authorization-url").val(),access_token_url:$("#request-helper-oauth2-access-token-url").val(),client_id:$("#request-helper-oauth2-client-id").val(),client_secret:$("#request-helper-oauth2-client-secret").val(),scope:$("#request-helper-oauth2-scope").val()};a.save(),$("#oauth2-debug-url-group").hide(),b.trigger("startAuthorization",c)}),$("#request-helper-oAuth2 .request-helper-save").on("click",function(){var a=$("#request-helper-oauth2-name").val(),b=$(this).attr("data-id"),c={id:b,name:a};pm.mediator.trigger("updateOAuth2Token",c)}),pm.mediator.on("addedOAuth2Token",this.onAddedOAuth2Token,this)},onAddedOAuth2Token:function(a){$("#request-helper-oAuth2-access-token-data").html(""),$("#request-helper-oAuth2-access-token-data").append(Handlebars.templates.environment_quicklook({items:a.data})),$("#request-helper-oAuth2 .request-helper-save").attr("data-id",a.id),this.showSaveForm()},showSaveForm:function(){$("#request-helper-oAuth2-access-tokens-container").css("display","none"),$("#request-helper-oAuth2-access-token-form").css("display","none"),$("#request-helper-oAuth2-access-token-save-form").css("display","block")},showAccessTokens:function(){$("#request-helper-oAuth2-access-tokens-container").css("display","block"),$("#request-helper-oAuth2-access-token-save-form").css("display","none"),$("#request-helper-oAuth2-access-token-form").css("display","none")},save:function(){var a={id:"oAuth2",authorization_url:$("#request-helper-oauth2-authorization-url").val(),access_token_url:$("#request-helper-oauth2-access-token-url").val(),client_id:$("#request-helper-oauth2-client-id").val(),client_secret:$("#request-helper-oauth2-client-secret").val(),scope:$("#request-helper-oauth2-scope").val(),time:(new Date).getTime()};this.model.set(a)},render:function(){$("#request-helper-oauth2-authorization-url").val(this.model.get("authorization_url")),$("#request-helper-oauth2-access-token-url").val(this.model.get("access_token_url")),$("#request-helper-oauth2-client-id").val(this.model.get("client_id")),$("#request-helper-oauth2-client-secret").val(this.model.get("client_secret")),$("#request-helper-oauth2-scope").val(this.model.get("scope")),$("#oauth2-debug-url-group").hide()}}),OAuth2Manager=Backbone.View.extend({initialize:function(){{var a=this;new OAuth2Form({model:this.model})}pm.mediator.on("showAccessTokens",this.showAccessTokens,this),pm.mediator.on("updatedOAuth2Token",this.showAccessTokens,this),$("#request-helper-oAuth2-access-token-get").on("click",function(){a.showAccessTokenForm()})},showAccessTokenForm:function(){$("#request-helper-oAuth2-access-tokens-container").css("display","none"),$("#request-helper-oAuth2-access-token-save-form").css("display","none"),$("#request-helper-oAuth2-access-token-form").css("display","block")},showAccessTokens:function(){$("#request-helper-oAuth2-access-tokens-container").css("display","block"),$("#request-helper-oAuth2-access-token-save-form").css("display","none"),$("#request-helper-oAuth2-access-token-form").css("display","none")},render:function(){}}),OAuth2TokenList=Backbone.View.extend({initialize:function(){var a=this.model;a.on("add",this.render,this),a.on("remove",this.render,this),a.on("change",this.render,this),$("#request-helper-oAuth2-access-tokens").on("mouseenter",".oauth2-access-token-container",function(){var a=$(".oauth2-access-token-actions",this);a.css("display","block")}),$("#request-helper-oAuth2-access-tokens").on("mouseleave",".oauth2-access-token-container",function(){var a=$(".oauth2-access-token-actions",this);a.css("display","none")}),$("#request-helper-oAuth2-access-tokens").on("click",".oauth2-access-token-actions-load",function(){var b=$(this).attr("data-id"),c=$("#request-helper-oAuth2-options input[name='oAuth2-token-location']:checked").val();a.addAccessTokenToRequest(b,c)}),$("#request-helper-oAuth2-access-tokens").on("click",".oauth2-access-token-actions-delete",function(){var b=$(this).attr("data-id");a.deleteAccessToken(b)})},render:function(){var a=this.model.toJSON();$("#request-helper-oAuth2-access-tokens").html(""),$("#request-helper-oAuth2-access-tokens").append(Handlebars.templates.oauth2_access_tokens({items:a}))}}),HistoryRequest=Backbone.Model.extend({defaults:function(){return{}}}),History=Backbone.Collection.extend({model:HistoryRequest,initialize:function(){var a=this;pm.indexedDB.getAllRequestItems(function(b){var c=[],d=b.length;if(0===d)b=[];else for(var e=0;d>e;e++){var f=b[e];pm.mediator.trigger("addToURLCache",f.url);var g=f;g.position="top",c.push(g)}pm.syncManager&&pm.syncManager.trigger("itemLoaded","history"),a.add(c,{merge:!0})}),pm.mediator.on("syncChangeReceived",this.onSyncChangeReceived,this)},requestExists:function(a){var b=-1,c=a.method.toLowerCase();if(isMethodWithBody(c))return-1;for(var d=this.toJSON(),e=d.length,f=0;e>f;f++){var g=d[f];if(g.url.length!==a.url.length||g.headers.length!==a.headers.length||g.method!==a.method?b=-1:g.url===a.url&&g.headers===a.headers&&(b=f),b>=0)break}return b},loadRequest:function(a){var b=this.get(a).toJSON();pm.mediator.trigger("loadRequest",b,!1,!1),this.trigger("loadRequest")},addRequestFromJSON:function(a){request=JSON.parse(a),this.addRequest(request.url,request.method,request.headers,request.data,request.dataMode,request.preRequestScript,request.pathVariables,request.currentHelper,request.helperAttributes,null)},addRequestFromObject:function(a){this.addRequest(a.url,a.method,a.headers,a.data,a.dataMode,a.preRequestScript,a.pathVariables,a.currentHelper,a.helperAttributes,null)},addRequestWithId:function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=pm.settings.getSetting("historyCount"),o=this.toJSON(),p=o.length,q=this;if(n>0&&p>=n){var r=o[0];this.deleteRequest(r.id)}var s={id:a,url:b.toString(),method:c.toString(),headers:d.toString(),data:e,dataMode:f.toString(),tests:g,preRequestScript:h,currentHelper:j,helperAttributes:k,pathVariables:i,timestamp:(new Date).getTime(),version:2},t=this.requestExists(s);if(t>=0){var u=o[t].id;this.deleteRequest(u)}return pm.indexedDB.addRequest(s,function(a){pm.mediator.trigger("addToURLCache",a.url),pm.mediator.trigger("databaseOperationComplete");var b=new HistoryRequest(a);l===!1&&pm.syncManager.addChangeset("request","history",s,null,!0),b.set("position","top"),q.add(b),"function"==typeof m&&m()}),0},addRequest:function(a,b,c,d,e,f,g,h,i,j,k){var l=guid();this.addRequestWithId(l,a,b,c,d,e,f,g,h,i,j,!1,k)},deleteRequest:function(a){var b=this;pm.indexedDB.deleteRequest(a,function(a){b.remove(a),pm.mediator.trigger("databaseOperationComplete")})},clear:function(){var a=this;pm.indexedDB.deleteHistory(function(){a.reset([]),pm.mediator.trigger("databaseOperationComplete")})},filter:function(a){for(var b=this.toJSON(),c=b.length,d=[],e=0;c>e;e++){var f=b[e].id,g=b[e].url,h={id:f,url:g,toShow:!1};g=g.toLowerCase(),h.toShow=g.indexOf(a)>=0?!0:!1,d.push(h)}return this.trigger("filter",d),d},revert:function(){this.trigger("revertFilter")},onSyncChangeReceived:function(a,b,c){b.model||(b.model=b.type);var d=["request"];if(-1!==d.indexOf(b.model)&&"history"===a){"raw"===b.data.dataMode&&(b.data.data=b.data.rawModeData,b.data.rawModeData="");var e=pm.history.addRequestWithId(b.data.id,b.data.url,b.data.method,b.data.headers,b.data.data,b.data.dataMode,"var tests;","var prScript",b.data.pathVariables,b.data.currentHelper,b.data.helperAttributes,!0,c);-1==e?pm.mediator.trigger("syncOperationFailed","Adding history request failed"):pm.syncManager.updateSinceFromMessage(b)}}}),HistorySidebar=Backbone.View.extend({initialize:function(){var a=this.model;this.model.on("reset",this.render,this),this.model.on("add",this.addOne,this),this.model.on("remove",this.removeOne,this),this.model.on("filter",this.onFilter,this),this.model.on("revertFilter",this.onRevertFilter,this),$(".history-actions-delete").click(function(){a.clear()}),$("#history-items").on("click",".request-actions-delete",function(){var b=$(this).parent().parent().next(),c=$(this).attr("data-request-id");a.deleteRequest(c),b.addClass("hover"),b.children(".request-actions").show()}),$("#history-items").on("click",".request",function(){var b=$(this).attr("data-request-id");$(".sidebar-history-request").removeClass("sidebar-history-request-active"),$(this).parent().addClass("sidebar-history-request-active"),pm.tracker.trackEvent("history","view"),a.loadRequest(b)}),$("#history-items").on("mouseenter",".sidebar-request",function(){var a=jQuery(".request-actions",this);a.css("display","block")}),$("#history-items").on("mouseleave",".sidebar-request",function(){var a=jQuery(".request-actions",this);a.css("display","none")}),$("#history-items").on("mouseenter",".sidebar-history-request",function(){$(this).addClass("hover")}),$("#history-items").on("mouseleave",".sidebar-history-request",function(){$(this).removeClass("hover")});var b=function(){return pm.tracker.trackEvent("interaction","shortcut","clear_history"),pm.app.isModalOpen()?void 0:(pm.history.clear(),!1)};$(document).bind("keydown","alt+c",b),this.showEmptyMessage()},addOne:function(a){var b=a.toJSON(),c=_.clone(b.url),d=b.method,e=b.id,f=b.position;c.length>80&&(c=c.substring(0,80)+"..."),c=limitStringLineWidth(c,40);var b={url:c,method:d,id:e,position:f};"top"===f?$("#history-items").prepend(Handlebars.templates.item_history_sidebar_request(b)):$("#history-items").append(Handlebars.templates.item_history_sidebar_request(b)),this.hideEmptyMessage()},showEmptyMessage:function(){$("#history-items").append(Handlebars.templates.message_no_history())},hideEmptyMessage:function(){$("#history-items .empty-message").remove()},removeOne:function(a,b){{var c=a.toJSON();c.id}$("#sidebar-request-"+a.id).remove();var d=b.toJSON();0===d.length?this.showEmptyMessage():this.hideEmptyMessage()},render:function(){var a=this.model.toJSON();0===a.length?($("#history-items").html(""),this.showEmptyMessage()):(this.hideEmptyMessage(),$("#history-items").append(Handlebars.templates.history_sidebar_requests({items:a})),$("#history-items").fadeIn())},onFilter:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e="#sidebar-request-"+d.id;d.toShow?$(e).css("display","block"):$(e).css("display","none")}},onRevertFilter:function(){$("#history-items li").css("display","block")}}),CurlCapture=Backbone.Model.extend({defaults:function(){return{}},initialize:function(){pm.mediator.on("onMessageExternal",this.onMessageExternal,this)},onMessageExternal:function(a){if(a.curlImportMessage){var b=a.curlImportMessage.curlText;this.importCurl(b)}},importCurl:function(a){var b=pm.collections.guessFileFormat(a);return 0===b?void pm.mediator.trigger("failedCollectionImport","format not recognized"):void pm.collections.importData(a,b)}}),InterceptorCapture=Backbone.Model.extend({defaults:function(){return{}},initialize:function(){pm.mediator.on("onMessageExternal",this.onMessageExternal,this)},onMessageExternal:function(a,b,c){if(a.postmanMessage){var d=pm.settings.getSetting("useInterceptor");if("capturedRequest"===a.postmanMessage.type&&d===!0){var e=this.getRequestJSON(a.postmanMessage.request);pm.history.addRequestFromObject(e),c({success:!0})}}},isUrlEncodedHeaderPresent:function(a){for(var b=0;b<a.length;b++)if("content-type"===a[b].name.toLowerCase()&&a[b].value.search("urlencoded")>=0)return!0;return!1},getFormData:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({key:c,value:a[c][0]});return b},getUrlEncodedData:function(a){var b,c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=a[d].length;for(b=0;e>b;b++)c.push({key:d,value:a[d][b]})}return c},getRawData:function(a){return arrayBufferToString(ArrayBufferEncoderDecoder.decode(a))},getRequestJSON:function(a){var b={url:a.url,method:a.method,headers:packHeaders(a.requestHeaders),data:null,dataMode:"params",preRequestScript:a.preRequestScript};return isMethodWithBody(a.method)&&("formData"===a.requestBodyType?this.isUrlEncodedHeaderPresent(a.requestHeaders)?(b.dataMode="urlencoded",b.data=this.getUrlEncodedData(a.requestBody.formData)):(b.dataMode="params",b.data=this.getFormData(a.requestBody.formData)):(b.dataMode="raw",b.data=this.getRawData(a.requestBody&&a.requestBody.rawData?a.requestBody.rawData:""))),b}}),InterceptorIntro=Backbone.View.extend({initialize:function(){var a=(this.model,this);$("#modal-interceptor-intro").on("shown",function(){$("#interceptor-intro-name").focus(),pm.app.trigger("modalOpen","#modal-interceptor-intro")}),$("#modal-interceptor-intro").on("hidden",function(){pm.app.trigger("modalClose")}),$("#modal-interceptor-install").on("click",function(){a.triggerInstall()})},triggerInstall:function(){console.log("Trigger install");var a="https://chrome.google.com/webstore/detail/"+postman_interceptor_id;window.open(a)}}),InterceptorStatus=Backbone.View.extend({initialize:function(){var a=(this.model,this);$(".interceptor-status-trigger").on("click",function(){a.toggleInterceptor()}),$("#postman-interceptor-status").on("click",function(){a.toggleInterceptor()}),pm.mediator.on("enableInterceptor",this.enableInterceptor,this),this.setIcon()},enableInterceptor:function(){pm.settings.setSetting("useInterceptor",!0),this.setIcon()},setIcon:function(){var a=pm.settings.getSetting("useInterceptor");a===!1?$("#postman-interceptor-status img").attr("src","img/v2/interceptor.png"):$("#postman-interceptor-status img").attr("src","img/v2/interceptor_connected.png")},toggleInterceptor:function(){var a=!1,b=this,c={postmanMessage:{type:"detectExtension"}},d=pm.settings.getSetting("useInterceptor");d===!0?(pm.settings.setSetting("useInterceptor",!1),b.setIcon()):chrome.runtime.sendMessage(postman_interceptor_id,c,function(c){if("undefined"==typeof c)a=!1,console.log("show modal"),$("#modal-interceptor-intro").modal("show");else{a=!0;var d=pm.settings.getSetting("useInterceptor");d===!0?pm.settings.setSetting("useInterceptor",!1):pm.settings.setSetting("useInterceptor",!0),b.setIcon()}})}}),PostmanAPI=Backbone.Model.extend({defaults:function(){return{web_url:pm.webUrl}},initialize:function(){},exchangeRefreshToken:function(a){var b=pm.webUrl+"/client-oauth2-refresh";b+="?user_id="+pm.user.get("id");var c={grant_type:"refresh_token",refresh_token:pm.user.get("refresh_token")};$.ajax({type:"POST",url:b,data:c,success:function(b){if(b.hasOwnProperty("result")){var c=b.hasOwnProperty("result");c||pm.mediator.trigger("invalidRefreshToken")}else b.hasOwnProperty("access_token")&&(pm.user.setAccessToken(b),b.hasOwnProperty("syncEnabled")&&pm.user.set("syncEnabled",b.syncEnabled+""=="1"),b.hasOwnProperty("syncInvited")&&pm.user.set("syncInvited",b.syncInvited+""=="1"),a&&a())}})},logoutUser:function(a,b,c){var d=pm.webUrl+"/client-logout";d+="?user_id="+a,d+="&access_token="+b,$.ajax({type:"POST",url:d,success:function(){c&&c()}})},isTokenValid:function(){var a=pm.user.get("expires_in"),b=pm.user.get("logged_in_at"),c=(new Date).getTime();return b+a>c?!0:!1},executeAuthenticatedRequest:function(a){var b=this.isTokenValid();b?a():this.exchangeRefreshToken(function(){a()})},uploadCollection:function(a,b,c){var d=pm.webUrl+"/collections?is_public="+b;pm.user.isLoggedIn()?this.executeAuthenticatedRequest(function(){d+="&user_id="+pm.user.get("id"),d+="&access_token="+pm.user.get("access_token"),$.ajax({type:"POST",url:d,data:a,success:function(a){c&&c(a)}})}):$.ajax({type:"POST",url:d,data:a,success:function(a){c&&c(a)}})},getDirectoryCollections:function(a,b,c,d){var e=pm.webUrl+"/collections";e+="?user_id="+pm.user.get("id"),e+="&access_token="+pm.user.get("access_token"),e+="&start_id="+a,e+="&count="+b,e+="&order="+c,$.ajax({type:"GET",url:e,success:function(a){d&&d(a)}})},getTeamCollections:function(a,b,c,d,e){if(pm.user.isTeamMember()){var f=pm.webUrl+"/profile/team/collections",g=postman_syncserver_url+"/api/team/"+c;g+="?user_id="+pm.user.get("id")+"&access_token="+b,f+="?user_id="+pm.user.get("id"),$.ajax({url:g,type:"GET",success:d,error:e})}},getTeamUsers:function(a,b,c,d){if(pm.user.isTeamMember()){var e=pm.webUrl+"/organizations/"+c+" /users";e+="?user_id="+pm.user.get("id")+"&access_token="+b,$.ajax({url:e,type:"GET",success:d})}},subscribeToCollection:function(a,b,c,d){if(pm.user.isTeamMember()){var e=postman_syncserver_url+"/api/collection/"+a+"/subscribe";$.ajax({url:e,type:"PUT",data:{user_id:b,owner:c},success:d})}},addCollectionToTeam:function(a,b,c,d,e,f,g,h){if(pm.user.isTeamMember()){var i=pm.webUrl+"/profile/team/collection";$.ajax({url:i,type:"POST",data:{user_id:a,collection_id:c,collection_name:d,collection_description:e,collection_owner_name:f,collection_owner_id:g},headers:{"X-Access-Token":b},success:h})}},updateCollectionToTeam:function(a,b,c,d,e,f,g){if(pm.user.isTeamMember()){var h=pm.webUrl+"/profile/team/collection-update/"+c;$.ajax({url:h,type:"POST",data:{user_id:a,collection_id:c,collection_name:d,collection_description:e,collection_owner_id:f},headers:{"X-Access-Token":b},success:g})}},deleteCollectionFromTeam:function(a,b,c,d,e){if(pm.user.isTeamMember()){var f=pm.webUrl+"/profile/team/collection/"+c+"/"+a;$.ajax({url:f,type:"DELETE",headers:{"X-Access-Token":b},success:d,failure:e})}},downloadDirectoryCollection:function(a,b){var c=pm.webUrl+"/collections/"+a;c+="?user_id="+pm.user.get("id"),c+="&access_token="+pm.user.get("access_token"),$.get(c,function(a){b&&b(a)})},getUserPurchases:function(a){this.executeAuthenticatedRequest(function(){var b=pm.user,c=pm.webUrl+"/users/"+b.get("id")+"/purchases";c+="?user_id="+b.get("id"),c+="&access_token="+b.get("access_token"),$.ajax({type:"GET",url:c,success:function(b){a&&a(b)}})})},getUserCollections:function(a){this.executeAuthenticatedRequest(function(){var b=pm.user,c=pm.webUrl+"/users/"+b.get("id")+"/collections";c+="?user_id="+b.get("id"),c+="&access_token="+b.get("access_token"),$.ajax({type:"GET",url:c,success:function(b){a&&a(b)}})})},getUserOrganizations:function(a){a({})},deleteSharedCollection:function(a,b){this.executeAuthenticatedRequest(function(){var c=pm.user,d=pm.webUrl+"/users/"+c.get("id")+"/collections/"+a;d+="?user_id="+c.get("id"),d+="&access_token="+c.get("access_token"),$.ajax({type:"DELETE",url:d,success:function(a){b&&b(a)}})})},getCollectionFromRemoteId:function(a,b){var c=pm.webUrl+"/collections/"+a;c+="?id_type=remote&user_id="+pm.user.get("id"),c+="&access_token="+pm.user.get("access_token"),$.get(c,function(a){b&&b(a)})},postErrorToServer:function(a,b,c,d,e,f,g,h,i,j){var k=pm.webUrl+"/app_error";$.ajax({url:k,type:"POST",data:{msg:a,url:b||"Custom message",line_number:c,col_number:d,stack_trace:e,installation_id:f,user_id:g,timestamp:h+"",version:i},headers:{"X-Access-Token":j},success:function(){console.log("Error message sent to server")}})},acceptSyncEula:function(a,b,c){var d=pm.webUrl+"/sync-eula-accept";d+="?user_id="+a,d+="&access_token="+b,$.post(d,function(a){c&&c(a)})},notifyServerOfVersionChange:function(a){var b=pm.webUrl+"/user_app_version",c=pm.user,d=c.get("id");if(0!=d){var e=c.get("access_token");$.ajax({url:b,type:"PUT",data:{version:a,user_id:d},headers:{"X-Access-Token":e},success:function(){console.log("Version update sent")}})}}}),Purchase=Backbone.Model.extend({defaults:function(){return{id:"",license_key:"",timestamp:"",is_beta:!1,is_trial:!1,trial_completed:!1,trial_start_time:0,trial_elapsed_time:0,trial_end_time:0,trial_duration:postman_trial_duration}},isPurchased:function(){return""!==this.get("license_key")?!0:!1},isTrialCompleted:function(){return this.get("trial_completed")},getDaysLeft:function(){var a=this.get("trial_start_time"),b=this.get("trial_elapsed_time"),c=Math.round(14-(b-a)/864e5);return c},isTrialValid:function(){var a=this.get("trial_start_time"),b=this.get("trial_elapsed_time"),c=this.get("trial_duration"),d=this.get("trial_completed");return 0===a||d===!0?!1:c>=b-a?!0:!1}}),Purchases=Backbone.Collection.extend({model:Purchase,initialize:function(){var a=this;this.loadPurchases(),pm.mediator.on("startTrial",this.onStartTrial,this),pm.mediator.on("purchaseComplete",this.onPurchaseComplete,this),pm.mediator.on("loadedPurchasesFromServer",this.onLoadedPurchasesFromServer,this),pm.mediator.on("postmanInitialized",function(){pm.mediator.trigger("loadedPurchases",a)}),pm.mediator.on("loadedPurchases",function(){a.updateTrialElapsedTimes()})},onStartTrial:function(a){this.startTrial(a)},isTrialCompleted:function(a){var b=this.get(a);return b?b.isTrialCompleted():!1},isUpgradeAvailable:function(a){var b=this.get(a);return postman_all_purchases_available?!0:b&&(""!==b.get("license_key")||b.isTrialValid())?!0:!1},onPurchaseComplete:function(a){var b=new Purchase;b.set("id",a.id),b.set("license_key",a.license_key),b.set("timestamp",(new Date).getTime()),b.set("is_beta",a.is_beta),this.add(b,{merge:!0}),this.savePurchases()},onLoadedPurchasesFromServer:function(a){if(a.hasOwnProperty("purchases")&&a.purchases.length>0){this.reset([]);for(var b=a.purchases,c=0;c<b.length;c++)b[c].timestamp=new Date(b[c].created_at).getTime();this.add(a.purchases,{merge:!0}),this.savePurchases(),pm.mediator.trigger("loadedPurchases",this)}},loadPurchases:function(){var a=this;pm.storage.getValue("purchases",function(b){null!=b&&a.add(b),pm.mediator.trigger("loadedPurchases",this)})},savePurchases:function(){var a={purchases:this.toJSON()};pm.storage.setValue(a,function(){console.log("Purchase saved")})},startTrial:function(a){var b=new Purchase;b.set("id",a),b.set("license_key",""),b.set("timestamp",(new Date).getTime()),b.set("is_beta",!1),b.set("is_trial",!0),b.set("trial_completed",!1),b.set("trial_start_time",(new Date).getTime()),b.set("trial_elapsed_time",(new Date).getTime()),b.set("trial_end_time",0),b.set("trial_duration",postman_trial_duration),this.add(b,{merge:!0}),this.savePurchases(),pm.mediator.trigger("loadedPurchases",this),pm.mediator.trigger("onTrialStart",b)},endTrial:function(a){var b=this.get(a);b.set("trial_elapsed_time",(new Date).getTime()),b.set("trial_completed",!0),b.set("trial_end_time",(new Date).getTime()),this.add(b,{merge:!0}),this.savePurchases(),pm.mediator.trigger("onTrialEnd",b)},updateTrialElapsedTimes:function(){var a,b;for(a=0;a<this.models.length;a++)b=this.models[a],b.isPurchased()||b.isTrialCompleted()||(b.isTrialValid()?(b.set("trial_elapsed_time",(new Date).getTime()),this.add(b,{merge:!0}),this.savePurchases()):this.endTrial(b.get("id")))}}),PrscriptSnippet=Backbone.Model.extend({"default":function(){return{id:"",name:"",description:"",version:"",code:""}},initialize:function(){}}),PrscriptSnippets=Backbone.Collection.extend({model:PrscriptSnippet,comparator:function(a,b){var c,d=a.get("name"),e=b.get("name");c=d.length>e.legnth?e.length:d.length;for(var f=0;c>f;f++)if(d[f]!=e[f])return d[f]>e[f]?1:-1;return 1},initialize:function(){this.add(postmanPrscriptSnippets,{merge:!0})},addPrscriptSnippet:function(a){var b=this.get(a);pm.mediator.trigger("addPrscriptSnippetToEditor",b)}}),Request=Backbone.Model.extend({defaults:function(){return{id:"",url:"",folderId:null,pathVariables:{},urlParams:{},name:"",description:"",descriptionFormat:"markdown",bodyParams:{},headers:[],method:"GET",dataMode:"params",transformedUrl:"",isFromCollection:!1,collectionRequestId:"",methodsWithBody:["POST","PUT","PATCH","DELETE","LINK","UNLINK","LOCK","PROPFIND"],areListenersAdded:!1,startTime:0,endTime:0,xhr:null,editorMode:0,responses:[],body:null,data:null,previewHtml:"",curlHtml:"",preRequestScript:null,tests:null,testResults:null,testErrors:null,areHelpersEnabled:!0,selectedHelper:null,jsonIsCurrent:!1,xmlIsCurrent:!1,htmlIsCurrent:!1,jsonPreParse:"",xmlPreParse:"",htmlPreParse:"",jsonSearchString:"",xmlSearchString:"",htmlSearchString:"",inHtmlMode:!1,write:!0}},initialize:function(){var a=new RequestBody,b=new PreRequestScripter,c=new Response;this.set("body",a),this.set("prScripter",b),this.set("response",c),this.on("cancelRequest",this.onCancelRequest,this),this.on("startNew",this.onStartNew,this),this.on("send",this.onSend,this),c.on("finishedLoadResponse",this.onFinishedResponseLoaded,this),pm.mediator.on("addRequestURLParam",this.onAddRequestURLParam,this),pm.mediator.on("addRequestHeader",this.onAddRequestHeader,this),pm.mediator.on("loadRequest",this.loadRequest,this),pm.mediator.on("saveSampleResponse",this.saveSampleResponse,this),pm.mediator.on("loadSampleResponse",this.loadSampleResponse,this),pm.mediator.on("getRequest",this.onGetRequest,this),pm.mediator.on("updateCollectionRequest",this.checkIfCurrentRequestIsUpdated,this)},destroy:function(){},onExternalExtensionMessage:function(a){if(this.get("waitingForInterceptorResponse")===!0&&(this.set("waitingForInterceptorResponse",!1),a.postmanMessage))if("xhrResponse"===a.postmanMessage.type){var b=a.postmanMessage.response,c=a.postmanMessage.cookies,d=a.postmanMessage.guid;d===this.get("messageGuid")&&(this.get("response").set("cookies",c),b.getResponseHeader=function(a){return b.headers[a]},b.getAllResponseHeaders=function(){return b.rawHeaders},b.fromInterceptor=!0,_.bind(this.get("response").load,this)(b))}else if("xhrError"===a.postmanMessage.type){var d=a.postmanMessage.guid;if(d===this.get("messageGuid")){var e=(a.postmanMessage.error,pm.envManager.getCurrentValue(this.get("url")));this.get("response").trigger("failedRequest",e)}}},onAddRequestURLParam:function(a){var b=this.getUrlParams(),c=arrayObjectIndexOf(b,"access_token","key");c>=0&&b.splice(c,1),b.push(a),this.setUrlParamString(b),this.trigger("customURLParamUpdate")},onAddRequestHeader:function(a){this.setHeader(a.key,a.value),this.trigger("customHeaderUpdate")},onGetRequest:function(a){a(this)},onCancelRequest:function(){this.cancel()},onStartNew:function(){this.startNew()},onSend:function(a,b){var c=this;c.send(a,b)},onFinishedResponseLoaded:function(){var a=this,b=this.get("tests");null!==b?pm.mediator.trigger("runRequestTest",this,{},1,function(b,c){"result"===c?(a.set("testResults",b),a.set("testErrors",null)):"error"===c&&(a.set("testResults",null),a.set("testErrors",b)),pm.envManager.get("globals").trigger("change")}):(this.set("testResults",null),this.set("testErrors",null))},isMethodWithBody:function(a){return pm.methods.isMethodWithBody(a)},packHeaders:function(a){for(var b=a.length,c="",d=0;b>d;d++){var e=a[d],f="";e.enabled===!1&&(f="//"),e.name&&""!==e.name&&(c+=f+e.name+": "+e.value+"\n")}return c},getHeaderValue:function(a){var b=this.get("headers");a=a.toLowerCase();for(var c=0,d=b.length;d>c;c++){var e=b[c].key.toLowerCase();if(e===a)return b[c].value}return!1},saveCurrentRequestToLocalStorage:function(){pm.settings.setSetting("lastRequest",this.getAsJson())},getTotalTime:function(){var a=this.get("endTime")-this.get("startTime");return this.set("totalTime",a),a},getPackedHeaders:function(){return this.packHeaders(this.get("headers"))},unpackHeaders:function(a){if(a&&"string"==typeof a){for(var b,c,d=[],e=a.split("\n"),f=0;f<e.length;f++)if(b=e[f]){var g=b.search(":");if(-1!==g){var h=$.trim(b.substr(0,g)),i=!0;0==h.indexOf("//")&&(i=!1,h=h.substring(2));var j=$.trim(b.substr(g+1));c={name:$.trim(h),key:$.trim(h),value:$.trim(j),enabled:i,description:headerDetails[$.trim(h).toLowerCase()]},d.push(c)}}return d}return[]},decodeLink:function(a){return $(document.createElement("div")).html(a).text()},setPathVariables:function(a){this.set("pathVariables",a)},getPathVariables:function(){return this.get("pathVariables")},getUrlParams:function(){var a=getUrlVars(this.get("url"));return a},setUrlParams:function(a){this.set("urlParams",a)},setUrlParamStringWithOptBlankValRemoval:function(a,b,c,d){d||(d=this.get("url"));for(var e=[],f=0;f<a.length;f++){var g=a[f];if(g.key&&""!==g.key&&(g.key=g.key.replace(/&/g,"%26"),g.value=g.value.replace(/&/g,"%26"),0==c||""!==g.value)){var h=0===g.value.length?"":"=";e.push(g.key+h+g.value)}}var i=d.split("?")[0];e.length>0?d=i+"?"+e.join("&"):d.indexOf("?")>0&&d.indexOf("=")>0&&(d=i),b?(this.set("url",d,{silent:!0}),this.trigger("updateURLInputText")):this.set("url",d)},setUrlParamString:function(a,b,c){this.setUrlParamStringWithOptBlankValRemoval(a,b,!1,c)},encodeUrl:function(a){var b=a.indexOf("?");if(b>0){for(var c=getUrlVars(a),d=a.substring(0,b),e=c.length,f=d+"?",g=0;e>g;g++)f+=c[g].key+"="+c[g].value+"&";return f=f.substr(0,f.length-1),a}return a},getFinalRequestUrl:function(a){var b;return b=replaceURLPathVariables(a,this.get("pathVariables")),b=this.encodeUrl(b),b=pm.envManager.getCurrentValue(b),b=ensureProperUrl(b),b.trim()},prepareHeadersForProxy:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c].key.toLowerCase();_.indexOf(pm.bannedHeaders,d)>=0&&(a[c].key="Postman-"+a[c].key,a[c].name="Postman-"+a[c].name)}return a},processUrl:function(a){var b=pm.envManager.getCurrentValue(a);return b=ensureProperUrl(b)},splitUrlIntoHostAndPath:function(a){var b,c="",d=a.split("/");b=d[2];for(var e=d[0]+"/"+d[1]+"/",f=d.length,g=3;f>g;g++)c+="/"+d[g];var h=c.indexOf("?"),i=h>=0?!0:!1;if(i){d=getUrlVars(c);for(var j=d.length,k=c.substr(0,h+1),l=0;j>l;l++){var m=d[l].value,n=d[l].key,o=0===m.length?"":"=";k+=n+o+m+"&"}j>0&&(k=k.substr(0,k.length-1)),c=k}return{host:b,path:c,prefix:e}},getAsObject:function(){var a=this.get("body"),b={url:this.get("url"),pathVariables:this.get("pathVariables"),data:a.get("dataAsObjects"),headers:this.getPackedHeaders(),dataMode:a.get("dataMode"),method:this.get("method"),tests:this.get("tests"),version:2};return b},getAsJson:function(){var a=this.get("body"),b={url:this.get("url"),pathVariables:this.get("pathVariables"),data:a.get("dataAsObjects"),headers:this.getPackedHeaders(),dataMode:a.get("dataMode"),method:this.get("method"),tests:this.get("tests"),version:2};return JSON.stringify(b)},getHeadersAsKvPairs:function(){for(var a=this.get("headers"),b=a.length,c={},d=0;b>d;d++)c[a[d].key]=a[d].value;return c},saveFinalRequest:function(){},getForTester:function(){var a,b=this.get("body"),c=b.get("dataMode"),d=b.get("transformedData");"params"===c?a=b.getDataAsKvPairs(d):"urlencoded"===c?a=b.getDataAsKvPairs(d):"raw"===c?a=d:"binary"===c&&(a="");var e={url:this.get("transformedUrl"),data:a,headers:this.getHeadersAsKvPairs(),dataMode:b.get("dataMode"),method:this.get("method")};return e},getForPrscript:function(){var a,b=this.get("body"),c=b.get("dataMode"),d=b.get("data");"params"===c?a=b.getDataAsKvPairs(d):"urlencoded"===c?a=b.getDataAsKvPairs(d):"raw"===c?a=d:"binary"===c&&(a="");var e={url:this.get("url"),data:a,headers:this.getHeadersAsKvPairs(),dataMode:b.get("dataMode"),method:this.get("method")};return e},startNew:function(){var a=this.get("body"),b=this.get("response");this.set("editorMode",0);var c=this.get("xhr");c&&(c.abort(),this.unset("xhr")),this.set("url",""),this.set("urlParams",{}),this.set("bodyParams",{}),this.set("name",""),this.set("description",""),this.set("headers",[]),this.set("method","GET"),this.set("dataMode",""),this.set("isFromCollection",!1),this.set("collectionRequestId",""),this.set("responses",[]),this.set("tests",""),a.set("data",""),this.trigger("loadRequest",this),b.trigger("clearResponse")},cancel:function(){var a=this.get("response"),b=pm.settings.getSetting("useInterceptor");if(b){this.set("waitingForInterceptorResponse",!1);var c=pm.envManager.getCurrentValue(this.get("url"));a.trigger("failedRequest",c)}else{var d=this.get("xhr");null!==d&&d.abort()}a.clear()},saveSampleResponse:function(a){var b=this.getAsObject(),c=a,d=this.get("collectionRequestId");if(c.request=b,d){var e=this.get("responses");e.push(c),this.trigger("change:responses"),pm.mediator.trigger("addResponseToCollectionRequest",d,c)}},loadSampleResponseById:function(a){var b=this.get("responses"),c=arrayObjectIndexOf(b,a,"id");this.loadSampleResponse(b[c])},deleteSampleResponseByIdWithOptSync:function(a,b,c){var d=this.get("collectionRequestId");if(d){var e=this.get("responses"),f=arrayObjectIndexOf(e,a,"id");if(e.splice(f,1),this.trigger("change:responses"),pm.mediator.trigger("updateResponsesForCollectionRequestWithOptSync",d,e,!1),b){var g=pm.collections.getOwnerForCollection(this.get("collectionId"));
pm.syncManager.addChangeset("response","destroy",{id:a,owner:g},null,!0)}}"function"==typeof c&&c()},deleteSampleResponseById:function(a){this.deleteSampleResponseByIdWithOptSync(a,!0)},loadSampleResponse:function(a){var b=a.request;this.set("url",b.url),this.set("method",b.method),this.set("headers",this.unpackHeaders(b.headers)),this.set("data",b.data),this.set("dataMode",b.dataMode);var c=this.get("body");this.isMethodWithBody(b.method)&&(c.set("dataMode",b.dataMode),c.loadData(b.dataMode,b.data,!0)),this.trigger("loadRequest",this);var d=this.get("response");d.loadSampleResponse(this,a)},loadRequest:function(a,b,c){var d=this.get("body"),e=this.get("response");this.set("id",a.id),this.set("write",a.write),this.set("editorMode",0),this.set("url",a.url),"pathVariables"in a?this.set("pathVariables",a.pathVariables):this.set("pathVariables",[]),"currentHelper"in a?(this.set("currentHelper",a.currentHelper),this.set("helperAttributes",a.helperAttributes)):(this.set("currentHelper","normal"),this.set("helperAttributes",[])),this.set("isFromCollection",b),this.set("isFromSample",c),a.method||(a.method="get"),this.set("method",a.method.toUpperCase()),b?(this.set("collectionId",a.collectionId),this.set("collectionRequestId",a.id),"undefined"!=typeof a.name?this.set("name",a.name):this.set("name",""),"undefined"!=typeof a.description?this.set("description",a.description):this.set("description",""),"responses"in a?(this.set("responses",a.responses),a.responses||this.set("responses",[])):this.set("responses",[])):c||this.set("name",""),a.hasOwnProperty("tests")?(this.set("tests",a.tests),this.set("testResults",null)):(this.set("tests",null),this.set("testResults",null)),a.hasOwnProperty("preRequestScript")?this.set("preRequestScript",a.preRequestScript):this.set("preRequestScript",null),"undefined"!=typeof a.headers?this.set("headers",this.unpackHeaders(a.headers)):this.set("headers",[]),e.clear(),this.isMethodWithBody(this.get("method"))?(d.set("dataMode",a.dataMode),"version"in a&&2===a.version?d.loadData(a.dataMode,a.data,!0):d.loadData(a.dataMode,a.data,!1)):("version"in a&&2===a.version?d.loadData("raw","",!0):d.loadData("raw","",!1),d.set("dataMode","params")),e.trigger("clearResponse"),this.trigger("loadRequest",this)},loadRequestFromLink:function(a,b){this.trigger("startNew"),this.set("url",this.decodeLink(a)),this.set("method","GET"),this.set("isFromCollection",!1),pm.settings.getSetting("retainLinkHeaders")===!0&&b&&this.set("headers",b);var c=getUrlVars($("#url").val(),!1);$("#url-keyvaleditor").keyvalueeditor("reset",c)},disableHelpers:function(){this.set("areHelpersEnabled",!1)},prepareForSending:function(){this.set("startTime",(new Date).getTime())},removeHeader:function(a){var b=_.clone(this.get("headers")),c=a,d=findPosition(b,"key",c);d>=0&&(b.splice(d,1),this.set("headers",b))},setHeaderInArray:function(a,b,c){var d=b,e=findPosition(a,"key",d);return"text"===c?e>=0&&a.splice(e,1):e>=0?a[e]={key:d,type:"text",name:d,value:c}:a.push({key:d,name:d,value:c}),a},setHeader:function(a,b){var c=_.clone(this.get("headers")),d=a,e=findPosition(c,"key",d);"text"===b?e>=0&&c.splice(e,1):e>=0?c[e]={key:d,type:"text",name:d,value:b}:c.push({key:d,name:d,value:b}),this.set("headers",c)},getXhrHeaders:function(){var a=this.get("body"),b=_.clone(this.get("headers"));pm.settings.getSetting("sendNoCacheHeader")===!0&&this.setHeaderInArray(b,"Cache-Control","no-cache"),pm.settings.getSetting("sendPostmanTokenHeader")===!0&&this.setHeaderInArray(b,"Postman-Token",guid()),this.isMethodWithBody(this.get("method"))&&"urlencoded"===a.get("dataMode")&&this.setHeaderInArray(b,"Content-Type","application/x-www-form-urlencoded"),pm.settings.getSetting("usePostmanProxy")===!0&&(b=this.prepareHeadersForProxy(b));var c,d=[];for(c=0;c<b.length;c++){var e=_.clone(b[c]);_.isEmpty(e.value)||_.isEmpty(e.key)||e.enabled===!1||(e.key=pm.envManager.getCurrentValue(e.key),e.value=pm.envManager.getCurrentValue(e.value),d.push(e))}return d},getRequestBodyPreview:function(){var a=this.get("body");return a.get("dataAsPreview")},getRequestBodyForCurl:function(){var a=this.get("body");return a.getBodyForCurl()},getSerializedFormData:function(){},getHelperProperties:function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){if("request"===c)continue;b[c]=a[c]}return b},send:function(a,b,c){pm.mediator.once("onMessageExternal",this.onExternalExtensionMessage,this),this.set("action",b);var d=this,e=this.get("body"),f=e.get("dataMode"),g=this.get("response"),h=pm.settings.getSetting("xhrTimeout"),i=this.get("url"),j=this.getFinalRequestUrl(this.get("url")),k=this.splitUrlIntoHostAndPath(j);j=k.prefix+k.host+k.path,this.set("transformedUrl",j);var l=this.get("method").toUpperCase();"display"===b?pm.tracker.trackEvent("request","send",l):"download"===b&&pm.tracker.trackEvent("request","download",l),a||(a="text");var m=this.getXhrHeaders(),n=m?m.length:0;pm.tracker.trackEvent("request","headers","execute",n);var o=pm.settings.getSetting("useInterceptor"),p=this.isMethodWithBody(l);if(o){var q={url:j,xhrTimeout:h,method:l,dataMode:this.get("dataMode"),responseType:a,headers:m};if(p){var r=e.get("dataToBeSent");q.dataMode=f,q.body="params"===f?e.get("serializedData"):"binary"===f?ArrayBufferEncoderDecoder.encode(r):r}this.set("messageGuid",guid());var s=pm.settings.getSetting("interceptorRedirect"),t={postmanMessage:{guid:this.get("messageGuid"),type:"xhrRequest",request:q,autoRedirect:s}};this.prepareForSending(),this.set("waitingForInterceptorResponse",!0),chrome.runtime.sendMessage(postman_interceptor_id,t,function(){})}else if("sails"===a){var u=this.splitUrlIntoHostAndPath(j),v=io.connect(u.prefix+u.host,{"force new connection":!0}),w={};_.each(m,function(a){w[a.key]=a.value}),this.prepareForSending();var x,y=e.get("dataToBeSent");try{x=JSON.parse(y)}catch(z){x=y}v.on("connect",function(){v.request(u.path,x,function(a,b){_.bind(g.socketResponseLoad,d)(b),v.disconnect()},l.toLowerCase())})}else{var A=new XMLHttpRequest;try{A.open(l,j,!0),0!==h&&(A.timeout=h),A.onreadystatechange=function(a){_.bind(g.load,d)(a.target)},A.responseType=a;for(var B=0;B<m.length;B++)A.setRequestHeader(m[B].key,m[B].value);if(this.prepareForSending(),p){var x=e.get("dataToBeSent");x===!1?A.send():A.send(x)}else A.send();this.unset("xhr"),this.set("xhr",A)}catch(z){return void noty({type:"error",text:"Error while sending request: "+z.message,layout:"top",timeout:3e3})}}var C,D,E;pm.helpers?(C=pm.helpers.getActiveHelperType(),"normal"!==C&&(D=pm.helpers.getHelper(C).attributes,E=this.getHelperProperties(D))):(C=this.get("currentHelper"),"normal"!==C&&(E=this.get("helperAttributes"))),pm.settings.getSetting("autoSaveRequest")&&!c&&pm.history.addRequest(i,l,this.getPackedHeaders(),e.get("dataAsObjects"),e.get("dataMode"),this.get("tests"),this.get("preRequestScript"),this.get("pathVariables"),C,E);var g=this.get("response");this.saveCurrentRequestToLocalStorage(),g.trigger("sentRequest",this),this.trigger("sentRequest",this)},generateCurl:function(){var a=this.get("method").toUpperCase(),b=this.getFinalRequestUrl(this.get("url")),c=this.getXhrHeaders(),d=this.get("body").get("dataMode");this.isMethodWithBody(a)&&"params"===d&&(c=this.setHeaderInArray(c,"Content-Type",this.getDummyFormDataHeader()));var e,f=this.isMethodWithBody(a);f&&(e=this.getRequestBodyForCurl());var g;g="<pre>",g+="curl -X "+a;for(var h=c.length,i=0;h>i;i++)g+=' -H "'+c[i].key+": "+c[i].value+'"';f&&e!==!1&&(g+=e),g+=" "+b,g+="</pre>",this.set("curlHtml",g)},getDummyFormDataHeader:function(){var a="multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW";return a},generateHTTPRequest:function(){var a=this.get("method").toUpperCase(),b="HTTP/1.1",c=this.getFinalRequestUrl(this.get("url")),d=this.splitUrlIntoHostAndPath(c),e=d.path,f=d.host;e=e.replace(/&/g,"&amp;");var g=this.getXhrHeaders(),h=this.get("body").get("dataMode");this.isMethodWithBody(a)&&"params"===h&&(g=this.setHeaderInArray(g,"Content-Type",this.getDummyFormDataHeader()));var i,j=this.isMethodWithBody(a);j&&(i=this.getRequestBodyPreview());var k;k="<pre>",k+=a+" "+e+" "+b+"<br/>",k+="Host: "+f+"<br/>";for(var l=g.length,m=0;l>m;m++)k+=g[m].name+": "+g[m].value+"<br/>";j&&i!==!1&&(k+="<br/>"+i),k+="</pre>",this.set("previewHtml",k)},generatePreview:function(){this.generateCurl(),this.generateHTTPRequest()},stripScriptTag:function(a){if(!a)return a;var b=/<script\b[^>]*>([\s\S]*?)<\/script>/gm;return a=a.replace(b,"")},checkIfCurrentRequestIsUpdated:function(a){var b=this.get("collectionRequestId");b===a.id&&(this.set("name",a.name),this.set("description",a.description),this.set("tests",a.tests))}}),RequestBody=Backbone.Model.extend({defaults:function(){return{data:"",transformedData:"",dataToBeSent:"",dataMode:"params",isEditorInitialized:!1,codeMirror:!1,rawEditorType:"editor",bodyParams:{},editorMode:"html",language:""}},initialize:function(){},getFormDataForCurl:function(){for(var a,b=this.get("dataAsObjects"),c="",d=0;d<b.length;d++)a=pm.envManager.getCurrentValue(b[d].value),c+=' -F "'+b[d].key+"="+a+'"';return c},getBodyForCurl:function(){var a,b=this.get("dataMode");return"params"!==b?(a=pm.envManager.getCurrentValue(this.get("dataAsPreview"))," -d '"+a+"'"):this.getFormDataForCurl()},getBodyParamString:function(a){for(var b=a.length,c=[],d=0;b>d;d++){var e=a[d];e.key&&""!==e.key&&c.push(e.key+"="+e.value)}return c.join("&")},getDataMode:function(){return this.get("dataMode")},loadData:function(a,b,c){if(this.set("dataMode",a),this.set("asObjects",c),"raw"!==a){if(c)"params"===a?(this.set("data",_.clone(b)),this.set("dataAsObjects",_.clone(b)),this.set("dataToBeSent",_.clone(b)),this.set("serializedData",_.clone(b))):(this.set("data",_.clone(b)),this.set("dataToBeSent",_.clone(b)),this.set("dataAsObjects",_.clone(b)));else{var d=getBodyVars(b,!1);this.set("data",_.clone(d)),this.set("dataToBeSent",_.clone(d)),this.set("dataAsObjects",_.clone(d))}this.trigger("change:dataAsObjects")}else this.set("data",_.clone(b)),this.set("dataToBeSent",_.clone(b));this.trigger("dataLoaded",this),this.trigger("change:data")},getUrlEncodedBody:function(){var a,b,c,d,e,f,g="",h=[];if(a=this.get("data"),b=a.length,b>0){for(c=0;b>c;c++)d=a[c],f=d.value,pm.settings.getSetting("trimKeysAndValues")&&(f=$.trim(f)),f=pm.envManager.getCurrentValue(f),f=encodeURIComponent(f),f=f.replace(/%20/g,"+"),e=encodeURIComponent(d.key),e=e.replace(/%20/g,"+"),pm.settings.getSetting("trimKeysAndValues")&&(e=$.trim(e)),g+=e+"="+f+"&",h.push({key:e,value:f});return g=g.substr(0,g.length-1),this.set("transformedData",h),g}return!1},getFormDataBody:function(){var a,b,c,d,e,f,g=new FormData,h=[];if(a=this.get("data"),b=a?a.length:0,b>0){for(c=0;b>c;c++)d=a[c],e=d.key,pm.settings.getSetting("trimKeysAndValues")&&(e=$.trim(e)),f=d.value,f=pm.envManager.getCurrentValue(f),pm.settings.getSetting("trimKeysAndValues")&&(f=$.trim(f)),g.append(e,f),h.push({key:e,value:f});return this.set("transformedData",h),g}return!1},getDataAsKvPairs:function(a){for(var b=a.length,c={},d=0;b>d;d++)c[a[d].key]=a[d].value;return c},setDataForXHR:function(){var a=this.get("dataMode");if("params"===a){this.set("data",this.get("dataAsObjects"));var b=this.getFormDataBody();this.set("data",b),this.set("dataToBeSent",b)}else if("urlencoded"===a){var c=this.getUrlEncodedBody();this.set("data",c),this.set("dataToBeSent",c)}else if("raw"===a){var d=this.get("data");"string"!=typeof d&&(d="");var e=pm.envManager.getCurrentValue(d);this.set("transformedData",e),this.set("dataToBeSent",e)}}}),RequestMethods=Backbone.Model.extend({defaults:function(){var a=[{verb:"GET",hasBody:!1},{verb:"POST",hasBody:!0},{verb:"PUT",hasBody:!0},{verb:"PATCH",hasBody:!0},{verb:"DELETE",hasBody:!0},{verb:"COPY",hasBody:!1},{verb:"HEAD",hasBody:!1},{verb:"OPTIONS",hasBody:!1},{verb:"LINK",hasBody:!0},{verb:"UNLINK",hasBody:!0},{verb:"PURGE",hasBody:!1},{verb:"LOCK",hasBody:!0},{verb:"UNLOCK",hasBody:!1},{verb:"PROPFIND",hasBody:!0}];return{methods:a}},initialize:function(a){var b=this;pm.storage.getValue("requestMethods",function(c){if(null!==c)a&&a();else{var d={requestMethods:b.get("methods")};pm.storage.setValue(d,function(){a&&a()})}})},isMethodWithBody:function(a){var b=this.get("methods"),c=arrayObjectIndexOf(b,a,"verb");return c>=0?b[c].hasBody:!1},saveMethods:function(){var a={requestMethods:this.get("methods")};pm.storage.setValue(a,function(){callback&&callback()})},addMethod:function(a){var b=arrayObjectIndexOf(this.get("methods"),a.verb,"verb");-1===b&&(this.get("methods").push(a),this.saveMethods())},updateMethod:function(a){var b=arrayObjectIndexOf(this.get("methods"),a.verb,"verb");if(b>=0){var c=this.get("methods");c[b]=a,this.set("methods",c),this.saveMethods()}},deleteMethod:function(){var a=arrayObjectIndexOf(this.get("methods"),method.verb,"verb");if(a>=0){var b=this.get("methods");b.splice(a,1),this.set("methods",b),this.saveMethods()}}}),Response=Backbone.Model.extend({defaults:function(){return{status:"",responseCode:{},time:0,headers:[],cookies:[],mime:"",text:"",language:"",rawDataType:"",state:{size:"normal"},previewType:"parsed",searchResultScrolledTo:-1,forceRaw:!1,write:!0}},initialize:function(){},setResponseCode:function(a){var b,c;"statusText"in a?(b=a.statusText,c="",a.status in httpStatusCodes&&(c=httpStatusCodes[a.status].detail)):a.status in httpStatusCodes?(b=httpStatusCodes[a.status].name,c=httpStatusCodes[a.status].detail):(b="",c="");var d={code:a.status,name:b,detail:c};this.set("responseCode",d)},setResponseTime:function(a){var b=Date.now(),c=b-a;this.set("time",c)},setResponseData:function(a){"arraybuffer"===a.responseType?this.set("responseData",a.response):this.set("text",a.responseText)},setHeaders:function(a){var b=this.unpackResponseHeaders(a.stringHeaders||a.getAllResponseHeaders());if(pm.settings.getSetting("usePostmanProxy")===!0)for(var c=b.length,d=0;c>d;d++)if("Postman-Location"===b[d].key){b[d].key="Location",b[d].name="Location";break}b=_.sortBy(b,function(a){return a.name}),this.set("headers",b)},setCookies:function(){},getHeadersAsKvPairs:function(){for(var a=this.get("headers"),b=a.length,c={},d=0;b>d;d++)c[a[d].key]=a[d].value;return c},doesContentTypeExist:function(a){return!_.isUndefined(a)&&!_.isNull(a)},isContentTypeJavascript:function(a){return-1!==a.search(/json/i)||-1!==a.search(/javascript/i)||"javascript"===pm.settings.getSetting("languageDetection")},isContentTypeXML:function(a){return-1!==a.search(/xml/i)},isContentTypeImage:function(a){return a.search(/image/i)>=0},isContentTypePDF:function(a){return a.search(/pdf/i)>=0},saveAsSample:function(a){var b=this.toJSON();b.state={size:"normal"},b.id=guid(),b.name=a,pm.mediator.trigger("saveSampleResponse",b)},loadSampleResponse:function(a,b){this.set("status",b.status),this.set("responseCode",b.responseCode),this.set("time",b.time),this.set("headers",b.headers),this.set("cookies",b.cookies),this.set("mime",b.mime),this.set("language",b.language),this.set("text",b.text),this.set("rawDataType",b.rawDataType),this.set("state",b.state),this.set("previewType",b.previewType),this.trigger("loadResponse",a)},socketResponseLoad:function(a){var b=this,c=b.get("response");c.setResponseTime(b.get("startTime"));var d=(b.get("url"),""),e=a.headers;for(var f in e)e.hasOwnProperty(f)&&(d+=f+": "+e[f]+"\n");var g={status:a.statusCode||400,responseText:JSON.stringify(a.body),stringHeaders:d,responseType:"text"};c.setResponseCode(g),c.setResponseData(g),c.setHeaders(g);var h=getResponseHeadersAsLowercaseArray(d),i=(getCaseInsensitiveHeader("content-type",h),"html"),j=0,k=getCaseInsensitiveHeader("content-length",h);null!==k&&(j=parseInt(k));var l="html";c.set("forceRaw",!1),i="javascript",c.set("language",i),c.set("previewType",l),c.set("rawDataType",g.responseType),c.set("state",{size:"normal"}),c.trigger("loadResponse",c)},load:function(a){var b=this,c=b.get("response");if(!a){var d=pm.envManager.getCurrentValue(b.get("url"));return void c.trigger("failedRequest",d)}c.setResponseTime(b.get("startTime"));var e=(pm.settings.getSetting("previewType"),pm.settings.getSetting("languageDetection"));if(2===a.readyState){var f=getResponseHeadersAsLowercaseArray(a.getAllResponseHeaders()),g=getCaseInsensitiveHeader("content-type",f);g&&"string"==typeof g&&c.isContentTypeImage(g)&&(a.responseType="arraybuffer")}else if(4===a.readyState){if(0===a.status){var d=pm.envManager.getCurrentValue(b.get("url"));return void c.trigger("failedRequest",d)}{b.get("url")}c.setResponseCode(a),c.setResponseData(a),c.setHeaders(a);var f=getResponseHeadersAsLowercaseArray(a.getAllResponseHeaders()),g=getCaseInsensitiveHeader("content-type",f),h="html",i=0,j=getCaseInsensitiveHeader("content-length",f);null!==j&&(i=parseInt(j));var k=1e6,l=5e5,m="html";c.set("forceRaw",!1),c.doesContentTypeExist(g)?(c.isContentTypeJavascript(g)?h="javascript":c.isContentTypeXML(g)&&(h="xml"),c.isContentTypeImage(g)?m="image":c.isContentTypePDF(g)&&"arraybuffer"===a.responseType?m="pdf":c.isContentTypePDF(g)&&"text"===a.responseType?m="pdf":c.isContentTypeJavascript(g)&&i>k||c.isContentTypeXML(g)&&i>l?(m="raw",c.set("forceRaw",!0)):m="html"):h="javascript"===e?"javascript":"html",c.set("language",h),c.set("previewType",m),c.set("rawDataType",a.responseType),c.set("state",{size:"normal"}),c.trigger("loadResponse",c)}},clear:function(){this.trigger("clearResponse")},unpackResponseHeaders:function(a){if(null===a||""===a)return[];for(var b,c,d=[],e=a.split("\n"),f=0;f<e.length;f++){b=e[f];var g=b.search(":");if(-1!==g){var h=$.trim(b.substr(0,g)),i=$.trim(b.substr(g+1)),j=headerDetails[h.toLowerCase()]||"Custom header";c={name:h,key:h,value:i,description:j},"link"===h.toLowerCase()&&(c.isLink=!0),d.push(c)}}return d}}),ResponseBody=Backbone.Model.extend({}),Snippet=Backbone.Model.extend({"default":function(){return{id:"",name:"",description:"",version:"",code:""}},initialize:function(){}}),Snippets=Backbone.Collection.extend({model:Snippet,comparator:function(a,b){var c,d=a.get("name"),e=b.get("name");c=d.length>e.legnth?e.length:d.length;for(var f=0;c>f;f++)if(d[f]!=e[f])return d[f]>e[f]?1:-1;return 1},initialize:function(){this.add(postmanTestSnippets,{merge:!0})},addSnippet:function(a){var b=this.get(a);pm.mediator.trigger("addSnippetToEditor",b)}}),RequestBodyBinaryEditor=Backbone.View.extend({initialize:function(){this.model.on("startNew",this.onStartNew,this);var a=(this.model.get("body"),this.model,this);$("#body-data-binary").on("change",function(b){var c=b.target.files;_.bind(a.readFile,a)(c[0])})},onStartNew:function(){},readFile:function(a){var b=(this.model,new FileReader),c=this;b.onload=function(){return function(a){c.binaryData=a.currentTarget.result}}(a),b.readAsArrayBuffer(a)},getBinaryBody:function(){return this.binaryData}}),RequestBodyEditor=Backbone.View.extend({initialize:function(){var a=this.model,b=this,c=a.get("body");a.on("change:method",this.onChangeMethod,this),c.on("change:dataMode",this.onChangeDataMode,this),c.on("change:data",this.onChangeData,this),this.bodyFormDataEditor=new RequestBodyFormDataEditor({model:this.model}),this.bodyURLEncodedEditor=new RequestBodyURLEncodedEditor({model:this.model}),this.bodyRawEditor=new RequestBodyRawEditor({model:this.model}),this.bodyBinaryEditor=new RequestBodyBinaryEditor({model:this.model}),$("#data-mode-selector").on("click","a",function(){pm.tracker.trackEvent("request","body","data_modes");var a=$(this).attr("data-mode");b.setDataMode(a)}),$("#body-editor-mode-selector .dropdown-menu").on("click","a",function(a){var c=$(a.target).attr("data-editor-mode"),d=$(a.target).attr("data-language");b.bodyRawEditor.setEditorMode(c,d,!0)}),$("#body-editor-mode-selector-format").on("click.postman",function(a){$(event.target).attr("data-editor-mode");$(a.currentTarget).hasClass("disabled")});var d=pm.settings.getSetting("requestBodyEditorContainerType");$("#request-body-editor-container-type a").removeClass("active"),$('#request-body-editor-container-type a[data-container-type="'+d+'"]').addClass("active"),$("#request-body-editor-container-type").on("click","a",function(){var a=$(this).attr("data-container-type");pm.settings.setSetting("requestBodyEditorContainerType",a)}),$(document).bind("keydown","p",function(){return pm.tracker.trackEvent("interaction","shortcut","add_formdata_row"),pm.app.isModalOpen()?void 0:a.isMethodWithBody(a.get("method"))?($("#formdata-keyvaleditor div:first-child input:first-child").focus(),!1):void 0}),this.setDataMode("params")},onChangeData:function(){},resetBody:function(){this.bodyRawEditor.resetBody()},getRequestBodyPreview:function(){var a=this.model.get("body"),b=a.get("dataMode");if("raw"===b){var c=a.get("data");return c=htmlEncode(c),c=pm.envManager.getCurrentValue(c)}if("params"===b){var d=this.bodyFormDataEditor.getFormDataPreview(!1);return d!==!1?d:!1}if("urlencoded"===b){var e=this.bodyURLEncodedEditor.getUrlEncodedBody(!1);return e!==!1?e:!1}},getRequestBodyToBeSent:function(a){var b=this.model,c=b.get("body"),d=c.get("dataMode");if("raw"===d){var e=_.clone(this.getData(!0));return e=pm.envManager.getCurrentValue(e),c.set("transformedData",e),e}if("params"===d){var f=this.bodyFormDataEditor.getFormDataBody(a);return f!==!1?f:!1}if("urlencoded"===d){var g=this.bodyURLEncodedEditor.getUrlEncodedBody(a);return g!==!1?g:!1}if("binary"===d){var h=this.bodyBinaryEditor.getBinaryBody();return h}},getData:function(a,b){var c,d,e,f,g,h=this.model,i=this.model.get("body"),j=i.get("dataMode");if("params"===j){for(d=$("#formdata-keyvaleditor").keyvalueeditor("getValues"),e=[],g=0;g<d.length;g++)(0!=b||0!=d[g].enabled)&&(f={key:d[g].key,value:d[g].value,type:d[g].type,enabled:d[g].enabled},e.push(f));if(a===!0)return e;c=h.getBodyParamString(e)}else if("raw"===j)c=this.bodyRawEditor.getRawData();else if("urlencoded"===j){for(d=$("#urlencoded-keyvaleditor").keyvalueeditor("getValues"),e=[],g=0;g<d.length;g++)(0!=b||0!=d[g].enabled)&&(f={key:d[g].key,value:d[g].value,type:d[g].type,enabled:d[g].enabled},e.push(f));if(a===!0)return e;c=h.getBodyParamString(e)}return c},updateModel:function(a){{var b=this.model.get("body"),c=b.get("dataMode");this.getRequestBodyToBeSent(a)}b.set("data",this.getData(!0,a)),b.set("dataToBeSent",this.getRequestBodyToBeSent(a)),"urlencoded"===c&&b.set("transformedData",getBodyVars(b.get("dataToBeSent")));var d=this.getData(!0,a);b.set("dataAsObjects",d,{silent:!0});var e=this.getRequestBodyPreview();b.set("dataAsPreview",e);var f=pm.settings.getSetting("useInterceptor");if(f&&"params"===c){var g=this.bodyFormDataEditor.getSerializedFormDataBody();b.set("serializedData",g)}},openFormDataEditor:function(){var a="#formdata-keyvaleditor-container";$(a).css("display","block");for(var b="#formdata-keyvaleditor",c=$(b).keyvalueeditor("getValues"),d=[],e=0;e<c.length;e++){var f={key:c[e].key,value:c[e].value};d.push(f)}},closeFormDataEditor:function(){var a="#formdata-keyvaleditor-container";$(a).css("display","none")},openUrlEncodedEditor:function(){var a="#urlencoded-keyvaleditor-container";$(a).css("display","block");for(var b="#urlencoded-keyvaleditor",c=$(b).keyvalueeditor("getValues"),d=[],e=0;e<c.length;e++){var f={key:c[e].key,value:c[e].value};d.push(f)}},closeUrlEncodedEditor:function(){var a="#urlencoded-keyvaleditor-container";$(a).css("display","none")},onChangeMethod:function(){var a=this.model.get("method");this.model.isMethodWithBody(a)?$("#data").css("display","block"):$("#data").css("display","none")},onChangeDataMode:function(){var a=this.model.get("body"),b=a.get("dataMode");this.setDataMode(b)},setDataMode:function(a){var b=(this.model,this),c=this.model.get("body");if(c.set("dataMode",a),$("#data-mode-selector a").removeClass("active"),$('#data-mode-selector a[data-mode="'+a+'"]').addClass("active"),$("#body-editor-mode-selector").css("display","none"),"params"===a)b.openFormDataEditor(),b.closeUrlEncodedEditor(),$("#body-data-container").css("display","none"),$("#body-data-binary-container").css("display","none");else if("raw"===a){b.closeUrlEncodedEditor(),b.closeFormDataEditor(),$("#body-data-container").css("display","block");{var d=c.get("isEditorInitialized");c.get("codeMirror")}d===!1&&b.bodyRawEditor.initCodeMirrorEditor(),$("#body-editor-mode-selector").css("display","block"),$("#body-data-binary-container").css("display","none")}else"urlencoded"===a?(b.closeFormDataEditor(),b.openUrlEncodedEditor(),$("#body-data-container").css("display","none"),$("#body-data-binary-container").css("display","none")):"binary"===a&&(b.closeFormDataEditor(),b.closeUrlEncodedEditor(),$("#body-data-container").css("display","none"),$("#body-data-binary-container").css("display","block"))}}),RequestBodyFormDataEditor=Backbone.View.extend({initialize:function(){var a=this;this.model.on("startNew",this.onStartNew,this),this.files={};var b=this.model.get("body");b.on("change:dataAsObjects",this.onChangeBodyData,this);var c="#formdata-keyvaleditor",d=$(c),e={placeHolderKey:"Key",placeHolderValue:"Value",valueTypes:["text","file"],deleteButton:'<span class="icon-delete"/>',onDeleteRow:function(){},onBlurElement:function(){}};d.on("change","input[type='file']",function(b){a.onHandleFileChange(b)}),d.keyvalueeditor("init",e)},clearFilenamesFromInput:function(a){$(a).attr("data-filenames","")},appendFilenameToInput:function(a,b){a=$(a);var c=a.attr("data-filenames");""===c?c=b:c+=","+b,a.attr("data-filenames",c)},onHandleFileChange:function(a){var b=this,c=this.files;if(b.clearFilenamesFromInput(a.currentTarget),a.target.files.length>0)for(var d=0;d<a.target.files.length;d++){var e=new FileReader;e.onload=function(d){return function(e){if(pm.settings.getSetting("useInterceptor"))var f=e.currentTarget.result,g=ArrayBufferEncoderDecoder.encode(f);var h=encodeURIComponent(d.name);b.appendFilenameToInput(a.currentTarget,h);{var i=$(a.currentTarget).parent();$($(i).children(".keyvalueeditor-key")[0]).val()}c[h]=pm.settings.getSetting("useInterceptor")?g:d}}(a.target.files[d]),e.readAsArrayBuffer(a.target.files[d])}},onStartNew:function(){this.files={},$("#formdata-keyvaleditor").keyvalueeditor("reset")},onChangeBodyData:function(){var a=this.model.get("body"),b=a.get("dataMode"),c=(a.get("asObjects"),a.get("dataAsObjects"));if("params"===b&&c)try{this.files={},$("#formdata-keyvaleditor").keyvalueeditor("reset",c),a.set("dataToBeSent",this.getFormDataBody())}catch(d){}},getFormDataBody:function(a){var b,c,d,e,f,g,h,i=new FormData,j=[],k=this.model.get("body");if(b=$("#formdata-keyvaleditor").keyvalueeditor("getElements"),c=b.length,c>0){for(d=0;c>d;d++){f=b[d],g=f.keyElement.val();var l=f.valueType,m=f.valueElement,n=f.enabled;if(0!=f.enabled||0!=a)if(pm.settings.getSetting("trimKeysAndValues")&&(g=$.trim(g)),"file"===l){var o=m.get(0),p=o.files.length;if(p>0){var q=m.attr("data-filenames").split(",");for(e=0;p>e;e++)i.append(g,o.files[e],q[e])}}else h=m.val(),h=pm.envManager.getCurrentValue(h),pm.settings.getSetting("trimKeysAndValues")&&(h=$.trim(h)),i.append(g,h),j.push({key:g,value:h,enabled:n})}return k.set("transformedData",j),i}return!1},getDummyFormDataBoundary:function(){var a="----WebKitFormBoundary7MA4YWxkTrZu0gW";return a},getSerializedFormDataBody:function(a){var b,c,d,e,f,g,h=[],i=[],j=this.model.get("body");b=$("#formdata-keyvaleditor").keyvalueeditor("getElements"),c=b.length;var k=this.files;if(c>0){for(d=0;c>d;d++){e=b[d],f=e.keyElement.val();var l=e.valueType,m=e.valueElement,n=e.enabled;if(0!=e.enabled||0!=a)if(pm.settings.getSetting("trimKeysAndValues")&&(f=$.trim(f)),"file"===l){var o=$(m[0]).attr("data-filenames");if(o){for(var p=o.split(","),q={name:f,value:[],fileName:p[0],type:l},r=0;r<p.length;r++)q.value.push(k[p[r]]);h.push(q)}}else{g=m.val(),g=pm.envManager.getCurrentValue(g),pm.settings.getSetting("trimKeysAndValues")&&(g=$.trim(g));var q={name:f,value:g,type:l,enabled:n};h.push(q),i.push({key:f,value:g,enabled:n})}}return j.set("transformedData",i),h}return!1},getFormDataPreview:function(a){var b,c,d,e,f,g,h;b=$("#formdata-keyvaleditor").keyvalueeditor("getElements"),c=b.length;var i=[];if(c>0){for(d=0;c>d;d++){e=b[d],f=e.keyElement.val();var j=e.valueType,k=e.valueElement,l=e.enabled;if(0!=e.enabled||0!=a)if(pm.settings.getSetting("trimKeysAndValues")&&(f=$.trim(f)),"file"===j){var m=k.get(0),n=m.files.length;for(h=0;n>h;h++){var o={key:f,value:m.files[h],type:"file"};i.push(o)}}else{g=k.val(),g=pm.envManager.getCurrentValue(g),pm.settings.getSetting("trimKeysAndValues")&&(g=$.trim(g));var p={key:f,value:g,type:"text",enabled:l};i.push(p)}}var q=i.length,r="";for(h=0;q>h;h++){var s=i[h];r+=this.getDummyFormDataBoundary(),"text"===s.type?(r+='<br/>Content-Disposition: form-data; name="'+s.key+'"<br/><br/>',r+=s.value,r+="<br/>"):"file"===s.type&&(r+='<br/>Content-Disposition: form-data; name="'+s.key+'"; filename=',r+='"'+s.value.name+'"<br/>',r+="Content-Type: "+s.value.type,r+="<br/><br/><br/>")}return r+=this.getDummyFormDataBoundary()}return!1}}),RequestBodyRawEditor=Backbone.View.extend({initialize:function(){var a=this.model,b=this.model.get("body");b.on("change:data",this.onChangeBodyData,this),a.on("change:headers",this.onChangeHeaders,this),pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this)},onSwitchCodeMirrorTheme:function(a){var b=this.model.get("body").get("codeMirror");b&&b.setTheme("ace/theme/"+a)},onChangeHeaders:function(){var a=this.model.get("body"),b=this.model.getHeaderValue("Content-Type"),c="text",d="text";b&&(-1!==b.search(/json/i)||-1!==b.search(/javascript/i)?(c="javascript",d=b):-1!==b.search(/xml/i)?(c="xml",d=b):-1!==b.search(/html/i)?(c="xml",d=b):(c="text",d="text")),a.set("editorMode",c),a.set("language",d),this.setEditorMode(c,d,!1)},resetBody:function(){this.loadRawData("")},onChangeBodyData:function(){{var a=this.model.get("body"),b=a.get("dataMode"),c=(a.get("asObjects"),a.get("data"));a.get("language"),a.get("editorMode")}this.loadRawData("raw"===b&&"string"==typeof c?c:"")},initCodeMirrorEditor:function(){var a=(this.model,this.model.get("body")),b=a.get("editorMode");a.set("isEditorInitialized",!0);var c=pm.settings.getSetting("postmanCodeMirrorTheme"),d=document.getElementById("body");this.editor=ace.edit(d),pm.addFolderEditor=this.editor;var c="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";this.editor.setTheme("ace/theme/"+c),a.set("codeMirror",this.editor);var e=this.editor;$("#body-data-container .aceeditor-div").resizable({stop:function(){e.resize(!0)}}),b&&("javascript"===b?this.editor.getSession().setMode("ace/mode/javascript"):"text"===b?this.editor.getSession().setMode("ace/mode/plain_text"):"xml"===b&&this.editor.getSession().setMode("ace/mode/xml"),"text"===b?$("#body-editor-mode-selector-format").addClass("disabled"):$("#body-editor-mode-selector-format").removeClass("disabled")),$("#body-data-container .CodeMirror-scroll").css("height","200px")},setEditorMode:function(a,b,c){var d=this.model,e=d.get("body"),f=e.get("codeMirror"),g=e.get("isEditorInitialized"),h=$("#body-editor-mode-selector a[data-language='"+b+"']").html();$("#body-editor-mode-item-selected").html(h),g&&("javascript"===a?f.getSession().setMode("ace/mode/javascript"):"text"===a?f.getSession().setMode("ace/mode/plain_text"):"xml"===a&&f.getSession().setMode("ace/mode/xml"),"text"===a?$("#body-editor-mode-selector-format").addClass("disabled"):$("#body-editor-mode-selector-format").removeClass("disabled"),c&&d.setHeader("Content-Type",b))},autoFormatEditor:function(a){{var b=this.model,c=b.get("body"),d=(c.get("isEditorInitialized"),c.get("codeMirror"));d.getValue()}return $("#body-editor-mode-selector-format-result").empty().hide(),void console.error("Auto format not currently supported for ace editor")},loadRawData:function(a){var b=this.model.get("body"),c=b.get("isEditorInitialized"),d=b.get("codeMirror");c===!0&&(a?d.setValue(a,-1):d.setValue("",-1))},getRawData:function(){var a=this.model,b=a.get("body"),c=b.get("isEditorInitialized"),d=b.get("codeMirror");if(c){var e=d.getValue();return pm.settings.getSetting("forceWindowsLineEndings")===!0&&(e=e.replace(/\r/g,""),e=e.replace(/\n/g,"\r\n")),e
}return""}}),RequestBodyURLEncodedEditor=Backbone.View.extend({initialize:function(){this.model.on("startNew",this.onStartNew,this);var a=this.model.get("body");a.on("change:dataAsObjects",this.onChangeBodyData,this);var b="#urlencoded-keyvaleditor",c={placeHolderKey:"Key",placeHolderValue:"Value",valueTypes:["text"],deleteButton:'<span class="icon-delete"/>',onDeleteRow:function(){},onBlurElement:function(){}};$(b).keyvalueeditor("init",c)},onStartNew:function(){$("#urlencoded-keyvaleditor").keyvalueeditor("reset")},onChangeBodyData:function(){var a=this.model.get("body"),b=a.get("dataMode"),c=(a.get("asObjects"),a.get("dataAsObjects"));if("urlencoded"===b&&c)try{$("#urlencoded-keyvaleditor").keyvalueeditor("reset",c)}catch(d){console.log(d)}},getUrlEncodedBody:function(a){var b,c,d,e,f,g,h="";if(b=$("#urlencoded-keyvaleditor").keyvalueeditor("getElements"),c=b.length,c>0){for(d=0;c>d;d++)e=b[d],g=e.valueElement.val(),(0!=e.enabled||0!=a)&&(pm.settings.getSetting("trimKeysAndValues")&&(g=$.trim(g)),g=pm.envManager.getCurrentValue(g),g=encodeURIComponent(g),g=g.replace(/%20/g,"+"),f=encodeURIComponent(e.keyElement.val()),f=f.replace(/%20/g,"+"),pm.settings.getSetting("trimKeysAndValues")&&(f=$.trim(f)),h+=f+"="+g+"&");return h=h.substr(0,h.length-1)}return!1}}),RequestClipboard=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");$("#response-copy-button").on("click",function(){var a=$(window).scrollTop();if("JSON"==$("#currentPrettyMode").html()){var c=b.get("text"),d=c.substring(c.indexOf("{"));copyToClipboard(vkbeautify.json(d))}else copyToClipboard(b.get("text"));$(document).scrollTop(a)})}}),RequestEditor=Backbone.View.extend({initialize:function(){{var a=this.model,b=a.get("response"),c=this;a.get("body")}this.isTestsEditor=!1,this.isPrScriptEditor=!1,this.requestMetaViewer=new RequestMetaViewer({model:this.model}),this.requestMethodEditor=new RequestMethodEditor({model:this.model}),this.requestHeaderEditor=new RequestHeaderEditor({model:this.model}),this.requestURLPathVariablesEditor=new RequestURLPathVariablesEditor({model:this.model}),this.requestURLEditor=new RequestURLEditor({model:this.model}),this.requestBodyEditor=new RequestBodyEditor({model:this.model}),this.requestClipboard=new RequestClipboard({model:this.model}),this.requestPreviewer=new RequestPreviewer({model:this.model}),this.requestTestEditor=new RequestTestsEditor({model:this.model}),this.requestPrscriptEditor=new RequestPrscriptEditor({model:this.model}),a.on("loadRequest",this.onLoadRequest,this),a.on("sentRequest",this.onSentRequest,this),a.on("startNew",this.onStartNew,this),a.on("updateModel",this.updateModel,this),b.on("failedRequest",this.onFailedRequest,this),b.on("finishedLoadResponse",this.onFinishedLoadResponse,this),this.on("send",this.onSend,this),this.on("preview",this.onPreview,this),setTimeout(function(){$._data(document.getElementById("submit-request"),"events")&&1===$._data(document.getElementById("submit-request"),"events").click.length?console.log("Submit request event handler already registered"):$("#submit-request").click(function(){c.trigger("send","text")})},1e3),pm.mediator.on("updateRequestModel",this.onUpdateRequestModel,this),$("#url-keyvaleditor-actions-close").on("click",function(){c.requestURLPathVariablesEditor.closeEditor(),c.requestURLEditor.closeUrlEditor()}),$("#url-keyvaleditor-actions-open").on("click",function(){var a="block"===$("#url-keyvaleditor-container").css("display");a?(c.requestURLPathVariablesEditor.closeEditor(),c.requestURLEditor.closeUrlEditor()):(pm.tracker.trackEvent("request","url_params"),c.requestURLPathVariablesEditor.openEditor(),c.requestURLEditor.openAndInitUrlEditor())}),$("button#prettySearchToggle").on("click",function(){$(".CodeMirror-dialog.CodeMirror-dialog-top").remove();var a=$("#prettySearchToggle").hasClass("active"),b=$("#currentPrettyMode").html();if(a)$(".search-panel").hide(),$("#prettySearchToggle").removeClass("active"),"JSON"===b&&$(".jv-search-panel>.sidebar-search-cancel").hide(),"XML"===b&&$(".xv-search-panel>.sidebar-search-cancel").hide();else if("block"===$("#response-as-code").css("display")){var d=$(".CodeMirror").not(".ui-resizable");d.length>0,$('#response-language a[data-mode="html"]').addClass("active"),$("#prettySearchToggle").addClass("active"),"none"!==$(".search-panel").css("display")&&$(".search-panel .search-field").focus(),"JSON"===b&&($(".jv-search-panel>.sidebar-search-cancel").show(),$(".jv-search-panel").show()),"XML"===b&&($(".xv-search-panel>.sidebar-search-cancel").show(),$(".xv-search-panel").show())}$("span.jv_searchFound").contents().unwrap(),$(".jv-search-field").val(""),c.model.set("scrollToNextResult",0)}),$("#update-request-in-collection").on("click",function(){c.updateCollectionRequest()}),$("#cancel-request").on("click",function(){a.trigger("cancelRequest",a)}),$("#request-actions-reset").on("click",function(){c.requestBodyEditor.resetBody(),c.requestPrscriptEditor.clearTextarea(),$("#prscript-error").html("").hide(),$("#test-error").html("").hide(),$("#update-request-in-collection").show(),a.trigger("startNew",a)}),$("#add-to-collection").on("click",function(){c.updateModel(!0);var b=a.get("name"),d=a.get("description");pm.mediator.trigger("showAddCollectionModal",b,d)}),$("#submit-request").on("click",function(){c.trigger("send","text")}),$("#submit-request-download").on("click",function(){c.trigger("send","arraybuffer","download")}),$("#submit-sails").on("click",function(){c.trigger("send","sails")}),$("#write-tests").on("click",function(){c.toggleTestsEditor()}),$("#write-prscript").on("click",function(){c.togglePrScriptEditor()}),$("#preview-request").on("click",function(){_.bind(c.onPreviewRequestClick,c)()}),$(document).bind("keydown","alt+s",function(){return pm.tracker.trackEvent("interaction","shortcut","save_folder"),pm.app.isModalOpen()?void 0:(c.updateCollectionRequest(),!0)}),$("body").on("keydown","input",function(a){if(!pm.app.isModalOpen()&&!$("#prettySearchToggle").hasClass("active")){var b=a.target.id;if(27===a.keyCode)$(a.target).blur();else if(13===a.keyCode)if("url"!==b)c.triggerSend();else{var d="true"===$("#url").attr("data-cancel-enter");d||c.triggerSend(),$("#url").attr("data-cancel-enter","false")}return!0}}),$("body").on("keydown","div#body-data-container-editor",function(a){return(a.ctrlKey||a.metaKey)&&13===a.keyCode?(c.trigger("send","text"),a.preventDefault(),!1):!0}),$(document).bind("keydown","return",function(){return pm.tracker.trackEvent("interaction","shortcut","send_request"),pm.app.isModalOpen()?void 0:(c.triggerSend(),!1)});var d=function(){pm.tracker.trackEvent("interaction","shortcut","new_request_reset"),pm.app.isModalOpen()||a.trigger("startNew",a)};$(document).bind("keydown","alt+p",function(){pm.tracker.trackEvent("interaction","shortcut","build_preview_toggle"),_.bind(c.onPreviewRequestClick,c)()}),$(document).bind("keydown","alt+n",d),$(document).bind("keydown","ctrl+s",function(){pm.tracker.trackEvent("interaction","shortcut","save_request"),c.updateCollectionRequest()}),$(document).bind("keydown","ctrl+f",function(){pm.tracker.trackEvent("interaction","shortcut","toggle_search"),c.toggleSearchField()}),$(document).bind("keydown","meta+f",function(){pm.tracker.trackEvent("interaction","shortcut","toggle_search_meta"),c.toggleSearchField()}),$(document).bind("keydown","ctrl+g",function(){pm.tracker.trackEvent("interaction","shortcut","next_search_result"),c.scrollToNextResult()}),$(document).bind("keydown","ctrl+t",function(){pm.tracker.trackEvent("interaction","shortcut","scroll_to_top"),c.scrollToTop()}),$(document).bind("keydown","meta+g",function(){pm.tracker.trackEvent("interaction","shortcut","next_search_result_meta"),c.scrollToNextResult()}),this.loadLastSavedRequest()},triggerSend:function(){pm.app.isModalOpen()||($("#url").autocomplete("close"),this.trigger("send","text"))},toggleSearchField:function(){var a=$("#prettySearchToggle").hasClass("active"),b=$("#currentPrettyMode").html();("JSON"===b||"XML"===b)&&(a?($(".search-panel").hide(),$("#prettySearchToggle").removeClass("active"),$(".CodeMirror-dialog.CodeMirror-dialog-top").remove(),"JSON"===b&&$(".jv-search-panel>.sidebar-search-cancel").hide(),"XML"===b&&$(".xv-search-panel>.sidebar-search-cancel").hide()):"block"===$("#response-as-code").css("display")&&($("#prettySearchToggle").addClass("active"),"none"!==$(".search-panel").css("display")&&$(".search-panel .search-field").focus(),"JSON"===b&&($(".jv-search-panel>.sidebar-search-cancel").show(),$(".jv-search-panel").show()),"XML"===b&&($(".xv-search-panel>.sidebar-search-cancel").show(),$(".xv-search-panel").show())),$("span.jv_searchFound").contents().unwrap(),$(".jv-search-field").val(""),this.model.set("scrollToNextResult",0))},scrollToTop:function(){$("#main").scrollTop(0)},scrollToNextResult:function(){var a=this.model.get("scrollToNextResult");if(-1!=a&&($("span.jv_searchFound").removeClass("jv_searching"),$("span.jv_searchFound").length==a+1&&(a=-1),$("span.jv_searchFound").length>a+1)){var b=$("span.jv_searchFound")[a+1];$(b).addClass("jv_searching"),"scrollIntoViewIfNeeded"in b?b.scrollIntoViewIfNeeded():b.scrollIntoView(),this.model.set("scrollToNextResult",a+1)}},updateCollectionRequest:function(){pm.tracker.trackEvent("request","save");var a=this.model,b=this;b.updateModel(!0);var c,d,e,f=a.getAsObject(),g=pm.helpers.getActiveHelperType();"normal"!==g?(c=pm.helpers.getHelper(g).attributes,d=a.getHelperProperties(c),e=$("#request-helper-"+g+"-saveHelper").is(":checked")):e=!1,e===!1&&(g="normal",d={});var h={id:a.get("collectionRequestId"),headers:f.headers,url:f.url,preRequestScript:a.get("preRequestScript"),pathVariables:f.pathVariables,method:f.method,data:f.data,dataMode:f.dataMode,version:f.version,tests:f.tests,currentHelper:g,helperAttributes:d,time:(new Date).getTime()};pm.collections.updateCollectionRequest(h)},loadLastSavedRequest:function(){var a=pm.settings.getSetting("lastRequest");if(""!==a&&void 0!==a){var b=JSON.parse(a);this.model.set("isFromCollection",!1),pm.mediator.trigger("loadRequest",b,!1,!1)}},onStartNew:function(){this.isTestsEditor&&($("#write-tests").removeClass("active"),this.isTestsEditor=!1),this.isPrScriptEditor&&(this.isPrScriptEditor=!1,$("#write-prscript").removeClass("active")),$("#submit-request").button("reset"),$(".sidebar-collection-request").removeClass("sidebar-collection-request-active"),$(".sidebar-history-request").removeClass("sidebar-history-request-active"),$("#update-request-in-collection").css("display","none")},onUpdateRequestModel:function(a){this.updateModel(!0),a()},updateModel:function(a){this.requestPrscriptEditor.updateModel(),this.requestHeaderEditor.updateModel(),this.requestURLPathVariablesEditor.updateModel(),this.requestURLEditor.updateModel(),this.requestBodyEditor.updateModel(a),this.requestTestEditor.updateModel()},processHelpers:function(){var a=pm.helpers.getActiveHelperType();"oAuth1"===a&&pm.helpers.getHelper("oAuth1").get("auto")?(pm.helpers.getHelper("oAuth1").process(),pm.helpers.getHelper("oAuth1").generateHelper()):"basicAuth"===a?pm.helpers.getHelper("basicAuth").process():"digestAuth"===a&&pm.helpers.getHelper("digestAuth").process()},onSend:function(a,b){a||(a="text"),b||(b="display");var c=this;c.updateModel(!1),this.requestPrscriptEditor.updateModel(),this.model.get("prScripter").runPreRequestScript(this.model,{},1,function(){c.processHelpers(),c.updateModel(!1),c.model.trigger("send",a,b)})},onPreview:function(){this.updateModel(!1),pm.mediator.trigger("showPreview")},onSentRequest:function(){$("#submit-request").button("loading")},onFailedRequest:function(){$("#submit-request").button("reset")},onFinishedLoadResponse:function(){this.model.set("jsonIsCurrent",!1),this.model.set("xmlIsCurrent",!1),this.model.set("htmlIsCurrent",!1),$("#submit-request").button("reset")},onLoadRequest:function(){var a=this.model,b=(a.get("body"),a.get("method")),c=a.isMethodWithBody(b),d=a.get("url"),e=a.get("pathVariables"),f=a.get("headers"),g=(a.get("data"),a.get("name"),a.get("description"),a.get("responses"),a.get("isFromSample")),h=a.get("isFromCollection");this.showRequestBuilder();var i=h||g;$("#update-request-in-collection").css("display","none"),a.get("write")===!1?$("#response-sample-save-start").hide():(i&&$("#update-request-in-collection").show(),$("#response-sample-save-start").show()),$("#headers-keyvaleditor-actions-open .headers-count").html(f.length),$("#url").val(d);var j=getUrlVars(d,!1);$("#url-keyvaleditor").keyvalueeditor("reset",j),$("#headers-keyvaleditor").keyvalueeditor("reset",f),this.requestURLPathVariablesEditor.loadEditorParams(e),$("#request-method-selector").val(b),c?$("#data").css("display","block"):(this.requestBodyEditor.resetBody(),$("#data").css("display","none")),this.requestTestEditor.loadTests(),this.requestPrscriptEditor.loadPrscript()},showRequestBuilder:function(){$("#preview-request").html("Preview"),this.model.set("editorMode",0),$("#request-preview").css("display","none"),$("#request-builder").css("display","block")},onPreviewRequestClick:function(){var a=this.model.get("editorMode");1===a?(pm.tracker.trackEvent("request","build"),this.showRequestBuilder()):(pm.tracker.trackEvent("request","preview","http_request"),this.trigger("preview",this))},toggleTestsEditor:function(){pm.purchases.isUpgradeAvailable("collection-runner")?this.isTestsEditor===!1?(this.isTestsEditor=!0,$("#write-tests").addClass("active"),this.requestTestEditor.showTests(),this.requestTestEditor.loadTests()):($("#write-tests").removeClass("active"),this.isTestsEditor=!1,this.requestTestEditor.hideTests(),this.requestTestEditor.updateModel()):$("#modal-jetpacks-about").modal("show")},togglePrScriptEditor:function(){pm.purchases.isUpgradeAvailable("collection-runner")?this.isPrScriptEditor===!1?(this.isPrScriptEditor=!0,$("#write-prscript").addClass("active"),this.requestPrscriptEditor.showPrscript(),this.requestPrscriptEditor.loadPrscript()):($("#write-prscript").removeClass("active"),this.isPrScriptEditor=!1,this.requestPrscriptEditor.hidePrscript(),this.requestTestEditor.updateModel()):$("#modal-jetpacks-about").modal("show")}}),RequestHeaderEditor=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("change:headers",this.onChangeHeaders,this),a.on("customHeaderUpdate",this.onCustomHeaderUpdate,this),a.on("loadRequest",this.onLoadRequest,this);var c={placeHolderKey:"Header",placeHolderValue:"Value",deleteButton:'<span class="icon-delete"/>',onInit:function(){},onAddedParam:function(){$("#headers-keyvaleditor .keyvalueeditor-key").catcomplete({source:pm.headerPresets.getPresetsForAutoComplete(),delay:50,select:function(a,c){b.onHeaderAutoCompleteItemSelect(c.item)}})},onDeleteRow:function(){var c=b.getHeaderEditorParams();b.setHeadersInTextarea(c),$("#headers-keyvaleditor-actions-open .headers-count").html(c.length),a.set("headers",c,{silent:!0})},onFocusElement:function(a){b.currentFocusedRow=$(a.currentTarget).parent()[0];var c=$(a.currentTarget).attr("class").search("keyvalueeditor-value")>=0;if(c){var d=b.currentFocusedRow,e=$(d).children(".keyvalueeditor-key")[0],f=$(e).val().toLowerCase();"content-type"===f&&$(a.currentTarget).autocomplete({source:mediatypes,delay:50})}$("#headers-keyvaleditor .keyvalueeditor-key").catcomplete({source:pm.headerPresets.getPresetsForAutoComplete(),delay:50,select:function(a,c){_.bind(b.onHeaderAutoCompleteItemSelect,b)(c.item)}})},onBlurElement:function(){$("#headers-keyvaleditor .keyvalueeditor-key").catcomplete({source:pm.headerPresets.getPresetsForAutoComplete(),delay:50,select:function(a,c){b.onHeaderAutoCompleteItemSelect(c.item)}});var c=b.getHeaderEditorParams();b.setHeadersInTextarea(c),$("#headers-keyvaleditor-actions-open .headers-count").html(c.length),a.set("headers",c,{silent:!0})},onReset:function(){var b=$("#headers-keyvaleditor").keyvalueeditor("getValues");$("#headers-keyvaleditor-actions-open .headers-count").html(b.length),a.set("headers",b,{silent:!0})}};$("#headers-keyvaleditor").keyvalueeditor("init",c),$("#headers-keyvaleditor-actions-close").on("click",function(){$("#headers-keyvaleditor-actions-open").removeClass("active"),b.closeHeaderEditor()}),$("#headers-keyvaleditor-actions-open").on("click",function(){var a="block"===$("#headers-keyvaleditor-container").css("display");a?b.closeHeaderEditor():b.openHeaderEditor()}),$("textarea#headers-direct").on("change",function(){b.onDirectHeaderInput(this.value.trim())}),$(document).bind("keydown","h",function(){if(pm.tracker.trackEvent("interaction","shortcut","open_header_kveditor"),!pm.app.isModalOpen()){var a=$("#headers-keyvaleditor-container").css("display");return"block"===a?b.closeHeaderEditor():(b.openHeaderEditor(),$("#headers-keyvaleditor div:first-child input:first-child").focus()),!1}})},onCustomHeaderUpdate:function(){this.openHeaderEditor()},onChangeHeaders:function(){var a=_.cloneDeep(this.model.get("headers"));$("#headers-keyvaleditor").keyvalueeditor("reset",a)},openHeaderEditor:function(){$("#headers-keyvaleditor-actions-open").addClass("active");var a="#headers-keyvaleditor-container";$(a).css("display","block")},closeHeaderEditor:function(){$("#headers-keyvaleditor-actions-open").removeClass("active");var a="#headers-keyvaleditor-container";$(a).css("display","none")},onLoadRequest:function(){var a=this.model,b=a.get("headers");this.setHeadersInTextarea(b)},setHeaderValue:function(a,b){var c=this.model.get("headers"),d=a;a=a.toLowerCase();for(var e=!1,f=0,g=c.length;g>f;f++){var h=c[f].key.toLowerCase();h===a&&"text"!==b&&(c[f].value=b,e=!0)}var i="#headers-keyvaleditor";if(!e&&"text"!==b){var j={key:d,name:d,value:b};c.push(j)}$(i).keyvalueeditor("reset",c)},updateModel:function(){this.model.set("headers",this.getHeaderEditorParams(),{silent:!0});var a=this.model.get("headers");$("#headers-keyvaleditor-actions-open .headers-count").html(a.length)},getHeaderEditorParams:function(){for(var a=$("#headers-keyvaleditor").keyvalueeditor("getValues"),b=[],c=0;c<a.length;c++){var d={key:a[c].key,value:a[c].value,name:a[c].key,enabled:a[c].enabled};b.push(d)}return b},onHeaderAutoCompleteItemSelect:function(a){if("preset"===a.type){$(this.currentFocusedRow).remove();var b=pm.headerPresets.getHeaderPreset(a.id),c=$("#headers-keyvaleditor").keyvalueeditor("getValues"),d=_.union(c,b.get("headers"));$("#headers-keyvaleditor").keyvalueeditor("reset",d);var e=$("#headers-keyvaleditor .keyvalueeditor-last input:first-child")[0];$("#headers-keyvaleditor .keyvalueeditor-last input:first-child")[0].focus(),setTimeout(function(){e.focus()},10)}},onDirectHeaderInput:function(a){$("#headers-textarea-message").html('Enter headers in "key":"value" format.'),$("#headers-textarea-message").removeClass("wrong-header");var b=a.split("\n"),c=b.length,d=[],e=$("#headers-keyvaleditor");for(i=0;c>i;i++){var f={},g=b[i].split(":");g.length<2?($("#headers-textarea-message").html('<span id="wrong-headers-format">Incorrect format for headers in line [  '+b[i]+'  ]. Use "key":"value"</span>'),$("#headers-textarea-message").addClass("wrong-header")):(f.key=f.name=g.shift(),f.type="text",f.value=g.join(":").trim(),d.push(f))}e.keyvalueeditor("reset",d)},setHeadersInTextarea:function(a){var b=$("textarea#headers-direct"),c=a.length,d="";for(i=0;c>i;i++)d+=a[i].key+": "+a[i].value+"\n";b.val(d),$("#headers-textarea-message").html('Enter headers in "key":"value" format.'),$("#headers-textarea-message").removeClass("wrong-header")}}),RequestMetaViewer=Backbone.View.extend({initialize:function(){var a=this.model;a.on("loadRequest",this.render,this),a.on("change:name",this.render,this),a.on("change:description",this.render,this),this.requestSampleResponseList=new RequestSampleResponseList({model:this.model}),$(".request-meta-actions-togglesize").on("click",function(){var a=$(this).attr("data-action");"minimize"===a?($(this).attr("data-action","maximize"),$(".request-meta-actions-togglesize span").removeClass("icon-circle-minus"),$(".request-meta-actions-togglesize span").addClass("icon-circle-plus"),$("#request-description-container").slideUp(100)):($(".request-meta-actions-togglesize span").removeClass("icon-circle-plus"),$(".request-meta-actions-togglesize span").addClass("icon-circle-minus"),$(this).attr("data-action","minimize"),$("#request-description-container").slideDown(100))}),$("#request-description-container").on("click","a",function(){var a=$(this).attr("href");return window.open(a),!1}),$("#request-meta").on("mouseenter",function(){$(".request-meta-actions").css("display","block")}),$("#request-meta").on("mouseleave",function(){$(".request-meta-actions").css("display","none")})},show:function(){$("#request-description-container").css("display","block"),$("#request-meta").css("display","block"),$("#request-name").css("display","block"),$("#request-description").css("display","block")},hide:function(){$("#request-meta").css("display","none")},render:function(){var a=this.model,b=this.model.get("isFromCollection");if(b){this.show();var c=a.get("name"),d=_.clone(a.get("description")),e=a.get("descriptionFormat");"markdown"===e&&(d||(d=""),d=markdown.toHTML(d)),"undefined"!=typeof c?($("#request-meta").css("display","block"),$("#request-name").html(c),$("#request-name").css("display","inline-block")):($("#request-meta").css("display","none"),$("#request-name").css("display","none")),"undefined"!=typeof d?($("#request-description").html(d),$("#request-description").css("display","block")):$("#request-description").css("display","none"),$(".request-meta-actions-togglesize").attr("data-action","minimize"),$(".request-meta-actions-togglesize span").attr("class","icon-circle-minus")}else this.hide()}}),RequestMethodEditor=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("startNew",this.onStartNew,this),$("#request-method-selector").change(function(){var a=$(this).val();_.bind(b.setMethod,b)(a)})},onStartNew:function(){$("#request-method-selector").val("GET")},setMethod:function(a){var b=this.model.get("body");this.model.set("url",$("#url").val()),this.model.set("method",a),this.model.isMethodWithBody(a)||b.set("dataMode","params")}}),RequestPreviewer=Backbone.View.extend({initialize:function(){var a=(this.model,this);$(".request-preview-header-limitations").dropdown(),pm.mediator.on("showPreview",this.showPreview,this),$("#request-preview-header .request-helper-tabs li").on("click",function(){$("#request-preview-header .request-helper-tabs li").removeClass("active"),$(event.currentTarget).addClass("active");var b=$(event.currentTarget).attr("data-id");a.showPreviewType(b),pm.tracker.trackEvent("request","preview",b)}),$(".request-preview-header-limitations").click(function(){pm.tracker.trackEvent("request","preview","limitations")})},showPreview:function(){this.model.generatePreview(),this.render()},showPreviewType:function(a){$("#request-preview-content div").css("display","none"),$("#request-preview-content-"+a).css("display","block")},render:function(){this.model.set("editorMode",1);var a=this.model.get("previewHtml"),b=this.model.get("curlHtml");$("#request-preview-content-http-request").html(a),$("#request-preview-content-curl").html(b),$("#preview-request").html("Build"),$("#request-builder").css("display","none"),$("#request-preview").css("display","block")}}),RequestPrscriptEditor=Backbone.View.extend({initialize:function(){var a=(this.model,this);pm.mediator.on("refreshPrscriptLayout",this.onRefreshLayout,this),pm.mediator.on("addPrscriptSnippetToEditor",this.addPrscriptSnippetToEditor,this);var b=new PrscriptSnippets;this.snippetsList=new RequestPrscriptEditorSnippets({model:b}),this.model.on("startNew",this.onStartNew,this),pm.mediator.on("onHidePrscriptSnippets",function(){a.setLayout()}),pm.mediator.on("purchaseComplete",function(b){"collection-runner"===b.id&&a.hidePurchaseMessage()}),pm.mediator.on("loadedPurchases",function(b){b.isUpgradeAvailable("collection-runner")?a.hidePurchaseMessage():(a.showPurchaseMessage(),pm.purchases.isTrialCompleted("collection-runner")&&$("#request-helper-prscript .try-jetpacks").remove())}),pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),$("#request-prscript-editor-snippets-maximize").on("click",function(){pm.settings.setSetting("hidePrscriptSnippets",!1),pm.mediator.trigger("onShowPrscriptSnippets"),a.setLayout()}),$("#request-helper-prscript").on("click",".know-more-collection-runner",function(){tracker.sendEvent("test_runner","know_more","test_editor"),pm.mediator.trigger("startPurchaseFlow","test_runner")}),$("#request-prscript-help-button").click(function(){pm.tracker.trackEvent("request","pre_request_script","help")}),$('li[data-id="prscript"]').on("click",function(){var a=window.innerWidth;window.resizeTo(window.innerWidth-1),window.resizeTo(a)}),setTimeout(function(){a.setLayout()},1e3),this.editor||this.initializeEditor()},onSwitchCodeMirrorTheme:function(a){var b=this.editor;b&&b.setTheme("ace/theme/"+a)},clearTextarea:function(){this.editor&&this.editor.setValue("",1)},hidePurchaseMessage:function(){var a=this;$(".request-prscript-purchase-message").css("display","none"),$(".request-prscript-wrapper").css("display","block"),setTimeout(function(){a.setLayout(),a.loadPrscript()},1e3)},showPurchaseMessage:function(){$(".request-prscript-purchase-message").css("display","block"),$(".request-prscript-wrapper").css("display","none")},addPrscriptSnippetToEditor:function(a){if(this.editor){var b=this.editor.getValue();""!==b&&(b+="\n\n"),b+=a.get("code"),this.editor.setValue(b,1)}},setLayout:function(){var a,b=pm.settings.getSetting("hidePrscriptSnippets"),c=$(document).width()-385;b?(a=c,$("#request-prscript-editor-snippets-maximize").css("display","block"),$(".request-prscript-editor-snippets").css("display","none")):(a=c-200,$("#request-prscript-editor-snippets-maximize").css("display","none"),$(".request-prscript-editor-snippets").css("display","block")),$(".request-prscript-editor-codemirror").css("width",a+"px"),$(".request-prscript-editor-snippets").css("width","197px")},onRefreshLayout:function(){this.setLayout()},onStartNew:function(){this.hidePrscript()},initializeEditor:function(){var a=this;if(!this.editor){a.setLayout();{pm.settings.getSetting("postmanCodeMirrorTheme")}this.editor=ace.edit(document.getElementById("prscript-aceeditor")),this.editor.getSession().setMode("ace/mode/javascript");var b=this.editor;$(".request-prscript-editor-codemirror").resizable({stop:function(){b.resize(!0)}}),this.editor.resize(),setTimeout(function(){a.setLayout(),pm.mediator.trigger("refreshPrscriptLayout")},750)}},showPrscript:function(){$("#request-helper-prscript").css("display","block")},hidePrscript:function(){$("#request-helper-prscript").css("display","none")},loadPrscript:function(){var a=this.model,b=this;this.editor||this.initializeEditor(),setTimeout(function(){b.editor.setValue("",0),$("#prscript-error").html("").hide(),a.get("preRequestScript")?b.editor.setValue(a.get("preRequestScript"),-1):b.editor.setValue("",-1),b.editor.gotoLine(0,0,!1)},300)},updateModel:function(){this.editor&&this.model.set("preRequestScript",this.editor.getValue())}}),RequestPrscriptEditorSnippets=Backbone.View.extend({initialize:function(){var a=this.model,b=this;this.render(),pm.mediator.on("onShowPrscriptSnippets",function(){b.showPrscriptSnippets()}),$("#request-prscript-editor-snippets-minimize").on("click",function(){b.hidePrscriptSnippets()}),$("#request-prscript-editor-snippets-list").on("click",".prscript-snippet a",function(){pm.tracker.trackEvent("request","pre_request_script","snippets");var b=$(this).attr("data-id");a.addPrscriptSnippet(b)})},hidePrscriptSnippets:function(){pm.settings.setSetting("hidePrscriptSnippets",!0),$(".request-prscript-editor-snippets").css("display","none"),pm.mediator.trigger("onHidePrscriptSnippets")},showPrscriptSnippets:function(){$(".request-prscript-editor-snippets").css("display","block")},render:function(){$("#request-prscript-editor-snippets-list").html(""),$("#request-prscript-editor-snippets-list").append(Handlebars.templates.prscript_snippets_list({items:this.model.toJSON()}))}}),RequestSampleResponseList=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("loadRequest",this.render,this),a.on("change:responses",this.render,this),$("#request-samples").on("mouseenter",".sample-response-container",function(){var a=$(".sample-response-actions",this);a.css("display","block")}),$("#request-samples").on("mouseleave",".sample-response-container",function(){var a=$(".sample-response-actions",this);a.css("display","none")}),$("#request-samples").on("click",".sample-response-actions-load",function(){var a=$(this).attr("data-id");b.loadResponse(a),pm.tracker.trackEvent("response","view")}),$("#request-samples").on("click",".sample-response-actions-delete",function(){var a=$(this).attr("data-id");b.deleteResponse(a),pm.tracker.trackEvent("response","delete")}),this.render()},loadResponse:function(a){this.model.loadSampleResponseById(a)},deleteResponse:function(a){this.model.deleteSampleResponseById(a)},render:function(){var a=this.model.get("responses");$("#request-samples-list").html(""),a&&a.length>0?($("#request-samples").css("display","block"),$("#request-samples-list").append(Handlebars.templates.sample_responses({items:a}))):$("#request-samples").css("display","none")}}),RequestTestsEditor=Backbone.View.extend({initialize:function(){var a=(this.model,this);pm.mediator.on("refreshLayout",this.onRefreshLayout,this),pm.mediator.on("addSnippetToEditor",this.addSnippetToEditor,this);var b=new Snippets;this.snippetsList=new RequestTestsEditorSnippets({model:b}),this.model.on("startNew",this.onStartNew,this),pm.mediator.on("onHideSnippets",function(){a.setLayout()}),pm.mediator.on("purchaseComplete",function(b){"collection-runner"===b.id&&a.hidePurchaseMessage()}),pm.mediator.on("loadedPurchases",function(b){b.isUpgradeAvailable("collection-runner")?a.hidePurchaseMessage():(a.showPurchaseMessage(),pm.purchases.isTrialCompleted("collection-runner")&&$("#request-tests .try-jetpacks").remove())}),pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),$("#request-tests-editor-snippets-maximize").on("click",function(){pm.settings.setSetting("hideSnippets",!1),pm.mediator.trigger("onShowSnippets"),a.setLayout()}),$("#request-tests-help-button").click(function(){pm.tracker.trackEvent("request","tests","help")}),$("#request-tests").on("click",".know-more-collection-runner",function(){tracker.sendEvent("test_runner","know_more","test_editor"),pm.mediator.trigger("startPurchaseFlow","test_runner")}),setTimeout(function(){a.setLayout()},1e3),this.editor||this.initializeEditor()},onSwitchCodeMirrorTheme:function(a){var b=this.editor;b&&b.setTheme("ace/theme/"+a)},hidePurchaseMessage:function(){var a=this;$(".request-tests-purchase-message").css("display","none"),$(".request-tests-wrapper").css("display","block"),setTimeout(function(){a.setLayout(),a.loadTests()},1e3)},showPurchaseMessage:function(){$(".request-tests-purchase-message").css("display","block"),$(".request-tests-wrapper").css("display","none")},addSnippetToEditor:function(a){if(this.editor){var b=this.editor.getValue();""!==b&&(b+="\n\n"),b+=a.get("code"),this.editor.setValue(b,1)}},setLayout:function(){var a,b=pm.settings.getSetting("hideSnippets"),c=$(document).width()-385;b?(a=c,$("#request-tests-editor-snippets-maximize").css("display","block"),$(".request-tests-editor-snippets").css("display","none")):(a=c-200,$("#request-tests-editor-snippets-maximize").css("display","none"),$(".request-tests-editor-snippets").css("display","block")),$(".request-tests-editor-codemirror").css("width",a+"px"),$(".request-tests-editor-snippets").css("width","197px")},onRefreshLayout:function(){this.setLayout()},onStartNew:function(){this.hideTests()},initializeEditor:function(){var a=this;if(!this.editor){a.setLayout();{pm.settings.getSetting("postmanCodeMirrorTheme")}this.editor=ace.edit(document.getElementById("tests-aceeditor")),this.editor.getSession().setMode("ace/mode/javascript");
var b=this.editor;$(".request-tests-editor-codemirror").resizable({stop:function(){b.resize(!0)}}),this.editor.resize(),setTimeout(function(){a.setLayout(),pm.mediator.trigger("refreshLayout")},750)}},showTests:function(){$("#request-tests").css("display","block")},hideTests:function(){$("#request-tests").css("display","none")},loadTests:function(){var a=this.model,b=this;this.editor||this.initializeEditor(),setTimeout(function(){b.editor.setValue("",-1),$("#prscript-error").html("").hide(),a.get("tests")?b.editor.setValue(a.get("tests"),-1):b.editor.setValue("",-1),b.editor.gotoLine(0,0,!1)},250)},updateModel:function(){this.editor&&this.model.set("tests",this.editor.getValue())}}),RequestTestsEditorSnippets=Backbone.View.extend({initialize:function(){var a=this.model,b=this;this.render(),pm.mediator.on("onShowSnippets",function(){b.showSnippets()}),$("#request-tests-editor-snippets-minimize").on("click",function(){b.hideSnippets()}),$("#request-tests-editor-snippets-list").on("click",".test-snippet a",function(){pm.tracker.trackEvent("request","tests","snippets");var b=$(this).attr("data-id");a.addSnippet(b)})},hideSnippets:function(){pm.settings.setSetting("hideSnippets",!0),$(".request-tests-editor-snippets").css("display","none"),pm.mediator.trigger("onHideSnippets")},showSnippets:function(){$(".request-tests-editor-snippets").css("display","block")},render:function(){$("#request-tests-editor-snippets-list").html(""),$("#request-tests-editor-snippets-list").append(Handlebars.templates.test_snippets_list({items:this.model.toJSON()}))}}),RequestURLEditor=Backbone.View.extend({initialize:function(){var a,b=this.model,c=this;a="#url-keyvaleditor",this.editorId=a,b.on("change:url",this.onChangeUrl,this),b.on("updateURLInputText",this.onUpdateURLInputText,this),b.on("startNew",this.onStartNew,this),b.on("customURLParamUpdate",this.onCustomUrlParamUpdate,this);var d={placeHolderKey:"URL Parameter Key",placeHolderValue:"Value",deleteButton:'<span class="icon-delete"/>',encodeValues:!1,disableOption:!1,onDeleteRow:function(){var a=c.getUrlEditorParams();b.set("url",$("#url").val()),b.setUrlParams(a),b.setUrlParamString(a,!0)},onBlurElement:function(){var a=c.getUrlEditorParams(),d=$("#url").val();b.setUrlParams(a),b.setUrlParamString(a,!0,d)}};$(a).keyvalueeditor("init",d),$("#url").keyup(function(){var a=getUrlVars($("#url").val(),!1);$("#url-keyvaleditor").keyvalueeditor("reset",a)}),$("#url-keyvaleditor .icon-bulk-edit").on("click",function(){pm.tracker.trackEvent("request","bulk_edit","url_params")});var e=function(){return pm.tracker.trackEvent("interaction","shortcut","url_input_focus"),pm.app.isModalOpen()?void 0:($("#url").focus(),!1)};try{$("#url").autocomplete({source:pm.urlCache.getUrls(),delay:50,select:function(){return $("#url").attr("data-cancel-enter","true"),!1}})}catch(f){}$(document).bind("keydown","backspace",e)},onCustomUrlParamUpdate:function(){this.openUrlEditor()},onUpdateURLInputText:function(){var a=this.model.get("url");$("#url").val(a)},onChangeUrl:function(){var a=this.model.get("url");$("#url").val(a);var b=getUrlVars(a,!1);$("#url-keyvaleditor").keyvalueeditor("reset",b)},onStartNew:function(){$("#url").val("");var a=[];$(this.editorId).keyvalueeditor("reset",a),$("#url").focus()},updateModel:function(){this.model.set("url",$("#url").val()),this.model.setUrlParamString(this.getUrlEditorParams(),!0)},openAndInitUrlEditor:function(){var a=getUrlVars($("#url").val(),!1);$("#url-keyvaleditor").keyvalueeditor("reset",a),this.openUrlEditor()},openUrlEditor:function(){$("#url-keyvaleditor-actions-open").addClass("active");var a="#url-keyvaleditor-container";$(a).css("display","block")},closeUrlEditor:function(){$("#url-keyvaleditor-actions-open").removeClass("active");var a="#url-keyvaleditor-container";$(a).css("display","none")},getUrlEditorParams:function(){for(var a="#url-keyvaleditor",b=$(a).keyvalueeditor("getValues"),c=[],d=0;d<b.length;d++){var e={key:b[d].key,value:b[d].value};c.push(e)}return c}}),RequestURLPathVariablesEditor=Backbone.View.extend({initialize:function(){var a=this.model,b=this,c="#pathvariables-keyvaleditor";this.editorId=c,a.on("change:url",this.onChangeUrl,this),a.on("startNew",this.onStartNew,this);var d={placeHolderKey:"Path variable key",placeHolderValue:"Value",deleteButton:'<span class="icon-delete"/>',editableKeys:!1,onDeleteRow:function(){b.setUrl()},onBlurElement:function(){b.setUrl()}};$("#url").keyup(function(){var a=$(this).val();b.setEditorParams(a)}),$(c).keyvalueeditor("init",d)},setUrl:function(){var a=this.getEditorParams();this.model.set("url",$("#url").val()),this.model.setPathVariables(a)},loadEditorParams:function(a){var b,c=[];for(var d in a)a.hasOwnProperty(d)&&(b={key:d,value:a[d]},c.push(b));$(this.editorId).keyvalueeditor("reset",c)},setEditorParams:function(a){for(var b,c,d=getURLPathVariables(a),e=$(this.editorId).keyvalueeditor("getValues"),f=[],g=0;g<e.length;g++)b=e[g],keyIndex=_.indexOf(d,b.key),keyIndex>=0&&(f.push(b),d.splice(keyIndex,1));for(g=0;g<d.length;g++)c={key:d[g],value:""},f.push(c);$(this.editorId).keyvalueeditor("reset",f)},onChangeUrl:function(){this.setEditorParams($("#url").val())},startNew:function(){var a=[];$(this.editorId).keyvalueeditor("reset",a)},updateModel:function(){this.setUrl()},getEditorParams:function(){for(var a=$(this.editorId).keyvalueeditor("getValues"),b={},c=0;c<a.length;c++)b[a[c].key]=a[c].value;return b},openEditor:function(){var a="#pathvariables-keyvaleditor-container";$(a).css("display","block");var b=$("#url").val();this.setEditorParams(b)},closeEditor:function(){var a="#pathvariables-keyvaleditor-container";$(a).css("display","none"),this.updateModel()}}),ResponseBodyIFrameViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");b.on("finishedLoadResponse",this.render,this)},render:function(){var a=this.model,b=a.get("response"),c=b.get("previewType"),d=b.get("text");if("html"===c){$("#response-as-preview").html("");var e=a.stripScriptTag(d);pm.filesystem.renderResponsePreview("response.html",e,"html",function(a){$("#response-as-preview").html("<iframe scrolling='yes' id='previewIframe'></iframe>"),$("#response-as-preview iframe").attr("src",a),$("#previewIframe").removeAttr("sandbox"),$("#previewIframe").load(function(){var a=document.getElementById("previewIframe");try{a.height=Math.max(document.getElementById("previewIframe").contentWindow.document.body.scrollHeight,document.getElementById("previewIframe").contentWindow.outerHeight)}catch(c){a.height=600}a.contentWindow.document.body.style["-webkit-user-select"]="initial",a.contentWindow.document.body.style["word-break"]="break-word",a.contentWindow.document.body.style["-webkit-user-select"]="text",a.contentWindow.document.body.style.color="dark"===pm.settings.getSetting("postmanTheme")&&"html"!==b.get("language")?"rgb(202,202,202)":"rgb(20,20,20)",$("#previewIframe").attr("sandbox","")})})}}}),ResponseBodyImageViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");b.on("finishedLoadResponse",this.render,this)},renderAsImage:function(a){for(var b=new Uint8Array(a),c=b.length,d=new Array(c);c--;)d[c]=String.fromCharCode(b[c]);var e=d.join(""),f=window.btoa(e);this.createBase64Image(f)},createBase64Image:function(a){$("#response-as-image").html("<img id='response-as-image-inline'/>"),document.getElementById("response-as-image-inline").src="data:image/png;base64,"+a},render:function(){var a=this.model,b=a.get("response"),c=b.get("previewType"),d=b.get("rawDataType"),e=pm.settings.getSetting("useInterceptor");if("image"===c&&"text"===d)$("#response-as-image").css("display","block"),e||a.trigger("send","arraybuffer");else if("image"===c&&"arraybuffer"===d)if(e){var f=b.get("responseData");this.createBase64Image(f)}else{var g=b.get("responseData");this.renderAsImage(g)}}}),ResponseBodyPDFViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");b.on("finishedLoadResponse",this.render,this)},render:function(){var a=this.model,b=a.get("response"),c=b.get("previewType"),d=b.get("rawDataType");if("pdf"===c&&"arraybuffer"===d){var e=b.get("responseData");$("#response-as-preview").html(""),$("#response-as-preview").css("display","block");var f="response.pdf",g="pdf";pm.filesystem.saveAndOpenFile(f,e,g,function(){noty({type:"success",text:"Saved PDF to disk",layout:"topCenter",timeout:750})})}else"pdf"===c&&"text"===d&&a.trigger("send","arraybuffer")}}),ResponseBodyPrettyViewer=Backbone.View.extend({defineCodeMirrorLinksMode:function(){this.mode},toggleLineWrapping:function(){var a=$("span#currentPrettyMode").html(),b=$("#response-body-line-wrapping").hasClass("active");if("HTML"===a||"Text"===a){var c=this.codeMirror,d=c.getSession().getUseWrapMode();d===!0?($("#response-body-line-wrapping").removeClass("active"),d=!1,c.getSession().setUseWrapMode(!1)):($("#response-body-line-wrapping").addClass("active"),d=!0,c.getSession().setUseWrapMode(!0)),pm.settings.setSetting("lineWrapping",d)}else b?($("#response-as-code").css("word-wrap","normal"),$(".xv-wrap").removeClass("xv-wrap")):($("#response-as-code").css("word-wrap","break-word"),$(".xv-attr,.xv-text,.xv-tag-name").addClass("xv-wrap"));$("#response-body-line-wrapping").toggleClass("active")},initialize:function(){this.codeMirror=null,this.mode="text",this.defineCodeMirrorLinksMode(),pm.cmp=this.codeMirror,pm.mediator.on("switchCodeMirrorTheme",this.onSwitchCodeMirrorTheme,this),pm.mediator.on("focusPrettyViewer",this.onFocusPrettyViewer,this)},onSwitchCodeMirrorTheme:function(a){var b=this.codeMirror;b&&b.setTheme("ace/theme/"+a)},onFocusPrettyViewer:function(){},showJSONPretty:function(a){if($("#prettySearchToggle").addClass("active"),$("#prettySearchToggle").click(),$("span#currentPrettyMode").html("JSON"),$("div#response-as-code>div.CodeMirror").hide(),$("div.treeView#jsonTree").show(),this.model.set("jsonPreParse",a),!this.model.get("jsonIsCurrent"))if(pm.isTesting){var b=jv_processJSON(a);this.renderJSON(b)}else this.jv_processJSON_worker(a);this.model.set("jsonIsCurrent",!0)},jv_processJSON_worker:function(a){var b=new Worker("jsonWorker.js"),c=this;$(".jv-source-pane-inner").html("Loading..."),b.onmessage=function(a){"error"===a.data?$(".jv-source-pane-inner").html("Malformed JSON"):c.renderJSON(a.data)},b.postMessage(a)},renderJSON:function(a){$(".jv-source-pane-inner").html(a),setTimeout(function(){for(var a=$(".collapsible.jv"),b=0;b<a.length;b++)jv_addCollapser(a[b].parentNode);$("li.jv:not(:last-child)").append(",")},10)},showXMLPretty:function(a){$("#prettySearchToggle").addClass("active"),$("#prettySearchToggle").click(),$("span#currentPrettyMode").html("XML"),$("div#response-as-code>div.CodeMirror").hide(),$("div.treeView#xmlTree").show(),this.model.get("xmlIsCurrent")||xv_controller.process(a),this.model.set("xmlIsCurrent",!0)},showHTMLPretty:function(a){$("#prettySearchToggle").addClass("active"),$("#prettySearchToggle").click(),$("span#currentPrettyMode").html("HTML"),$("div#response-as-code>div.CodeMirror").hide(),$("div.treeView#htmlView").show(),this.model.set("htmlPreParse",a),this.model.get("htmlIsCurrent")||$("code.html-source-pane-inner").html("Loading..."),this.model.set("htmlIsCurrent",!0)},showHTMLPretty_new:function(a,b,c,d,e,f){var g;$("span#currentPrettyMode").html("HTML"),$("#htmlView").show(),this.model.set("htmlPreParse",c),this.model.set("inHtmlMode",!0),this.model.get("htmlIsCurrent")||"parsed"!==b||(c=vkbeautify.xml(c),g="xml",$('#response-language a[data-mode="html"]').addClass("active"),this.model.set("htmlIsCurrent",!0)),pm.settings.getSetting("lineWrapping")===!0?($("#response-body-line-wrapping").addClass("active"),f=!0):($("#response-body-line-wrapping").removeClass("active"),f=!1),this.mode=g,this.defineCodeMirrorLinksMode();var h=this.codeMirror,i=pm.settings.getSetting("postmanCodeMirrorTheme");if(h)h.setReadOnly(!0),h.setValue(c,-1),h.gotoLine(0,0,!1),$(window).scrollTop(0);else{$("#response .CodeMirror").remove(),h=ace.edit(d),h.setReadOnly(!0),h.setValue(c,-1);var i="light"===pm.settings.getSetting("postmanTheme")?"clouds":"monokai";h.setTheme("ace/theme/"+i),h.getSession().on("tokenizerUpdate",function(){}),this.codeMirror=h}"html"===a?(h.getSession().setMode("ace/mode/html"),$("span#currentPrettyMode").html("HTML"),setTimeout(function(){var a=$(".ace_entity.ace_other.ace_attribute-name");a.each(function(){var a=$(this);if("href"===a.html().toLowerCase()){var b=a.next();if(b){var c=b.next();c.addClass("ace-editor-link")}}})},1e3)):(h.getSession().setMode("ace/mode/plain_text"),$("span#currentPrettyMode").html("Text"))}}),ResponseBodyRawViewer=Backbone.View.extend({initialize:function(){}}),ResponseBodyViewer=Backbone.View.extend({initialize:function(){var a=this,b=this.model,c=b.get("response");c.on("finishedLoadResponse",this.load,this),this.responseBodyPrettyViewer=new ResponseBodyPrettyViewer({model:this.model}),this.responseBodyRawViewer=new ResponseBodyRawViewer({model:this.model}),this.responseBodyIFrameViewer=new ResponseBodyIFrameViewer({model:this.model}),this.responseBodyImageViewer=new ResponseBodyImageViewer({model:this.model}),this.responseBodyPDFViewer=new ResponseBodyPDFViewer({model:this.model}),$(document).bind("keydown","ctrl+f",function(){pm.tracker.trackEvent("interaction","shortcut","search_response"),a.searchResponse()}),$(document).bind("keydown","meta+f",function(){pm.tracker.trackEvent("interaction","shortcut","search_response_meta"),a.searchResponse()}),$(".jv-search-field").keyup(function(b){if(27==b.keyCode&&($("span.jv_searchFound").contents().unwrap(),a.model.set("jsonSearchString",""),$(".search-panel").hide(),$("#prettySearchToggle").removeClass("active"),$(this).val("")),13==b.keyCode){b.preventDefault(),jv_processJSON(a.model.get("jsonPreParse")),$("span.jv_searchFound").contents().unwrap(),a.model.set("jsonSearchString",this.value);var c=a.model.get("jsonSearchString");if(""==c)return void $(".jv-search-panel>.sidebar-search-cancel").hide();var d="+?^[]()$*|.",e="";for(i=0;i<c.length;i++)e+=-1==d.indexOf(c[i])?c[i]:"\\"+c[i];var f=e;if($(".jv-search-panel>.sidebar-search-cancel").show(),$("span.jv.string , span.jv.num , span.jv.prop , span.jv.bool , a.jv.link").each(function(){if(-1!=this.innerHTML.toLowerCase().indexOf(c.toLowerCase())){var a=this.innerHTML,b=new RegExp("("+f+")","gi");a=a.replace(b,'<span class="jv_searchFound">$1</span>'),this.innerHTML=a}}),$("span.jv_searchFound").length>0){var g=$("span.jv_searchFound")[0];"scrollIntoViewIfNeeded"in g?g.scrollIntoViewIfNeeded():g.scrollIntoView(),a.model.set("scrollToNextResult",0)}$(".search-panel").hide(),$("#prettySearchToggle").removeClass("active"),$(this).val("")}}),$(".html-search-field").keyup(function(b){b.stopPropagation(),$("span.jv_searchFound").contents().unwrap(),a.model.set("htmlSearchString",this.value);var c=a.model.get("htmlSearchString");if(""==c)return void $(".html-search-panel>.sidebar-search-cancel").hide();var d="+?^[]()$*|.",e="";for(i=0;i<c.length;i++)e+=-1==d.indexOf(c[i])?c[i]:"\\"+c[i];var f=e;if($(".html-search-panel>.sidebar-search-cancel").show(),$("span.rainbow.support.tag-name , span.rainbow.comment.html , span.rainbow.support.attribute , span.rainbow.string.value , span.rainbow.plainText , span.rainbow.entity.tag.script , span.rainbow.entity.tag.style").each(function(){if($(this).hasClass("plainText")&&0!=$(this).children().length)return!0;if(-1!=this.innerHTML.toLowerCase().indexOf(c.toLowerCase())){var a=this.innerHTML,b=new RegExp("("+f+")","gi");a=a.replace(b,'<span class="jv_searchFound">$1</span>'),this.innerHTML=a}}),$("span.jv_searchFound").length>0){var g=$("span.jv_searchFound")[0];"scrollIntoViewIfNeeded"in g?g.scrollIntoViewIfNeeded():g.scrollIntoView(),a.model.set("scrollToNextResult",0)}}),$(".sidebar-search-cancel").click(function(){var b=$(this);b.parent().children(".search-field").val(""),b.hide(),$("span.jv_searchFound").contents().unwrap(),$(".search-panel").hide(),$("#prettySearchToggle").removeClass("active"),a.model.set("jsonSearchString",""),a.model.set("xmlSearchString",""),a.model.set("htmlSearchString","")})},searchResponse:function(){},downloadBody:function(a){var b,c=a.get("previewType"),d=a.get("rawDataType"),e=c,f="response."+c,g=pm.settings.getSetting("useInterceptor");"arraybuffer"===d?(b=a.get("responseData"),g&&(b=ArrayBufferEncoderDecoder.decode(b))):b=text,pm.filesystem.saveAndOpenFile(f,b,e,function(){noty({type:"success",text:"Saved response to disk",layout:"topCenter",timeout:750})})},load:function(){var a=this.model,b=a.get("response"),c=b.get("previewType"),d=b.get("rawDataType"),e=pm.settings.getSetting("previewType"),f=b.get("language"),g=b.get("text"),h=pm.settings.getSetting("responsePreviewDataSection"),i=a.get("action"),j=b.get("forceRaw");j===!0&&(e="raw",noty({type:"warning",text:"Response too big for Pretty mode. Click 'Pretty' to force. Doing so may result in unexpected behavior",layout:"topCenter",timeout:750})),"download"===i?($("#response-data-container").css("display","none"),this.downloadBody(b)):("HEAD"!==a.get("method")&&$("#response-data-container").css("display","block"),"image"===c?($("#response-as-code").css("display","none"),$("#response-as-text").css("display","none"),$("#response-as-image").css("display","block"),$("#response-formatting").css("display","none"),$("#response-actions").css("display","none"),$("#response-language").css("display","none"),$("#response-as-preview").css("display","none"),$("#response-copy-container").css("display","none"),$("#response-pretty-modifiers").css("display","none")):"pdf"===c&&"arraybuffer"===d?($("#response-as-code").css("display","none"),$("#response-as-text").css("display","none"),$("#response-as-image").css("display","none"),$("#response-formatting").css("display","none"),$("#response-actions").css("display","none"),$("#response-language").css("display","none"),$("#response-copy-container").css("display","none"),$("#response-pretty-modifiers").css("display","none")):"pdf"===c&&"text"===d||this.displayTextResponse(f,g,e,!0),"body"!==h&&$("#response-data-container").css("display","none"))},displayTextResponse:function(a,b,c){var d,e,f=$("#html-aceeditor")[0],g=($(document).width()-$("#sidebar").width()-60,d);$("#response-copy-container").css("display","block"),$("#response-as-code").css("display","block"),$("#response-as-text").css("display","none"),$("#response-as-image").css("display","none"),$("#response-formatting").css("display","block"),$("#response-actions").css("display","block"),$("#response-formatting a").removeClass("active"),$('#response-formatting a[data-type="'+c+'"]').addClass("active"),$("#code-data").css("display","none"),$("#code-data").attr("data-mime",a),$("#response-language").css("display","block"),$("span#currentPrettyMode").html("Default"),this.model.set("inHtmlMode",!1),$("div.treeView").hide(),"javascript"===a&&"parsed"===c?this.responseBodyPrettyViewer.showJSONPretty(b):"xml"===a&&"parsed"===c?this.responseBodyPrettyViewer.showXMLPretty(b):($("div#response-as-code>div.CodeMirror").show(),$(".search-panel").hide(),$("#prettySearchToggle").removeClass("active"),$(".CodeMirror-dialog.CodeMirror-dialog-top").remove(),"parsed"===c&&this.responseBodyPrettyViewer.showHTMLPretty_new(a,c,b,f,g,e)),"parsed"===c?($("#response-as-code").css("display","block"),$("#response-as-text").css("display","none"),$("#response-as-preview").css("display","none"),$("#response-pretty-modifiers").css("display","block")):"raw"===c?($("#code-data-raw").val(b),$("#code-data-raw").css("width","95%"),$("#code-data-raw").css("height","600px"),$("#response-as-code").css("display","none"),$("#response-as-text").css("display","block"),$("#response-pretty-modifiers").css("display","none")):"preview"===c&&($("#response-as-code").css("display","none"),$("#response-as-text").css("display","none"),$("#response-as-preview").css("display","block"),$("#response-pretty-modifiers").css("display","none"));var h=$(document).height();$(".xv-source-pane-inner").css("height",h-331+"px"),$(".xv-outline").css("height",h-301+"px"),$("#response-as-code>.CodeMirror").css("height",h-295+"px")},loadImage:function(){var a=new RAL.RemoteImage({priority:0,src:imgLink,headers:this.model.getXhrHeaders()});a.addEventListener("loaded",function(){}),$("#response-as-image").html("");var b=document.querySelector("#response-as-image");b.appendChild(a.element),RAL.Queue.add(a),RAL.Queue.setMaxConnections(4),RAL.Queue.start()},changePreviewType:function(a){var b=this.model,c=b.get("response"),d=c.get("previewType"),e=c.get("text");if(d!==a){var f=this.model.get("response").get("language");if(d=a,c.set("previewType",a),pm.settings.setSetting("previewType",a),$("#response-formatting a").removeClass("active"),$('#response-formatting a[data-type="'+d+'"]').addClass("active"),"raw"===d){$("#response-as-text").css("display","block"),$("#response-as-code").css("display","none"),$("#response-as-preview").css("display","none"),$("#code-data-raw").val(e);{$(document).width()-$("#sidebar").width()-60}$("#code-data-raw").css("width","95%"),$("#code-data-raw").css("height","600px"),$("#response-pretty-modifiers").css("display","none")}else"parsed"===d?("javascript"!==f||this.model.get("jsonIsCurrent")?"xml"!==f||this.model.get("xmlIsCurrent")?"html"!==f||this.model.get("htmlIsCurrent")||this.responseBodyPrettyViewer.showHTMLPretty(e):this.responseBodyPrettyViewer.showXMLPretty(e):this.responseBodyPrettyViewer.showJSONPretty(e),$("#response-as-text").css("display","none"),$("#response-as-code").css("display","block"),$("#response-as-preview").css("display","none"),$("#code-data").css("display","none"),$("#response-pretty-modifiers").css("display","block")):"preview"===d&&($("#response-as-text").css("display","none"),$("#response-as-code").css("display","none"),$("#code-data").css("display","none"),$("#response-as-preview").css("display","block"),$("#response-pretty-modifiers").css("display","none"))}},toggleBodySize:function(){var a=this.model,b=a.get("response"),c=b.get("state");return"none"===$("#response").css("display")?!1:($('a[rel="tooltip"]').tooltip("hide"),"normal"===c.size?(c.size="maximized",$("#response-body-toggle span").removeClass("icon-size-toggle-maximize"),$("#response-body-toggle span").addClass("icon-size-toggle-minimize"),c.width=$("#response-data").width(),c.height=$("#response-data").height(),c.display=$("#response-data").css("display"),c.overflow=$("#response-data").css("overflow"),c.position=$("#response-data").css("position"),$("#response-data").css("position","absolute"),$("#response-data").css("overflow","scroll"),$("#response-data").css("left",0),$("#response-data").css("top","-15px"),$("#response-data").css("width",$(document).width()-20),$("#response-data").css("height",$(document).height()),$("#response-data").css("z-index",100),$("#response-data").css("padding","10px")):(c.size="normal",$("#response-body-toggle span").removeClass("icon-size-toggle-minimize"),$("#response-body-toggle span").addClass("icon-size-toggle-maximize"),$("#response-data").css("position",c.position),$("#response-data").css("overflow",c.overflow),$("#response-data").css("left",0),$("#response-data").css("top",0),$("#response-data").css("width",c.width),$("#response-data").css("height",c.height),$("#response-data").css("z-index",10),$("#response-data").css("padding","0px")),$("#response-body-toggle").focus(),void b.set("state",c))},toggleLineWrapping:function(){this.responseBodyPrettyViewer.toggleLineWrapping()},setMode:function(a){var b=this.model,c=b.get("response"),d=(c.get("body"),c.get("text")),e=pm.settings.getSetting("previewType");this.displayTextResponse(a,d,e,!0)}}),ResponseCookieViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");b.on("finishedLoadResponse",this.load,this)},load:function(){var a=this.model,b=a.get("response"),c=b.get("cookies");if(c){var d=0;if(d=c?c.length:0,0===d)$("#response-tabs-cookies").html("Cookies"),$("#response-tabs-cookies").css("display","block"),$("#response-cookies").css("display","none"),$("#response-cookies-not-found-message").css("display","block");else{$("#response-tabs-cookies").html("Cookies ("+d+")"),$("#response-tabs-cookies").css("display","block"),$("#response-cookies").css("display","table"),$("#response-cookies-not-found-message").css("display","none"),c=_.sortBy(c,function(a){return a.name});for(var e=0;d>e;e++){var f=c[e];if(f.name=limitStringLineWidth(f.name,20),f.value=limitStringLineWidth(f.value,20),f.path=limitStringLineWidth(f.path,20),"expirationDate"in f){var g=new Date(1e3*f.expirationDate);c[e].expires=g.toLocaleString()}}$("#response-cookies-items").html(Handlebars.templates.response_cookies({items:c}))}}}}),ResponseHeaderViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");b.on("finishedLoadResponse",this.load,this)},load:function(){var a=this.model,b=a.get("response"),c=b.get("headers");$('.response-tabs li[data-section="headers"]').html("Headers ("+c.length+")"),$("#response-headers").html(""),$("#response-headers").append(Handlebars.templates.response_headers({items:c})),$(".response-header-name").popover({trigger:"hover"})}}),ResponseMetaViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response");b.on("finishedLoadResponse",this.render,this)},render:function(){var a=this.model,b=a.get("response"),c=b.get("time");$("#response-status").css("display","block"),$("#response-status").html(Handlebars.templates.item_response_code(b.get("responseCode"))),$(".response-code").popover({trigger:"hover"}),$("#response-time .data").html(c+" ms")}}),ResponseSaver=Backbone.View.extend({initialize:function(){var a=(this.model,this);$("#response-sample-save-start").on("click",function(){a.showSaveForm()}),$("#response-sample-save").on("click",function(){a.saveResponse(),pm.tracker.trackEvent("response","add")}),$("#response-sample-cancel").on("click",function(){a.cancelSaveResponse()})},showSaveForm:function(){$("#response-sample-save-start").css("display","none"),$("#response-sample-save-form").css("display","block")},hideSaveForm:function(){$("#response-sample-save-start").css("display","block"),$("#response-sample-save-form").css("display","none")},saveResponse:function(){var a=this;pm.mediator.trigger("updateRequestModel",function(){a.hideSaveForm();var b=$("#response-sample-name").val(),c=a.model.get("response");$("#response-sample-name").val(""),c.saveAsSample(b)})},cancelSaveResponse:function(){$("#response-sample-name").val(""),this.hideSaveForm()}}),ResponseViewer=Backbone.View.extend({initialize:function(){var a=this.model,b=a.get("response"),c=this;this.defaultSection="body",this.responseBodyViewer=new ResponseBodyViewer({model:this.model}),this.responseHeaderViewer=new ResponseHeaderViewer({model:this.model}),this.responseCookieViewer=new ResponseCookieViewer({model:this.model}),this.responseMetaViewer=new ResponseMetaViewer({model:this.model}),this.responseSaver=new ResponseSaver({model:this.model}),this.testResultViewer=new TestResultViewer({model:this.model}),b.on("failedRequest",this.onFailedRequest,this),b.on("clearResponse",this.clear,this),b.on("sentRequest",this.onSentRequest,this),b.on("loadResponse",this.load,this),$("#response-body-toggle").on("click",function(){c.responseBodyViewer.toggleBodySize()}),$("#response-body-line-wrapping").on("click",function(){return c.responseBodyViewer.toggleLineWrapping(),!0}),$("#response-formatting").on("click","a",function(){var a=$(this).attr("data-type");c.responseBodyViewer.changePreviewType(a)}),$("#response-language").on("click","a",function(){var a=$(this).attr("data-mode");c.responseBodyViewer.setMode(a)}),$("#response-data,#response-headers").on("mousedown",".cm-link",function(){function b(a){var b=a.indexOf("//");if(-1==b)return a.split("/")[0];var c=a.substring(b+2);return a.substring(0,b)+"//"+c.split("/")[0]}var c=$(this).html();if("/"==c[0]){var d=a.get("url");c=b(d)+c}var e=$("#headers-keyvaleditor").keyvalueeditor("getValues");a.loadRequestFromLink(c,e)}),$(".response-tabs").on("click","li",function(){var a=$(this).attr("data-section");pm.settings.setSetting("responsePreviewDataSection",a),"body"===a?c.showBody():"headers"===a?c.showHeaders():"cookies"===a?c.showCookies():"tests"===a&&c.showTests()}),$(document).bind("keydown","f",function(){pm.tracker.trackEvent("interaction","shortcut","toggle_response_fullscreen"),pm.app.isModalOpen()||c.responseBodyViewer.toggleBodySize()});var d=/(\s*<\s*)([^>]*)(\s*>[^,]*,?)/g,e=function(a,b,c,d){return Handlebars.Utils.escapeExpression(b)+'<span class="cm-link">'+c+"</span>"+Handlebars.Utils.escapeExpression(d)};Handlebars.registerHelper("link_to_hyperlink",function(a){var b=a.replace(d,e);return new Handlebars.SafeString(b)})},onSentRequest:function(){this.showScreen("waiting")},onFailedRequest:function(a){$("#connection-error-url").html("<a href='"+a+"' target='_blank'>"+a+"</a>"),this.showScreen("failed")},clear:function(){$("#response").css("display","none")},load:function(){var a=this.model,b=a,c=a.get("response"),d=(c.get("headers"),c.get("time"),c.get("previewType"),c.get("language"),c.get("rawDataType"),c.get("responseData"),c.get("text"),b.get("method")),e=a.get("action"),f=(pm.settings.getSetting("previewType"),pm.settings.getSetting("responsePreviewDataSection"));this.showScreen("success"),$("#response").css("display","block"),$("#response-data").css("display","block"),"download"===e?this.showHeaders():"HEAD"===d?this.showHeaders():"body"===f?this.showBody():"headers"===f?this.showHeaders():"tests"===f?this.showTests():"cookies"===f?this.showCookies():this.showBody(),b.get("isFromCollection")===!0?$("#response-collection-request-actions").css("display","block"):$("#response-collection-request-actions").css("display","none"),c.trigger("finishedLoadResponse"),$("#response-as-code, #response-as-code .CodeMirror, textarea#code-data-raw").css("font-size",pm.settings.getSetting("responseFontSize")+"px")},showHeaders:function(){$(".response-tabs li").removeClass("active"),$('.response-tabs li[data-section="headers"]').addClass("active"),$("#response-data-container").css("display","none"),$("#response-headers-container").css("display","block"),$("#response-cookies-container").css("display","none"),$("#response-tests-container").css("display","none")},showBody:function(){$(".response-tabs li").removeClass("active"),$('.response-tabs li[data-section="body"]').addClass("active"),$("#response-data-container").css("display","block"),$("#response-headers-container").css("display","none"),$("#response-cookies-container").css("display","none"),$("#response-tests-container").css("display","none")},showCookies:function(){$(".response-tabs li").removeClass("active"),$('.response-tabs li[data-section="cookies"]').addClass("active"),$("#response-data-container").css("display","none"),$("#response-headers-container").css("display","none"),$("#response-cookies-container").css("display","block"),$("#response-tests-container").css("display","none")},showTests:function(){$(".response-tabs li").removeClass("active"),$('.response-tabs li[data-section="tests"]').addClass("active"),$("#response-data-container").css("display","none"),$("#response-headers-container").css("display","none"),$("#response-cookies-container").css("display","none"),$("#response-tests-container").css("display","block")},showScreen:function(a){$("#response").css("display","block");for(var b="#response-"+a+"-container",c=["#response-waiting-container","#response-failed-container","#response-success-container"],d=0;3>d;d++)$(c[d]).css("display","none");$(b).css("display","block")}}),URLCache=Backbone.Model.extend({defaults:function(){return{urls:[]}},initialize:function(){var a=this;pm.mediator.on("addToURLCache",function(b){a.addUrl(b)})},addUrl:function(a){var b=this.get("urls");-1===$.inArray(a,b)&&b.push(a)},getUrls:function(){return this.get("urls")}});pm.collectionValidator_old={defaults:function(){return{}},getFail:function(a){return{result:!1,reason:a}
},validateJSON:function(a,b){var c=!(!b||!b.correctDuplicates),d=!1,e={result:!0,reason:"Valid Collection"};if(!a.hasOwnProperty("id"))return this.getFail("Must have  a collection ID");var f=a.id,g=a.order;if(!g)return this.getFail("Order[] must be present in the collection");if(!(g instanceof Array))return this.getFail("Order must be an array");var h=_.clone(g),i=[g],j=a.requests,k=[];if(!j)return this.getFail("Requests[] must be present in the collection");if(!(j instanceof Array))return this.getFail("Requests must be an array");for(var l=j.length,m=0;l>m;m++){if(!j[m].hasOwnProperty("id")||"string"!=typeof j[m].id)return this.getFail("Each request must have an ID (string)");if(!j[m].hasOwnProperty("collectionId")||"string"!=typeof j[m].collectionId)return this.getFail("Each request must have an collectionId field");if(j[m].collectionId!==f)return this.getFail("Each request must have the same collectionId as the root collection object");0!==_.intersection([j[m].id],k).length&&(d=!0),k.push(j[m].id)}var n=a.folders;if(n){if(!(n instanceof Array))return this.getFail("Folders must be an array");for(var o=n.length,m=0;o>m;m++){if(!n[m].hasOwnProperty("id")||"string"!=typeof n[m].id)return this.getFail("Each folder must have an ID (String)");if(!(n[m].hasOwnProperty("order")&&n[m].order instanceof Array))return this.getFail("Each folder must have an order[] field");0!==_.intersection(n[m].order,h).length&&(d=!0),h=h.concat(n[m].order),i.push(n[m].order)}}if(d){if(!c)return this.getFail("Request IDs cannot be duplicated");for(var p,q=i.length,m=0;q-1>m;m++)for(p=m+1;q>p;p++){var r=_.intersection(i[m],i[p]),s=r.length;if(0!==r.length)for(var t=0;s>t;t++){var u=i[p].indexOf(r[t]);i[p].splice(u,1)}}}var v=_.difference(k,h);if(0!==v.length){var w=v.join(", ");return this.getFail("Request count not matching. "+w+" are defined, but not present in any order array")}if(v=_.difference(h,k),0!==v.length){var x=v.join(", ");return this.getFail("Request count not matching. "+x+" are included in the order, but are not defined")}return e.finalCollection=a,e}},pm.filesystem={fs:{},onInitFs:function(a){pm.filesystem.fs=a},errorHandler:function(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;default:b="Unknown Error"}console.log("Error: "+b)},init:function(){window.requestFileSystem(window.TEMPORARY,5242880,this.onInitFs,this.errorHandler)},removeFileIfExists:function(a,b){pm.filesystem.fs.root.getFile(a,{create:!1},function(a){a.remove(function(){b()},function(){b()})},function(){b()})},renderResponsePreview:function(a,b,c,d){a=encodeURI(a),a=a.replace("/","_"),pm.filesystem.removeFileIfExists(a,function(){pm.filesystem.fs.root.getFile(a,{create:!0},function(a){a.createWriter(function(e){e.onwriteend=function(){var b={url:a.toURL()};d(b.url)},e.onerror=function(){d(!1)};var f;f="pdf"===c?new Blob([b],{type:"application/pdf"}):new Blob([b],{type:"text/plain"}),e.write(f)},pm.filesystem.errorHandler)},pm.filesystem.errorHandler)})},saveAndOpenFile:function(a,b,c,d){a=encodeURIComponent(a),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a},function(a){a&&a.createWriter(function(a){var e=!1;a.onerror=function(){d()},a.onwriteend=function(){return e?void d():(e=!0,void this.truncate(this.position))};var f;f="pdf"===c?new Blob([b],{type:"application/pdf"}):new Blob([b],{type:"text/plain"}),a.write(f)},pm.filesystem.errorHandler)})}},pm.indexedDB={TABLE_HEADER_PRESETS:"header_presets",TABLE_HELPERS:"helpers",TABLE_DRIVE_FILES:"drive_files",TABLE_DRIVE_CHANGES:"drive_changes",TABLE_OAUTH2_ACCESS_TOKENS:"oauth2_access_tokens",TABLE_TEST_RUNS:"test_runs",onTransactionComplete:function(a){pm.isTesting?pm.indexedDB.clearAllObjectStores(function(){a()}):a()},onerror:function(a){console.log("Could not load DB",a),pm.mediator.trigger("error")},open_v21:function(){var a=indexedDB.open(pm.databaseName,"POSTman request history");a.onsuccess=function(b){var c="0.7.10";pm.indexedDB.db=b.target.result;var d=pm.indexedDB.db;if(c!==d.version){var e=d.setVersion(c);e.onfailure=function(a){console.log(a)},e.onsuccess=function(b){if(!d.objectStoreNames.contains("requests")){var c=d.createObjectStore("requests",{keyPath:"id"});c.createIndex("timestamp","timestamp",{unique:!1})}if(!d.objectStoreNames.contains("systemValues")){var c=d.createObjectStore("systemValues",{keyPath:"name"});c.createIndex("name","name",{unique:!0})}if(!d.objectStoreNames.contains("collections")){var e=d.createObjectStore("collections",{keyPath:"id"});e.createIndex("timestamp","timestamp",{unique:!1})}if(!d.objectStoreNames.contains("collection_requests")){var f=d.createObjectStore("collection_requests",{keyPath:"id"});f.createIndex("timestamp","timestamp",{unique:!1}),f.createIndex("collectionId","collectionId",{unique:!1})}if(!d.objectStoreNames.contains("unsynced_changes")){var g=d.createObjectStore("unsynced_changes",{keyPath:"id"});g.createIndex("timestamp","timestamp",{unique:!1})}if(d.objectStoreNames.contains("collection_responses")&&d.deleteObjectStore("collection_responses"),!d.objectStoreNames.contains("environments")){var h=d.createObjectStore("environments",{keyPath:"id"});h.createIndex("timestamp","timestamp",{unique:!1}),h.createIndex("id","id",{unique:!1})}if(!d.objectStoreNames.contains("header_presets")){var i=d.createObjectStore("header_presets",{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1})}if(!d.objectStoreNames.contains(pm.indexedDB.TABLE_HELPERS)){var j=d.createObjectStore(pm.indexedDB.TABLE_HELPERS,{keyPath:"id"});j.createIndex("timestamp","timestamp",{unique:!1})}if(d.objectStoreNames.contains(pm.indexedDB.TABLE_DRIVE_FILES)){var k=a.transaction.objectStore(pm.indexedDB.TABLE_DRIVE_FILES);k.createIndex("fileId","fileId",{unique:!1})}else{var l=d.createObjectStore(pm.indexedDB.TABLE_DRIVE_FILES,{keyPath:"id"});l.createIndex("timestamp","timestamp",{unique:!1}),l.createIndex("fileId","fileId",{unique:!1})}if(!d.objectStoreNames.contains(pm.indexedDB.TABLE_DRIVE_CHANGES)){var m=d.createObjectStore(pm.indexedDB.TABLE_DRIVE_CHANGES,{keyPath:"id"});m.createIndex("timestamp","timestamp",{unique:!1})}if(!d.objectStoreNames.contains(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS)){var n=d.createObjectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS,{keyPath:"id"});n.createIndex("timestamp","timestamp",{unique:!1})}if(!d.objectStoreNames.contains(pm.indexedDB.TABLE_TEST_RUNS)){var h=d.createObjectStore(pm.indexedDB.TABLE_TEST_RUNS,{keyPath:"id"});h.createIndex("timestamp","timestamp",{unique:!1})}var o=b.target.result;o.oncomplete=pm.indexedDB.onTransactionComplete},e.onupgradeneeded=function(){}}},a.onfailure=pm.indexedDB.onerror},open_latest:function(a){var b=39,c=indexedDB.open(pm.databaseName,b);c.onupgradeneeded=function(a){console.log("Upgrade DB");var b=a.target.result;if(pm.indexedDB.db=b,!b.objectStoreNames.contains("requests")){var c=b.createObjectStore("requests",{keyPath:"id"});c.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains("systemValues")){var c=b.createObjectStore("systemValues",{keyPath:"name"});c.createIndex("name","name",{unique:!0})}if(!b.objectStoreNames.contains("sinceIds")){var c=b.createObjectStore("sinceIds",{keyPath:"id"});c.createIndex("id","id",{unique:!0})}if(!b.objectStoreNames.contains("subscriptions")){var c=b.createObjectStore("subscriptions",{keyPath:"id"});c.createIndex("id","id",{unique:!0})}if(!b.objectStoreNames.contains("collections")){var d=b.createObjectStore("collections",{keyPath:"id"});d.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains("unsynced_changes")){var e=b.createObjectStore("unsynced_changes",{keyPath:"id"});e.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains("sync_conflicts")){var e=b.createObjectStore("sync_conflicts",{keyPath:"id"});e.createIndex("id","id",{unique:!0})}if(!b.objectStoreNames.contains("collection_requests")){var f=b.createObjectStore("collection_requests",{keyPath:"id"});f.createIndex("timestamp","timestamp",{unique:!1}),f.createIndex("collectionId","collectionId",{unique:!1}),f.createIndex("folderId","folderId",{unique:!1})}if(!b.objectStoreNames.contains("environments")){var g=b.createObjectStore("environments",{keyPath:"id"});g.createIndex("timestamp","timestamp",{unique:!1}),g.createIndex("id","id",{unique:!1})}if(!b.objectStoreNames.contains("header_presets")){var h=b.createObjectStore("header_presets",{keyPath:"id"});h.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains(pm.indexedDB.TABLE_HELPERS)){var i=b.createObjectStore(pm.indexedDB.TABLE_HELPERS,{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains(pm.indexedDB.TABLE_DRIVE_FILES)){var j=b.createObjectStore(pm.indexedDB.TABLE_DRIVE_FILES,{keyPath:"id"});j.createIndex("timestamp","timestamp",{unique:!1}),j.createIndex("fileId","fileId",{unique:!1})}if(!b.objectStoreNames.contains(pm.indexedDB.TABLE_DRIVE_CHANGES)){var k=b.createObjectStore(pm.indexedDB.TABLE_DRIVE_CHANGES,{keyPath:"id"});k.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS)){var l=b.createObjectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS,{keyPath:"id"});l.createIndex("timestamp","timestamp",{unique:!1})}if(!b.objectStoreNames.contains(pm.indexedDB.TABLE_TEST_RUNS)){var g=b.createObjectStore(pm.indexedDB.TABLE_TEST_RUNS,{keyPath:"id"});g.createIndex("timestamp","timestamp",{unique:!1})}},c.onsuccess=function(b){pm.indexedDB.db=b.target.result,pm.indexedDB.onTransactionComplete(a)},c.onerror=pm.indexedDB.onerror},open:function(a){parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2])<23?pm.indexedDB.open_v21(a):(console.log("Open latest DB"),pm.indexedDB.open_latest(a)),pm.mediator.on("initiateBackup",pm.indexedDB.downloadAllData)},getSince:function(a){var b=pm.indexedDB.db,c=b.transaction(["sinceIds"],"readwrite"),d=c.objectStore("sinceIds"),e=IDBKeyRange.lowerBound(0),f=d.index("id"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c){if(0===h.length){console.log("Since not found...resetting to 0");{d.put({id:"own",value:0})}h=[{id:"own",value:0}]}return void(a&&a(h))}var e=c.value;h.push(e),c["continue"]()},g.onerror=pm.indexedDB.onerror},updateSince:function(a,b,c){var d=pm.indexedDB.db,e=d.transaction(["sinceIds"],"readwrite"),f=e.objectStore("sinceIds"),g=(IDBKeyRange.only("own"),f.put({id:"own",value:a}));g.onsuccess=function(){c(a)},g.onerror=function(){c(a)}},deleteAllSince:function(){{var a=pm.indexedDB.db,b=a.transaction(["sinceIds"],"readwrite"),c=b.objectStore("sinceIds");c.clear()}},updateLocalSince:function(a,b,c){var d=pm.indexedDB.db,e=d.transaction(["sinceIds"],"readwrite"),f=e.objectStore("sinceIds"),g=(IDBKeyRange.only("own"),f.put({id:"own",value:a}));g.onsuccess=function(){c(a)},g.onerror=function(a){console.log(a.value)}},updateSubscribedSince:function(a,b,c,d){var e=pm.indexedDB.db,f=e.transaction(["sinceIds"],"readwrite"),g=f.objectStore("sinceIds"),h=(IDBKeyRange.only(a),g.put({id:"subscriptionId",value:b}));h.onsuccess=function(){d(b)},h.onerror=function(a){console.log(a.value)}},deleteAllSyncValues:function(a){var b=pm.indexedDB.db,c=b.transaction(["systemValues"],"readwrite"),d=c.objectStore("systemValues"),e=d.clear();e.onsuccess=function(){a()}},addSyncConflict:function(a,b){var c,d=pm.indexedDB.db,e=d.transaction(["sync_conflicts"],"readwrite"),f=e.objectStore("sync_conflicts");c=f.put(a),c.onsuccess=function(){b(a)},c.onerror=function(a){console.log(a.value)}},getAllConflicts:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["sync_conflicts"],"readwrite"),d=c.objectStore("sync_conflicts"),e=IDBKeyRange.lowerBound(0),f=d.index("id"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void(a&&a(h));var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateSyncConflict:function(a,b){try{var c=pm.indexedDB.db,d=c.transaction(["sync_conflicts"],"readwrite"),e=d.objectStore(["sync_conflicts"]),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(changeset)},f.onerror=function(a){console.log(a)}}catch(g){console.log(g)}},clearSyncConflicts:function(){var a=pm.indexedDB.db;if(null!==a){var b=a.transaction(["sync_conflicts"],"readwrite"),c=b.objectStore("sync_conflicts");c.clear()}},addUnsyncedChange:function(a,b){var c,d=pm.indexedDB.db,e=d.transaction(["unsynced_changes"],"readwrite"),f=e.objectStore("unsynced_changes");c=f.put(a),c.onsuccess=function(){b(a)},c.onerror=function(a){console.log(a.value)}},getUnsyncedChanges:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["unsynced_changes"],"readwrite"),d=c.objectStore("unsynced_changes"),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void(a&&a(h));var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateUnsyncedChange:function(a,b){try{var c=pm.indexedDB.db,d=c.transaction(["unsynced_changes"],"readwrite"),e=d.objectStore(["unsynced_changes"]),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b&&b(a)},f.onerror=function(a){console.log(a)}}catch(g){console.log(g)}},deleteUnsyncedChange:function(a,b){try{var c=pm.indexedDB.db,d=c.transaction(["unsynced_changes"],"readwrite"),e=d.objectStore(["unsynced_changes"]),f=e["delete"](a);f.onsuccess=function(){"function"==typeof b&&b(a)},f.onerror=function(a){console.log(a)}}catch(g){console.log(g)}},clearUnsyncedChanges:function(){var a=pm.indexedDB.db;if(null!==a){var b=a.transaction(["unsynced_changes"],"readwrite"),c=b.objectStore("unsynced_changes");c.clear()}},getAllSyncNotifs:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["systemValues"],"readwrite"),d=c.objectStore("systemValues"),e=d.get("syncNotifs");e.onsuccess=function(b){if(void 0===b||void 0===b.target.result){console.log("No notifs found");{IDBKeyRange.only("syncNotifs"),d.put({name:"syncNotifs",value:[]})}a({name:"syncNotifs",value:[]})}else{var c=b.target.result;a(c)}}}},updateSyncNotifs:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["systemValues"],"readwrite"),e=d.objectStore("systemValues"),f=(IDBKeyRange.only("syncNotifs"),{name:"syncNotifs",value:a}),g=e.put(f);g.onsuccess=function(){b(a)},g.onerror=function(a){console.log(a.value)}},addCollection:function(a,b){var c,d=pm.indexedDB.db,e=d.transaction(["collections"],"readwrite"),f=e.objectStore("collections");try{c=f.put(a)}catch(g){pm.syncLogger.error("Error adding collection to DB - "+g.value+". CollectionJSON: "+JSON.stringify(a)),console.error("Error adding collection to DB: "+g.value)}c.onsuccess=function(){b(a)},c.onerror=function(b){pm.syncLogger.error("Error adding collection to DB - "+b.value+". CollectionJSON: "+JSON.stringify(a)),console.error("Error adding collection to DB: "+b.value)}},updateCollection:function(a,b,c,d){var e=pm.indexedDB.db,f=e.transaction(["collections"],"readwrite"),g=f.objectStore("collections"),h=(IDBKeyRange.only(a.id),g.put(a));h.onsuccess=function(){d(a)},h.onerror=function(b){console.error("Error: ",b.value),d(a)}},addCollectionRequest:function(a,b,c){var d=pm.indexedDB.db,e=d.transaction(["collection_requests"],"readwrite"),f=e.objectStore("collection_requests"),g=f.put(a);g.onsuccess=function(){c(a)},g.onerror=function(a){console.error(a.value)}},updateCollectionRequest:function(a,b,c,d){var e=pm.indexedDB.db,f=e.transaction(["collection_requests"],"readwrite"),g=f.objectStore("collection_requests"),h=(IDBKeyRange.only(a.id),g.put(a));h.onsuccess=function(){d(a)},h.onerror=function(b){console.log("Error: ",b.value),d(a)}},getCollection:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["collections"],"readwrite"),e=d.objectStore("collections"),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror},getCollections:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["collections"],"readwrite"),d=c.objectStore("collections"),e=IDBKeyRange.lowerBound(0),f=d.openCursor(e),g=0,h=[];f.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;g++,h.push(d),c["continue"]()},f.onerror=function(a){console.log(a)}}},deleteAllCollections:function(a){var b=pm.indexedDB.db,c=b.transaction(["collections"],"readwrite"),d=c.objectStore("collections"),e=d.clear();e.onsuccess=function(){a()}},getAllCollectionRequests:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["collection_requests"],"readwrite"),d=c.objectStore("collection_requests"),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void(a&&a(h));var d=c.val;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},getAllRequestsForCollectionId:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["collection_requests"],"readwrite"),e=IDBKeyRange.only(a),f=d.objectStore("collection_requests"),g=f.index("collectionId"),h=g.openCursor(e),i=[];h.onsuccess=function(a){var c=a.target.result;if(!c)return void b(i);var d=c.value;i.push(d),c["continue"]()},h.onerror=pm.indexedDB.onerror},getAllRequestsInCollection:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["collection_requests"],"readwrite"),e=IDBKeyRange.only(a.id),f=d.objectStore("collection_requests"),g=f.index("collectionId"),h=g.openCursor(e),i=[];h.onsuccess=function(c){var d=c.target.result;if(!d)return void b(a,i);var e=d.value;i.push(e),d["continue"]()},h.onerror=pm.indexedDB.onerror},addRequest:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["requests"],"readwrite"),e=d.objectStore("requests"),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a.value)}},getRequest:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["requests"],"readwrite"),e=d.objectStore("requests"),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;c&&b(c)},f.onerror=pm.indexedDB.onerror},deleteAllHistoryRequests:function(a){var b=pm.indexedDB.db,c=b.transaction(["requests"],"readwrite"),d=c.objectStore("requests"),e=d.clear();e.onsuccess=a},getCollectionRequest:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["collection_requests"],"readwrite"),e=d.objectStore("collection_requests");if("string"!=typeof a){var f=new Error;return pm.syncLogger.error("Bad request id passed. Stack: "+f.stack),b(null),null}var g=e.get(a);g.onsuccess=function(c){var d=c.target.result;return d?(b(d),d):(pm.syncLogger.error("Could not find a request with this ID: "+a),void b(null))},g.onerror=function(){pm.syncLogger.error("Could not find a request with this ID: "+a),b(null)}},getAllRequestItems:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["requests"],"readwrite"),d=c.objectStore("requests"),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},deleteRequest:function(a,b){try{var c=pm.indexedDB.db,d=c.transaction(["requests"],"readwrite"),e=d.objectStore(["requests"]),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}}catch(g){console.log(g)}},deleteHistory:function(a){var b=pm.indexedDB.db,c=b.transaction(["requests"],"readwrite"),d=c.objectStore(["requests"]).clear();d.onsuccess=function(){a()}},deleteCollectionRequestWithOptSync:function(a,b,c){var d=pm.indexedDB.db,e=d.transaction(["collection_requests"],"readwrite"),f=e.objectStore(["collection_requests"]),g=f["delete"](a);g.onsuccess=function(){c(a)},g.onerror=function(b){console.log("Error: ",b),c(a)}},deleteCollectionRequest:function(a,b){this.deleteCollectionRequestWithOptSync(a,!0,b)},deleteAllCollectionRequests:function(a){var b=pm.indexedDB.db,c=b.transaction(["collection_requests"],"readwrite"),d=IDBKeyRange.only(a),e=c.objectStore("collection_requests"),f=e.index("collectionId"),g=f.openCursor(d);g.onsuccess=function(a){var b=a.target.result;if(b){var c=b.value;pm.indexedDB.deleteCollectionRequest(c.id,function(){}),b["continue"]()}},g.onerror=pm.indexedDB.onerror},deleteEachCollectionRequest:function(){{var a=pm.indexedDB.db,b=a.transaction(["collection_requests"],"readwrite"),c=b.objectStore("collection_requests");c.clear()}},deleteCollectionWithOptSync:function(a,b,c){var d=pm.indexedDB.db,e=d.transaction(["collections"],"readwrite"),f=e.objectStore(["collections"]),g=f["delete"](a);g.onsuccess=function(){c(a)},g.onerror=function(b){console.log("Error: ",b),c(a)}},subscriptions:{addSubscription:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["subscriptions"],"readwrite"),e=d.objectStore("subscriptions"),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},deleteSubscription:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["subscriptions"],"readwrite"),e=d.objectStore(["subscriptions"]),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=function(c){console.log("Error: ",c),b(a)}},deleteAllSubscriptions:function(a){var b=pm.indexedDB.db,c=b.transaction(["subscriptions"],"readwrite"),d=c.objectStore("subscriptions"),e=d.clear();e.onsuccess=function(){a()}},getAllSubscriptions:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["subscriptions"],"readwrite"),d=c.objectStore("subscriptions"),e=IDBKeyRange.lowerBound(0),f=d.index("id"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},isSubscribedTo:function(a){var b=pm.indexedDB.db,c=b.transaction(["subscriptions"],"readwrite"),d=c.objectStore("subscriptions"),e=d.get(a);e.onsuccess=function(a){var b=a.target.result;if(b)return callback(b),b},e.onerror=pm.indexedDB.onerror}},environments:{addEnvironment:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["environments"],"readwrite"),e=d.objectStore("environments"),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getEnvironment:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["environments"],"readwrite"),e=d.objectStore("environments"),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror},deleteEnvironment:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["environments"],"readwrite"),e=d.objectStore(["environments"]),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=function(c){console.log("Error: ",c),b(a)}},getAllEnvironments:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction(["environments"],"readwrite"),d=c.objectStore("environments"),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateEnvironment:function(a,b){var c=pm.indexedDB.db,d=c.transaction(["environments"],"readwrite"),e=d.objectStore("environments"),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(a)},f.onerror=function(c){console.log("Error: ",c.value),b(a)}},deleteAllEnvironments:function(a){var b=pm.indexedDB.db,c=b.transaction(["environments"],"readwrite"),d=c.objectStore("environments"),e=d.clear();e.onsuccess=function(){a()}}},helpers:{addHelper:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_HELPERS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_HELPERS),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getHelper:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_HELPERS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_HELPERS),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror}},headerPresets:{addHeaderPreset:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_HEADER_PRESETS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_HEADER_PRESETS),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getHeaderPreset:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_HEADER_PRESETS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_HEADER_PRESETS),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror},deleteHeaderPreset:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_HEADER_PRESETS],"readwrite"),e=d.objectStore([pm.indexedDB.TABLE_HEADER_PRESETS]),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},deleteAllHeaderPresets:function(a){var b=pm.indexedDB.db,c=b.transaction([pm.indexedDB.TABLE_HEADER_PRESETS],"readwrite"),d=c.objectStore(pm.indexedDB.TABLE_HEADER_PRESETS),e=d.clear();e.onsuccess=function(){a()},e.onerror=function(a){console.log(a)}},getAllHeaderPresets:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction([pm.indexedDB.TABLE_HEADER_PRESETS],"readwrite"),d=c.objectStore(pm.indexedDB.TABLE_HEADER_PRESETS),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateHeaderPreset:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_HEADER_PRESETS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_HEADER_PRESETS),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a.value)}}},driveFiles:{addDriveFile:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_FILES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_FILES),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getDriveFile:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_FILES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_FILES),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror},getDriveFileByFileId:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_FILES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_FILES),f=IDBKeyRange.only(a),g=e.index("fileId"),h=g.openCursor(f);h.onsuccess=function(a){var c=a.target.result;b(c?c.value:null)},h.onerror=function(){b(null)}},deleteDriveFile:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_FILES],"readwrite"),e=d.objectStore([pm.indexedDB.TABLE_DRIVE_FILES]),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getAllDriveFiles:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction([pm.indexedDB.TABLE_DRIVE_FILES],"readwrite"),d=c.objectStore(pm.indexedDB.TABLE_DRIVE_FILES),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateDriveFile:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_FILES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_FILES),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a.value)}}},driveChanges:{addDriveChange:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_CHANGES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_CHANGES),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getDriveChange:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_CHANGES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_CHANGES),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror},deleteDriveChange:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_CHANGES],"readwrite"),e=d.objectStore([pm.indexedDB.TABLE_DRIVE_CHANGES]),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},getAllDriveChanges:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction([pm.indexedDB.TABLE_DRIVE_CHANGES],"readwrite"),d=c.objectStore(pm.indexedDB.TABLE_DRIVE_CHANGES),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return h.sort(sortAscending),void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateDriveChange:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_DRIVE_CHANGES],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_DRIVE_CHANGES),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a.value)}}},oAuth2AccessTokens:{addAccessToken:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},deleteAccessToken:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=pm.indexedDB.onerror},getAllAccessTokens:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction([pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS],"readwrite"),d=c.objectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateAccessToken:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a.value)}},getAccessToken:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_OAUTH2_ACCESS_TOKENS),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror}},testRuns:{addTestRun:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_TEST_RUNS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_TEST_RUNS),f=e.put(a);f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a)}},deleteTestRun:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_TEST_RUNS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_TEST_RUNS),f=e["delete"](a);f.onsuccess=function(){b(a)},f.onerror=pm.indexedDB.onerror},getAllTestRuns:function(a){var b=pm.indexedDB.db;if(null!==b){var c=b.transaction([pm.indexedDB.TABLE_TEST_RUNS],"readwrite"),d=c.objectStore(pm.indexedDB.TABLE_TEST_RUNS),e=IDBKeyRange.lowerBound(0),f=d.index("timestamp"),g=f.openCursor(e),h=[];g.onsuccess=function(b){var c=b.target.result;if(!c)return void a(h);var d=c.value;h.push(d),c["continue"]()},g.onerror=pm.indexedDB.onerror}},updateTestRun:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_TEST_RUNS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_TEST_RUNS),f=(IDBKeyRange.only(a.id),e.put(a));f.onsuccess=function(){b(a)},f.onerror=function(a){console.log(a.value)}},getTestRun:function(a,b){var c=pm.indexedDB.db,d=c.transaction([pm.indexedDB.TABLE_TEST_RUNS],"readwrite"),e=d.objectStore(pm.indexedDB.TABLE_TEST_RUNS),f=e.get(a);f.onsuccess=function(a){var c=a.target.result;b(c)},f.onerror=pm.indexedDB.onerror}},downloadAllData:function(a){console.log("Starting to download all data");var b=0,c=0,d=[],e=[],f=[],g=[],h=function(a){d.push(a),c++,c===b&&i(d)
},i=function(){console.log(pm.envManager),e=pm.envManager.get("globals").get("globals"),pm.indexedDB.environments.getAllEnvironments(function(b){f=b,pm.indexedDB.headerPresets.getAllHeaderPresets(function(b){g=b,j(a)})})},j=function(){console.log("collections",d),console.log("environments",f),console.log("headerPresets",g),console.log("globals",e);var b={version:1,collections:d,environments:f,headerPresets:g,globals:e},c="Backup.postman_dump",h=JSON.stringify(b,null,"	"),i="application/json";pm.filesystem.saveAndOpenFile(c,h,i,function(){a&&a()})};pm.indexedDB.getCollections(function(c){function d(a,b){a.requests=b,h(a)}b=c.length,pm.collections.items=c;var i=c.length;if(0!==i)for(var k=0;i>k;k++){var l=c[k];pm.indexedDB.getAllRequestsInCollection(l,d)}else e=pm.envManager.get("globals").get("globals"),pm.indexedDB.environments.getAllEnvironments(function(b){f=b,pm.indexedDB.headerPresets.getAllHeaderPresets(function(b){g=b,j(a)})})})},importAllData:function(a,b,c){if(1===a.length){var d=(a[0],new FileReader);d.onload=function(){return function(a){var d=a.currentTarget.result,e="";try{e=JSON.parse(d)}catch(a){return void c(a.message)}var f=e.version;pm.indexedDB.importDataForVersion(f,e,b)}}(a[0]),d.readAsText(a[0])}},importDataForVersion:function(a,b,c){if(1===a){var d=pm.envManager.get("environments"),e=pm.envManager.get("globals");"collections"in b&&(console.log("Import collections"),pm.collections.mergeCollections(b.collections)),"environments"in b&&(console.log("Import environments"),d.mergeEnvironments(b.environments)),"globals"in b&&(console.log("Import globals"),e.mergeGlobals(b.globals,!0)),"headerPresets"in b&&(console.log("Import headerPresets"),pm.headerPresets.mergeHeaderPresets(b.headerPresets))}c()}};var Logger=Backbone.Model.extend({defaults:function(){return{toShow:!0}},debug:function(){console.log(arguments)},message:function(){console.log(arguments)}}),Storage=Backbone.Model.extend({defaults:function(){},getValue:function(a,b){if(pm.target===pm.targets.CHROME_LEGACY_APP)b(localStorage[a]);else if(pm.target===pm.targets.CHROME_PACKAGED_APP){var c={};c[a]=null,chrome.storage.local.get(c,function(c){b(c[a])})}},setValue:function(a,b){if(pm.target===pm.targets.CHROME_LEGACY_APP){for(key in a)a.hasOwnProperty(key)&&(localStorage[key]=a[key]);b&&b()}else pm.target===pm.targets.CHROME_PACKAGED_APP&&chrome.storage.local.set(a,function(){b&&b()})}}),Settings=Backbone.Model.extend({defaults:function(){return{lastRequest:"",autoSaveRequest:!0,selectedEnvironmentId:"",type:"chromeStorageArea",items:{}}},resetSettings:function(){this.setSetting("historyCount",100),this.setSetting("autoSaveRequest",!0),this.setSetting("selectedEnvironmentId",!0),this.setSetting("lineWrapping",!0),this.setSetting("previewType","parsed"),this.setSetting("trimKeysAndValues",!1),this.setSetting("retainLinkHeaders",!1),this.setSetting("sendNoCacheHeader",!0),this.setSetting("sendPostmanTokenHeader",!0),this.setSetting("usePostmanProxy",!1),this.setSetting("useInterceptor",!1),this.setSetting("proxyURL",""),this.setSetting("lastRequest",""),this.setSetting("launcherNotificationCount",0),this.setSetting("xhrTimeout",0),this.setSetting("variableDelimiter","{{...}}"),this.setSetting("languageDetection","auto"),this.setSetting("haveDonated",!1),this.setSetting("instantModals",!0),this.setSetting("responseFontSize",13),this.setSetting("enableSync",!1),this.setSetting("syncInviteEnabled",!1),this.setSetting("syncInviteShown",!1),this.setSetting("baseEulaAccepted",!1),this.setSetting("postmanTheme","light"),this.setSetting("postmanCodeMirrorTheme","eclipse"),this.setSetting("responsePreviewDataSection","body"),this.setSetting("requestBodyEditorContainerType","editor"),this.setSetting("driveSyncPermissionStatus","disabled"),this.setSetting("driveSyncEnabled",!1),this.setSetting("driveStartChangeId",0),this.setSetting("driveAppDataFolderId",0),this.setSetting("lastDriveChangeTime",""),this.setSetting("syncedGlobals",!1),this.setSetting("hideSnippets",!1),this.setSetting("hidePrscriptSnippets",!1),this.setSetting("interceptorRedirect",!0)},initValues:function(a){this.set({items:{}});var b=function(b){null!==b&&this.set({items:JSON.parse(b)}),this.create("historyCount",100),this.create("autoSaveRequest",!0),this.create("selectedEnvironmentId",!0),this.create("lineWrapping",!0),this.create("previewType","parsed"),this.create("trimKeysAndValues",!1),this.create("retainLinkHeaders",!1),this.create("sendNoCacheHeader",!0),this.create("sendPostmanTokenHeader",!0),this.create("usePostmanProxy",!1),this.create("useInterceptor",!1),this.create("proxyURL",""),this.create("lastRequest",""),this.create("xhrTimeout",0),this.create("launcherNotificationCount",0),this.create("variableDelimiter","{{...}}"),this.create("languageDetection","auto"),this.create("haveDonated",!1),this.create("instantModals",!0),this.create("postmanTheme","light"),this.create("postmanCodeMirrorTheme","eclipse"),this.create("responsePreviewDataSection","body"),this.create("requestBodyEditorContainerType","editor"),this.create("responseFontSize",13),this.create("driveSyncPermissionStatus","not_asked"),this.create("driveSyncEnabled",!1),this.create("driveStartChangeId",0),this.create("driveAppDataFolderId",0),this.create("lastDriveChangeTime",""),this.create("syncedGlobals",!1),this.create("syncedHeaderPresets",!1),this.create("hideSnippets",!1),this.create("hidePrscriptSnippets",!1),this.create("enableSync",!1),this.create("syncInviteEnabled",!1),this.create("syncInviteShown",!1),this.create("baseEulaAccepted",!1),this.create("interceptorRedirect",!0),pm.isTesting&&this.resetSettings(),a()};b=_.bind(b,this),pm.storage.getValue("settings",b)},initListeners:function(){},test:function(){},init:function(a){this.initValues(a)},create:function(a,b){a in this.get("items")||"undefined"!==b&&this.setSetting(a,b)},setSetting:function(a,b){var c=_.clone(this.get("items"));c[a]=b,this.set({items:c});var d={settings:JSON.stringify(this.get("items"))};pm.storage.setValue(d,function(){})},getSetting:function(a){var b=this.get("items")[a];return"true"===b?!0:"false"===b?!1:b},update:function(a){this.setSetting("historyCount",a.historyCount,!1),this.setSetting("autoSaveRequest",a.autoSaveRequest,!1),this.setSetting("retainLinkHeaders",a.retainLinkHeaders,!1),this.setSetting("sendNoCacheHeader",a.sendNoCacheHeader,!1),this.setSetting("variableDelimiter",a.variableDelimiter,!1),this.setSetting("languageDetection",a.languageDetection,!1),this.setSetting("haveDonated",a.haveDonated,!1),this.setSetting("instantModals",a.instantModals,!1),this.setSetting("enableSync",a.enableSync,!1),this.setSetting("baseEulaAccepted",a.baseEulaAccepted,!1),this.setSetting("responseFontSize",a.responseFontSize,!1),this.setSetting("interceptorRedirect",a.interceptorRedirect,!0),this.initValues(),this.initListeners()},getAsJson:function(){var a={historyCount:this.getSetting("historyCount"),autoSaveRequest:this.getSetting("autoSaveRequest"),retainLinkHeaders:this.getSetting("retainLinkHeaders"),sendNoCacheHeader:this.getSetting("sendNoCacheHeader"),variableDelimiter:this.getSetting("variableDelimiter"),languageDetection:this.getSetting("languageDetection"),haveDonated:this.getSetting("haveDonated"),instantModals:this.getSetting("instantModals"),responseFontSize:this.getSetting("responseFontSize"),enableSync:this.getSetting("enableSync"),baseEulaAccepted:this.getSetting("baseEulaAccepted"),interceptorRedirect:this.getSetting("interceptorRedirect")};return a}}),DebugInfo=Backbone.View.extend({initialize:function(){this.model;this.render()},render:function(){var a=chrome.runtime.getManifest();$(".postman-version").html("Version "+a.version+" (packaged)"),chrome.runtime.getPlatformInfo(function(a){var b="OS: <strong>"+a.os+"</strong><br/>";b+="Architecture: <strong>"+a.arch+"</strong><br/>",b+="Native client architecture: <strong>"+a.nacl_arch+"</strong><br/>",$(".postman-os-info").html(b)})}}),SettingsModal=Backbone.View.extend({el:$("#modal-settings"),initialize:function(){{var a=this.model;new DebugInfo({model:this.model}),new ThemeSettingsTab({model:a})}this.model.on("change:items",this.render,this),$("#modal-settings").on("shown",function(){$("#history-count").focus(),pm.app.trigger("modalOpen","#modal-settings")}),$("#modal-settings").on("hidden",function(){pm.app.trigger("modalClose")}),$("#history-count").change(function(){a.setSetting("historyCount",$("#history-count").val())}),$("#auto-save-request").change(function(){var b=$("#auto-save-request").val();"true"===b?a.setSetting("autoSaveRequest",!0):a.setSetting("autoSaveRequest",!1)}),$("#trim-keys-and-values").change(function(){var b=$("#trim-keys-and-values").val();"true"===b?a.setSetting("trimKeysAndValues",!0):a.setSetting("trimKeysAndValues",!1)}),$("#retain-link-headers").change(function(){var b=$("#retain-link-headers").val();"true"===b?a.setSetting("retainLinkHeaders",!0):a.setSetting("retainLinkHeaders",!1)}),$("#send-no-cache-header").change(function(){var b=$("#send-no-cache-header").val();"true"===b?a.setSetting("sendNoCacheHeader",!0):a.setSetting("sendNoCacheHeader",!1)}),$("#send-postman-token-header").change(function(){var b=$("#send-postman-token-header").val();"true"===b?a.setSetting("sendPostmanTokenHeader",!0):a.setSetting("sendPostmanTokenHeader",!1)}),$("#use-postman-proxy").change(function(){var b=$("#use-postman-proxy").val();"true"===b?a.setSetting("usePostmanProxy",!0):a.setSetting("usePostmanProxy",!1)}),$("#auto-follow-interceptor-redirects").change(function(){var b=$("#auto-follow-interceptor-redirects").val();"true"===b?a.setSetting("interceptorRedirect",!0):a.setSetting("interceptorRedirect",!1)}),$("#postman-proxy-url").change(function(){a.setSetting("postmanProxyUrl",$("#postman-proxy-url").val())}),$("#response-font-size").change(function(){a.setSetting("responseFontSize",parseInt($("#response-font-size").val(),10))}),$("#xhr-timeout").change(function(){a.setSetting("xhrTimeout",parseInt($("#xhr-timeout").val(),10))}),$("#variable-delimiter").change(function(){a.setSetting("variableDelimiter",$("#variable-delimiter").val())}),$("#language-detection").change(function(){a.setSetting("languageDetection",$("#language-detection").val())}),$("#have-donated").change(function(){var b=$("#have-donated").val();"true"===b?(a.setSetting("haveDonated",!0),pm.mediator.trigger("donatedStatusChanged",!0)):(a.setSetting("haveDonated",!1),pm.mediator.trigger("donatedStatusChanged",!1))}),$("#force-windows-line-endings").change(function(){var b=$("#force-windows-line-endings").val();"true"===b?a.setSetting("forceWindowsLineEndings",!0):a.setSetting("forceWindowsLineEndings",!1)}),$("#instant-modals").change(function(){var b=$("#instant-modals").val();"true"===b?(a.setSetting("instantModals",!0),$(".fade").removeClass("fade").addClass("fade_disable")):(a.setSetting("instantModals",!1),$(".modal-backdrop.in").addClass("fade"),$(".fade_disable").removeClass("fade_disable").addClass("fade"))}),$("#download-all-data").on("click",function(){pm.tracker.trackEvent("account","download_dump"),pm.indexedDB.downloadAllData(function(){noty({type:"success",text:"Saved the data dump",layout:"topCenter",timeout:750})})}),$("#import-all-data-files-input").on("change",function(a){var b=a.target.files;pm.tracker.trackEvent("account","import_dump"),pm.indexedDB.importAllData(b,function(){$("#import-all-data-files-input").val(""),noty({type:"success",text:"Imported all data",layout:"topCenter",timeout:750})},function(a){$("#import-all-data-files-input").val(""),noty({type:"error",text:"Error parsing JSON: "+a,layout:"topCenter"})})}),$(document).bind("keydown","shift+/",function(){pm.tracker.trackEvent("interaction","shortcut","show_settings"),pm.app.isModalOpen()||($("#modal-settings").modal({keyboard:!0}),$("#modal-settings").modal("show"),$('#modal-settings a[href="#settings-shortcuts"]').tab("show"))}),this.model.getSetting("usePostmanProxy")===!0?$("#postman-proxy-url-container").css("display","block"):$("#postman-proxy-url-container").css("display","none"),this.render()},render:function(){$("#history-count").val(this.model.getSetting("historyCount")),$("#auto-save-request").val(this.model.getSetting("autoSaveRequest")+""),$("#trim-keys-and-values").val(this.model.getSetting("trimKeysAndValues")+""),$("#retain-link-headers").val(this.model.getSetting("retainLinkHeaders")+""),$("#send-no-cache-header").val(this.model.getSetting("sendNoCacheHeader")+""),$("#send-postman-token-header").val(this.model.getSetting("sendPostmanTokenHeader")+""),$("#use-postman-interceptor").val(this.model.getSetting("useInterceptor")+""),$("#use-postman-proxy").val(this.model.getSetting("usePostmanProxy")+""),$("#postman-proxy-url").val(this.model.getSetting("postmanProxyUrl")),$("#xhr-timeout").val(this.model.getSetting("xhrTimeout")),$("#variable-delimiter").val(this.model.getSetting("variableDelimiter")),$("#language-detection").val(this.model.getSetting("languageDetection")),$("#have-donated").val(this.model.getSetting("haveDonated")+""),$("#instant-modals").val(this.model.getSetting("instantModals")+""),$("#response-font-size").val(this.model.getSetting("responseFontSize")+"")}}),ThemeSettingsTab=Backbone.View.extend({initialize:function(){var a=(this.model,this);$("#postman-theme").change(function(){pm.mediator.trigger("switchTheme",$("#postman-theme").val()),a.hideSettings()}),$("body").on("click",".theme-thumbnail",function(){$(".theme-thumbnail").removeClass("selected-theme-thumb"),$(this).addClass("selected-theme-thumb"),pm.mediator.trigger("switchTheme",$(this).attr("data-theme"))}),pm.mediator.on("purchaseComplete",function(b){"collection-runner"===b.id&&a.hidePurchaseMessage()}),pm.mediator.on("loadedPurchases",function(b){b.isUpgradeAvailable("collection-runner")?(console.log("ThemeSettingsTab: Purchase is available"),a.hidePurchaseMessage()):(console.log("ThemeSettingsTab: Purchase is not available"),a.hidePurchaseMessage(),pm.purchases.isTrialCompleted("collection-runner")&&console.log("ThemeSettingsTab: Trial completed"))}),this.render()},hideSettings:function(){$("#modal-settings").modal("hide")},hidePurchaseMessage:function(){$("#settings-theme-buy-message").css("display","none"),$("#settings-theme-form").css("display","block")},showPurchaseMessage:function(){$("#settings-theme-form").css("display","none"),$("#settings-theme-buy-message").css("display","block")},render:function(){$("#postman-theme").val(this.model.getSetting("postmanTheme")),$(".theme-thumbnail").removeClass("selected-theme-thumb"),$(".theme-thumbnail[data-theme='"+this.model.getSetting("postmanTheme")+"']").addClass("selected-theme-thumb")}}),SearchForm=Backbone.View.extend({initialize:function(){var a,b=this,c=this.model;$("#sidebar-search").on("keyup",function(){$("#sidebar-search-cancel").css("display","block"),clearTimeout(a),a=setTimeout(function(){var a=$("#sidebar-search").val();a!==c.get("term")&&c.set("term",a),""===a&&$("#sidebar-search-cancel").css("display","none")},250)}),$("#sidebar-search-cancel").on("click",function(){$("#sidebar-search").val(""),b.revertSidebar()})},revertSidebar:function(){$("#sidebar-search-cancel").css("display","none");var a=this.model.get("history"),b=this.model.get("collections");a.revert(),b.revert()}}),SearchState=Backbone.Model.extend({defaults:function(){return{term:"",history:null,collections:null}},initialize:function(){this.on("change:term",this.onChangeSearchTerm,this)},onChangeSearchTerm:function(){this.filterSidebar(this.get("term"))},filterSidebar:function(a){var b=this.get("history"),c=this.get("collections");""===a?(b.revert(),c.revert()):(b.filter(a),c.filter(a))}}),Sidebar=Backbone.View.extend({initialize:function(){var a=this.model.get("history"),b=this.model.get("collections"),c=(new HistorySidebar({model:a}),new CollectionSidebar({model:b}),this);c.searchState=new SearchState({history:this.model.get("history"),collections:this.model.get("collections")});var d=(new SearchForm({model:c.searchState}),pm.settings.getSetting("activeSidebarSection"));$("#sidebar-toggle").on("click",function(){c.toggleSidebar()}),this.model.set("width",$("#sidebar").width()+10),this.select(d?d:"history"),$("#sidebar-selectors li").click(function(){var a=$(this).attr("data-id");c.select(a)}),pm.mediator.on("hideSidebar",this.hideSidebar,this),pm.mediator.on("showSidebar",this.showSidebar,this),a.on("loadRequest",this.onLoadHistoryRequest,this),b.on("addCollectionRequest",this.onAddCollectionRequest,this),a.on("historyRequestAdded",this.onHistoryRequestAdded,this)},hideSidebar:function(){$("#sidebar").css("display","none"),$("#sidebar-filler").css("display","none"),$("#sidebar-toggle").css("display","none"),$("#sidebar-search-container").css("display","none")},showSidebar:function(){$("#sidebar").css("display","block"),$("#sidebar-filler").css("display","block"),$("#sidebar-toggle").css("display","block"),$("#sidebar-search-container").css("display","block")},onHistoryRequestAdded:function(){this.searchState.trigger("change:term")},onLoadHistoryRequest:function(){$(".sidebar-collection-request").removeClass("sidebar-collection-request-active")},onAddCollectionRequest:function(){this.select("collections")},minimizeSidebar:function(){var a=this.model;a.set("width",$("#sidebar").width());var b=a.get("animationDuration");$("#sidebar-toggle").animate({left:"0"},b,function(){pm.mediator.trigger("sidebarResize",{sidebarWidth:0,sidebarOuterWidth:$("#sidebar-toggle").width()})}),$("#sidebar").animate({width:"0px",marginLeft:"-10px"},b),$("#sidebar-filler").animate({width:"0px",marginLeft:"-10px"},b),$("#sidebar-search-container").css("display","none"),$("#sidebar div").animate({opacity:0},b);var c=$(document).width();$("#main").animate({width:c+"px","margin-left":"5px"},b),$("#sidebar-toggle img").attr("src","img/tri_arrow_right.png")},maximizeSidebar:function(){var a=this.model,b=a.get("animationDuration"),c=a.get("width");$("#sidebar-toggle").animate({left:"350px"},b,function(){pm.mediator.trigger("sidebarResize",{sidebarWidth:c+10,sidebarOuterWidth:c+$("#sidebar-toggle").width()+10})}),$("#sidebar").animate({width:c+"px",marginLeft:"0px"},b),$("#sidebar-filler").animate({width:c+"px",marginLeft:"0px"},b),$("#sidebar-search-container").fadeIn(b),$("#sidebar div").animate({opacity:1},b),$("#sidebar-toggle img").attr("src","img/tri_arrow_left.png");var d=$(document).width()-c-10,e=c+10;$("#main").animate({width:d+"px","margin-left":e+"px"},b)},toggleSidebar:function(){var a=this.model,b=a.get("isSidebarMaximized");b?this.minimizeSidebar():this.maximizeSidebar(),a.set("isSidebarMaximized",!b)},select:function(a){var b=this.model.get("currentSection");$("#sidebar-selectors li").removeClass("active"),$("#sidebar-selectors-"+a).addClass("active"),pm.settings.setSetting("activeSidebarSection",a),$("#sidebar-section-"+b).css("display","none"),$("#"+b+"-options").css("display","none"),this.model.set("currentSection",a),$("#sidebar-section-"+a).css("display","block"),$("#"+a+"-options").css("display","block")}}),SidebarState=Backbone.Model.extend({defaults:function(){return{currentSection:"history",isSidebarMaximized:!0,sections:["history","collections"],width:0,animationDuration:250,history:null,collections:null}},initialize:function(){}}),LocalChanges=Backbone.Model.extend({defaults:function(){return{unsyncedChanges:[],syncEnabled:!0}},initialize:function(){pm.mediator.on("setSync",this.setSync,this),this.serverChangesReadyToBeSaved=new PriorityQueue({comparator:function(a,b){return a.revision-b.revision}}),pm.mediator.on("addUnsyncedChange",this.onAddUnsyncedChange,this),pm.mediator.on("resolveConflicts",this.onResolveConflicts,this),pm.mediator.on("singleUnsyncedChangeSynced",this.onUnsyncedChangeSynced,this),pm.mediator.on("conflictsResolved",this.onConflictsResolved,this),pm.mediator.on("commitTransaction",this.onCommitTransaction,this),pm.mediator.on("singleClientChangeSent",this.onSingleClientChangeSent,this),pm.mediator.on("deleteSyncedData",this.deleteSyncedData,this),pm.mediator.on("checkForUnsyncedChangesBeforeLogout",this.onCheckForUnsyncedChangesBeforeLogout,this),pm.mediator.on("deleteUnsyncedData",this.onDeleteUnsyncedData,this),pm.mediator.on("syncAllObjects",this.syncAllObjects,this),pm.mediator.on("syncAllRequestsFix",this.syncAllRequestsFix,this),this.syncEnabled=this.get("syncEnabled"),this.loadUnsyncedChanges()},setSync:function(a){this.syncEnabled=a},onDeleteUnsyncedData:function(){pm.indexedDB.clearUnsyncedChanges()},onCheckForUnsyncedChangesBeforeLogout:function(){var a=this.get("unsyncedChanges");a&&a.length>0&&pm.mediator.trigger("showUnsyncedDeletetionModal")},deleteSyncedData:function(){pm.indexedDB.clearUnsyncedChanges(),this.set("unsyncedChanges",[]),pm.indexedDB.deleteAllCollections(function(){pm.collections.reset()}),pm.indexedDB.deleteEachCollectionRequest(),pm.indexedDB.environments.deleteAllEnvironments(function(){pm.environments.reset()}),pm.indexedDB.deleteAllHistoryRequests(function(){pm.history.reset()}),pm.indexedDB.subscriptions.deleteAllSubscriptions(function(){pm.subscriptionManger.clearSubscriptions()}),pm.indexedDB.headerPresets.deleteAllHeaderPresets(function(){pm.headerPresets.reset()});var a={globals:JSON.stringify([])};pm.storage.setValue(a,function(){pm.globals.set({globals:[]}),pm.appWindow.trigger("sendMessageObject","updatedGlobals",[])}),pm.indexedDB.deleteAllSince(function(){}),pm.mediator.trigger("clearSystemValues")},loadUnsyncedChanges:function(){if(this.syncEnabled){var a=this;pm.syncLogger.log(new Error,"Loading unsynced changes from DB..."),pm.indexedDB.getUnsyncedChanges(function(b){pm.syncLogger.log(new Error,"DB returned "+b.length+" changes."),a.set("unsyncedChanges",b)})}},onUnsyncedChangeSynced:function(a,b){if(a===!0);else{for(var c=this.get("unsyncedChanges"),d=0,e=0;e<c.length;e++)if(c[e].stream===b){d=e;break}var f=c.splice(d,1)[0];if(!f)return this.set("unsyncedChanges",c),void pm.mediator.trigger("syncClientChanges",c,b);var g=this;pm.indexedDB.deleteUnsyncedChange(f.id,function(){g.set("unsyncedChanges",c),pm.mediator.trigger("syncClientChanges",c,b)})}},onCommitTransaction:function(a){this.syncEnabled&&pm.syncManager.get("loggedIn")===!0&&pm.syncManager.get("allClientChangesSynced")===!0&&pm.mediator.trigger("syncClientChanges",this.get("unsyncedChanges"),a)},getUnsyncedChangeId:function(a,b,c,d){var e;return e="transfer"===b||"unsubscribe"===b?a+":"+d:a+":"+c.id,"user"===a&&(e="user:NOID"),"transfer"===b&&(e+=":transfer",c.id=d),"unsubscribe"===b&&(e+=":unsubscribe",c.id=d),e},onAddUnsyncedChange:function(a,b,c,d,e){var f=(new Date).getTime(),g=this.getUnsyncedChangeId(a,b,c,d);"transfer"===b&&(c.id=d),"unsubscribe"===b&&(c.id=d);var h=guid();"collection"===a?h=c.id:c.hasOwnProperty("collection")&&(h=c.collection);var i={id:g,entity:a,verb:b,data:c,timestamp:f,stream:h,sentOnce:e},j=this.get("unsyncedChanges"),k=this;if("transfer"==b&&-2==this._checkForTransferAfterCreate(g,c))return void pm.syncLogger.log(new Error,"Transfer merged with create...no further action required");"destroy"==b&&-2==this._checkForDeleteAfterTransfer(g,c)&&pm.syncLogger.log(new Error,"Delete after transfer. Transfer change deleted...the delete change will be added now");var l=this._findIndex(j,function(a){return void 0!=a&&a.id===g});if(-1==l){var m=i;j.push(m),k.set("unsyncedChanges",j),pm.indexedDB.addUnsyncedChange(m,function(){})}else{var n=j[l],o=this._getNewVerbAndResolveConflicts(b,n.verb,g,j,n,i);if(-1==o)return void pm.syncLogger.log(new Error,"Changeset deleted");_.extend(n.data,i.data),n.verb=o,j[l]=n,i.data=n.data,i.verb=n.verb,i.sentOnce=n.sentOnce||e;var m=i;k.set("unsyncedChanges",j),pm.indexedDB.updateUnsyncedChange(m,function(){})}},_checkForTransferAfterCreate:function(a,b){var c=a.split(":"),d=this.get("unsyncedChanges"),e=this;c.pop();var f=c.join(":"),g=this._findIndex(d,function(a){return void 0!=a&&"create"==a.verb&&a.id===f});if(-1!==g){var h=d[g],i={},j=(new Date).getTime();"collection"==b.to.model?i.collection=b.to.model_id:"folder"==b.to.model?i.folder=b.to.model_id:pm.syncLogger.error("Fatal Error: has to transfer to a collection or folder. Tried to transfer to: "+b.to.model),_.extend(h.data,i);var k={id:f,entity:"request",verb:"create",data:h.data,timestamp:j};return pm.indexedDB.updateUnsyncedChange(k,function(){d[g]=h,e.set("unsyncedChanges",d)}),-2}},_checkForDeleteAfterTransfer:function(a){var b=a+":transfer",c=this.get("unsyncedChanges"),d=this,e=this._findIndex(c,function(a){return void 0!=a&&"transfer"==a.verb&&a.id===b});if(-1!=e){{c[e]}return pm.indexedDB.deleteUnsyncedChange(b,function(){c.splice(e,1),d.set("unsyncedChanges",c)}),-2}},_findIndex:function(a,b){for(var c,d,e=a.length,c=0;e>c;c++)if(d=a[c],b(d))return parseInt(c);return-1},_getNewVerbAndResolveConflicts:function(a,b,c,d,e){var f=this;if("create"===a){{Math.ceil(1e3*Math.random())}return pm.syncLogger.error("Object already exists - merging creates"),"create"}if("destroy"===a){if("create"===b)return pm.indexedDB.deleteUnsyncedChange(c,function(){d=_.without(d,_.findWhere(d,{id:c}));var a=-1===c.indexOf(":")?c:c.split(":")[1];if("collection"===e.entity)for(var b=0;b<d.length;b++)d[b].data.collection===a&&(pm.indexedDB.deleteUnsyncedChange(d[b].id),d.splice(b,1),b--);else if("folder"===e.entity)for(var b=0;b<d.length;b++)d[b].data.folder===a&&(pm.indexedDB.deleteUnsyncedChange(d[b].id),d.splice(b,1),b--);f.set("unsyncedChanges",d)}),-1;if("update"===b||"transfer"===b)return a}if("update"===a){if("create"===b)return"create";if("update"===b)return"update";if("destroy"===b)return void pm.syncLogger.error("Fatal Error: Cannot update deleted object")}return"transfer"===a?"transfer"!==b?void pm.syncLogger.error("FATAL error - One transfer, and one create/update entry cannot have the same id"):a:void 0},onResolveConflicts:function(a){if(this.syncEnabled){if(0===a.length)return void pm.mediator.trigger("syncClientChanges",this.get("unsyncedChanges"),null);for(var b,c=!1;0!==a.length&&(b=a.dequeue());){pm.syncLogger.log(new Error,"Server change to process: "),pm.syncLogger.log(new Error,b),"user"===b.meta.model&&(b.model_id="NOID");var d=b.meta.model+":"+b.model_id;"transfer"===b.meta.action&&(d+=":transfer");var e=this._findConflictingLocalChange(d);if(null===e)pm.syncLogger.log(new Error,"No conflict for this server change - adding change to processable changes"),this.serverChangesReadyToBeSaved.queue(b);else{var f=this._getConflictRows(e,b);if(null!==f&&f.length>0){c=!0;{this._addConflictRows(f)}}}}c?pm.conflictResolverModal.showModal():this._saveProcessedServerChange()}},_findConflictingLocalChange:function(a){for(var b=this.get("unsyncedChanges"),c=b.length,d=0;c>d;d++)if(b[d].id===a)return b[d];return null},_getConflictRows:function(a,b){pm.syncLogger.log(new Error,"Getting conflictRow for: localChange="),pm.syncLogger.log(new Error,a),pm.syncLogger.log(new Error," and remoteChange="),pm.syncLogger.log(new Error,b);var c,d,e=a.id.split(":"),f=e[0],g=e[1],h=b.data.name;null==h&&(h=b.data.id);var i=a.data.name;null==i&&(i=a.data.id);var j=[],k={};if(k.localChange=_.cloneDeep(a),k.remoteChange=_.cloneDeep(b),k.model=f,k.model_id=g,k.nameOrId=i,k.id=g,k.conflictId=a.id,k.key="",k.revision=b.revision,k.showRow=!0,"destroy"===a.verb&&"destroy"===b.action)return this.deleteUnsyncedChange(a.id),null;if("create"===a.verb&&"create"===b.action){c="Created",d="Created";var l=_.clone(k);l.localAction=c,l.remoteAction=d;var m=a.data,n=.001,o=!1;for(var p in m)if(m.hasOwnProperty(p))if(l.showRow=!0,"owner"===p)l.key=p,l.revision=b.revision+n,l.showRow=!1,j.push(_.clone(l));else if("folder"===f&&"collection"===p)l.key=p,l.revision=b.revision+n,l.showRow=!1,j.push(_.clone(l));else if(b.data[p]!==m[p]&&!arraysEqual(b.data[p],m[p])){o=!0,l.key=p,l.serverValue="Set to: "+b.data[p],l.localValue="Set to: "+m[p],l.revision=b.revision+n,n+=.001,"globals"===p&&"user"===f&&this._setGlobalConflictMessage(l,m.globals,b.data.globals);for(var q in l.localChange.data)"id"===q||q===p||"folder"==f&&"collection"===q||(delete l.localChange.data[q],delete l.remoteChange.data[q]);j.push(_.clone(l))}if(o===!1)return null}if("update"===a.verb&&"update"===b.action){c="Updated",d="Updated";var m=_.cloneDeep(a.data),r=[];for(var s in m)m.hasOwnProperty(s)&&r.push(s);for(var t=r.length,n=.001,u=0;t>u;u++){var l=_.cloneDeep(k);l.localAction=c,l.remoteAction=d;var p=r[u];if(m.hasOwnProperty(p)){if("time"===p||"timestamp"===p)continue;if(l.showRow=!0,"owner"===p)l.key=p,l.revision=b.revision+n,l.showRow=!1,j.push(_.clone(l));else if("folder"===f&&"collection"===p)l.key=p,l.revision=b.revision+n,l.showRow=!1,j.push(_.clone(l));else if(b.data[p]!==m[p]&&!arraysEqual(b.data[p],m[p])){l.key=p;var v=m[p];"object"==typeof v&&(v=JSON.stringify(v).replace(/":"/g,'": "').replace(/","/g,'", "'));var w=b.data[p];"object"==typeof w&&(w=JSON.stringify(w).replace(/":"/g,'": "').replace(/","/g,'", "')),l.serverValue="Updated to: "+w,l.localValue="Updated to: "+v,l.revision=b.revision+n,n+=.001,"globals"===p&&"user"===f&&this._setGlobalConflictMessage(l,m.globals,b.data.globals);for(var q in l.localChange.data)"id"===q||q===p||"folder"==f&&"collection"===q||(delete l.localChange.data[q],delete l.remoteChange.data[q]);j.push(_.clone(l))}}}}else if("destroy"===a.verb&&"update"===b.action){c="Deleted",d="Updated";var l=_.clone(k);l.localAction=c,l.serverValue="Updated to: "+b.data,l.localValue="Deleted",l.remoteAction=d,j.push(l)}else if("update"===a.verb&&"destroy"===b.action){c="Updated",d="Deleted";var l=_.clone(k);l.localAction=c,l.remoteAction=d,l.serverValue="Deleted",l.localValue="Updated to: "+a.data,j.push(l)}else if("transfer"===a.verb&&"transfer"===b.action){c="Moved",d="Moved";var l=_.clone(k);l.key="Destination",l.localAction=c,l.remoteAction=d,l.serverValue="Moved to: "+b.data.to.model+":"+b.data.to.model_id,l.localValue="Moved to: "+a.data.to.model+":"+a.data.to.model_id,j.push(l)}return pm.syncLogger.log(new Error,["Conflict row generated: ",j]),j},_updateUnsyncedChange:function(a,b){pm.syncLogger.log(new Error,["Updating changeId: ",a," with change: ",b]);for(var c=this.get("unsyncedChanges"),d=c.length,e=0;d>e;e++)c[e].id===a&&(c[e]=b,this.set("unsyncedChanges",c));return 0},deleteUnsyncedChange:function(a){for(var b=this.get("unsyncedChanges"),c=b.length,d=0;c>d;d++)if(b[d].id===a)return pm.syncLogger.log(new Error,"Deleting change with changeId: "+a),b.splice(d,1),this.set("unsyncedChanges",b),a;return-1},_getJsonStringFromGlobal:function(a){for(var b=a.length,c=[],d=0;b>d;d++){var e={};e[a[d].key]=a[d].value,c.push(e)}return c},_setGlobalConflictMessage:function(a,b,c){var d="Updated to "+JSON.stringify(this._getJsonStringFromGlobal(b),null,2),e="Updated to "+JSON.stringify(this._getJsonStringFromGlobal(c),null,2);a.serverValue=e,a.localValue=d},_addConflictRows:function(a){for(var b=a.length,c=0;b>c;c++)pm.conflictResolverModal.addRow(a[c])},_saveProcessedServerChange:function(){if(0===this.serverChangesReadyToBeSaved.length)return void pm.mediator.trigger("syncClientChanges",this.get("unsyncedChanges"),null);var a=this.serverChangesReadyToBeSaved.dequeue();this._saveServerChange(a,_.bind(this._saveProcessedServerChange,this))},_saveServerChange:function(a,b){if(this.syncEnabled){{var c=(a.meta.model,a.model_id,a.meta.action);a.data}pm.syncManager.executeOrAddFunctionToQueue(function(){a.model=a.meta.model,a.action=a.meta.action,pm.mediator.trigger("syncChangeReceived",c,a,b)})}},_syncFirstClientChange:function(){if(this.syncEnabled){pm.syncLogger.log(new Error,"Syncing client change to sever...");var a=this.get("unsyncedChanges");if(0===a.length)return pm.syncLogger.log(new Error,"All client side changes have been resolved and synced"),this.set("allClientChangesSynced",!0),void(pm.syncManager.get("loggedIn")===!0&&(this.set("syncFinished",!0),this.trigger("syncFinished")));pm.syncLogger.log(new Error,"Change so sync: "),pm.syncLogger.log(new Error,b);var b=a[0],c=b.verb,d=b.entity,e=b.data,f=b.meta;"transfer"===c&&e&&null!=e.id&&(f=e.id),this._syncClientChangeToServer(c,d,e,f,!1)
}},onConflictsResolved:function(a){var b=a.length;pm.syncLogger.log(new Error,"Resolving "+b+" conflicts...");for(var c=0;b>c;c++){var d=$(a[c]),e=(d.attr("data-model"),d.attr("data-model-id")),f=d.attr("data-key"),g=d.attr("value"),h=d.data("change"),i=d.attr("data-remote-action"),j=d.attr("data-local-action"),k=d.attr("data-conflict-id");if("Updated"===i&&"Updated"===j){var l={};l.id=e,l[f]=g,"local"===d.attr("data-which-change")?(this._updateUnsyncedChange(k,h),pm.indexedDB.updateUnsyncedChange(h)):(this.serverChangesReadyToBeSaved.queue(h),this.deleteUnsyncedChange(k)&&pm.indexedDB.deleteUnsyncedChange(k))}else"Created"===i&&"Created"===j?"local"===d.attr("data-which-change")?(h.verb="update",this._updateUnsyncedChange(k,h),pm.indexedDB.updateUnsyncedChange(h)):(h.action="update",this.serverChangesReadyToBeSaved.queue(h),this.deleteUnsyncedChange(k)&&pm.indexedDB.deleteUnsyncedChange(k)):"Deleted"===i&&"Updated"===j?"local"===d.attr("data-which-change")?(h.verb="create",this._updateUnsyncedChange(k,h),pm.indexedDB.updateUnsyncedChange(h)):(this.serverChangesReadyToBeSaved.queue(h),this.deleteUnsyncedChange(k)&&pm.indexedDB.deleteUnsyncedChange(k)):"Updated"===i&&"Deleted"===j?"local"===d.attr("data-which-change")||(this.serverChangesReadyToBeSaved.queue(h),this.deleteUnsyncedChange(k)&&pm.indexedDB.deleteUnsyncedChange(k)):"Moved"===i&&"Moved"===j?"local"===d.attr("data-which-change")?(this._updateUnsyncedChange(k,h),pm.indexedDB.updateUnsyncedChange(h)):(this.serverChangesReadyToBeSaved.queue(h),this.deleteUnsyncedChange(k)&&pm.indexedDB.deleteUnsyncedChange(k)):pm.syncLogger.log(new Error,"ERROR")}pm.conflictResolverModal.clearTable(),this._saveProcessedServerChange()},syncAllRequestsFix:function(){if(this.syncEnabled){var a=pm.collections.getAllCollections(),b=_.flatten(a.map(function(a){return a.get("requests")}));b.map(function(a){pm.syncManager.addChangeset("request","create",a,null,!0)})}},syncAllObjects:function(){if(this.syncEnabled){var a=pm.collections.getAllCollections(),b=a.map(function(a){return a.getAsJSON()}),c=_.flatten(a.map(function(a){return a.get("folders")})),d=_.flatten(a.map(function(a){return a.get("requests")})),e=_.flatten(d.map(function(a){return _.map(a.responses,function(b){b.collectionId=a.collectionId,b.requestId=a.id,b.owner=a.owner}),a.responses})),f=pm.environments.models,g=f.map(function(a){return a.toJSON()}),h=pm.headerPresets.models,i=h.map(function(a){return a.toJSON()}),j=[];b.map(function(a){pm.syncManager.addChangeset("collection","create",a,null,!0),j.push(a.id)}),c.map(function(a){pm.syncManager.addChangeset("folder","create",a,null,!0)}),d.map(function(a){pm.syncManager.addChangeset("request","create",a,null,!0)}),g.map(function(a){a&&a.id&&pm.syncManager.addChangeset("environment","create",a,null,!0)}),e.map(function(a){a&&a.hasOwnProperty("request")&&(a.requestObject=JSON.stringify(a.request),a.request=a.requestId,a.collection=a.collectionId,a.collectonId=a.collectionId,a.owner=request.owner,pm.syncManager.addChangeset("response","create",a,null,!0))}),i.map(function(a){pm.syncManager.addChangeset("headerpreset","create",a,null,!0)}),setTimeout(function(){pm.storage.getValue("globals",function(a){var b={globals:JSON.parse(a)};pm.syncManager.addChangeset("user","update",b,null,!0)})},4e3),pm.syncLogger.error("Synced all objects including "+b.length+" collections. Ids = "+JSON.stringify(j)),console.log(pm.syncLogger.getLogDate()+" - All data exported")}}}),SubscriptionHandler=Backbone.Model.extend({initialize:function(){this.loadSubscriptions(),this.subscribedTo=[],pm.mediator.on("syncChangeReceived",this.onSyncChangeReceived,this),pm.mediator.on("unsubscribeFromCollection",this.unsubscribeFromCollectionWithOptSync,this)},isSubscribedTo:function(a){return-1===this.subscribedTo.indexOf(a)?!1:!0},clearSubscriptions:function(){this.subscribedTo=[]},loadSubscriptions:function(){var a=this;pm.indexedDB.subscriptions.getAllSubscriptions(function(b){_.map(b,function(b){a.subscribedTo.push(b.id)})})},onSyncChangeReceived:function(a,b,c){if("subscribe"===a||"unsubscribe"===a){var d=pm.user.get("organizations");if(d&&!(d.length<=0)){var e=this;"subscribe"===a?b.data&&b.data.hasOwnProperty("user")?"function"==typeof c&&c():this.subscribeToCollectionWithOptSync(b,!1,function(a){a!==!0&&(e.getFoldersForObject(b.data,b.data.owner),e.getRequestsForObject(b.data,b.data.owner,b.data.id,"collection")),"function"==typeof c&&c()}):"unsubscribe"===a&&(b.data&&b.data.hasOwnProperty("user")?"function"==typeof c&&c():this.unsubscribeFromCollectionWithOptSync(b,!1,function(){"function"==typeof c&&c()}))}}},unsubscribeFromCollectionWithOptSync:function(a,b,c){var d=a.model_id||a.data.id,e=this;this.isSubscribedTo(d)?pm.indexedDB.subscriptions.deleteSubscription(d,function(){b&&pm.syncManager.addChangeset("collection","unsubscribe",{owner:a.owner},a.model_id,!0);var f=e.subscribedTo.indexOf(d);-1!==f&&e.subscribedTo.splice(f,1);pm.collections.deleteCollectionFromDataStoreWithOptSync(a.model_id,!0,!1,function(){});"function"==typeof c&&c()}):(console.log(pm.syncLogger.getLogDate()+" - Cannot unsubscribe - you are not subscribed to the collection with id: "+d),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("syncOperationDone"),"function"==typeof c&&c()),pm.syncManager.updateSinceFromMessage(a)},subscribeToCollectionWithOptSync:function(a,b,c){var d=a.data,e=this,f={id:d.id,userId:d.owner,collectionId:d.id};if(this.isSubscribedTo(f.id))return console.log(pm.syncLogger.getLogDate()+" - Already subscribed to collection with id: "+f.id),pm.mediator.trigger("databaseOperationComplete"),pm.mediator.trigger("syncOperationDone"),"function"==typeof c&&c(!0),void pm.syncManager.updateSinceFromMessage(a);var g=pm.indexedDB.subscriptions.addSubscription(f,function(a){var f={id:d.id,name:d.name,description:d.description,owner:d.owner,order:d.order||[],write:d.write,subscribed:!0,justSubscribed:!0};pm.collections.addFullCollection(f,!0,c),b&&pm.syncManager.addChangeset("collection","subscribe",{owner:d.owner},d.id,!0),pm.mediator.trigger("addedSubscription"),e.subscribedTo.push(a.id)});-1==g?pm.mediator.trigger("syncOperationFailed","Adding db subscription failed"):pm.syncManager.updateSinceFromMessage(a)},getFoldersForObject:function(a,b){var c=a.folders_ids,d=this;c?_.map(c,function(a){pm.syncManager.getEntityFromId("folder",a,b,null,function(c){-1!==d.subscribedTo.indexOf(c.collection)&&(pm.collections.addFolderFromRemote(c,null),c.folders_ids&&d.getFoldersForObject(c,b),d.getRequestsForObject(c,b,a,"folder"))})}):pm.syncManager.getEntityForCollection("folder",b,a.id,function(a){_.map(a,function(a){-1!==d.subscribedTo.indexOf(a.collection)&&(pm.collections.addFolderFromRemote(a,null),a.folders_ids&&d.getFoldersForObject(a,b),d.getRequestsForObject(a,b,a.id,"folder"))})})},getRequestsForObject:function(a,b,c,d){var e=this,f=0;_.map(a.order,function(g){pm.syncManager.getEntityFromId("request",g,b,a,function(g){-1!==e.subscribedTo.indexOf(g.collection)&&(g.collectionId=g.collection,"raw"===g.dataMode&&g.rawModeData&&(g.data=g.rawModeData,delete g.rawModeData),pm.collections.addFullCollectionRequest(g,null),e.getResponsesForRequest(g.id,b),f++,f===a.order.length&&setTimeout(function(a,b,c){return function(){pm.collections.trigger("sortRequestContainer",a,b,c)}}(d,c,a.order),1e3))})})},getResponsesForRequest:function(a,b){pm.syncSocket.get("/"+postman_sync_api_version+"/response?request="+a+"&owner="+b,function(b){b.error&&b.error.message||0!=b.length&&pm.collections.addResponsesToCollectionRequestWithoutSync(a,b,function(){})})}}),SyncLogger=Backbone.Model.extend({log:function(a,b){if(this.logging){var c=this.getLogDate();if(b instanceof Array){var d=b.length;console.groupCollapsed(c+" - "+b.join(" - ")),console.dir(c+" - "+a.stack);for(var e=0;d>e;e++)console.log(c+" - "+b[e]);console.groupEnd()}else console.groupCollapsed(c+" - "+b),console.dir(c+" - "+a.stack),console.groupEnd()}},error:function(a,b,c,d,e){var f=pm.settings.getSetting("installation_id"),g=pm.user.id,h=pm.user.get("access_token"),i=new Date,j=chrome.runtime.getManifest().version;pm.syncManager.syncEnabled&&pm.api.postErrorToServer(a||"",b,c+"",d+"",""|e,f,g,i,j,h),console.error(this.getLogDate()+" - "+a)},errorForce:function(a,b,c,d,e){var f=pm.settings.getSetting("installation_id"),g=pm.user.id,h=pm.user.get("access_token"),i=new Date,j=chrome.runtime.getManifest().version;pm.api.postErrorToServer("Uncaught - "+a||"Uncaught - ",b,c+"",d+"",""|e,f,g,i,j,h),console.error(this.getLogDate()+" - "+a)},initialize:function(){window.onerror=function(a,b,c,d,e){return pm.syncLogger.errorForce(a,b,c,d,e.stack),!1},this.logging=!1},getLogDate:function(){var a=new Date;return a.getHours()+":"+a.getMinutes()+":"+a.getMinutes()+"."+a.getMilliseconds()}}),SyncManagerNew=Backbone.Model.extend({defaults:function(){return{unsyncedChanges:[],syncConflicts:null,loggedIn:!1,socketConnected:!1,sinceId:0,syncFinished:!1,finishedLoading:{environments:!1,collections:!1,history:!1,globals:!1},connectingToSocket:!1,syncEnabled:!1}},initialize:function(){window.hasOwnProperty("TestRunApp")||(pm.mediator.on("setSync",this.setSync,this),this.showServerErrors=!1,this.sentChanges=[],this.retrySentChangesInterval=null,this.lastKeyTried=null,this.lastKeyCount=0,this.serverChanges=new PriorityQueue({comparator:function(a,b){return a.revision-b.revision}}),this.clientChangesReadyToBeSent=[],this.set("loginAttempts",0),pm.mediator.on("databaseOperationComplete",function(){if(pm.syncLogger.log(new Error,"Database operation complete...checking for next item in sync queue"),0===pm.syncQueue.length)return void pm.syncLogger.log(new Error,"Sync queue is empty");if(pm.syncQueue.shift(),0===pm.syncQueue.length)return void pm.syncLogger.log(new Error,"Sync queue had one operation, which was already completed");pm.syncLogger.log(new Error,"Executing next function...");var a=pm.syncQueue[0];a()}),pm.mediator.on("syncOperationDone",function(){}),pm.mediator.on("syncOperationFailed",function(a){if(pm.syncLogger.error("Sync Operation Failed. Reason: "+JSON.stringify(a)),0!==pm.syncQueue.length){{pm.syncQueue.shift()}if(0!==pm.syncQueue.length){var b=pm.syncQueue[0];b()}}}),pm.mediator.on("syncClientChanges",this.onSyncClientChanges,this),pm.mediator.on("clearSystemValues",this.onClearSystemValues,this),this.on("itemLoaded",this.itemLoaded,this),this.on("singleSyncDone",this._syncFirstClientChange,this),this.updateSince(),this.set("loggedIn",!1),this.set("finalRevisionNumber",-1),this.set("csrfToken",""),this.createSocket(),this.set("allClientChangesSynced",!1))},setSync:function(a){this.syncEnabled=a,1==a&&this.signIn()},onClearSystemValues:function(){this.set("since",{own:0}),this.set("lastTimestamp",null),pm.indexedDB.deleteAllSyncValues(function(){})},itemLoaded:function(a){var b=this.get("finishedLoading");b[a]=!0,this.set("finishedLoading",b),this.signIn()},hasDatabaseLoaded:function(){var a=this.get("finishedLoading");for(var b in a)if(a.hasOwnProperty(b)&&a[b]===!1)return!1;return!0},createSocket:function(){this.syncEnabled&&(pm.syncLogger.log(new Error,"Trying to connect to socket: "+postman_syncserver_url),pm.syncSocket=io.connect(postman_syncserver_url),this.set("connectingToSocket",!0),this.attachListeners())},signIn:function(){if(!this.syncEnabled)return void pm.syncLogger.log(new Error,"Sync is not enabled...cannot proceed with sign in");if(pm.isTesting!==!0||pm.hasStartedSyncTest===!0){if(pm.syncLogger.log(new Error,"Attempting to sign in..."),this.get("loggedIn")===!0)return void pm.syncLogger.log(new Error,"The user is already logged in to anakin...cannot sign in again");if(pm.user.isLoggedIn()===!1&&pm.isTesting===!1)return void pm.syncLogger.log(new Error,"The user isn't logged in to Postman...cannot sign in to anakin");if(this.hasDatabaseLoaded()===!1)return void pm.syncLogger.log(new Error,"Database hasn't loaded yet...cannot sign in to anakin");if(null==pm.syncSocket)return pm.syncLogger.log(new Error,"Socket doesn't exist - will try after connection is established"),void this.createSocket();if(this.get("socketConnected")===!1)return pm.syncLogger.log(new Error,"Socket connection is not established yet...you will be signed in to sync as soon as the socket is connected"),void(this.get("connectingToSocket")===!1&&null===pm.syncSocket?this.createSocket():this.get("connectingToSocket")===!1&&pm.syncSocket.socket.reconnect());if(this.get("loggingIn")===!0)return void pm.syncLogger.log(new Error,"Sync login is already in progress");var a=this,b=pm.isTesting===!0?"test":"1",c=pm.isTesting===!0?"test":"xyz",d="local"===postman_env?b:pm.user.id,e="local"===postman_env?c:pm.user.get("access_token");this.set("loggingIn",!0),setTimeout(function(){if(pm.syncManager.get("loggingIn")&&!pm.syncManager.get("loggedIn")){var b=a.get("loginAttempts");if(b>5)return noty({type:"error",text:"Oops. We're having trouble connecting you to the Sync service. Please try after some time",layout:"topCenter",timeout:3050}),void a.set("loginAttempts",0);a.set("loginAttempts",b+1),pm.syncManager.set("loggingIn",!1),pm.syncManager.signIn()}},1e4),pm.syncLogger.log(new Error,"Sending login request with user_id="+d+", access_token="+e),pm.syncSocket.get("/csrfToken",function(b){a.set("csrfToken",b._csrf),pm.syncSocket.post("/"+postman_sync_api_version+"/session/create",{user_id:d,access_token:e,_csrf:b._csrf},function(b){a.set("syncFinished",!1),a.set("loginAttempts",0),b.error?(pm.syncLogger.log(new Error,"Login failure - "+b.error.description),a.set("loggingIn",!1),a.set("loggedIn",!1)):(pm.syncLogger.log(new Error,"Logged in: ..."),pm.syncLogger.log(new Error,b),a.set("loggedIn",!0),a.set("loggingIn",!1),a.checkAllSync(),a.requestInitialSync())})})}},checkAllSync:function(){pm.settings.getSetting("syncedOnce")||(pm.mediator.trigger("syncAllObjects"),pm.settings.setSetting("syncedOnce",!0))},signOut:function(){if(this.syncEnabled){var a=this;return null==pm.syncSocket?(pm.syncLogger.log(new Error,"Socket doesn't exists - cannot sign out"),this.set("loggedIn",!1),void this.set("connectingToSocket",!1)):this.get("connectingToSocket")===!0||this.get("loggedIn")===!1?void pm.syncLogger.log(new Error,"Already connecting, or user isn't loggedIn...cannot sign out"):void pm.syncSocket.get("/"+postman_sync_api_version+"/session/destroy",function(b){pm.syncLogger.log(new Error,"Logged out: "),pm.syncLogger.log(new Error,b),a.set("loggedIn",!1),a.set("socketConnected",!1),a.set("connectingToSocket",!1),a.syncEnabled=!1,pm.syncSocket.disconnect()})}},updateSinceFromMessage:function(a){if(null!=a.revision&&"undefined"!=typeof a.revision){var b=(new Date).getTime();pm.indexedDB.updateSince(a.revision,b,function(){pm.syncLogger.log(new Error,"SinceId updated to "+a.revision+", timestamp updated to "+b),pm.syncManager.set("sinceId",a.revision),pm.syncManager.set("since",{own:a.revision}),pm.syncManager.set("lastTimestamp",b)})}else if("subscribe"===a.action||"unsubscribe"===a.action);else if(a.hasOwnProperty("model_id")&&a.hasOwnProperty("owner"));else if(a.error&&"instanceFoundError"===a.error.name||("CSRF mismatch"===a.error&&pm.syncSocket.get("/csrfToken",function(a){pm.syncManager.set("csrfToken",a._csrf)}),pm.syncLogger.error("Invalid sinceId received. Message: "+JSON.stringify(a)),pm.syncLogger.log(new Error,"Invalid sinceId received. Message: "),pm.syncLogger.log(new Error,a)),a.error&&"instanceNotFoundError"==a.error.name&&a.error.details&&a.error.details.model){var c=a.error.details.model,d="folder"==c||"collection"==c?"If you were working on a request, duplicate the parent folder or collection.":"",e="The "+c+" was not found. Try duplicating it. "+d;pm.syncLogger.error("Notifying the user to duplicate the "+c),pm.syncManager.showServerErrors&&noty({type:"error",text:e,layout:"topCenter",timeout:3050})}else if(pm.syncManager.showServerErrors){var f=a.err&&a.err.error?a.err.error:a.error?a.error.message:"Unknown error";noty({type:"error",text:f,layout:"topCenter",timeout:1050})}},updateSince:function(){var a=this;pm.indexedDB.getSince(function(b){(null==b||"undefined"==typeof b)&&(pm.syncLogger.log(new Error,"sinceId not updated. Obj from db: "),pm.syncLogger.log(new Error,b));var c={};_.map(b,function(a){c[a.id]=a.value}),a.set("since",c),a.set("lastTimestamp",(new Date).getTime())})},requestInitialSync:function(){if(this.syncEnabled){pm.syncLogger.log(new Error,"Making initial since request");var a=this.get("since").own||0,b=this.get("lastTimestamp");this._sendSyncRequest(a,b,4e4,-1)}},_sendSyncRequest:function(a,b,c,d){if(this.syncEnabled){var e={};e.since_id=a,e.since_timestamp=b,e.count=c,e._csrf=this.get("csrfToken"),pm.syncLogger.log(new Error,"Making /sync request with obj: ..."),pm.syncLogger.log(new Error,e);var f=this;pm.syncSocket.post("/"+postman_sync_api_version+"/session/sync",e,function(a){pm.syncLogger.log(new Error,"Sync response received: "),pm.syncLogger.log(new Error,a),f._handleNewSyncResponse(a)})}},_handleNewSyncResponse:function(a){if(pm.syncLogger.log(new Error,"Handling sync response: "),pm.syncLogger.log(new Error,a),a.own){var b=a.own.max_id,c=a.own.last_since_id;if(-1!==c);this.set("finalRevisionNumber",b);var d=_.filter(a.own.entities,function(a){return!("subscribe"===a.action)});d=d.concat(_.map(a.subscribe.entities,function(a){return a.subscribe=!0,a}));for(var e=d.length,f=0,g=0;e>g;g++)d[g].hasOwnProperty("meta")?(this.serverChanges.queue(d[g]),d[g].revision>f&&(f=d[g].revision)):pm.syncLogger.log(new Error,"Server change did not have meta field. "+JSON.stringify(d[g]));this.set("initialSyncComplete",!0),pm.mediator.trigger("resolveConflicts",this.serverChanges)}else console.error("Failure to sync."),noty({type:"error",text:"There was an error while syncing. Please sign out (clear data), and sign back in",layout:"topCenter",timeout:3050}),pm.syncLogger.error("Sync operation returned malformed message (no message.own): "+JSON.stringify(a))},onSyncClientChanges:function(a,b){var c=_.filter(a,function(a){return b&&a.stream!==b?void 0:!0});if(0===c.length)this.trigger("syncFinished"),this.set("allClientChangesSynced",!0);else{var d=c[0];this._syncClientChange(d,b)}},_syncClientChange:function(a,b){if(this.syncEnabled){pm.syncLogger.log(new Error,"Syncing client change to sever..."),pm.syncLogger.log(new Error,"Change so sync: "),pm.syncLogger.log(new Error,a);var c=a.verb,d=a.entity,e=a.data,f=a.meta;if("transfer"===c&&e&&null!=e.id&&(f=e.id),"unsubscribe"===c&&e&&null!=e.id&&(f=e.id),!e.hasOwnProperty("owner")){if(e.hasOwnProperty("collection")){var g=pm.collections.getCollectionById(e.collection);g&&(e.owner=pm.collections.getCollectionById(e.collection).get("owner"))}if("collection"===d){var g=pm.collections.getCollectionById(e.id);g&&(e.owner=pm.collections.getCollectionById(e.id).get("owner"))}if("request"===d){var h=pm.collections.getRequestById(e.id);h&&(e.owner=pm.collections.getRequestById(e.id).owner)}}this._syncClientChangeToServer(c,d,e,f,!1,b,null)}},_getInitSynObject:function(a,b){var c={};c.since_id=a;for(var d=[],e=b.length,f=0;e>f;f++){var g=b[f],h=g.entity,i=g.data.id,j=g.verb,k=g.data;d.push({model:h,model_id:i,action:j,data:k})}return c.client_data=d,c},executeOrAddFunctionToQueue:function(a){if(pm.syncQueue.push(a),1==pm.syncQueue.length){var b=pm.syncQueue.shift();b()}},handleNewMessageFormat:function(a){a.hasOwnProperty("meta")&&(a.model=a.meta.model,a.action=a.meta.action)},attachListeners:function(){if(this.syncEnabled&&null!=pm.syncSocket){pm.syncLogger.log(new Error,"Attaching listeners to socket.");var a=this;pm.syncSocket.on("connect",function(){pm.syncManager.set("connectingToSocket",!1),pm.syncManager.set("socketConnected",!0),pm.syncSocket.on("user",function(){}),pm.syncSocket.on("subscribe",function(b){a.handleNewMessageFormat(b),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","subscribe",b)})}),pm.syncSocket.on("unsubscribe",function(b){a.handleNewMessageFormat(b),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","unsubscribe",b)})}),pm.syncSocket.on("create",function(b){a.handleNewMessageFormat(b),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","create",b)})}),pm.syncSocket.on("update",function(b){a.handleNewMessageFormat(b),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","update",b)})}),pm.syncSocket.on("destroy",function(b){a.handleNewMessageFormat(b),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","destroy",b)})}),pm.syncSocket.on("history",function(b){a.handleNewMessageFormat(b),pm.syncLogger.log(new Error,["History: ",b]),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","history",b)})}),pm.syncSocket.on("transfer",function(b){a.handleNewMessageFormat(b),pm.syncLogger.log(new Error,"Transfer notif received"),null!=b.revision&&pm.syncManager.updateSinceFromMessage(b),pm.syncManager.executeOrAddFunctionToQueue(function(){pm.mediator.trigger("syncChangeReceived","transfer",b)})}),pm.syncSocket.on("disconnect",function(){pm.syncLogger.log(new Error,"Socket is now disconnected!"),a.set("loggedIn",!1)}),pm.user.isLoggedIn()===!0&&pm.syncManager.signIn()})}},_clearClientChangeIfNeeded:function(a,b,c){pm.mediator.trigger("singleUnsyncedChangeSynced",a,b),c()},getEntityFromId:function(a,b,c,d,e){this.syncEnabled&&pm.syncSocket.get("/"+postman_sync_api_version+"/"+a+"/"+b+"?owner="+c,function(a){e(a,d)})},getEntityForCollection:function(a,b,c,d){this.syncEnabled&&pm.syncSocket.get("/"+postman_sync_api_version+"/"+a+"?collection="+c+"&owner="+b,function(a){d(a)})},_handleErrorObject:function(){},handleInstanceNotFound:function(a){a||pm.syncLogger.error("Sobti - No details received for instanceNotFound");var b=!0;switch(a.model){case"collection":b=pm.collections.resyncCollectionId(a.model_id);break;case"folder":b=pm.collections.resyncFolderId(a.model_id);break;case"request":b=pm.collections.resyncRequestId(a.model_id);break;default:pm.syncLogger.error("instanceNotFound recd for model: "+a.model)}return b},_syncClientChangeToServer:function(a,b,c,d,e,f,g){var h=this,i=pm.isTesting===!0?"test":"1",j="local"===postman_env?i:pm.user.id;switch(c&&(c._csrf=this.get("csrfToken")),a){case"share":pm.syncSocket.put("/"+postman_sync_api_version+"/collection/share/"+d,c,function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error"))if("instanceFoundError"===d.error.name);else{if(pm.syncManager._handleErrorObject(d),pm.mediator.trigger("syncErrorReceived","share",d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else pm.syncLogger.error("Error while sending share event to server. Data: "+JSON.stringify(c));"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"unshare":pm.syncSocket.put("/"+postman_sync_api_version+"/collection/unshare/"+d,{_csrf:h.get("csrfToken")},function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error"))if("instanceFoundError"===d.error.name);else{if(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else pm.syncLogger.error("Error while sending unshare event to server. Meta: "+c);"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,d,g));break;case"create":"collection"!==b||c.owner||pm.collections.updateCollectionOwnerWithoutSync(c.id,j);var k="";c.owner&&(k="?owner="+c.owner),pm.syncSocket.post("/"+postman_sync_api_version+"/"+b+k,c,function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error"))if("instanceFoundError"===d.error.name);else{if(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else pm.syncLogger.error("Error while sending create event to server. Data: "+JSON.stringify(c));"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"update":"user"==b&&(c.id=j),pm.syncSocket.put("/"+postman_sync_api_version+"/"+b+"/"+c.id,c,function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error"))if("instanceFoundError"===d.error.name);else{if(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else if("orderUpdateError"===d.error.name)if(c.hasOwnProperty("collection")){var i=c.id;pm.collections.resyncFolderId(i),e=pm.collections.correctFolderOrder(i,d.error.details.order,c.order,c.owner)}else e=pm.collections.correctCollectionOrder(c.id,d.error.details.order,c.order,c.owner);else pm.syncLogger.error("Error while sending update event to server. Data: "+JSON.stringify(c));"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"destroy":var k="?";c.owner&&(k="?owner="+c.owner),pm.syncSocket.delete("/"+postman_sync_api_version+"/"+b+"/"+c.id+k,{_csrf:h.get("csrfToken")},function(a,b,c){return function(d){var e=!0;d.hasOwnProperty("error")&&(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name?e=!0:pm.syncLogger.error("Error while sending destroy event to server. Data: "+JSON.stringify(c)),"CSRF mismatch"===d.error&&(e=!1)),e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"history":pm.syncSocket.post("/"+postman_sync_api_version+"/user/history",c,function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error")){if(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else pm.syncLogger.error("Error while sending history event to server. Data: "+JSON.stringify(c));"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"transfer":pm.syncSocket.put("/"+postman_sync_api_version+"/request/transfer/"+d,c,function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error")){if(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else pm.syncLogger.error("Error while sending transfer event to server. Data: "+JSON.stringify(c));"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"subscribe":pm.syncSocket.put("/"+postman_sync_api_version+"/"+b+"/subscribe/"+d,c,function(a,b,c){return function(d){var e=!0;if(d.hasOwnProperty("error")){if(pm.syncManager._handleErrorObject(d),"instanceNotFoundError"===d.error.name){var f=h.handleInstanceNotFound(d.error.details);e=f===!1?!0:!1}else pm.syncLogger.error("Error while sending subscribe event to server. Data: "+JSON.stringify(c));"CSRF mismatch"===d.error&&(e=!1)}e&&(pm.mediator.trigger("successfulSubscribe",d),pm.syncManager._handleServerResponseAfterSendingClientChange(d,a,b),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;case"unsubscribe":pm.syncSocket.put("/"+postman_sync_api_version+"/"+b+"/unsubscribe/"+d,c,function(a,c,d){return function(e){var f=!0;if(e.hasOwnProperty("error")){if(pm.syncManager._handleErrorObject(e),"instanceNotFoundError"===e.error.name){var i=h.handleInstanceNotFound(e.error.details);f=i===!1?!0:!1}else pm.syncLogger.error("Error while sending unsubscribe event to server. Entity: "+b+", Data: "+JSON.stringify(d));"CSRF mismatch"===e.error&&(f=!1)}f&&(pm.mediator.trigger("successfulUnsubscribe",e),pm.syncManager._handleServerResponseAfterSendingClientChange(e,a,c),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g}))}}(e,f,c,g));break;default:pm.syncLogger.log(new Error,"Invalid action: "+a),pm.syncManager._handleServerResponseAfterSendingClientChange(null,null,f),h.sentChanges=_.reject(h.sentChanges,function(a){return a.key===g})}},_handleServerResponseAfterSendingClientChange:function(a,b,c){pm.syncLogger.log(new Error,["Response after sending data to server: ",a]),pm.syncManager._clearClientChangeIfNeeded(b,c,function(){pm.syncManager.updateSinceFromMessage(a)})},checkSizeOfFields:function(a,b,c){if("response"===a&&"create"===b){if(c.text&&c.text.length>6e4)return noty({type:"warning",text:'Response too large. The response "'+c.name+'" cannot be synced. The maximum length for the response text is 60000 characters',layout:"topCenter",timeout:5e3}),!1}else if("request"===a){if(c.rawModeData&&c.rawModeData.length>6e4)return noty({type:"warning",text:'Request data too large. The request "'+c.name+'" cannot be synced. The maximum length for the raw data is 60000 characters',layout:"topCenter",timeout:5e3}),!1;if(c.preRequestScript&&c.preRequestScript.length>6e4)return noty({type:"warning",text:'Request data too large. The request "'+c.name+'" cannot be synced. The maximum length for the pre-request script is 60000 characters',layout:"topCenter",timeout:5e3}),!1;if(c.tests&&c.tests.length>6e4)return noty({type:"warning",text:'Request data too large. The request "'+c.name+'" cannot be synced. The maximum length for the test script is 60000 characters',layout:"topCenter",timeout:5e3}),!1}return!0},addChangeset:function(a,b,c,d,e){if(this.syncEnabled){var f=_.clone(c);null!=f&&(f.timestamp=new Date(f.timestamp));var g=pm.isTesting===!0?"test":"1",h="local"===postman_env?g:pm.user.id;if(pm.syncLogger.log(new Error,["Changeset recorder - entity:",a," verb:",b," data:",f]),"request"!==a&&"response"!==a||f.owner?"folder"!==a||f.owner?"create"!==b||f.owner||"local"!==postman_env||(f.owner=h):(f.owner=pm.collections.getOwnerForCollection(f.collection_id),f.owner&&"local"!==postman_env||(f.owner=h)):(f.owner=pm.collections.getOwnerForCollection(f.collectionId),f.owner&&"local"!==postman_env||(f.owner=h)),"request"===a&&"raw"===f.dataMode&&"string"==typeof f.data&&(f.rawModeData=f.data,f.data=[]),"response"===a&&"create"===b){for(var i=f.headers?f.headers.length:0,j=0;i>j;j++)f.headers[j].description="";f.responseCode&&f.responseCode.detail&&delete f.responseCode.detail}if("request"===a&&"create"===b&&(f.method||(f.method="GET")),"request"!==a&&"folder"!==a&&"response"!==a||"create"!==b||(f.collection=f.collectionId,delete f.collectionId),"request"===a&&f.hasOwnProperty("helperAttributes")&&"object"==typeof f.helperAttributes&&(f.helperAttributes=JSON.stringify(f.helperAttributes)),"request"===a&&f.hasOwnProperty("folder")&&!f.folder&&delete f.folder,"request"===a&&"create"===b&&f.hasOwnProperty("folderId")&&!f.folder&&(f.folder=f.folderId),this.checkSizeOfFields(a,b,f)===!1)return void console.log("One of the size checks failed. Not syncing");if("folder"!==a||"create"!==b&&"update"!==b||(f.collection=f.collection_id,delete f.collection_id),"collection"===a&&"create"===b&&(f.folders=[]),this.get("loggedIn")===!1||e===!1||this.get("allClientChangesSynced")===!1)null==f&&(f={id:d}),pm.mediator.trigger("addUnsyncedChange",a,b,f,d,!1);else{null==f&&(f={id:d});try{var k=pm.localChanges.getUnsyncedChangeId(a,b,f,d);this.sentChanges.push({key:k,changeset:{entity:a,verb:b,data:f,meta:d}}),clearInterval(this.retrySentChangesInterval);var l=this;this.retrySentChangesInterval=setInterval(function(){l.retrySentChanges()},5e3),this._syncClientChangeToServer(b,a,f,d,!0,null,k)
}catch(m){pm.syncLogger.error("SyncClientChangeToServer threw error. That means the socket wasnt connected properly. Adding to unsynced")}}}},retrySentChanges:function(){if(this.lastKeyCount>3){for(this.sentChanges.length;this.sentChanges.length;){var a=this.sentChanges[0].changeset;pm.mediator.trigger("addUnsyncedChange",a.entity,a.verb,a.data,a.meta,!0),this.sentChanges=this.sentChanges.splice(1)}this.lastKeyCount=0,clearInterval(this.retrySentChangesInterval)}if(this.sentChanges.length>0){var b=this.sentChanges[0].key,a=this.sentChanges[0].changeset;return this.lastKeyTried===b?this.lastKeyCount++:this.lastKeyCount=0,this.lastKeyTried=b,void this._syncClientChangeToServer(a.verb,a.entity,a.data,a.meta,!0,null,b)}clearInterval(this.retrySentChangesInterval)},saveGlobals:function(a){pm.globals.saveGlobals(a,!1)},mergeEntitiesForUpdate:function(a,b){var c={};c.id=a.id,c.owner=a.owner;for(key in b)a[key]!=b[key]&&JSON.stringify(a[key])!=JSON.stringify(b[key])&&(c[key]=a[key]);return c}}),SyncNotif=Backbone.Model.extend({defaults:function(){return{id:"",text:"",timestamp:0}},getAsJSON:function(){return{id:this.get("id"),text:this.get("text"),timestamp:this.get("timestamp")}}}),SyncStatusManager=Backbone.Model.extend({defaults:function(){return{notifs:[]}},initialize:function(){this.loadOldNotifs()},loadOldNotifs:function(){var a=this;pm.indexedDB.getAllSyncNotifs(function(b){var c=_.sortBy(b.value,function(a){return a.timestamp}).reverse();a.set("notifs",c),a.trigger("updateNotifs",c)})},clearNotifs:function(){this.trigger("removeAllNotifs")},addNotification:function(a,b,c){var d=guid(),e=new Date,f=10,g=this.get("notifs");g.length==f&&(g.pop(),this.trigger("removeOldestNotif")),a=this._getProperCasedEntity(a);var h,i=b.name?b.name:b.id?b.id.substring(0,6):"Unknown",j=a+" "+i,k=this._getProperVerb(c);"history"===a&&(j="Request",k.verb="Sent"),b.lastUpdatedBy&&b.lastUpdatedBy.username&&(j+=" by "+b.lastUpdatedBy.username,h=b.lastUpdatedBy.username);var l={id:d,text:j,verb:k.verb,method:k.method,entity:a,entityName:i,user:h,timestamp:e.getTime()};g.unshift(l);var m=this;pm.indexedDB.updateSyncNotifs(g,function(){m.set("notifs",g),m.trigger("notificationAdded",l)})},_getProperCasedEntity:function(a){switch(a){case"collection":return"Collection";case"request":return"Request";case"history":return"History";case"environment":return"Environment";case"response":return"Response";case"folder":return"Folder";default:return"Entity ["+a+"]"}},_getProperVerb:function(a){switch(a){case"create":return{verb:"Added",method:"post"};case"update":return{verb:"Edited",method:"put"};case"destroy":return{verb:"Deleted",method:"delete"};case"transfer":return{verb:"Moved",method:"put"};default:return{verb:"unknown",method:"unknown"}}}}),ConflictResolverModal=Backbone.View.extend({initialize:function(){this.model;this.clearTable(),$("#reSyncConflicts").click(function(){var a=$("#confictResolverTable input[type='radio']:checked");pm.mediator.trigger("conflictsResolved",a),$("#modal-conflict-resolver").modal("hide")})},clearTable:function(){$("#confictResolverTable>tbody").html("")},addRow:function(a){$("tr#conflictRow-"+a.model+"-"+a.model_id+"-"+a.key).remove(),$("#confictResolverTable>tbody").append(Handlebars.templates.conflict_resolver_row(a)),$("#"+a.model+"-"+a.model_id+"-"+a.key+"-server").data("change",_.cloneDeep(a.remoteChange)),$("#"+a.model+"-"+a.model_id+"-"+a.key+"-local").data("change",_.cloneDeep(a.localChange)),a.showRow===!1&&$("tr#conflictRow-"+a.model+"-"+a.model_id+"-"+a.key).hide()},getCount:function(){return $("tr.conflictRow").length},showModal:function(){$("#modal-conflict-resolver").modal()},initializeEditor:function(){this.editor}}),SyncStatusNotif=Backbone.View.extend({initialize:function(){var a=this.model;a.on("change:loggedIn",this.onChangeStatus,this),a.on("syncFinished",this.makeInSync,this),a.on("syncStarting",this.makeSyncing,this),pm.mediator.on("setSync",this.setSync,this),this.$icon=$("#sync-status-icon"),this.$text=$("#sync-status-text")},setSync:function(a){a?$("#sync-status").show():$("#sync-status").hide()},onChangeStatus:function(){this.model.get("loggedIn")===!0?this.model.get("syncFinished")===!0?this.makeInSync():this.makeSyncing():this.makeNotInSync()},makeInSync:function(){this.$icon.removeClass("notInSync").removeClass("syncing").addClass("inSync"),this.$text.html("In Sync")},makeNotInSync:function(){this.$icon.removeClass("inSync").removeClass("syncing").addClass("notInSync"),this.$text.html("Not in sync")},makeSyncing:function(){this.$icon.removeClass("inSync").addClass("syncing").removeClass("notInSync"),this.$text.html("Syncing...")}}),SyncStatusSidebar=Backbone.View.extend({initialize:function(){var a=this.model;a.on("notificationAdded",this.addNewNotif,this),a.on("removeOldestNotif",this.removeOldestNotif,this),a.on("updateNotifs",this.updateNotifs,this),a.on("removeAllNotifs",this.removeAllNotifs,this);var b=$("#syncstatus-items");b.html("")},addNewNotif:function(a){var b=$("#syncstatus-items");b.prepend(Handlebars.templates.syncstatus_item(a))},updateNotifs:function(a){var b=$("#syncstatus-items");b.html("");for(var c=a.length,d=0;c>d;d++)b.prepend(Handlebars.templates.syncstatus_item(a[d]))},removeOldestNotif:function(){var a=$("#syncstatus-items");a.children().last().remove()},removeAllNotifs:function(){var a=$("#syncstatus-items");a.children().remove()}}),TCPManager=Backbone.View.extend({initialize:function(){var a=this.model,b=this;a.on("change",this.render,this),pm.mediator.on("refreshCollections",this.renderTargetMenu,this),pm.mediator.on("showTCPManager",this.show,this),$("#modal-tcp-manager .nav li").on("click",function(){b.updateModel()}),$("#tcp-manager-save-filters").on("click",function(){b.updateModel(),pm.mediator.trigger("notifySuccess","Saved settings")}),$("#postman-proxy-target").on("change",function(){b.updateModel()}),$("#tcp-manager-connect-toggle").on("click",function(){var c=a.get("status");"connected"===c?(tracker.sendEvent("proxy","disconnect"),b.disconnect()):"disconnected"===c&&(tracker.sendEvent("proxy","connect"),b.connect())}),this.render()},updateModel:function(){var a=this.model,b=parseInt($("#postman-proxy-port").val(),10);a.set("host",$("#postman-proxy-host").val()),a.set("port",b);var c,d,e=$("#postman-proxy-target").val();"history"===e||"history_history"===e?(c="history",d="history"):(c="collection",d=e.split("_")[1]),a.set("target_type",c),a.set("target_id",d);var f={url:$("#postman-proxy-filter-url").val(),url_disabled:$("#postman-proxy-filter-url-disabled").val(),methods:$("#postman-proxy-filter-methods").val()};a.set("filters",f),a.save()},renderTargetMenu:function(){var a,b=this.model,c=pm.collections.getAllCollections();$("#postman-proxy-target").html("");var d={proxy_target_value:"history",name:"History",id:"history"};$("#postman-proxy-target").append(Handlebars.templates.item_tcp_reader_target(d));for(var e=0;e<c.length;e++)a=_.clone(c[e].toJSON()),a.proxy_target_value="collection",a.name="Collection: "+a.name,$("#postman-proxy-target").append(Handlebars.templates.item_tcp_reader_target(a));var f=b.get("target_type")+"_"+b.get("target_id");$("#postman-proxy-target").val(f)},connect:function(){this.updateModel(),this.model.connect(),$("#tcp-manager-connect-toggle").html("Disconnect")},disconnect:function(){this.model.disconnect(),$("#tcp-manager-connect-toggle").html("Connect")},render:function(){var a=this.model,b=a.get("status");"connected"===b?($("#modal-tcp-manager .status").html("Connected"),$("#modal-tcp-manager .status").addClass("status-connected"),$("#modal-tcp-manager .status").removeClass("status-disconnected"),$("#tcp-manager-connect-toggle").html("Disconnect")):"disconnected"===b&&($("#modal-tcp-manager .status").html("Disconnected"),$("#modal-tcp-manager .status").removeClass("status-connected"),$("#modal-tcp-manager .status").addClass("status-disconnected"),$("#tcp-manager-connect-toggle").html("Connect")),$("#postman-proxy-host").val(a.get("host")),$("#postman-proxy-port").val(a.get("port"));var c=a.get("target_type")+"_"+a.get("target_id");$("#postman-proxy-target").val(c);var d=a.get("filters");$("#postman-proxy-filter-url").val(d.url),$("#postman-proxy-filter-url-disabled").val(d.url_disabled),$("#postman-proxy-filter-methods").val(d.methods)},show:function(){$("#modal-tcp-manager").modal("show")}}),TCPReader=Backbone.Model.extend({defaults:function(){return{socketId:null,socketInfo:null,host:"127.0.0.1",port:"5005",target_type:"history",target_id:"",status:"disconnected",filters:{url:"",url_disabled:"",methods:"",status_codes:"",content_type:""}}},initialize:function(){var a=this;pm.storage.getValue("readerSettings",function(b){b&&(a.set("host",b.host),a.set("port",b.port),a.set("target_type",b.target_type),a.set("target_id",b.target_id),a.set("filters",b.filters))})},save:function(){var a={readerSettings:{host:this.get("host"),port:this.get("port"),target_type:this.get("target_type"),target_id:this.get("target_id"),filters:this.get("filters")}};pm.storage.setValue(a,function(){})},writeResponse:function(a,b){function c(a){d.readFromSocket(a.socketId)}var d=this,e=chrome.socket,f=stringToUint8Array(b),g=new ArrayBuffer(f.byteLength),h=new Uint8Array(g),i=this.get("socketInfo");h.set(f,0),e.write(a,g,function(){e.destroy(a),e.accept(i.socketId,c)})},isAllowed:function(a){function b(a){return a.trim().toUpperCase()}var c,d=this.get("filters"),e=d.methods.split(","),f=_.each(e,b),g=!0,h=!0,i=!0;return g=""===d.url?!0:a.url.search(d.url)>=0?!0:!1,h=""===d.url_disabled?!0:a.url.search(d.url_disabled)<0?!0:!1,i=f.length>0?_.indexOf(f,a.method.toUpperCase()):!0,c=i&&h&&g},addRequest:function(a){var b,c=JSON.parse(a),d=this.get("target_type");this.isAllowed(c)&&("history"===d?pm.history.addRequestFromJSON(a):(b=this.get("target_id"),pm.collections.addRequestToCollectionId(c,b)))},readFromSocket:function(a){var b=this,c=chrome.socket;c.read(a,function(c){try{var d=arrayBufferToString(c.data);b.addRequest(d),b.writeResponse(a,"received-request",!1)}catch(e){b.writeResponse(a,"received-request",!1)}})},onAccept:function(a){this.readFromSocket(a.socketId)},startListening:function(){function a(a){d.readFromSocket(a.socketId)}var b,c,d=this,e=chrome.socket,f=this.get("host"),g=this.get("port");chrome.socket.create("tcp",{},function(h){d.set("socketInfo",h),d.set("socketId",h.socketId),b=h,c=h.socketId,d.set("status","connected"),e.listen(b.socketId,f,g,50,function(){e.accept(b.socketId,a)})})},stopListening:function(){chrome.socket.destroy(this.get("socketId")),this.set("status","disconnected")},connect:function(){this.startListening()},disconnect:function(){this.stopListening()}}),TCPReaderStatus=Backbone.View.extend({initialize:function(){var a=this.model;a.on("change",this.render,this),$("#tcp-reader-status").on("click",function(){tracker.sendEvent("proxy","click"),pm.mediator.trigger("showTCPManager")})},render:function(){var a="Disconnected",b=this.model.get("status"),c=this.model;"connected"===b?(a="Connected to "+c.get("host")+":"+c.get("port"),$("#tcp-reader-status img").attr("src","img/v2/proxy_connected.png")):"disconnected"===b&&(a="Disconnected",$("#tcp-reader-status img").attr("src","img/v2/proxy.png")),$("#tcp-reader-status").attr("data-original-title",a)}}),TeamDirectoryCollection=Backbone.Model.extend({defaults:function(){return{id:"",collection_name:"",collection_id:"",collection_description:"",collection_owner_id:0,collection_owner_name:"",timestamp:0,updated_at:"",updated_at_formatted:""}}}),TeamDirectory=Backbone.Collection.extend({model:TeamDirectoryCollection,startId:0,endId:0,fetchCount:44,lastCount:0,totalCount:0,order:"descending",isInitialized:!1,reload:function(){this.startId=0,this.fetchCount=44,this.lastCount=0,this.totalCount=0,this.getTeamCollections()},comparator:function(a,b){var c=a.get("timestamp"),d=b.get("timestamp");return c>d},initialize:function(){pm.mediator.on("initializeTeamDirectory",this.onInitializeTeamDirectory,this),pm.mediator.on("getDirectoryCollection",this.onGetDirectoryCollection,this),pm.mediator.on("successfulSubscribe",this.onSuccessfulSubscribe,this),pm.mediator.on("successfulUnsubscribe",this.onSuccessfulUnsubscribe,this)},subscribeToCollection:function(a,b){this.where({collectionId:a});pm.syncManager.addChangeset("collection","subscribe",{collectionId:a,owner:b},a,!0)},unsubscribeFromCollection:function(a,b){pm.syncManager.addChangeset("collection","unsubscribe",{collectionId:a,owner:b},a,!0);pm.collections.deleteCollectionFromDataStoreWithOptSync(a,!0,!1,function(){})},onSuccessfulSubscribe:function(a){if(a.data&&a.data.model_id){var b=this.get(a.data.model_id);b.set("canSubscribeTo",!1),this.set(b,{remove:!1}),this.trigger("subscribedTo",a.data.model_id)}},onSuccessfulUnsubscribe:function(a){if(a.data&&a.data.model_id){var b=this.get(a.data.model_id);b&&(b.set("canSubscribeTo",!0),this.set(b,{remove:!1}),this.trigger("unsubscribedFrom",a.data.model_id))}},onInitializeTeamDirectory:function(){this.isInitialized||(this.isInitialized=!0),this.getTeamCollections(),this.getTeamMembers()},onGetDirectoryCollection:function(a){this.downloadCollection(a)},loadNext:function(){this.getCollections(this.endId,this.fetchCount,"descending")},loadPrevious:function(){this.getCollections(this.startId,this.fetchCount,"ascending")},getTeamCollections:function(){var a=this;a.trigger("loading");var b=pm.user.get("organizations");if(b.length<=0)return console.log("You are not a member of a team"),void a.reset();var c=b[0].id;pm.api.getTeamCollections(pm.user.id,pm.user.get("access_token"),c,function(b){if(b.collections){$("#team-dir-loading").remove();var c=b.collections;if(c.error)return void console.log("Collections could not be added. Reason: "+c.result);a.reset();var d=_.map(c,function(a){return-1!==a.id.indexOf("#")&&(a.id=a.id.substring(a.id.indexOf("#")+1)),a.canSubscribeTo=pm.subscriptionManger.isSubscribedTo(a.id)?!1:!0,a.isOwn=!1,pm.user.id===a.owner.id&&(a.canSubscribeTo=!1,a.isOwn=!0),a});a.add(d,{merge:!0})}},function(){$("#team-dir-loading").remove()})},getTeamMembers:function(){},downloadCollection:function(a){var b=pm.user.getRemoteIdForLinkId(a);b?pm.user.downloadSharedCollection(b,function(){pm.mediator.trigger("notifySuccess","Downloaded collection")}):pm.api.downloadDirectoryCollection(a,function(a){try{var b=a;pm.mediator.trigger("notifySuccess","Downloaded collection"),pm.mediator.trigger("addDirectoryCollection",b)}catch(c){pm.mediator.trigger("notifyError","Failed to download collection"),pm.mediator.trigger("failedCollectionImport")}})}}),TeamDirectoryBrowser=Backbone.View.extend({initialize:function(){var a=this.model,b=this;this.directoryCollectionViewer=new TeamDirectoryCollectionViewer({model:this.model}),a.on("add",this.addDirectoryCollection,this),a.on("loading",this.showLoadingText,this),a.on("remove",this.removeDirectoryCollection,this),a.on("reset",this.render,this),a.on("subscribedTo",this.onSubscribedTo,this),a.on("unsubscribedFrom",this.onUnsubscribedFrom,this),pm.mediator.on("isTeamMember",this.showTeamLink,this),$(".team-directory-browser-header").on("click",function(){}),$("#team-directory-collections").on("click",".directory-collection-action-view",function(){var c=$(this).attr("data-id"),d=a.get(c);b.directoryCollectionViewer.showCollection(d)}),$("#team-directory-collections").on("click",".team-directory-collection-action-subscribe",function(){{var b=$(this).attr("data-id"),c=$(this).attr("data-owner-id");$(this)}a.subscribeToCollection(b,c),$(this).html("Subscribing...").attr("disabled","disabled")}),$("#team-directory-collections").on("click",".team-directory-collection-action-unsubscribe",function(){var b=$(this).attr("data-id"),c=$(this).attr("data-owner-id");$(this).html("Unubscribing...").attr("disabled","disabled"),a.unsubscribeFromCollection(b,c)}),$(".team-directory-browser-navigator-next").on("click",function(){$(this).hasClass("disabled")||a.loadNext()}),$(".team-directory-browser-navigator-previous").on("click",function(){$(this).hasClass("disabled")||a.loadPrevious()}),window.onresize=function(){$("#team-directory-browser").css("max-height",window.innerHeight-80+"px")},$("#team-directory-browser").css("max-height",window.innerHeight-80+"px")},render:function(){$("#team-directory-collections tbody").html("")},renderNavigator:function(){{var a=this.model;a.startId,a.length}a.lastCount<a.fetchCount?($(".directory-browser-navigator-next").removeClass("enabled"),$(".directory-browser-navigator-next").addClass("disabled")):($(".directory-browser-navigator-next").removeClass("disabled"),$(".directory-browser-navigator-next").addClass("enabled")),a.totalCount<=a.fetchCount?($(".directory-browser-navigator-previous").removeClass("enabled"),$(".directory-browser-navigator-previous").addClass("disabled")):($(".directory-browser-navigator-previous").removeClass("disabled"),$(".directory-browser-navigator-previous").addClass("enabled"));var b=a.totalCount-a.lastCount+1;0>b&&(b=1);var c=a.totalCount;$(".directory-browser-navigator-status .start").html(b),$(".directory-browser-navigator-status .end").html(c)},showTeamLink:function(a){a?$("#team-directory-opener").show():$("#team-directory-opener").hide()},showLoadingText:function(){$("#team-dir-loading").remove(),$("#team-directory-collections").before('<h4 style="text-align: center" id="team-dir-loading"><span class="label label-important">Loading team collections...</span></h4>')},addDirectoryCollection:function(a){this.renderNavigator();var b=_.clone(a.toJSON());b.description||(b.description=""),$("#team-dir-loading").remove(),b.updated_at_formatted=$.timeago(b.updatedAt),$("#team-directory-collections tbody").append(Handlebars.templates.item_team_directory_collection(b))},removeDirectoryCollection:function(){this.renderNavigator()},onSubscribedTo:function(a){var b=$("#team-directory-collection-"+a);b.find(".team-directory-collection-action-subscribe").removeClass("team-directory-collection-action-subscribe").removeClass("btn-primary").addClass("team-directory-collection-action-unsubscribe").addClass("btn-danger").html("Unsubscribe").removeAttr("disabled")},onUnsubscribedFrom:function(a){var b=$("#team-directory-collection-"+a);b.find(".team-directory-collection-action-unsubscribe").removeClass("team-directory-collection-action-unsubscribe").removeClass("btn-danger").addClass("team-directory-collection-action-subscribe").addClass("btn-primary").html("Subscribe").removeAttr("disabled")}}),TeamDirectoryCollectionViewer=Backbone.View.extend({initialize:function(){this.model;$("#team-directory-collection-viewer").on("click",".btn-primary",function(){var a=$(this).attr("data-link-id");pm.mediator.trigger("getTeamDirectoryCollection",a)})},showCollection:function(a){$("#team-directory-collection-viewer-name").html(a.get("name")),$("#team-directory-collection-viewer-user-name").html(a.get("user_name")),a.get("description")||a.set("description",""),$("#team-directory-collection-viewer-description").html(markdown.toHTML(a.get("description"))),$("#team-directory-collection-viewer-updated-at").html("Last updated: "+a.get("updated_at_formatted")),$("#directory-collection-viewer-download").attr("data-id",a.get("id")),$("#directory-collection-viewer-download").attr("data-link-id",a.get("link_id")),$("#directory-collection-viewer").modal("show")}}),PreRequestScripter=Backbone.Model.extend({defaults:function(){return{sandbox:null}},runPreRequestScript:function(a,b,c,d){$("#prscript-error").hide();var e=a.get("preRequestScript"),f="(function(){";f+=e,f+="\n})()",e&&e.length>1&&pm.tracker.trackEvent("request","pre_request_script","execute");var g=pm.envManager.get("selectedEnv"),h={},i=getKeyValPairsAsAssociativeArray(pm.envManager.get("globals").get("globals"));g&&(h=getKeyValPairsAsAssociativeArray(g.toJSON().values));var j={request:a.getForPrscript(),environment:h,globals:i};this.postCode(f,j),this.listenToOnce(pm.mediator,"resultReceivedPrscript",function(a){d&&d(a,"result")}),this.listenToOnce(pm.mediator,"resultErrorPrscript",function(a){this.showPreRequestScriptError(a)})},postCode:function(a,b){var c=this.get("sandbox"),d={command:"runprscript",code:a,environment:b,scriptType:"prscript"};c.contentWindow.postMessage(d,"*")},initialize:function(){var a=document.getElementById("tester_sandbox");this.set("sandbox",a),window.addEventListener("message",function(a){a.data.type;"resultReceivedPrscript"===a.data.type&&pm.mediator.trigger("resultReceivedPrscript",a.data.result),"resultErrorPrscript"===a.data.type&&pm.mediator.trigger("resultErrorPrscript",a.data.errorMessage)}),pm.mediator.on("runPreRequestScript",this.runPreRequestScript,this),pm.mediator.on("resultErrorPrscript",this.showPreRequestScriptError,this)},showPreRequestScriptError:function(a){window.hasOwnProperty("TestRun")?(clearTimeout(pm.globalPrScriptNotif),pm.globalPrScriptNotif=setTimeout(function(){pm.mediator.trigger("notifyError","Something is wrong with your Pre-request scripts. Please fix them in the editor first. Message: "+a),$("a#new-test-run").click()},500)):$("#prscript-error").show().html("There was an error evaluating the Pre-request script. "+a).css("display","inline-block")}}),TestPurchaser=Backbone.View.extend({initialize:function(){var a=this;pm.mediator.on("startPurchaseFlow",this.onStartPurchaseFlow,this),this.purchaserView=new TestPurchaserWebView,pm.mediator.on("closeTestPurchaser",this.onCloseTestPurchaser,this),pm.mediator.on("purchaseComplete",this.onPurchaseComplete,this),$("#modal-test-purchaser").on("shown",function(){pm.app.trigger("modalOpen","#modal-test-purchaser")}),$("#modal-test-purchaser").on("hidden",function(){pm.app.trigger("modalClose")}),pm.mediator.on("onMessageExternal",function(a,b,c){a&&a.postmanMessage&&"purchase"===a.postmanMessage.type&&(tracker.sendEvent("test_runner","collection_runner","purchase_complete"),pm.mediator.trigger("purchaseComplete",a.postmanMessage.purchase),c({result:"success"}),$("#modal-jetpacks-about").modal("hide"),$("#modal-jetpacks-intro").modal("show"))}),$("body").on("click",".buy-jetpacks",function(){a.purchase()}),$("body").on("click",".try-jetpacks",function(){a.startTrial()})},onCloseTestPurchaser:function(){$("#modal-test-purchaser").modal("hide")},onPurchaseComplete:function(a){"collection-runner"===a.id},startTrial:function(){pm.mediator.trigger("startTrial","collection-runner"),$("#modal-jetpacks-about").modal("hide")},purchase:function(){pm.mediator.trigger("onStartPurchase","collection-runner");var a=pm.webUrl+"/buy/jetpacks";a+="?key=collection-runner",a+="&is_beta="+pm.arePurchasesInBeta,a+="&user_id="+pm.user.get("id"),a+="&access_token="+pm.user.get("access_token"),a+="&random="+Math.random(),a+="&ga_client_id="+pm.gaClientId,a+="&app_name="+app_name,a+="&app_version="+chrome.runtime.getManifest().version,a+="&tracker_id="+tracker_id,window.open(a)},onStartPurchaseFlow:function(){pm.purchases.isTrialCompleted("collection-runner")&&$("#modal-jetpacks-about .try-jetpacks").remove(),$("#modal-jetpacks-about").modal("show")}}),TestPurchaserWebView=Backbone.View.extend({initialize:function(){this.model;this.webview=document.getElementById("test-purchaser-webview"),this.webview.addEventListener("loadstart",this.onLoadStart),this.webview.addEventListener("loadstop",this.onLoadStop),window.addEventListener("message",function(a){a.hasOwnProperty("data")&&("purchase"===a.data.message_type?(tracker.sendEvent("test_runner","collection_runner","purchase_complete"),pm.mediator.trigger("purchaseComplete",a.data.purchase)):"token"===a.data.message_type?(tracker.sendEvent("user","login","purchase"),pm.mediator.trigger("receiveTokenFromPurchaseFlow",a.data.token)):"finish_purchase"==a.data.message_type&&pm.mediator.trigger("closeTestPurchaser"))}),this.webview.addEventListener("newwindow",function(a){var b=a.targetUrl,c=document.createElement("a");c.href=b,c.target="_blank",c.click()}),this.webview.addEventListener("contentload",function(){event.target.contentWindow.postMessage({},"*")})},onContentLoad:function(){},onLoadStart:function(){$("#modal-test-purchaser .preloader").css("display","inline-block")},onLoadStop:function(a){$("#modal-test-purchaser .preloader").css("display","none"),a.target.executeScript({code:"document.innerHTML = 'blah';"})},loadUrl:function(a){this.webview.src=a}}),TestResultViewer=Backbone.View.extend({initialize:function(){var a=this.model;a.on("change:testResults",this.renderResults,this),a.on("change:testErrors",this.renderErrors,this),$("#response-tests").on("click",".know-more-collection-runner",function(){tracker.sendEvent("test_runner","know_more","test_result_viewer"),pm.mediator.trigger("startPurchaseFlow","test_runner")})},renderErrors:function(a){pm.purchases.isUpgradeAvailable("collection-runner")?a.get("testErrors")&&($("#response-tests").html("<h4>Test script execution failed</h4><h5>Error message:</h5>"),$("#response-tests").append("<span class='test-error'>"+a.get("testErrors")+"</span>")):this.renderPurchaseMessage()},renderPurchaseMessage:function(){$("#response-tests").html(Handlebars.templates.purchase_message_collection_runner({})),$("#response-tests .try-jetpacks").remove()},renderResults:function(){if(pm.purchases.isUpgradeAvailable("collection-runner")){var a=this.model.get("testResults");if(null===a)return $('.response-tabs li[data-section="tests"]').html("Tests (0/0)"),void $("#response-tests").html("");var b,c=0,d=0,e=0,f=[];for(var g in a)a.hasOwnProperty(g)&&(b=a[g]?"pass":"fail",f.push({key:g,value:b}),a[g]?c+=1:d+=1,e+=1);$('.response-tabs li[data-section="tests"]').css("display","block"),$('.response-tabs li[data-section="tests"]').html("Tests ("+c+"/"+e+")"),$("#response-tests").html(Handlebars.templates.response_tests({items:f}))}else this.renderPurchaseMessage()}}),Tester=Backbone.Model.extend({defaults:function(){return{sandbox:null}},runTest:function(a,b,c,d){$("#test-error").hide();var e=a.get("tests"),f="(function(){var tests={};";f+=e,f+="\nreturn tests;})()";var g=a.get("response"),h=pm.envManager.get("selectedEnv"),i={},j=getKeyValPairsAsAssociativeArray(pm.envManager.get("globals").get("globals"));h&&(i=getKeyValPairsAsAssociativeArray(h.toJSON().values));var k={request:a.getForTester(),responseBody:g.get("text"),responseHeaders:g.getHeadersAsKvPairs(),responseTime:g.get("time"),responseCookies:g.get("cookies"),responseCode:g.get("responseCode"),environment:i,globals:j,data:b,iteration:c};this.postCode(f,k),this.listenToOnce(pm.mediator,"resultReceived",function(a){d&&d(a,"result")}),this.listenToOnce(pm.mediator,"resultError",function(a){d&&d(a,"error")})},postCode:function(a,b){var c=this.get("sandbox"),d={command:"runtest",code:a,environment:b,scriptType:"test"};c.contentWindow.postMessage(d,"*")},initialize:function(){var a=document.getElementById("tester_sandbox");this.set("sandbox",a),window.addEventListener("message",function(a){var b=a.data.type;if("test_result"===a.data.type){pm.mediator.trigger("resultReceived",a.data.result);var c=_.size(a.data.result);pm.tracker.trackEvent("request","test","execute",c)}"test_error"===a.data.type&&"test"==a.data.scriptType?pm.mediator.trigger("resultError",a.data.errorMessage):"set_environment_variable"===b?pm.mediator.trigger("setEnvironmentVariable",a.data.variable):"set_global_variable"===b?pm.mediator.trigger("setGlobalVariable",a.data.variable):"clear_environment_variables"===b?pm.mediator.trigger("clearEnvironmentVariables"):"clear_global_variables"===b&&pm.mediator.trigger("clearGlobalVariables")}),pm.mediator.on("resultError",this.showTestScriptError,this),pm.mediator.on("runRequestTest",this.runTest,this)},showTestScriptError:function(a){$("#test-error").show().html("There was an error evaluating the test script. "+a).css("display","inline-block")}}),ThemeManager=Backbone.Model.extend({defaults:function(){return{theme:"light",bootstrap_theme:"default",codemirror_theme:"eclipse"}},initialize:function(){console.log("Initialized ThemeManager"),pm.mediator.on("switchTheme",this.onSwitchTheme,this),this.initializeTheme()},initializeTheme:function(){var a=pm.settings.getSetting("postmanTheme");this.switchTheme(a)},getCodeMirrorTheme:function(){return this.get("codemirror_theme")},addStylesheet:function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("link");d.id=a,d.rel="stylesheet",d.type="text/css",d.href=b,d.media="all",c.appendChild(d)},onSwitchTheme:function(a){this.switchTheme(a)},switchTheme:function(a){$(".postman-navbar").css("display","none"),$("#container").css("display","none"),$(".tooltip").css("display","none"),"light"===a?(this.set("theme",a),this.set("bootstrap_theme","default"),this.set("codemirror_theme","eclipse"),$('link[rel=stylesheet][href~="css/bootstrap-modal.css"]').remove(),this.addStylesheet("bootstrap-modal","css/bootstrap-modal.css"),this.addStylesheet("postman-theme-light","css/requester/styles.css"),this.addStylesheet("postman-theme-light-test","css/test_runner/styles.css"),$('link[rel=stylesheet][href~="css/bootstrap-slate.min.css"]').remove(),$('link[rel=stylesheet][href~="css/bootstrap-slate.mod.css"]').remove(),$('link[rel=stylesheet][href~="css/requester/styles.dark.css"]').remove(),$('link[rel=stylesheet][href~="css/test_runner/styles.dark.css"]').remove(),pm.settings.setSetting("postmanTheme","light"),pm.settings.setSetting("postmanCodeMirrorTheme","clouds")):(this.set("theme",a),this.set("bootstrap_theme","slate"),this.set("codemirror_theme","dark"),$('link[rel=stylesheet][href~="css/bootstrap-modal.css"]').remove(),this.addStylesheet("bootstrap-slate","css/bootstrap-slate.min.css"),this.addStylesheet("bootstrap-slate-mod","css/bootstrap-slate.mod.css"),this.addStylesheet("bootstrap-modal","css/bootstrap-modal.css"),this.addStylesheet("postman-theme-dark","css/requester/styles.dark.css"),this.addStylesheet("postman-theme-dark-test-runner","css/test_runner/styles.dark.css"),$('link[rel=stylesheet][href~="css/requester/styles.css"]').remove(),$('link[rel=stylesheet][href~="css/test_runner/styles.css"]').remove(),pm.mediator.trigger("switchCodeMirrorTheme","monokai"),pm.settings.setSetting("postmanTheme","dark"),pm.settings.setSetting("postmanCodeMirrorTheme","monokai")),setTimeout(function(){$(".postman-navbar").fadeIn(),$("#container").fadeIn(),$(".tooltip").css("display","none"),"light"===a?pm.mediator.trigger("switchCodeMirrorTheme","eclipse"):pm.mediator.trigger("switchCodeMirrorTheme","monokai")},500)}}),DeleteUserCollectionModal=Backbone.View.extend({initialize:function(){$("#modal-delete-user-collection-yes").on("click",function(){var a=$(this).attr("data-collection-id");pm.mediator.trigger("deleteSharedCollection",a)}),$("#modal-delete-user-collection").on("shown",function(){pm.app.trigger("modalOpen","#modal-delete-user-collection")}),$("#modal-delete-user-collection").on("hidden",function(){pm.app.trigger("modalClose")}),pm.mediator.on("confirmDeleteSharedCollection",this.render,this)},render:function(a){$("#modal-delete-user-collection-yes").attr("data-collection-id",a),$("#modal-delete-user-collection").modal("show")}}),User=Backbone.Model.extend({defaults:function(){return{id:0,name:"",access_token:"",refresh_token:"",expires_in:0,logged_in_at:0,link:"",expiredToken:!0,collections:[],organizations:[],syncEnabled:!1,syncInvited:!1,baseEulaAccepted:!1}},setDefaults:function(){this.set("id",0),this.set("name",""),this.set("access_token",""),this.set("refresh_token",""),this.set("expires_in",0),this.set("link",""),this.set("baseEulaAccepted",!1),this.set("syncEnabled",!1),this.set("syncInvited",!1),pm.features.isFeatureEnabled(FEATURES.USER)&&pm.storage.setValue({user:this.toJSON()},function(){})},initialize:function(){var a=this;pm.storage.getValue("user",function(b){if(b){a.set("id",b.id),a.set("name",b.name),a.set("access_token",b.access_token),a.set("refresh_token",b.refresh_token),a.set("syncInvited",b.syncInvited),a.set("syncEnabled",b.syncEnabled),a.set("baseEulaAccepted",b.baseEulaAccepted);var c=parseInt(b.expires_in,10);a.set("expires_in",c),a.set("logged_in_at",b.logged_in_at);
var d=a.isTokenValid();d?a.set("expiredToken",!1):a.set("expiredToken",!0),pm.features.isFeatureEnabled(FEATURES.USER)&&0!==b.id&&(d=!1,d?(a.getCollections(function(){a.getPurchases(),a.getOrganizations(),a.setupSync(),a.checkBaseEula()}),a.trigger("login",a)):pm.api.exchangeRefreshToken(function(){a.set("expiredToken",!1),a.getCollections(function(){a.getPurchases(),a.getOrganizations(),a.setupSync(),a.checkBaseEula()}),a.trigger("login",a)}))}}),pm.mediator.on("receiveTokenFromPurchaseFlow",this.receiveTokenFromPurchaseFlow,this),pm.mediator.on("refreshSharedCollections",this.getCollections,this),pm.mediator.on("downloadSharedCollection",this.onDownloadSharedCollection,this),pm.mediator.on("deleteSharedCollection",this.onDeleteSharedCollection,this),pm.mediator.on("invalidAccessToken",this.onTokenNotValid,this),pm.mediator.on("downloadAllSharedCollections",this.onDownloadAllSharedCollections,this),pm.mediator.on("onMessageExternal",function(a,b,c){a&&a.postmanMessage&&"token"===a.postmanMessage.type&&(pm.mediator.trigger("receiveTokenFromPurchaseFlow",a.postmanMessage.token),c({result:"success"}))})},isTokenValid:function(){var a=this.get("expires_in"),b=this.get("logged_in_at"),c=(new Date).getTime();return b+a>c?!0:!1},onTokenNotValid:function(){},isLoggedIn:function(){return 0!==this.get("id")&&this.get("expiredToken")!==!0},setAccessToken:function(a){var b=this,c=parseInt(a.expires_in,10);b.set("access_token",a.access_token),b.set("refresh_token",a.refresh_token),b.set("expires_in",c),b.set("logged_in_at",(new Date).getTime()),b.set("expiredToken",!1),b.set("syncInvited",1==a.syncInvited),b.set("syncEnabled",1==a.syncEnabled),pm.mediator.trigger("setSync",b.get("syncEnabled")),b.set("baseEulaAccepted",1==a.baseEulaAccepted),pm.storage.setValue({user:b.toJSON()},function(){})},setSyncEnabled:function(a){var b=this;b.set("syncEnabled",a),pm.storage.setValue({user:b.toJSON()},function(){})},setBaseEulaAccepted:function(a){var b=this;b.set("baseEulaAccepted",a),pm.storage.setValue({user:b.toJSON()},function(){})},getRemoteIdForCollection:function(a){var b=this.get("collections"),c=arrayObjectIndexOf(b,a,"id");return c>=0?b[c].remote_id:0},login:function(){var a=this,b=chrome.runtime.id;chrome.identity.launchWebAuthFlow({url:pm.webUrl+"/signup?appId="+b,interactive:!0},function(b){if(chrome.runtime.lastError)a.trigger("logout",a),pm.mediator.trigger("notifyError","Could not initiate login flow. Please ensure network connectivity.");else{var c=getUrlVars(b,!0);a.set("syncEnabled",pm.settings.getSetting("enableSync")),pm.mediator.trigger("setSync",a.get("syncEnabled")),a.set("id",c.user_id),a.set("name",decodeURIComponent(c.name)),a.set("access_token",decodeURIComponent(c.access_token)),a.set("refresh_token",decodeURIComponent(c.refresh_token)),a.set("expires_in",parseInt(c.expires_in,10)),a.set("logged_in_at",(new Date).getTime()),a.set("expiredToken",!1),a.set("syncInvited","1"==c.sync_invited),a.set("syncEnabled","1"==c.sync_enabled),a.set("baseEulaAccepted","1"==c.base_eula_accepted),pm.mediator.trigger("setSync",a.get("syncEnabled")),pm.storage.setValue({user:a.toJSON()},function(){}),a.getCollections(),a.getPurchases(),a.getOrganizations(),a.setupSync(),a.checkBaseEula(),tracker.sendEvent("user","login","header"),a.trigger("login",a)}})},receiveTokenFromPurchaseFlow:function(a){var b=this;b.set("id",a.user_id),b.set("name",a.name),b.set("access_token",a.access_token),b.set("refresh_token",a.refresh_token),b.set("syncInvited",1==a.syncInvited),b.set("syncEnabled",1==a.syncEnabled),pm.mediator.trigger("setSync",b.get("syncEnabled")),b.set("expires_in",parseInt(a.expires_in,10)),b.set("logged_in_at",(new Date).getTime()),b.set("baseEulaAccepted","1"==a.baseEulaAccepted),pm.storage.setValue({user:b.toJSON()},function(){}),b.getCollections(),b.getPurchases(),b.getOrganizations(),b.setupSync(),b.checkBaseEula(),b.trigger("login",b)},logout:function(){var a=this;pm.api.logoutUser(this.get("id"),this.get("access_token"),function(){a.setDefaults(),pm.settings.setSetting("syncInviteEnabled",!1),pm.settings.setSetting("syncInviteShown",!1),pm.settings.setSetting("enableSync",!1),pm.settings.setSetting("syncedOnce",!1),pm.mediator.trigger("showEnableSyncButton"),$("#user-status-not-logged-in").html("Log in"),$("#sync-status").hide(),a.trigger("onLogout"),pm.syncManager.signOut(),pm.mediator.trigger("isTeamMember",!1)}),pm.tracker.trackEvent("account","sign_out")},getCollections:function(a){var b=this;this.isLoggedIn()&&pm.api.getUserCollections(function(d){if(d.hasOwnProperty("collections")){for(var e=0;e<d.collections.length;e++)c=d.collections[e],c.is_public="1"===c.is_public?!0:!1,c.updated_at_formatted=new Date(c.updated_at).toDateString();b.set("collections",d.collections),b.trigger("change:collections"),"function"==typeof a&&a()}})},getPurchases:function(){this.isLoggedIn()&&pm.api.getUserPurchases(function(a){a.hasOwnProperty("purchases")&&pm.mediator.trigger("loadedPurchasesFromServer",a)})},getOrganizations:function(){var a=this;this.isLoggedIn()&&pm.api.getUserOrganizations(function(b){b.hasOwnProperty("organizations")&&b.organizations.length>0?(a.set("organizations",b.organizations),a.get("syncEnabled")?pm.mediator.trigger("isTeamMember",!0):pm.mediator.trigger("isTeamMember",!1)):(a.set("organizations",[]),pm.mediator.trigger("isTeamMember",!1))})},isTeamMember:function(){var a=this.get("organizations");return 0===a.length?!1:!0},onDeleteSharedCollection:function(a){var b=this;pm.api.deleteSharedCollection(a,function(){var c=b.get("collections"),d=arrayObjectIndexOf(c,a,"id"),e=_.clone(c[d]);d>=0&&c.splice(d,1),pm.mediator.trigger("deletedSharedCollection",e),b.trigger("change:collections")})},downloadSharedCollection:function(a,b){pm.api.getCollectionFromRemoteId(a,function(a){pm.mediator.trigger("overwriteCollection",a),pm.mediator.trigger("notifySuccess","Downloaded collection: "+a.name),b&&b()})},onDownloadSharedCollection:function(a){this.downloadSharedCollection(a),pm.tracker.trackEvent("collection","import","download")},onDownloadAllSharedCollections:function(){for(var a=this.get("collections"),b=0;b<a.length;b++)this.downloadSharedCollection(a[b].remote_id);pm.tracker.trackEvent("collection","import","download_all",a.length)},getRemoteIdForLinkId:function(a){var b=pm.webUrl+"/collections/"+a,c=this.get("collections"),d=arrayObjectIndexOf(c,b,"link");return d>=0?c[d].remote_id:0},setupSync:function(){var a=this;return pm.mediator.trigger("notifyVersionUpdate"),a.get("syncEnabled")?(pm.settings.setSetting("enableSync",!0),void pm.mediator.trigger("setSync",!0)):!a.get("syncInvited")||a.get("syncEnabled")||pm.settings.getSetting("syncInviteShown")?a.get("syncInvited")&&pm.settings.getSetting("syncInviteEnabled")&&!pm.settings.getSetting("enableSync")?void pm.mediator.trigger("showEnableSyncButton"):void 0:(pm.mediator.trigger("showSyncInvitePopup"),pm.settings.setSetting("syncInviteShown",!0),void pm.tracker.forceTrackEvent("sync","view","launch_modal"))},checkBaseEula:function(){return}}),UserCollections=Backbone.View.extend({initialize:function(){var a=this.model;a.on("login",this.render,this),a.on("logout",this.render,this),a.on("change:collections",this.render,this);new DeleteUserCollectionModal;$("#user-collections-actions-upload-all").on("click",function(){pm.mediator.trigger("uploadAllLocalCollections")}),$("#user-collections-actions-download-all").on("click",function(){pm.mediator.trigger("downloadAllSharedCollections")}),$("#user-collections-list").on("click",".user-collection-action-download",function(){var a=parseInt($(this).attr("data-remote-id"),10);pm.mediator.trigger("downloadSharedCollection",a)}),$("#user-collections-list").on("click",".user-collection-action-delete",function(){var a=$(this).attr("data-id");pm.mediator.trigger("confirmDeleteSharedCollection",a)}),this.render()},render:function(){var a=this.model.get("id"),b=(this.model.get("name"),this.model.get("expiredToken"));0!==a&&b===!1?(pm.syncManager.signIn(),$("#user-collections-list tbody").html(""),$("#user-collections-list tbody").append(Handlebars.templates.user_collections_list({items:this.model.get("collections")}))):(pm.syncManager.signOut(),$("#user-collections-list tbody").html(""))}}),UserStatus=Backbone.View.extend({initialize:function(){var a=this,b=this.model;b.on("login",this.render,this),b.on("onLogout",this.render,this),$("#user-status-shared-collections").on("click",function(){return $("#modal-user-collections").modal("show"),pm.tracker.trackEvent("account","my_collections"),!1}),$("#user-status-not-logged-in").on("click",function(){return $("#user-status-not-logged-in").html("Loading..."),b.login(),!1}),$("#user-status-manage-profile").on("click",function(){return a.openProfile(),pm.tracker.trackEvent("account","manage_profile"),!1}),$("#user-status-logout").on("click",function(){return b.trigger("logout",{message:"Manual logout"}),!1}),this.render()},openProfile:function(){var a=pm.webUrl+"/signin-client";a+="?user_id="+pm.user.get("id"),a+="&access_token="+pm.user.get("access_token"),window.open(a)},render:function(){pm.features.isFeatureEnabled(FEATURES.USER)&&$("#user-status").css("display","block");var a=this.model.get("id"),b=this.model.get("name"),c=this.model.get("expiredToken");$("#user-status-not-logged-in").tooltip(),0!==a&&c===!1?($("#user-status-false").css("display","none"),$("#user-status-true").css("display","block"),$("#user-status-username").html(b),$("#share-collection-team-directory-features").show()):($("#user-status-not-logged-in").html("Sign in"),$("#user-status-false").css("display","block"),$("#user-status-true").css("display","none"),$("#user-status-username").html(""),$("#share-collection-team-directory-features").hide())}}),UserSyncDataDeleteModal=Backbone.View.extend({initialize:function(){var a=this.model;a.on("logout",this.onLogout,this),$("#modal-syncdata-delete-yes").on("click",function(){pm.mediator.trigger("deleteSyncedData"),$("#request-actions-reset").click(),a.logout(),$("#modal-syncdata-delete").modal("hide")}),$("#modal-syncdata-delete-no").on("click",function(){$("#modal-syncdata-delete").modal("hide")})},onLogout:function(a){if(this.model.get("syncEnabled")){if("Manual logout"===a.message){var b=pm.localChanges.get("unsyncedChanges"),c="";b&&b.length>0&&(c="You currently have unsynced changes. If you choose to delete your data, these changes will be lost"),$("#modal-syncdata-warning").html(c),$("#modal-syncdata-delete").modal("show")}}else this.model.logout()}}),UserUnsyncedDataDeleteModal=Backbone.View.extend({initialize:function(){this.model;pm.mediator.on("showUnsyncedDeletetionModal",this.showModal,this),$("#modal-unsynced-delete-yes").on("click",function(){pm.mediator.trigger("deleteUnsyncedData"),$("#modal-unsynced-delete").modal("hide")})},showModal:function(){$("#modal-unsynced-delete").modal("show")}}),Tracker=Backbone.Model.extend({defaults:function(){return{}},initialize:function(){pm.mediator.once("onTrialStart",this.onTrialStart,this),pm.mediator.once("onTrialEnd",this.onTrialEnd,this),pm.mediator.on("onStartPurchase",this.onStartPurchase,this),pm.appWindow.trigger("registerInternalEvent","test_runner_event",this.onAddTestRunnerEvent,this)},onAddTestRunnerEvent:function(a){this.trackEvent(a.category,a.action,a.label,a.value)},onStartPurchase:function(){tracker&&tracker.sendEvent("test_runner","collection_runner","buy")},onTrialStart:function(){tracker&&tracker.sendEvent("test_runner","collection_runner","trial_start")},onTrialEnd:function(){tracker&&(console.log("trial_end event fired"),tracker.sendEvent("test_runner","collection_runner","trial_end"))},trackEvent:function(a,b,c,d){return pm.syncManager?void(pm.syncManager.syncEnabled&&this.forceTrackEvent(a,b,c,d)):void chrome.runtime.sendMessage({id:pm.appWindow.get("id"),event:"test_runner_event",object:{category:a,action:b,label:c,value:d}})},forceTrackEvent:function(a,b,c,d){tracker&&(d?tracker.sendEvent(a,b,c,d):c?tracker.sendEvent(a,b,c):tracker.sendEvent(a,b))}});